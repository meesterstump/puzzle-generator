import{m as Y,g as Jr,a as go}from"./mithril-BiGTF_x2.js";import{r as mo}from"./webawesome-7D1rN-GI.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))h(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&h(d)}).observe(document,{childList:!0,subtree:!0});function s(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function h(c){if(c.ep)return;c.ep=!0;const o=s(c);fetch(c.href,o)}})();const vo={view:({attrs:u})=>Y("a.github-corner",{href:u.link,"aria-label":"View source on GitHub",title:"View source on GitHub",target:"_blank"},Y("svg",{width:80,height:80,viewBox:"0 0 250 250","aria-hidden":"true"},[Y("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),Y("path.octo-arm",{fill:"currentColor",style:"transform-origin: 130px 106px;",d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"}),Y("path.octo-body",{fill:"currentColor",d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"})]))},_o={view:()=>{const u=Y.route.get();return Y("nav.navigation",[Y("div.nav-links",Y("wa-radio-group",{orientation:"horizontal",value:u,onchange:a=>{a.redraw=!1;const s=a.target;Y.route.set(String(s.value))}},[Y("wa-radio",{appearance:"button",value:"/puzzle"},"Puzzle Generator"),Y("wa-radio",{appearance:"button",value:"/puzzle-paper"},"Puzzle (Paper.js)"),Y("wa-radio",{appearance:"button",value:"/test"},"Test Harness"),Y("wa-radio",{appearance:"button",value:"/townscaper-debug"},"Townscaper Debug")]))])}};class lr{generators=new Map;register(a,s,h){this.generators.has(a)&&console.warn(`Generator "${a}" is already registered, overwriting`),this.generators.set(a,{factory:s,uiMetadata:h})}create(a,s,h){const c=this.generators.get(h.name);if(!c)throw new Error(`Unknown generator "${h.name}". Is it registered?`);return c.factory(a,s,h)}getAvailableGenerators(){return Array.from(this.generators.values()).sort((a,s)=>a.uiMetadata.sortHint-s.uiMetadata.sortHint).map(a=>({name:a.uiMetadata.name,displayName:a.uiMetadata.displayName}))}getUIMetadata(a){return this.generators.get(a)?.uiMetadata}getDefaultConfig(a,s,h){const c={name:a,width:s,height:h},o=this.getUIMetadata(a);if(o)for(const d of o.controls)c[d.name]=d.defaultValue;return c}}const vi=new lr,Ni=new lr,Oi=new lr,oi=new lr;let yo=0;function sa(){return yo++}const{abs:hn,cos:ni,sin:Hi,acos:bo,atan2:cn,sqrt:pi,pow:jt}=Math;function fn(u){return u<0?-jt(-u,1/3):jt(u,1/3)}const aa=Math.PI,Gn=2*aa,gi=aa/2,xo=1e-6,Ir=Number.MAX_SAFE_INTEGER||9007199254740991,kr=Number.MIN_SAFE_INTEGER||-9007199254740991,wo={x:0,y:0,z:0},Me={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(u,a){const s=a(u);let h=s.x*s.x+s.y*s.y;return typeof s.z<"u"&&(h+=s.z*s.z),pi(h)},compute:function(u,a,s){if(u===0)return a[0].t=0,a[0];const h=a.length-1;if(u===1)return a[h].t=1,a[h];const c=1-u;let o=a;if(h===0)return a[0].t=u,a[0];if(h===1){const _={x:c*o[0].x+u*o[1].x,y:c*o[0].y+u*o[1].y,t:u};return s&&(_.z=c*o[0].z+u*o[1].z),_}if(h<4){let _=c*c,b=u*u,C,S,P,D=0;h===2?(o=[o[0],o[1],o[2],wo],C=_,S=c*u*2,P=b):h===3&&(C=_*c,S=_*u*3,P=c*b*3,D=u*b);const z={x:C*o[0].x+S*o[1].x+P*o[2].x+D*o[3].x,y:C*o[0].y+S*o[1].y+P*o[2].y+D*o[3].y,t:u};return s&&(z.z=C*o[0].z+S*o[1].z+P*o[2].z+D*o[3].z),z}const d=JSON.parse(JSON.stringify(a));for(;d.length>1;){for(let _=0;_<d.length-1;_++)d[_]={x:d[_].x+(d[_+1].x-d[_].x)*u,y:d[_].y+(d[_+1].y-d[_].y)*u},typeof d[_].z<"u"&&(d[_].z=d[_].z+(d[_+1].z-d[_].z)*u);d.splice(d.length-1,1)}return d[0].t=u,d[0]},computeWithRatios:function(u,a,s,h){const c=1-u,o=s,d=a;let _=o[0],b=o[1],C=o[2],S=o[3],P;if(_*=c,b*=u,d.length===2)return P=_+b,{x:(_*d[0].x+b*d[1].x)/P,y:(_*d[0].y+b*d[1].y)/P,z:h?(_*d[0].z+b*d[1].z)/P:!1,t:u};if(_*=c,b*=2*c,C*=u*u,d.length===3)return P=_+b+C,{x:(_*d[0].x+b*d[1].x+C*d[2].x)/P,y:(_*d[0].y+b*d[1].y+C*d[2].y)/P,z:h?(_*d[0].z+b*d[1].z+C*d[2].z)/P:!1,t:u};if(_*=c,b*=1.5*c,C*=3*c,S*=u*u*u,d.length===4)return P=_+b+C+S,{x:(_*d[0].x+b*d[1].x+C*d[2].x+S*d[3].x)/P,y:(_*d[0].y+b*d[1].y+C*d[2].y+S*d[3].y)/P,z:h?(_*d[0].z+b*d[1].z+C*d[2].z+S*d[3].z)/P:!1,t:u}},derive:function(u,a){const s=[];for(let h=u,c=h.length,o=c-1;c>1;c--,o--){const d=[];for(let _=0,b;_<o;_++)b={x:o*(h[_+1].x-h[_].x),y:o*(h[_+1].y-h[_].y)},a&&(b.z=o*(h[_+1].z-h[_].z)),d.push(b);s.push(d),h=d}return s},between:function(u,a,s){return a<=u&&u<=s||Me.approximately(u,a)||Me.approximately(u,s)},approximately:function(u,a,s){return hn(u-a)<=(s||xo)},length:function(u){const s=Me.Tvalues.length;let h=0;for(let c=0,o;c<s;c++)o=.5*Me.Tvalues[c]+.5,h+=Me.Cvalues[c]*Me.arcfn(o,u);return .5*h},map:function(u,a,s,h,c){const o=s-a,d=c-h,_=u-a,b=_/o;return h+d*b},lerp:function(u,a,s){const h={x:a.x+u*(s.x-a.x),y:a.y+u*(s.y-a.y)};return a.z!==void 0&&s.z!==void 0&&(h.z=a.z+u*(s.z-a.z)),h},pointToString:function(u){let a=u.x+"/"+u.y;return typeof u.z<"u"&&(a+="/"+u.z),a},pointsToString:function(u){return"["+u.map(Me.pointToString).join(", ")+"]"},copy:function(u){return JSON.parse(JSON.stringify(u))},angle:function(u,a,s){const h=a.x-u.x,c=a.y-u.y,o=s.x-u.x,d=s.y-u.y,_=h*d-c*o,b=h*o+c*d;return cn(_,b)},round:function(u,a){const s=""+u,h=s.indexOf(".");return parseFloat(s.substring(0,h+1+a))},dist:function(u,a){const s=u.x-a.x,h=u.y-a.y;return pi(s*s+h*h)},closest:function(u,a){let s=jt(2,63),h,c;return u.forEach(function(o,d){c=Me.dist(a,o),c<s&&(s=c,h=d)}),{mdist:s,mpos:h}},abcratio:function(u,a){if(a!==2&&a!==3)return!1;if(typeof u>"u")u=.5;else if(u===0||u===1)return u;const s=jt(u,a)+jt(1-u,a),h=s-1;return hn(h/s)},projectionratio:function(u,a){if(a!==2&&a!==3)return!1;if(typeof u>"u")u=.5;else if(u===0||u===1)return u;const s=jt(1-u,a),h=jt(u,a)+s;return s/h},lli8:function(u,a,s,h,c,o,d,_){const b=(u*h-a*s)*(c-d)-(u-s)*(c*_-o*d),C=(u*h-a*s)*(o-_)-(a-h)*(c*_-o*d),S=(u-s)*(o-_)-(a-h)*(c-d);return S==0?!1:{x:b/S,y:C/S}},lli4:function(u,a,s,h){const c=u.x,o=u.y,d=a.x,_=a.y,b=s.x,C=s.y,S=h.x,P=h.y;return Me.lli8(c,o,d,_,b,C,S,P)},lli:function(u,a){return Me.lli4(u,u.c,a,a.c)},makeline:function(u,a){return new ft(u.x,u.y,(u.x+a.x)/2,(u.y+a.y)/2,a.x,a.y)},findbbox:function(u){let a=Ir,s=Ir,h=kr,c=kr;return u.forEach(function(o){const d=o.bbox();a>d.x.min&&(a=d.x.min),s>d.y.min&&(s=d.y.min),h<d.x.max&&(h=d.x.max),c<d.y.max&&(c=d.y.max)}),{x:{min:a,mid:(a+h)/2,max:h,size:h-a},y:{min:s,mid:(s+c)/2,max:c,size:c-s}}},shapeintersections:function(u,a,s,h,c){if(!Me.bboxoverlap(a,h))return[];const o=[],d=[u.startcap,u.forward,u.back,u.endcap],_=[s.startcap,s.forward,s.back,s.endcap];return d.forEach(function(b){b.virtual||_.forEach(function(C){if(C.virtual)return;const S=b.intersects(C,c);S.length>0&&(S.c1=b,S.c2=C,S.s1=u,S.s2=s,o.push(S))})}),o},makeshape:function(u,a,s){const h=a.points.length,c=u.points.length,o=Me.makeline(a.points[h-1],u.points[0]),d=Me.makeline(u.points[c-1],a.points[0]),_={startcap:o,forward:u,back:a,endcap:d,bbox:Me.findbbox([o,u,a,d])};return _.intersections=function(b){return Me.shapeintersections(_,_.bbox,b,b.bbox,s)},_},getminmax:function(u,a,s){if(!s)return{min:0,max:0};let h=Ir,c=kr,o,d;s.indexOf(0)===-1&&(s=[0].concat(s)),s.indexOf(1)===-1&&s.push(1);for(let _=0,b=s.length;_<b;_++)o=s[_],d=u.get(o),d[a]<h&&(h=d[a]),d[a]>c&&(c=d[a]);return{min:h,mid:(h+c)/2,max:c,size:c-h}},align:function(u,a){const s=a.p1.x,h=a.p1.y,c=-cn(a.p2.y-h,a.p2.x-s),o=function(d){return{x:(d.x-s)*ni(c)-(d.y-h)*Hi(c),y:(d.x-s)*Hi(c)+(d.y-h)*ni(c)}};return u.map(o)},roots:function(u,a){a=a||{p1:{x:0,y:0},p2:{x:1,y:0}};const s=u.length-1,h=Me.align(u,a),c=function(le){return 0<=le&&le<=1};if(s===2){const le=h[0].y,_e=h[1].y,de=h[2].y,Pe=le-2*_e+de;if(Pe!==0){const be=-pi(_e*_e-le*de),Ce=-le+_e,ke=-(be+Ce)/Pe,we=-(-be+Ce)/Pe;return[ke,we].filter(c)}else if(_e!==de&&Pe===0)return[(2*_e-de)/(2*_e-2*de)].filter(c);return[]}const o=h[0].y,d=h[1].y,_=h[2].y,b=h[3].y;let C=-o+3*d-3*_+b,S=3*o-6*d+3*_,P=-3*o+3*d,D=o;if(Me.approximately(C,0)){if(Me.approximately(S,0))return Me.approximately(P,0)?[]:[-D/P].filter(c);const le=pi(P*P-4*S*D),_e=2*S;return[(le-P)/_e,(-P-le)/_e].filter(c)}S/=C,P/=C,D/=C;const z=(3*P-S*S)/3,J=z/3,j=(2*S*S*S-9*S*P+27*D)/27,re=j/2,K=re*re+J*J*J;let ce,ue,fe,ae,I;if(K<0){const le=-z/3,_e=le*le*le,de=pi(_e),Pe=-j/(2*de),be=Pe<-1?-1:Pe>1?1:Pe,Ce=bo(be),ke=fn(de),we=2*ke;return fe=we*ni(Ce/3)-S/3,ae=we*ni((Ce+Gn)/3)-S/3,I=we*ni((Ce+2*Gn)/3)-S/3,[fe,ae,I].filter(c)}else{if(K===0)return ce=re<0?fn(-re):-fn(re),fe=2*ce-S/3,ae=-ce-S/3,[fe,ae].filter(c);{const le=pi(K);return ce=fn(-re+le),ue=fn(re+le),[ce-ue-S/3].filter(c)}}},droots:function(u){if(u.length===3){const a=u[0],s=u[1],h=u[2],c=a-2*s+h;if(c!==0){const o=-pi(s*s-a*h),d=-a+s,_=-(o+d)/c,b=-(-o+d)/c;return[_,b]}else if(s!==h&&c===0)return[(2*s-h)/(2*(s-h))];return[]}if(u.length===2){const a=u[0],s=u[1];return a!==s?[a/(a-s)]:[]}return[]},curvature:function(u,a,s,h,c){let o,d,_,b,C=0,S=0;const P=Me.compute(u,a),D=Me.compute(u,s),z=P.x*P.x+P.y*P.y;if(h?(o=pi(jt(P.y*D.z-D.y*P.z,2)+jt(P.z*D.x-D.z*P.x,2)+jt(P.x*D.y-D.x*P.y,2)),d=jt(z+P.z*P.z,3/2)):(o=P.x*D.y-P.y*D.x,d=jt(z,3/2)),o===0||d===0)return{k:0,r:0};if(C=o/d,S=d/o,!c){const J=Me.curvature(u-.001,a,s,h,!0).k,j=Me.curvature(u+.001,a,s,h,!0).k;b=(j-C+(C-J))/2,_=(hn(j-C)+hn(C-J))/2}return{k:C,r:S,dk:b,adk:_}},inflections:function(u){if(u.length<4)return[];const a=Me.align(u,{p1:u[0],p2:u.slice(-1)[0]}),s=a[2].x*a[1].y,h=a[3].x*a[1].y,c=a[1].x*a[2].y,o=a[3].x*a[2].y,d=18*(-3*s+2*h+3*c-o),_=18*(3*s-h-3*c),b=18*(c-s);if(Me.approximately(d,0)){if(!Me.approximately(_,0)){let D=-b/_;if(0<=D&&D<=1)return[D]}return[]}const C=2*d;if(Me.approximately(C,0))return[];const S=_*_-4*d*b;if(S<0)return[];const P=Math.sqrt(S);return[(P-_)/C,-(_+P)/C].filter(function(D){return 0<=D&&D<=1})},bboxoverlap:function(u,a){const s=["x","y"],h=s.length;for(let c=0,o,d,_,b;c<h;c++)if(o=s[c],d=u[o].mid,_=a[o].mid,b=(u[o].size+a[o].size)/2,hn(d-_)>=b)return!1;return!0},expandbox:function(u,a){a.x.min<u.x.min&&(u.x.min=a.x.min),a.y.min<u.y.min&&(u.y.min=a.y.min),a.z&&a.z.min<u.z.min&&(u.z.min=a.z.min),a.x.max>u.x.max&&(u.x.max=a.x.max),a.y.max>u.y.max&&(u.y.max=a.y.max),a.z&&a.z.max>u.z.max&&(u.z.max=a.z.max),u.x.mid=(u.x.min+u.x.max)/2,u.y.mid=(u.y.min+u.y.max)/2,u.z&&(u.z.mid=(u.z.min+u.z.max)/2),u.x.size=u.x.max-u.x.min,u.y.size=u.y.max-u.y.min,u.z&&(u.z.size=u.z.max-u.z.min)},pairiteration:function(u,a,s){const h=u.bbox(),c=a.bbox(),o=1e5,d=s||.5;if(h.x.size+h.y.size<d&&c.x.size+c.y.size<d)return[(o*(u._t1+u._t2)/2|0)/o+"/"+(o*(a._t1+a._t2)/2|0)/o];let _=u.split(.5),b=a.split(.5),C=[{left:_.left,right:b.left},{left:_.left,right:b.right},{left:_.right,right:b.right},{left:_.right,right:b.left}];C=C.filter(function(P){return Me.bboxoverlap(P.left.bbox(),P.right.bbox())});let S=[];return C.length===0||(C.forEach(function(P){S=S.concat(Me.pairiteration(P.left,P.right,d))}),S=S.filter(function(P,D){return S.indexOf(P)===D})),S},getccenter:function(u,a,s){const h=a.x-u.x,c=a.y-u.y,o=s.x-a.x,d=s.y-a.y,_=h*ni(gi)-c*Hi(gi),b=h*Hi(gi)+c*ni(gi),C=o*ni(gi)-d*Hi(gi),S=o*Hi(gi)+d*ni(gi),P=(u.x+a.x)/2,D=(u.y+a.y)/2,z=(a.x+s.x)/2,J=(a.y+s.y)/2,j=P+_,re=D+b,K=z+C,ce=J+S,ue=Me.lli8(P,D,j,re,z,J,K,ce),fe=Me.dist(ue,u);let ae=cn(u.y-ue.y,u.x-ue.x),I=cn(a.y-ue.y,a.x-ue.x),le=cn(s.y-ue.y,s.x-ue.x),_e;return ae<le?((ae>I||I>le)&&(ae+=Gn),ae>le&&(_e=le,le=ae,ae=_e)):le<I&&I<ae?(_e=le,le=ae,ae=_e):le+=Gn,ue.s=ae,ue.e=le,ue.r=fe,ue},numberSort:function(u,a){return u-a}};class yn{constructor(a){this.curves=[],this._3d=!1,a&&(this.curves=a,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(a){return Me.pointsToString(a.points)}).join(", ")+"]"}addCurve(a){this.curves.push(a),this._3d=this._3d||a._3d}length(){return this.curves.map(function(a){return a.length()}).reduce(function(a,s){return a+s})}curve(a){return this.curves[a]}bbox(){const a=this.curves;for(var s=a[0].bbox(),h=1;h<a.length;h++)Me.expandbox(s,a[h].bbox());return s}offset(a){const s=[];return this.curves.forEach(function(h){s.push(...h.offset(a))}),new yn(s)}}const{abs:dn,min:_s,max:ys,cos:Co,sin:So,acos:Po,sqrt:pn}=Math,Io=Math.PI;class ft{constructor(a){let s=a&&a.forEach?a:Array.from(arguments).slice(),h=!1;if(typeof s[0]=="object"){h=s.length;const z=[];s.forEach(function(J){["x","y","z"].forEach(function(j){typeof J[j]<"u"&&z.push(J[j])})}),s=z}let c=!1;const o=s.length;if(h){if(h>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");c=!0}}else if(o!==6&&o!==8&&o!==9&&o!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");const d=this._3d=!c&&(o===9||o===12)||a&&a[0]&&typeof a[0].z<"u",_=this.points=[];for(let z=0,J=d?3:2;z<o;z+=J){var b={x:s[z],y:s[z+1]};d&&(b.z=s[z+2]),_.push(b)}const C=this.order=_.length-1,S=this.dims=["x","y"];d&&S.push("z"),this.dimlen=S.length;const P=Me.align(_,{p1:_[0],p2:_[C]}),D=Me.dist(_[0],_[C]);this._linear=P.reduce((z,J)=>z+dn(J.y),0)<D/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(a,s,h,c){if(typeof c>"u"&&(c=.5),c===0)return new ft(s,s,h);if(c===1)return new ft(a,s,s);const o=ft.getABC(2,a,s,h,c);return new ft(a,o.A,h)}static cubicFromPoints(a,s,h,c,o){typeof c>"u"&&(c=.5);const d=ft.getABC(3,a,s,h,c);typeof o>"u"&&(o=Me.dist(s,d.C));const _=o*(1-c)/c,b=Me.dist(a,h),C=(h.x-a.x)/b,S=(h.y-a.y)/b,P=o*C,D=o*S,z=_*C,J=_*S,j={x:s.x-P,y:s.y-D},re={x:s.x+z,y:s.y+J},K=d.A,ce={x:K.x+(j.x-K.x)/(1-c),y:K.y+(j.y-K.y)/(1-c)},ue={x:K.x+(re.x-K.x)/c,y:K.y+(re.y-K.y)/c},fe={x:a.x+(ce.x-a.x)/c,y:a.y+(ce.y-a.y)/c},ae={x:h.x+(ue.x-h.x)/(1-c),y:h.y+(ue.y-h.y)/(1-c)};return new ft(a,fe,ae,h)}static getUtils(){return Me}getUtils(){return ft.getUtils()}static get PolyBezier(){return yn}valueOf(){return this.toString()}toString(){return Me.pointsToString(this.points)}toSVG(){if(this._3d)return!1;const a=this.points,s=a[0].x,h=a[0].y,c=["M",s,h,this.order===2?"Q":"C"];for(let o=1,d=a.length;o<d;o++)c.push(a[o].x),c.push(a[o].y);return c.join(" ")}setRatios(a){if(a.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=a,this._lut=[]}verify(){const a=this.coordDigest();a!==this._print&&(this._print=a,this.update())}coordDigest(){return this.points.map(function(a,s){return""+s+a.x+a.y+(a.z?a.z:0)}).join("")}update(){this._lut=[],this.dpoints=Me.derive(this.points,this._3d),this.computedirection()}computedirection(){const a=this.points,s=Me.angle(a[0],a[this.order],a[1]);this.clockwise=s>0}length(){return Me.length(this.derivative.bind(this))}static getABC(a=2,s,h,c,o=.5){const d=Me.projectionratio(o,a),_=1-d,b={x:d*s.x+_*c.x,y:d*s.y+_*c.y},C=Me.abcratio(o,a);return{A:{x:h.x+(h.x-b.x)/C,y:h.y+(h.y-b.y)/C},B:h,C:b,S:s,E:c}}getABC(a,s){s=s||this.get(a);let h=this.points[0],c=this.points[this.order];return ft.getABC(this.order,h,s,c,a)}getLUT(a){if(this.verify(),a=a||100,this._lut.length===a+1)return this._lut;this._lut=[],a++,this._lut=[];for(let s=0,h,c;s<a;s++)c=s/(a-1),h=this.compute(c),h.t=c,this._lut.push(h);return this._lut}on(a,s){s=s||5;const h=this.getLUT(),c=[];for(let o=0,d,_=0;o<h.length;o++)d=h[o],Me.dist(d,a)<s&&(c.push(d),_+=o/h.length);return c.length?t/=c.length:!1}project(a){const s=this.getLUT(),h=s.length-1,c=Me.closest(s,a),o=c.mpos,d=(o-1)/h,_=(o+1)/h,b=.1/h;let C=c.mdist,S=d,P=S,D;C+=1;for(let z;S<_+b;S+=b)D=this.compute(S),z=Me.dist(a,D),z<C&&(C=z,P=S);return P=P<0?0:P>1?1:P,D=this.compute(P),D.t=P,D.d=C,D}get(a){return this.compute(a)}point(a){return this.points[a]}compute(a){return this.ratios?Me.computeWithRatios(a,this.points,this.ratios,this._3d):Me.compute(a,this.points,this._3d,this.ratios)}raise(){const a=this.points,s=[a[0]],h=a.length;for(let c=1,o,d;c<h;c++)o=a[c],d=a[c-1],s[c]={x:(h-c)/h*o.x+c/h*d.x,y:(h-c)/h*o.y+c/h*d.y};return s[h]=a[h-1],new ft(s)}derivative(a){return Me.compute(a,this.dpoints[0],this._3d)}dderivative(a){return Me.compute(a,this.dpoints[1],this._3d)}align(){let a=this.points;return new ft(Me.align(a,{p1:a[0],p2:a[a.length-1]}))}curvature(a){return Me.curvature(a,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return Me.inflections(this.points)}normal(a){return this._3d?this.__normal3(a):this.__normal2(a)}__normal2(a){const s=this.derivative(a),h=pn(s.x*s.x+s.y*s.y);return{t:a,x:-s.y/h,y:s.x/h}}__normal3(a){const s=this.derivative(a),h=this.derivative(a+.01),c=pn(s.x*s.x+s.y*s.y+s.z*s.z),o=pn(h.x*h.x+h.y*h.y+h.z*h.z);s.x/=c,s.y/=c,s.z/=c,h.x/=o,h.y/=o,h.z/=o;const d={x:h.y*s.z-h.z*s.y,y:h.z*s.x-h.x*s.z,z:h.x*s.y-h.y*s.x},_=pn(d.x*d.x+d.y*d.y+d.z*d.z);d.x/=_,d.y/=_,d.z/=_;const b=[d.x*d.x,d.x*d.y-d.z,d.x*d.z+d.y,d.x*d.y+d.z,d.y*d.y,d.y*d.z-d.x,d.x*d.z-d.y,d.y*d.z+d.x,d.z*d.z];return{t:a,x:b[0]*s.x+b[1]*s.y+b[2]*s.z,y:b[3]*s.x+b[4]*s.y+b[5]*s.z,z:b[6]*s.x+b[7]*s.y+b[8]*s.z}}hull(a){let s=this.points,h=[],c=[],o=0;for(c[o++]=s[0],c[o++]=s[1],c[o++]=s[2],this.order===3&&(c[o++]=s[3]);s.length>1;){h=[];for(let d=0,_,b=s.length-1;d<b;d++)_=Me.lerp(a,s[d],s[d+1]),c[o++]=_,h.push(_);s=h}return c}split(a,s){if(a===0&&s)return this.split(s).left;if(s===1)return this.split(a).right;const h=this.hull(a),c={left:this.order===2?new ft([h[0],h[3],h[5]]):new ft([h[0],h[4],h[7],h[9]]),right:this.order===2?new ft([h[5],h[4],h[2]]):new ft([h[9],h[8],h[6],h[3]]),span:h};return c.left._t1=Me.map(0,0,1,this._t1,this._t2),c.left._t2=Me.map(a,0,1,this._t1,this._t2),c.right._t1=Me.map(a,0,1,this._t1,this._t2),c.right._t2=Me.map(1,0,1,this._t1,this._t2),s?(s=Me.map(s,a,1,0,1),c.right.split(s).left):c}extrema(){const a={};let s=[];return this.dims.forEach((function(h){let c=function(d){return d[h]},o=this.dpoints[0].map(c);a[h]=Me.droots(o),this.order===3&&(o=this.dpoints[1].map(c),a[h]=a[h].concat(Me.droots(o))),a[h]=a[h].filter(function(d){return d>=0&&d<=1}),s=s.concat(a[h].sort(Me.numberSort))}).bind(this)),a.values=s.sort(Me.numberSort).filter(function(h,c){return s.indexOf(h)===c}),a}bbox(){const a=this.extrema(),s={};return this.dims.forEach((function(h){s[h]=Me.getminmax(this,h,a[h])}).bind(this)),s}overlaps(a){const s=this.bbox(),h=a.bbox();return Me.bboxoverlap(s,h)}offset(a,s){if(typeof s<"u"){const h=this.get(a),c=this.normal(a),o={c:h,n:c,x:h.x+c.x*s,y:h.y+c.y*s};return this._3d&&(o.z=h.z+c.z*s),o}if(this._linear){const h=this.normal(0),c=this.points.map(function(o){const d={x:o.x+a*h.x,y:o.y+a*h.y};return o.z&&h.z&&(d.z=o.z+a*h.z),d});return[new ft(c)]}return this.reduce().map(function(h){return h._linear?h.offset(a)[0]:h.scale(a)})}simple(){if(this.order===3){const c=Me.angle(this.points[0],this.points[3],this.points[1]),o=Me.angle(this.points[0],this.points[3],this.points[2]);if(c>0&&o<0||c<0&&o>0)return!1}const a=this.normal(0),s=this.normal(1);let h=a.x*s.x+a.y*s.y;return this._3d&&(h+=a.z*s.z),dn(Po(h))<Io/3}reduce(){let a,s=0,h=0,c=.01,o,d=[],_=[],b=this.extrema().values;for(b.indexOf(0)===-1&&(b=[0].concat(b)),b.indexOf(1)===-1&&b.push(1),s=b[0],a=1;a<b.length;a++)h=b[a],o=this.split(s,h),o._t1=s,o._t2=h,d.push(o),s=h;return d.forEach(function(C){for(s=0,h=0;h<=1;)for(h=s+c;h<=1+c;h+=c)if(o=C.split(s,h),!o.simple()){if(h-=c,dn(s-h)<c)return[];o=C.split(s,h),o._t1=Me.map(s,0,1,C._t1,C._t2),o._t2=Me.map(h,0,1,C._t1,C._t2),_.push(o),s=h;break}s<1&&(o=C.split(s,1),o._t1=Me.map(s,0,1,C._t1,C._t2),o._t2=C._t2,_.push(o))}),_}translate(a,s,h){h=typeof h=="number"?h:s;const c=this.order;let o=this.points.map((d,_)=>(1-_/c)*s+_/c*h);return new ft(this.points.map((d,_)=>({x:d.x+a.x*o[_],y:d.y+a.y*o[_]})))}scale(a){const s=this.order;let h=!1;if(typeof a=="function"&&(h=a),h&&s===2)return this.raise().scale(h);const c=this.clockwise,o=this.points;if(this._linear)return this.translate(this.normal(0),h?h(0):a,h?h(1):a);const d=h?h(0):a,_=h?h(1):a,b=[this.offset(0,10),this.offset(1,10)],C=[],S=Me.lli4(b[0],b[0].c,b[1],b[1].c);if(!S)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(P){const D=C[P*s]=Me.copy(o[P*s]);D.x+=(P?_:d)*b[P].n.x,D.y+=(P?_:d)*b[P].n.y}),h?([0,1].forEach(function(P){if(!(s===2&&P)){var D=o[P+1],z={x:D.x-S.x,y:D.y-S.y},J=h?h((P+1)/s):a;h&&!c&&(J=-J);var j=pn(z.x*z.x+z.y*z.y);z.x/=j,z.y/=j,C[P+1]={x:D.x+J*z.x,y:D.y+J*z.y}}}),new ft(C)):([0,1].forEach(P=>{if(s===2&&P)return;const D=C[P*s],z=this.derivative(P),J={x:D.x+z.x,y:D.y+z.y};C[P+1]=Me.lli4(D,J,S,o[P+1])}),new ft(C))}outline(a,s,h,c){if(s=s===void 0?a:s,this._linear){const ae=this.normal(0),I=this.points[0],le=this.points[this.points.length-1];let _e,de,Pe;h===void 0&&(h=a,c=s),_e={x:I.x+ae.x*a,y:I.y+ae.y*a},Pe={x:le.x+ae.x*h,y:le.y+ae.y*h},de={x:(_e.x+Pe.x)/2,y:(_e.y+Pe.y)/2};const be=[_e,de,Pe];_e={x:I.x-ae.x*s,y:I.y-ae.y*s},Pe={x:le.x-ae.x*c,y:le.y-ae.y*c},de={x:(_e.x+Pe.x)/2,y:(_e.y+Pe.y)/2};const Ce=[Pe,de,_e],ke=Me.makeline(Ce[2],be[0]),we=Me.makeline(be[2],Ce[0]),Ue=[ke,new ft(be),we,new ft(Ce)];return new yn(Ue)}const o=this.reduce(),d=o.length,_=[];let b=[],C,S=0,P=this.length();const D=typeof h<"u"&&typeof c<"u";function z(ae,I,le,_e,de){return function(Pe){const be=_e/le,Ce=(_e+de)/le,ke=I-ae;return Me.map(Pe,0,1,ae+be*ke,ae+Ce*ke)}}o.forEach(function(ae){const I=ae.length();D?(_.push(ae.scale(z(a,h,P,S,I))),b.push(ae.scale(z(-s,-c,P,S,I)))):(_.push(ae.scale(a)),b.push(ae.scale(-s))),S+=I}),b=b.map(function(ae){return C=ae.points,C[3]?ae.points=[C[3],C[2],C[1],C[0]]:ae.points=[C[2],C[1],C[0]],ae}).reverse();const J=_[0].points[0],j=_[d-1].points[_[d-1].points.length-1],re=b[d-1].points[b[d-1].points.length-1],K=b[0].points[0],ce=Me.makeline(re,J),ue=Me.makeline(j,K),fe=[ce].concat(_).concat([ue]).concat(b);return new yn(fe)}outlineshapes(a,s,h){s=s||a;const c=this.outline(a,s).curves,o=[];for(let d=1,_=c.length;d<_/2;d++){const b=Me.makeshape(c[d],c[_-d],h);b.startcap.virtual=d>1,b.endcap.virtual=d<_/2-1,o.push(b)}return o}intersects(a,s){return a?a.p1&&a.p2?this.lineIntersects(a):(a instanceof ft&&(a=a.reduce()),this.curveintersects(this.reduce(),a,s)):this.selfintersects(s)}lineIntersects(a){const s=_s(a.p1.x,a.p2.x),h=_s(a.p1.y,a.p2.y),c=ys(a.p1.x,a.p2.x),o=ys(a.p1.y,a.p2.y);return Me.roots(this.points,a).filter(d=>{var _=this.get(d);return Me.between(_.x,s,c)&&Me.between(_.y,h,o)})}selfintersects(a){const s=this.reduce(),h=s.length-2,c=[];for(let o=0,d,_,b;o<h;o++)_=s.slice(o,o+1),b=s.slice(o+2),d=this.curveintersects(_,b,a),c.push(...d);return c}curveintersects(a,s,h){const c=[];a.forEach(function(d){s.forEach(function(_){d.overlaps(_)&&c.push({left:d,right:_})})});let o=[];return c.forEach(function(d){const _=Me.pairiteration(d.left,d.right,h);_.length>0&&(o=o.concat(_))}),o}arcs(a){return a=a||.5,this._iterate(a,[])}_error(a,s,h,c){const o=(c-h)/4,d=this.get(h+o),_=this.get(c-o),b=Me.dist(a,s),C=Me.dist(a,d),S=Me.dist(a,_);return dn(C-b)+dn(S-b)}_iterate(a,s){let h=0,c=1,o;do{o=0,c=1;let d=this.get(h),_,b,C,S,P=!1,D=!1,z,J=c,j=1;do if(D=P,S=C,J=(h+c)/2,_=this.get(J),b=this.get(c),C=Me.getccenter(d,_,b),C.interval={start:h,end:c},P=this._error(C,d,h,c)<=a,z=D&&!P,z||(j=c),P){if(c>=1){if(C.interval.end=j=1,S=C,c>1){let K={x:C.x+C.r*Co(C.e),y:C.y+C.r*So(C.e)};C.e+=Me.angle({x:C.x,y:C.y},K,this.get(1))}break}c=c+(c-h)/2}else c=J;while(!z&&o++<100);if(o>=100)break;S=S||C,s.push(S),h=j}while(c<1);return s}}var ko=(function(){function u(a,s){var h=[],c=!0,o=!1,d=void 0;try{for(var _=a[Symbol.iterator](),b;!(c=(b=_.next()).done)&&(h.push(b.value),!(s&&h.length===s));c=!0);}catch(C){o=!0,d=C}finally{try{!c&&_.return&&_.return()}finally{if(o)throw d}}return h}return function(a,s){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return u(a,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),bn=Math.PI*2,Er=function(a,s,h,c,o,d,_){var b=a.x,C=a.y;b*=s,C*=h;var S=c*b-o*C,P=o*b+c*C;return{x:S+d,y:P+_}},Eo=function(a,s){var h=s===1.5707963267948966?.551915024494:s===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(s/4),c=Math.cos(a),o=Math.sin(a),d=Math.cos(a+s),_=Math.sin(a+s);return[{x:c-o*h,y:o+c*h},{x:d+_*h,y:_-d*h},{x:d,y:_}]},bs=function(a,s,h,c){var o=a*c-s*h<0?-1:1,d=a*h+s*c;return d>1&&(d=1),d<-1&&(d=-1),o*Math.acos(d)},Ao=function(a,s,h,c,o,d,_,b,C,S,P,D){var z=Math.pow(o,2),J=Math.pow(d,2),j=Math.pow(P,2),re=Math.pow(D,2),K=z*J-z*re-J*j;K<0&&(K=0),K/=z*re+J*j,K=Math.sqrt(K)*(_===b?-1:1);var ce=K*o/d*D,ue=K*-d/o*P,fe=S*ce-C*ue+(a+h)/2,ae=C*ce+S*ue+(s+c)/2,I=(P-ce)/o,le=(D-ue)/d,_e=(-P-ce)/o,de=(-D-ue)/d,Pe=bs(1,0,I,le),be=bs(I,le,_e,de);return b===0&&be>0&&(be-=bn),b===1&&be<0&&(be+=bn),[fe,ae,Pe,be]},To=function(a){var s=a.px,h=a.py,c=a.cx,o=a.cy,d=a.rx,_=a.ry,b=a.xAxisRotation,C=b===void 0?0:b,S=a.largeArcFlag,P=S===void 0?0:S,D=a.sweepFlag,z=D===void 0?0:D,J=[];if(d===0||_===0)return[];var j=Math.sin(C*bn/360),re=Math.cos(C*bn/360),K=re*(s-c)/2+j*(h-o)/2,ce=-j*(s-c)/2+re*(h-o)/2;if(K===0&&ce===0)return[];d=Math.abs(d),_=Math.abs(_);var ue=Math.pow(K,2)/Math.pow(d,2)+Math.pow(ce,2)/Math.pow(_,2);ue>1&&(d*=Math.sqrt(ue),_*=Math.sqrt(ue));var fe=Ao(s,h,c,o,d,_,P,z,j,re,K,ce),ae=ko(fe,4),I=ae[0],le=ae[1],_e=ae[2],de=ae[3],Pe=Math.abs(de)/(bn/4);Math.abs(1-Pe)<1e-7&&(Pe=1);var be=Math.max(Math.ceil(Pe),1);de/=be;for(var Ce=0;Ce<be;Ce++)J.push(Eo(_e,de)),_e+=de;return J.map(function(ke){var we=Er(ke[0],d,_,re,j,I,le),Ue=we.x,pe=we.y,He=Er(ke[1],d,_,re,j,I,le),et=He.x,Ve=He.y,it=Er(ke[2],d,_,re,j,I,le),Lt=it.x,It=it.y;return{x1:Ue,y1:pe,x2:et,y2:Ve,x:Lt,y:It}})};function Mo(u,a){return u>a?1:u<a?-1:0}class es{constructor(a=Mo,s=!1){this._compare=a,this._root=null,this._size=0,this._noDuplicates=!!s}rotateLeft(a){var s=a.right;s&&(a.right=s.left,s.left&&(s.left.parent=a),s.parent=a.parent),a.parent?a===a.parent.left?a.parent.left=s:a.parent.right=s:this._root=s,s&&(s.left=a),a.parent=s}rotateRight(a){var s=a.left;s&&(a.left=s.right,s.right&&(s.right.parent=a),s.parent=a.parent),a.parent?a===a.parent.left?a.parent.left=s:a.parent.right=s:this._root=s,s&&(s.right=a),a.parent=s}_splay(a){for(;a.parent;){var s=a.parent;s.parent?s.left===a&&s.parent.left===s?(this.rotateRight(s.parent),this.rotateRight(s)):s.right===a&&s.parent.right===s?(this.rotateLeft(s.parent),this.rotateLeft(s)):s.left===a&&s.parent.right===s?(this.rotateRight(s),this.rotateLeft(s)):(this.rotateLeft(s),this.rotateRight(s)):s.left===a?this.rotateRight(s):this.rotateLeft(s)}}splay(a){for(var s,h,c,o,d;a.parent;)s=a.parent,h=s.parent,h&&h.parent?(c=h.parent,c.left===h?c.left=a:c.right=a,a.parent=c):(a.parent=null,this._root=a),o=a.left,d=a.right,a===s.left?(h&&(h.left===s?(s.right?(h.left=s.right,h.left.parent=h):h.left=null,s.right=h,h.parent=s):(o?(h.right=o,o.parent=h):h.right=null,a.left=h,h.parent=a)),d?(s.left=d,d.parent=s):s.left=null,a.right=s,s.parent=a):(h&&(h.right===s?(s.left?(h.right=s.left,h.right.parent=h):h.right=null,s.left=h,h.parent=s):(d?(h.left=d,d.parent=h):h.left=null,a.right=h,h.parent=a)),o?(s.right=o,o.parent=s):s.right=null,a.left=s,s.parent=a)}replace(a,s){a.parent?a===a.parent.left?a.parent.left=s:a.parent.right=s:this._root=s,s&&(s.parent=a.parent)}minNode(a=this._root){if(a)for(;a.left;)a=a.left;return a}maxNode(a=this._root){if(a)for(;a.right;)a=a.right;return a}insert(a,s){var h=this._root,c=null,o=this._compare,d;if(this._noDuplicates)for(;h;){if(c=h,d=o(h.key,a),d===0)return;o(h.key,a)<0?h=h.right:h=h.left}else for(;h;)c=h,o(h.key,a)<0?h=h.right:h=h.left;return h={key:a,data:s,left:null,right:null,parent:c},c?o(c.key,h.key)<0?c.right=h:c.left=h:this._root=h,this.splay(h),this._size++,h}find(a){for(var s=this._root,h=this._compare;s;){var c=h(s.key,a);if(c<0)s=s.right;else if(c>0)s=s.left;else return s}return null}contains(a){for(var s=this._root,h=this._compare;s;){var c=h(a,s.key);if(c===0)return!0;c<0?s=s.left:s=s.right}return!1}remove(a){var s=this.find(a);if(!s)return!1;if(this.splay(s),!s.left)this.replace(s,s.right);else if(!s.right)this.replace(s,s.left);else{var h=this.minNode(s.right);h.parent!==s&&(this.replace(h,h.right),h.right=s.right,h.right.parent=h),this.replace(s,h),h.left=s.left,h.left.parent=h}return this._size--,!0}removeNode(a){if(!a)return!1;if(this.splay(a),!a.left)this.replace(a,a.right);else if(!a.right)this.replace(a,a.left);else{var s=this.minNode(a.right);s.parent!==a&&(this.replace(s,s.right),s.right=a.right,s.right.parent=s),this.replace(a,s),s.left=a.left,s.left.parent=s}return this._size--,!0}erase(a){var s=this.find(a);if(s){this.splay(s);var h=s.left,c=s.right,o=null;h&&(h.parent=null,o=this.maxNode(h),this.splay(o),this._root=o),c&&(h?o.right=c:this._root=c,c.parent=o),this._size--}}pop(){var a=this._root,s=null;if(a){for(;a.left;)a=a.left;s={key:a.key,data:a.data},this.remove(a.key)}return s}next(a){var s=a;if(s)if(s.right)for(s=s.right;s&&s.left;)s=s.left;else for(s=a.parent;s&&s.right===a;)a=s,s=s.parent;return s}prev(a){var s=a;if(s)if(s.left)for(s=s.left;s&&s.right;)s=s.right;else for(s=a.parent;s&&s.left===a;)a=s,s=s.parent;return s}forEach(a){for(var s=this._root,h=[],c=!1,o=0;!c;)s?(h.push(s),s=s.left):h.length>0?(s=h.pop(),a(s,o++),s=s.right):c=!0;return this}range(a,s,h,c){const o=[],d=this._compare;let _=this._root,b;for(;o.length!==0||_;)if(_)o.push(_),_=_.left;else{if(_=o.pop(),b=d(_.key,s),b>0)break;if(d(_.key,a)>=0&&h.call(c,_))return this;_=_.right}return this}keys(){for(var a=this._root,s=[],h=[],c=!1;!c;)a?(s.push(a),a=a.left):s.length>0?(a=s.pop(),h.push(a.key),a=a.right):c=!0;return h}values(){for(var a=this._root,s=[],h=[],c=!1;!c;)a?(s.push(a),a=a.left):s.length>0?(a=s.pop(),h.push(a.data),a=a.right):c=!0;return h}at(a){for(var s=this._root,h=[],c=!1,o=0;!c;)if(s)h.push(s),s=s.left;else if(h.length>0){if(s=h.pop(),o===a)return s;o++,s=s.right}else c=!0;return null}load(a=[],s=[],h=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const c=a.length;return h&&jr(a,s,0,c-1,this._compare),this._root=Gr(null,a,s,0,c),this._size=c,this}min(){var a=this.minNode(this._root);return a?a.key:null}max(){var a=this.maxNode(this._root);return a?a.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(a,s,h,c,o){return new es(h,o).load(a,s,c)}}function Gr(u,a,s,h,c){const o=c-h;if(o>0){const d=h+Math.floor(o/2),_=a[d],b=s[d],C={key:_,data:b,parent:u};return C.left=Gr(C,a,s,h,d),C.right=Gr(C,a,s,d+1,c),C}return null}function jr(u,a,s,h,c){if(s>=h)return;const o=u[s+h>>1];let d=s-1,_=h+1;for(;;){do d++;while(c(u[d],o)<0);do _--;while(c(u[_],o)>0);if(d>=_)break;let b=u[d];u[d]=u[_],u[_]=b,b=a[d],a[d]=a[_],a[_]=b}jr(u,a,s,_,c),jr(u,a,_+1,h,c)}const oa=0,ua=1,la=2,ha=3,tr=0,Wr=1,ir=2,ca=3;function gn(u,a,s){a===null?(u.inOut=!1,u.otherInOut=!0):(u.isSubject===a.isSubject?(u.inOut=!a.inOut,u.otherInOut=a.otherInOut):(u.inOut=!a.otherInOut,u.otherInOut=a.isVertical()?!a.inOut:a.inOut),a&&(u.prevInResult=!xs(a,s)||a.isVertical()?a.prevInResult:a)),xs(u,s)?u.resultTransition=zo(u,s):u.resultTransition=0}function xs(u,a){switch(u.type){case oa:switch(a){case tr:return!u.otherInOut;case Wr:return u.otherInOut;case ir:return u.isSubject&&u.otherInOut||!u.isSubject&&!u.otherInOut;case ca:return!0}break;case la:return a===tr||a===Wr;case ha:return a===ir;case ua:return!1}return!1}function zo(u,a){let s=!u.inOut,h=!u.otherInOut,c;switch(a){case tr:c=s&&h;break;case Wr:c=s||h;break;case ca:c=s^h;break;case ir:u.isSubject?c=s&&!h:c=h&&!s;break}return c?1:-1}class $i{constructor(a,s,h,c,o){this.left=s,this.point=a,this.otherEvent=h,this.isSubject=c,this.type=o||oa,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(a){const s=this.point,h=this.otherEvent.point;return this.left?(s[0]-a[0])*(h[1]-a[1])-(h[0]-a[0])*(s[1]-a[1])>0:(h[0]-a[0])*(s[1]-a[1])-(s[0]-a[0])*(h[1]-a[1])>0}isAbove(a){return!this.isBelow(a)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const a=new $i(this.point,this.left,this.otherEvent,this.isSubject,this.type);return a.contourId=this.contourId,a.resultTransition=this.resultTransition,a.prevInResult=this.prevInResult,a.isExteriorRing=this.isExteriorRing,a.inOut=this.inOut,a.otherInOut=this.otherInOut,a}}function Yt(u,a){return u[0]===a[0]?u[1]===a[1]:!1}const si=11102230246251565e-32,Mt=134217729,Lo=(3+8*si)*si;function Ar(u,a,s,h,c){let o,d,_,b,C=a[0],S=h[0],P=0,D=0;S>C==S>-C?(o=C,C=a[++P]):(o=S,S=h[++D]);let z=0;if(P<u&&D<s)for(S>C==S>-C?(d=C+o,_=o-(d-C),C=a[++P]):(d=S+o,_=o-(d-S),S=h[++D]),o=d,_!==0&&(c[z++]=_);P<u&&D<s;)S>C==S>-C?(d=o+C,b=d-o,_=o-(d-b)+(C-b),C=a[++P]):(d=o+S,b=d-o,_=o-(d-b)+(S-b),S=h[++D]),o=d,_!==0&&(c[z++]=_);for(;P<u;)d=o+C,b=d-o,_=o-(d-b)+(C-b),C=a[++P],o=d,_!==0&&(c[z++]=_);for(;D<s;)d=o+S,b=d-o,_=o-(d-b)+(S-b),S=h[++D],o=d,_!==0&&(c[z++]=_);return(o!==0||z===0)&&(c[z++]=o),z}function No(u,a){let s=a[0];for(let h=1;h<u;h++)s+=a[h];return s}function En(u){return new Float64Array(u)}const Oo=(3+16*si)*si,Ro=(2+12*si)*si,Do=(9+64*si)*si*si,Gi=En(4),ws=En(8),Cs=En(12),Ss=En(16),Ot=En(4);function Vo(u,a,s,h,c,o,d){let _,b,C,S,P,D,z,J,j,re,K,ce,ue,fe,ae,I,le,_e;const de=u-c,Pe=s-c,be=a-o,Ce=h-o;fe=de*Ce,D=Mt*de,z=D-(D-de),J=de-z,D=Mt*Ce,j=D-(D-Ce),re=Ce-j,ae=J*re-(fe-z*j-J*j-z*re),I=be*Pe,D=Mt*be,z=D-(D-be),J=be-z,D=Mt*Pe,j=D-(D-Pe),re=Pe-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Gi[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Gi[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Gi[2]=ce-(_e-P)+(K-P),Gi[3]=_e;let ke=No(4,Gi),we=Ro*d;if(ke>=we||-ke>=we||(P=u-de,_=u-(de+P)+(P-c),P=s-Pe,C=s-(Pe+P)+(P-c),P=a-be,b=a-(be+P)+(P-o),P=h-Ce,S=h-(Ce+P)+(P-o),_===0&&b===0&&C===0&&S===0)||(we=Do*d+Lo*Math.abs(ke),ke+=de*S+Ce*_-(be*C+Pe*b),ke>=we||-ke>=we))return ke;fe=_*Ce,D=Mt*_,z=D-(D-_),J=_-z,D=Mt*Ce,j=D-(D-Ce),re=Ce-j,ae=J*re-(fe-z*j-J*j-z*re),I=b*Pe,D=Mt*b,z=D-(D-b),J=b-z,D=Mt*Pe,j=D-(D-Pe),re=Pe-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Ot[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Ot[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Ot[2]=ce-(_e-P)+(K-P),Ot[3]=_e;const Ue=Ar(4,Gi,4,Ot,ws);fe=de*S,D=Mt*de,z=D-(D-de),J=de-z,D=Mt*S,j=D-(D-S),re=S-j,ae=J*re-(fe-z*j-J*j-z*re),I=be*C,D=Mt*be,z=D-(D-be),J=be-z,D=Mt*C,j=D-(D-C),re=C-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Ot[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Ot[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Ot[2]=ce-(_e-P)+(K-P),Ot[3]=_e;const pe=Ar(Ue,ws,4,Ot,Cs);fe=_*S,D=Mt*_,z=D-(D-_),J=_-z,D=Mt*S,j=D-(D-S),re=S-j,ae=J*re-(fe-z*j-J*j-z*re),I=b*C,D=Mt*b,z=D-(D-b),J=b-z,D=Mt*C,j=D-(D-C),re=C-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Ot[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Ot[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Ot[2]=ce-(_e-P)+(K-P),Ot[3]=_e;const He=Ar(pe,Cs,4,Ot,Ss);return Ss[He-1]}function Fo(u,a,s,h,c,o){const d=(a-o)*(s-c),_=(u-c)*(h-o),b=d-_;if(d===0||_===0||d>0!=_>0)return b;const C=Math.abs(d+_);return Math.abs(b)>=Oo*C?b:-Vo(u,a,s,h,c,o,C)}function Zr(u,a,s){const h=Fo(u[0],u[1],a[0],a[1],s[0],s[1]);return h>0?-1:h<0?1:0}function _i(u,a){const s=u.point,h=a.point;return s[0]>h[0]?1:s[0]<h[0]?-1:s[1]!==h[1]?s[1]>h[1]?1:-1:Bo(u,a,s)}function Bo(u,a,s,h){return u.left!==a.left?u.left?1:-1:Zr(s,u.otherEvent.point,a.otherEvent.point)!==0?u.isBelow(a.otherEvent.point)?-1:1:!u.isSubject&&a.isSubject?1:-1}function mi(u,a,s){const h=new $i(a,!1,u,u.isSubject),c=new $i(a,!0,u.otherEvent,u.isSubject);return Yt(u.point,u.otherEvent.point)&&console.warn("what is that, a collapsed segment?",u),h.contourId=c.contourId=u.contourId,_i(c,u.otherEvent)>0&&(u.otherEvent.left=!0,c.left=!1),u.otherEvent.otherEvent=c,u.otherEvent=h,s.push(c),s.push(h),s}function jn(u,a){return u[0]*a[1]-u[1]*a[0]}function Tr(u,a){return u[0]*a[0]+u[1]*a[1]}function Uo(u,a,s,h,c){const o=[a[0]-u[0],a[1]-u[1]],d=[h[0]-s[0],h[1]-s[1]];function _(re,K,ce){return[re[0]+K*ce[0],re[1]+K*ce[1]]}const b=[s[0]-u[0],s[1]-u[1]];let C=jn(o,d),S=C*C;const P=Tr(o,o);if(S>0){const re=jn(b,d)/C;if(re<0||re>1)return null;const K=jn(b,o)/C;return K<0||K>1?null:re===0||re===1?[_(u,re,o)]:K===0||K===1?[_(s,K,d)]:[_(u,re,o)]}if(C=jn(b,o),S=C*C,S>0)return null;const D=Tr(o,b)/P,z=D+Tr(o,d)/P,J=Math.min(D,z),j=Math.max(D,z);return J<=1&&j>=0?J===1?[_(u,J>0?J:0,o)]:j===0?[_(u,j<1?j:1,o)]:[_(u,J>0?J:0,o),_(u,j<1?j:1,o)]:null}function Mr(u,a,s){const h=Uo(u.point,u.otherEvent.point,a.point,a.otherEvent.point),c=h?h.length:0;if(c===0||c===1&&(Yt(u.point,a.point)||Yt(u.otherEvent.point,a.otherEvent.point))||c===2&&u.isSubject===a.isSubject)return 0;if(c===1)return!Yt(u.point,h[0])&&!Yt(u.otherEvent.point,h[0])&&mi(u,h[0],s),!Yt(a.point,h[0])&&!Yt(a.otherEvent.point,h[0])&&mi(a,h[0],s),1;const o=[];let d=!1,_=!1;return Yt(u.point,a.point)?d=!0:_i(u,a)===1?o.push(a,u):o.push(u,a),Yt(u.otherEvent.point,a.otherEvent.point)?_=!0:_i(u.otherEvent,a.otherEvent)===1?o.push(a.otherEvent,u.otherEvent):o.push(u.otherEvent,a.otherEvent),d&&_||d?(a.type=ua,u.type=a.inOut===u.inOut?la:ha,d&&!_&&mi(o[1].otherEvent,o[0].point,s),2):_?(mi(o[0],o[1].point,s),3):o[0]!==o[3].otherEvent?(mi(o[0],o[1].point,s),mi(o[1],o[2].point,s),3):(mi(o[0],o[1].point,s),mi(o[3].otherEvent,o[2].point,s),3)}function qo(u,a){if(u===a)return 0;if(Zr(u.point,u.otherEvent.point,a.point)!==0||Zr(u.point,u.otherEvent.point,a.otherEvent.point)!==0)return Yt(u.point,a.point)?u.isBelow(a.otherEvent.point)?-1:1:u.point[0]===a.point[0]?u.point[1]<a.point[1]?-1:1:_i(u,a)===1?a.isAbove(u.point)?-1:1:u.isBelow(a.point)?-1:1;if(u.isSubject===a.isSubject){let s=u.point,h=a.point;if(s[0]===h[0]&&s[1]===h[1])return s=u.otherEvent.point,h=a.otherEvent.point,s[0]===h[0]&&s[1]===h[1]?0:u.contourId>a.contourId?1:-1}else return u.isSubject?-1:1;return _i(u,a)===1?1:-1}function Ho(u,a,s,h,c,o){const d=new es(qo),_=[],b=Math.min(h[2],c[2]);let C,S,P;for(;u.length!==0;){let D=u.pop();if(_.push(D),D.point[0]>b||o===ir)break;if(D.left){S=C=d.insert(D),P=d.minNode(),C!==P?C=d.prev(C):C=null,S=d.next(S);const z=C?C.key:null;let J;if(gn(D,z,o),S&&Mr(D,S.key,u)===2&&(gn(D,z,o),gn(S.key,D,o)),C&&Mr(C.key,D,u)===2){let j=C;j!==P?j=d.prev(j):j=null,J=j?j.key:null,gn(z,J,o),gn(D,z,o)}}else D=D.otherEvent,S=C=d.find(D),C&&S&&(C!==P?C=d.prev(C):C=null,S=d.next(S),d.remove(D),S&&C&&Mr(C.key,S.key,u))}return _}class Go{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function jo(u){let a,s,h,c;const o=[];for(s=0,h=u.length;s<h;s++)a=u[s],(a.left&&a.inResult||!a.left&&a.otherEvent.inResult)&&o.push(a);let d=!1;for(;!d;)for(d=!0,s=0,h=o.length;s<h;s++)s+1<h&&_i(o[s],o[s+1])===1&&(c=o[s],o[s]=o[s+1],o[s+1]=c,d=!1);for(s=0,h=o.length;s<h;s++)a=o[s],a.otherPos=s;for(s=0,h=o.length;s<h;s++)a=o[s],a.left||(c=a.otherPos,a.otherPos=a.otherEvent.otherPos,a.otherEvent.otherPos=c);return o}function Wo(u,a,s,h){let c=u+1,o=a[u].point,d;const _=a.length;for(c<_&&(d=a[c].point);c<_&&d[0]===o[0]&&d[1]===o[1];){if(s[c])c++;else return c;c<_&&(d=a[c].point)}for(c=u-1;s[c]&&c>h;)c--;return c}function Zo(u,a,s){const h=new Go;if(u.prevInResult!=null){const c=u.prevInResult,o=c.outputContourId;if(c.resultTransition>0){const _=a[o];if(_.holeOf!=null){const b=_.holeOf;a[b].holeIds.push(s),h.holeOf=b,h.depth=a[o].depth}else a[o].holeIds.push(s),h.holeOf=o,h.depth=a[o].depth+1}else h.holeOf=null,h.depth=a[o].depth}else h.holeOf=null,h.depth=0;return h}function $o(u){let a,s;const h=jo(u),c={},o=[];for(a=0,s=h.length;a<s;a++){if(c[a])continue;const d=o.length,_=Zo(h[a],o,d),b=D=>{c[D]=!0,D<h.length&&h[D]&&(h[D].outputContourId=d)};let C=a,S=a;const P=h[a].point;for(_.points.push(P);b(C),C=h[C].otherPos,b(C),_.points.push(h[C].point),C=Wo(C,h,c,S),!(C==S||C>=h.length||!h[C]););o.push(_)}return o}var Wn={exports:{}},Ps;function Ko(){if(Ps)return Wn.exports;Ps=1,Wn.exports=u,Wn.exports.default=u;function u(s,h){if(!(this instanceof u))return new u(s,h);if(this.data=s||[],this.length=this.data.length,this.compare=h||a,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)}function a(s,h){return s<h?-1:s>h?1:0}return u.prototype={push:function(s){this.data.push(s),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var s=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),s}},peek:function(){return this.data[0]},_up:function(s){for(var h=this.data,c=this.compare,o=h[s];s>0;){var d=s-1>>1,_=h[d];if(c(o,_)>=0)break;h[s]=_,s=d}h[s]=o},_down:function(s){for(var h=this.data,c=this.compare,o=this.length>>1,d=h[s];s<o;){var _=(s<<1)+1,b=_+1,C=h[_];if(b<this.length&&c(h[b],C)<0&&(_=b,C=h[b]),c(C,d)>=0)break;h[s]=C,s=_}h[s]=d}},Wn.exports}var Xo=Ko();const Yo=Jr(Xo),Is=Math.max,ks=Math.min;let Zn=0;function Es(u,a,s,h,c,o){let d,_,b,C,S,P;for(d=0,_=u.length-1;d<_;d++){if(b=u[d],C=u[d+1],S=new $i(b,!1,void 0,a),P=new $i(C,!1,S,a),S.otherEvent=P,b[0]===C[0]&&b[1]===C[1])continue;S.contourId=P.contourId=s,o||(S.isExteriorRing=!1,P.isExteriorRing=!1),_i(S,P)>0?P.left=!0:S.left=!0;const D=b[0],z=b[1];c[0]=ks(c[0],D),c[1]=ks(c[1],z),c[2]=Is(c[2],D),c[3]=Is(c[3],z),h.push(S),h.push(P)}}function Qo(u,a,s,h,c){const o=new Yo(null,_i);let d,_,b,C,S,P;for(b=0,C=u.length;b<C;b++)for(d=u[b],S=0,P=d.length;S<P;S++)_=S===0,_&&Zn++,Es(d[S],!0,Zn,o,s,_);for(b=0,C=a.length;b<C;b++)for(d=a[b],S=0,P=d.length;S<P;S++)_=S===0,_&&Zn++,Es(d[S],!1,Zn,o,h,_);return o}const nr=[];function Jo(u,a,s){let h=null;return u.length*a.length===0&&(h=nr),h}function eu(u,a,s,h,c){let o=null;return(s[0]>h[2]||h[0]>s[2]||s[1]>h[3]||h[1]>s[3])&&(o=nr),o}function tu(u,a,s){typeof u[0][0][0]=="number"&&(u=[u]),typeof a[0][0][0]=="number"&&(a=[a]);let h=Jo(u,a);if(h)return h===nr?null:h;const c=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],d=Qo(u,a,c,o);if(h=eu(u,a,c,o),h)return h===nr?null:h;const _=Ho(d,u,a,c,o,s),b=$o(_),C=[];for(let S=0;S<b.length;S++){let P=b[S];if(P.isExterior()){let D=[P.points];for(let z=0;z<P.holeIds.length;z++){let J=P.holeIds[z];D.push(b[J].points)}C.push(D)}}return C}function iu(u,a){return tu(u,a,tr)}function kn(u,a){const s=u[0]-a[0],h=u[1]-a[1];return s*s+h*h}function nu(u){return{vertices:u.vertices,pieces:Array.from(u.pieces.entries()),edges:Array.from(u.edges.entries()),halfEdges:Array.from(u.halfEdges.entries()),boundary:u.boundary,borderPath:u.borderPath}}function fa(u,a){let[s,h]=u,[c,o]=u;const d=_=>{s=Math.min(s,_[0]),h=Math.min(h,_[1]),c=Math.max(c,_[0]),o=Math.max(o,_[1])};for(const _ of a)_.type==="line"?d(_.p):(d(_.p1),d(_.p2),d(_.p3));return[s,h,c,o]}function da(u,a){let s=1/0,h=1/0,c=-1/0,o=-1/0;const d=u.halfEdge;let _=a.halfEdges.get(d);if(!_)return u.bounds;const b=C=>{s=Math.min(s,C[0]),h=Math.min(h,C[1]),c=Math.max(c,C[0]),o=Math.max(o,C[1])};do{if(b(_.origin),_.segments){const C=fa(_.origin,_.segments);b([C[0],C[1]]),b([C[2],C[3]])}_=a.halfEdges.get(_.next)}while(_&&_.id!==d);return[s,h,c,o]}const As=100,pa=As*As;function ru(u,a){let s=-1,h=pa;for(let c=0;c<u.vertices.length;c++){const o=kn(u.vertices[c],a);o<h&&(h=o,s=c)}return s===-1?null:s}function su(u,a){let s=null,h=pa;for(const c of u.pieces.values()){const o=kn(c.site,a);o<h&&(h=o,s=c.id)}return s}function $r(u){if(u.length===0)return[0,0,0,0];let a=u[0][0],s=u[0][1],h=a,c=s;for(let o=1;o<u.length;o++){const d=u[o];a=Math.min(a,d[0]),s=Math.min(s,d[1]),h=Math.max(h,d[0]),c=Math.max(c,d[1])}return[a,s,h,c]}function au(u,a){return Math.abs(u[0]-a[0])<1e-6&&Math.abs(u[1]-a[1])<1e-6}function ga(u,a,s,h){if(!u.tabs)return;const c=a.halfEdges.get(u.heLeft),o=a.halfEdges.get(u.heRight),d=c.origin,_=o.origin,b=[];let C=d;u.tabs.sort((S,P)=>S.position-P.position);for(const S of u.tabs){const P=S.position-S.size/2,D=[d[0]+(_[0]-d[0])*P,d[1]+(_[1]-d[1])*P];Math.hypot(D[0]-C[0],D[1]-C[1])>1e-6&&b.push({type:"line",p:D});const z=[d[0]+(_[0]-d[0])*(P+S.size),d[1]+(_[1]-d[1])*(P+S.size)],J=s.createTabSegments(D,z,S,h);b.push(...J),C=z}Math.hypot(_[0]-C[0],_[1]-C[1])>1e-6&&b.push({type:"line",p:_}),c.segments=b,o.segments=ou(b,d),u.bounds=fa(d,b)}function ou(u,a){const s=[];for(let h=u.length-1;h>=0;h--){const c=u[h];let o=a;if(h>0){const d=u[h-1];o=d.type==="line"?d.p:d.p3}c.type==="line"?s.push({type:"line",p:o}):s.push({type:"bezier",p1:c.p2,p2:c.p1,p3:o})}return s}function uu(u,a){const{p:s,radii:h,rotation:c,largeArc:o,sweep:d}=a,[_,b]=u,[C,S]=s,[P,D]=h;return To({px:_,py:b,cx:C,cy:S,rx:P,ry:D,xAxisRotation:c,largeArcFlag:o?1:0,sweepFlag:d?1:0}).map(j=>({type:"bezier",p1:[j.x1,j.y1],p2:[j.x2,j.y2],p3:[j.x,j.y]}))}function ma(u){const a=[];let s=[];if(u.length===0||u[0].type!=="move")return[];let h=[0,0];for(const c of u)switch(c.type){case"move":s.length>0&&a.push(s),h=c.p,s=[h];break;case"line":s.push(c.p),h=c.p;break;case"bezier":{const{p1:o,p2:d,p3:_}=c,C=new ft([...h,...o,...d,..._]).getLUT(100);s.push(...C.slice(1).map(S=>[S.x,S.y])),h=_;break}case"arc":{const o=uu(h,c);let d=h;for(const _ of o){const C=new ft([...d,..._.p1,..._.p2,..._.p3]).getLUT(100);s.push(...C.slice(1).map(S=>[S.x,S.y])),d=_.p3}h=c.p;break}}return s.length>0&&a.push(s),a}function ri(u,a,s){if(a.length>0&&a[0].type!=="move")throw new Error("Boundary path must start with a 'move' command.");const h=ma(a);let c=0;for(const o of h)cu(u,o)&&c++;return c%2===1}function lu(u){return Array.isArray(u[0])&&Array.isArray(u[0][0])&&typeof u[0][0][0]=="number"}function hu(u,a){const s=[u.map(o=>[o[0],o[1]])],h=[a.map(o=>[o[0],o[1]])],c=iu(s,h);return!c||c.length===0?null:lu(c)?c:c.map(o=>o[0].map(d=>[d[0],d[1]]))}function cu(u,a){const[s,h]=u;let c=!1;for(let o=0,d=a.length-1;o<a.length;d=o++){const[_,b]=a[o],[C,S]=a[d];b>h!=S>h&&s<(C-_)*(h-b)/(S-b)+_&&(c=!c)}return c}function fu(u,a,s){const h=[];for(const o of u)s.vertices.find(d=>au(d,o))||s.vertices.push(o);for(const o of u){const d={id:sa(),origin:o,twin:-1,next:-1,prev:-1,piece:a};h.push(d)}const c=h.length;for(let o=0;o<c;o++){const d=(o+1)%c,_=(o+c-1)%c;h[o].next=h[d].id,h[o].prev=h[_].id}return h.forEach(o=>s.halfEdges.set(o.id,o)),h}function va(u,a,s,h){const c=(d,_)=>`${d[0]},${d[1]}-${_[0]},${_[1]}`,o=u.length;for(let d=0;d<o;d++){const _=u[d],b=_.origin,C=a.halfEdges.get(_.next).origin,S=c(C,b),P=s.get(S),D=sa();let z;if(P!==void 0){const J=a.halfEdges.get(P);_.twin=J.id,J.twin=_.id,z={id:D,heLeft:J.id,heRight:_.id,bounds:$r([b,C])},s.delete(S)}else{const J=c(b,C);if(s.set(J,_.id),h(b,C))z={id:D,heLeft:_.id,heRight:-1,bounds:$r([b,C])},a.boundary.push(D);else continue}a.edges.set(D,z)}}function ts(u){return function(){let a=u+=1831565813;return a=Math.imul(a^a>>>15,a|1),a^=a+Math.imul(a^a>>>7,a|61),((a^a>>>14)>>>0)/4294967296}}function _a(u,a){return a()}async function du(u,a){return a()}async function Ri(u){return du("Puzzle Generation",()=>{const{bounds:a,pieceSize:s,border:h}=u,{pointConfig:c,pieceConfig:o,placementConfig:d,tabConfig:_}=u;console.log(`rebuilding puzzle with dimensions ${a.width}x${a.height}, piece size ${s}`);const b=vi.create(h,a,c),C=Ni.create(h,a,o),S=Oi.create(h,a,d),P=oi.create(h,a,_),D=u.seed??new Date().getTime(),z=ts(D),J=u.seedPoints??b.generatePoints({width:a.width,height:a.height,pieceSize:s,random:z,border:h});console.log(`${u.seedPoints?"Using":"Generated"} ${J.length} points`);const j=C.generatePieces(J,{random:z,pieceSize:s,border:h,bounds:a});if(console.log(`Generated ${j.pieces.size} pieces`),!u.skipTabs){S.placeTabs({topology:j,random:z});for(const K of j.edges.values())K.heRight!==-1&&K.tabs&&K.tabs.length>0&&ga(K,j,P,z)}const re={created:new Date().toISOString(),seed:D,width:a.width,height:a.height,pieceSize:s,pointConfig:c,pieceConfig:o,placementConfig:d,tabConfig:_,seedPoints:J,vertices:j.vertices,boundary:j.boundary,borderPath:j.borderPath,pieces:j.pieces,edges:j.edges,halfEdges:j.halfEdges};return Promise.resolve(re)})}async function ya(u,a,s){const h=[...u.seedPoints];let c=0;for(const o of u.pieces.values()){if(o.id===a){h[c]=s;break}c++}return Ri({bounds:{width:u.width,height:u.height},border:u.borderPath,pieceSize:u.pieceSize,pointConfig:u.pointConfig,pieceConfig:u.pieceConfig,placementConfig:u.placementConfig,tabConfig:u.tabConfig,seed:u.seed,seedPoints:h,skipTabs:!1})}function $n(u,a,s,h){_a("Canvas 2D Rendering",()=>{const c=a.getContext("2d");if(!c){console.error("Could not get 2D context from canvas");return}c.clearRect(0,0,a.width,a.height);{c.strokeStyle=s,c.lineWidth=1,c.beginPath();for(const o of u.edges.values()){const d=u.halfEdges.get(o.heLeft);if(d)if(c.moveTo(d.origin[0],d.origin[1]),d.segments&&d.segments.length>0)for(const _ of d.segments)switch(_.type){case"bezier":c.bezierCurveTo(_.p1[0],_.p1[1],_.p2[0],_.p2[1],_.p3[0],_.p3[1]);break;case"line":c.lineTo(_.p[0],_.p[1]);break}else{let _;d.twin!==-1?_=u.halfEdges.get(d.twin).origin:_=u.halfEdges.get(d.next).origin,c.lineTo(_[0],_[1])}}c.stroke()}if(u.problems&&u.problems.length>0){c.lineWidth=2,c.strokeStyle="red";for(const o of u.problems){const[d,_]=o;c.beginPath(),c.arc(d,_,8,0,2*Math.PI),c.stroke()}}if(h){c.fillStyle=h;for(const o of u.pieces.values()){const[d,_]=o.site;c.beginPath(),c.arc(d,_,3,0,2*Math.PI),c.fill()}}})}function Ki(u,a){return[{type:"move",p:[0,0]},{type:"line",p:[u,0]},{type:"line",p:[u,a]},{type:"line",p:[0,a]},{type:"line",p:[0,0]}]}function ba(u){const a=u/2,s=a;return[{type:"move",p:[0,s]},{type:"arc",p:[u,s],radii:[a,a],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,s],radii:[a,a],rotation:0,largeArc:!1,sweep:!0}]}function xa(u,a){const s=u/2,h=a/2;return[{type:"move",p:[0,h]},{type:"arc",p:[u,h],radii:[s,h],rotation:0,largeArc:!1,sweep:!0},{type:"arc",p:[0,h],radii:[s,h],rotation:0,largeArc:!1,sweep:!0}]}function wa(u,a,s){const h=Math.min(u,a)/2,c=Math.min(s,h);return[{type:"move",p:[c,0]},{type:"line",p:[u-c,0]},{type:"arc",p:[u,c],radii:[c,c],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[u,a-c]},{type:"arc",p:[u-c,a],radii:[c,c],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[c,a]},{type:"arc",p:[0,a-c],radii:[c,c],rotation:0,largeArc:!1,sweep:!0},{type:"line",p:[0,c]},{type:"arc",p:[c,0],radii:[c,c],rotation:0,largeArc:!1,sweep:!0}]}function Ca(u,a,s){if(a<0||a>=u.vertices.length){console.warn("moveVertex called with invalid vertex index:",a);return}const h=u.vertices[a];u.vertices[a]=s;const c=[];for(const _ of u.halfEdges.values())_.origin[0]===h[0]&&_.origin[1]===h[1]&&c.push(_);const o=new Set,d=[s[0]-h[0],s[1]-h[1]];for(const _ of c){_.origin=s,o.add(_.piece);const b=u.halfEdges.get(_.prev);if(b?.segments){const C=b.segments[b.segments.length-1];C.type==="line"?C.p=s:(C.p3=s,C.p1=[C.p1[0]+d[0],C.p1[1]+d[1]],C.p2=[C.p2[0]+d[0],C.p2[1]+d[1]]),o.add(b.piece)}}pu(u,a);for(const _ of o){const b=u.pieces.get(_);b&&(b.bounds=da(b,u))}}function pu(u,a){const{seed:s,width:h,height:c,placementConfig:o,tabConfig:d}=u,_=ts(s),b=Ki(h,c),C={width:h,height:c},S=Oi.create(b,C,o),P=oi.create(b,C,d),D=new Set,z=u.vertices[a],J=new Map;for(const re of u.edges.values())J.set(re.heLeft,re),re.heRight!==-1&&J.set(re.heRight,re);for(const re of u.halfEdges.values()){const K=u.halfEdges.get(re.next)?.origin;if(re.origin===z||K===z){const fe=J.get(re.id);fe&&D.add(fe)}}S.updateTabPlacements(Array.from(D),{topology:u,random:_});const j=new Set;for(const re of D)if(re.heRight!==-1){const ce=u.halfEdges.get(re.heLeft);ce&&(ce.segments=void 0,j.add(u.pieces.get(ce.piece)));const ue=u.halfEdges.get(re.heRight);ue&&(ue.segments=void 0,j.add(u.pieces.get(ue.piece))),ga(re,u,P,_)}for(const re of j)re.bounds=da(re,u)}const Ts=50,Ms=5,zs=Ms*Ms,gu=()=>{const u={canvas:null,isDragging:!1,draggedVertexId:-1,draggedSeedPointId:-1,lastRegenerationTime:0,pendingRegeneration:null,documentMouseMove:null,documentMouseUp:null},a=(S,P)=>{if(P.pointColor){for(const D of P.puzzle.pieces.values())if(kn(D.site,S)<zs)return!0}for(const D of P.puzzle.vertices)if(kn(D,S)<zs)return!0;return!1},s=S=>{if(!u.canvas)return[0,0];const P=u.canvas.getBoundingClientRect();if(S instanceof TouchEvent){if(S.changedTouches.length>0){const D=S.changedTouches[0];return[D.clientX-P.left,D.clientY-P.top]}}else return[S.clientX-P.left,S.clientY-P.top];return[0,0]},h=(S,P)=>{if(P.pointColor){const z=su(P.puzzle,S);if(z!==null)return{type:"seedPoint",id:z}}const D=ru(P.puzzle,S);return D!==null?{type:"vertex",id:D}:{type:"none"}},c=(S,P)=>{if(S.redraw=!1,u.isDragging)return;const D=s(S),z=a(D,P);u.canvas&&(u.canvas.style.cursor=z?"grab":"default")},o=(S,P,D)=>{const z=[...S.puzzle.seedPoints];let J=0;for(const j of S.puzzle.pieces.values()){if(j.id===P){z[J]=D;break}J++}Ri({bounds:{width:S.puzzle.width,height:S.puzzle.height},border:S.puzzle.borderPath,pieceSize:S.puzzle.pieceSize,pointConfig:S.puzzle.pointConfig,pieceConfig:S.puzzle.pieceConfig,placementConfig:S.puzzle.placementConfig,tabConfig:S.puzzle.tabConfig,seed:S.puzzle.seed,seedPoints:z,skipTabs:!0}).then(j=>{u.draggedSeedPointId===P&&$n(j,u.canvas,S.color,S.pointColor)}).catch(j=>{console.error("Failed to regenerate preview:",j)})},d=(S,P)=>{if(S.redraw=!1,S instanceof TouchEvent&&S.touches.length>1){u.isDragging=!1,u.draggedVertexId=-1,u.draggedSeedPointId=-1;return}if(S instanceof MouseEvent&&S.button!==0)return;const D=s(S),z=h(D,P);z.type==="vertex"?u.draggedVertexId=z.id:z.type==="seedPoint"&&(u.draggedSeedPointId=z.id),S instanceof MouseEvent&&(u.draggedVertexId>=0||u.draggedSeedPointId>=0)&&(u.documentMouseMove=J=>{const j=J;j.redraw=!1,_(j,P)},u.documentMouseUp=J=>{const j=J;j.redraw=!1,b(j,P)},document.addEventListener("mousemove",u.documentMouseMove),document.addEventListener("mouseup",u.documentMouseUp))},_=(S,P)=>{S.redraw=!1;const D=s(S);if(u.draggedVertexId>=0){u.isDragging=!0,S.preventDefault(),u.canvas&&(u.canvas.style.cursor="grabbing"),Ca(P.puzzle,u.draggedVertexId,D),$n(P.puzzle,u.canvas,P.color,P.pointColor);return}if(u.draggedSeedPointId>=0){u.isDragging=!0,S.preventDefault(),u.canvas&&(u.canvas.style.cursor="grabbing");const z=performance.now();if(z-u.lastRegenerationTime<Ts){u.pendingRegeneration&&clearTimeout(u.pendingRegeneration),u.pendingRegeneration=window.setTimeout(()=>{o(P,u.draggedSeedPointId,D)},Ts);return}u.lastRegenerationTime=z,o(P,u.draggedSeedPointId,D)}},b=(S,P)=>{S.redraw=!1,u.pendingRegeneration&&(clearTimeout(u.pendingRegeneration),u.pendingRegeneration=null);const D=u.draggedVertexId>=0&&u.isDragging,z=u.draggedSeedPointId>=0&&u.isDragging;if(D&&(S.preventDefault(),P.onPuzzleChanged(P.puzzle)),z){S.preventDefault();const J=u.draggedSeedPointId,j=s(S);P.onSeedPointMoved&&P.onSeedPointMoved(J,j)}u.documentMouseMove&&(document.removeEventListener("mousemove",u.documentMouseMove),u.documentMouseMove=null),u.documentMouseUp&&(document.removeEventListener("mouseup",u.documentMouseUp),u.documentMouseUp=null),u.canvas&&(u.canvas.style.cursor="default"),u.isDragging=!1,u.draggedVertexId=-1,u.draggedSeedPointId=-1,u.lastRegenerationTime=0},C="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";return{oncreate:({dom:S,attrs:P})=>{if(u.canvas=S.querySelector("canvas.puzzle"),!u.canvas){console.log("couldn't get canvas element");return}P.isDirty||$n(P.puzzle,u.canvas,P.color,P.pointColor)},onupdate:({attrs:S})=>{if(!u.canvas){console.log("couldn't get canvas element");return}S.isDirty||$n(S.puzzle,u.canvas,S.color,S.pointColor)},onremove:()=>{u.documentMouseMove&&(document.removeEventListener("mousemove",u.documentMouseMove),u.documentMouseMove=null),u.documentMouseUp&&(document.removeEventListener("mouseup",u.documentMouseUp),u.documentMouseUp=null)},view:({attrs:S})=>Y(".puzzle-stack",[Y("img.background",{width:S.width,height:S.height,src:S.imageUrl??C}),Y("canvas.puzzle",{width:S.width,height:S.height,style:{width:`${S.width}px`,height:`${S.height}px`,touchAction:"manipulation"},onmousedown:P=>d(P,S),onmousemove:P=>{c(P,S),_(P,S)},onmouseup:P=>b(P,S),ontouchstart:P=>d(P,S),ontouchmove:P=>_(P,S),ontouchend:P=>b(P,S),ontouchcancel:P=>b(P,S)})])}};function mu(u,a,s,h="black"){const o=[];for(const b of u.edges.values()){const C=u.halfEdges.get(b.heLeft);if(C)if(o.push(`M ${C.origin[0].toFixed(3)} ${C.origin[1].toFixed(3)}`),C.segments)for(const S of C.segments)switch(S.type){case"bezier":o.push(`C ${S.p1[0].toFixed(3)} ${S.p1[1].toFixed(3)}, ${S.p2[0].toFixed(3)} ${S.p2[1].toFixed(3)}, ${S.p3[0].toFixed(3)} ${S.p3[1].toFixed(3)}`);break;case"line":o.push(`L ${S.p[0].toFixed(3)} ${S.p[1].toFixed(3)}`);break}else{let S;C.twin!==-1?S=u.halfEdges.get(C.twin).origin:S=u.halfEdges.get(C.next).origin,o.push(`L ${S[0].toFixed(3)} ${S[1].toFixed(3)}`)}}const d=o.join(" ");return`
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg
  width="${a}"
  height="${s}"
  viewBox="0 0 ${a} ${s}"
  xmlns="http://www.w3.org/2000/svg"
  version="1.1"
>
  <path
    d="${d}"
    fill="none"
    stroke="${h}"
    stroke-width="1"
    vector-effect="non-scaling-stroke"
  />
</svg>`.trim().replace(/\r\n/g,`
`)}function vu(u,a="puzzle.svg"){const s=new Blob([u],{type:"image/svg+xml"}),h=URL.createObjectURL(s),c=document.createElement("a");c.href=h,c.download=a,c.hidden=!0,document.body.appendChild(c),c.click(),document.body.removeChild(c),setTimeout(()=>URL.revokeObjectURL(h),100)}const Sa={view:({attrs:u})=>Y("wa-button.download-svg",{size:"small",onclick:()=>{const a=mu(u.puzzle,u.width,u.height,u.color);vu(a,u.filename??"puzzle.svg")}},"Download SVG")},Pa={view:({attrs:u})=>{const a=u.progressPercent!==void 0&&u.progressPercent<100,s=!a&&u.problems!==void 0&&u.problems==0,h=!a&&u.problems!==void 0&&u.problems>0;return Y(".geometry-check-indicator",[Y(".label","Geometry Check:"),Y("wa-tooltip",{for:"check-geometry-now"},"Check geometry now"),Y("wa-button#check-geometry-now",{variant:"neutral",appearance:"plain",size:"small",disabled:a,onclick:c=>{c.redraw=!1,u.onCheckRequested?.()}},Y("wa-icon",{library:"material",name:"editor_choice",label:"Check geometry now"})),Y("wa-tooltip",{for:"auto-check-geometry"},"Check geometry after every change"),Y("wa-checkbox#auto-check-geometry",{checked:u.autoCheck,disabled:a,size:"small",onchange:c=>{c.redraw=!1;const o=c.target;u.onAutocheckChanged?.(o.checked)}},"auto check"),a&&Y("wa-progress-bar",{label:"Geometry check progress",value:u.progressPercent??0}),s&&Y("wa-badge",{variant:"success",pill:!0},"OK"),h&&Y("wa-badge",{variant:"danger",pill:!0},`${u.problems} issue${u.problems===1?"":"s"}`)])}};function _u(u,a,s=800){if(u<=s)return{width:u,height:a};const h=a/u;return{width:s,height:Math.round(s*h)}}const Ia=()=>{const u={inputElement:void 0,imageLoaded:!1,imageName:""};return{view:({attrs:a})=>[Y("wa-button.upload-button",{size:"small",disabled:a.disabled===!0,onclick:()=>{u.inputElement&&u.inputElement.click()}},a.label??"Upload Image"),Y("input[type=file]",{style:{display:"none"},accept:"image/*",oncreate:({dom:s})=>{u.inputElement=s},onchange:s=>{if(s.redraw=!1,u.inputElement){const h=u.inputElement.files?.[0];h?.type.startsWith("image/")&&createImageBitmap(h).then(c=>{const{width:o,height:d}=_u(c.width,c.height),_=URL.createObjectURL(h);c.close(),u.imageName=h.name,a.onUpload(_,h.name,o,d),u.imageLoaded=!0}).catch(c=>{console.error("could not create a bitmap image: ",c)})}}}),Y("span.background-image-label",u.imageName),u.imageLoaded&&Y("wa-icon.clear-button",{library:"material",name:"close",label:"Clear background image",onclick:s=>{s.redraw=!1,!a.disabled&&(u.imageName="",u.imageLoaded=!1,a.onClear())}},"Clear")]}},is=()=>({view:({attrs:u})=>Y("wa-checkbox.boolean-input",{hint:u.config.helpText,disabled:u.disabled,checked:u.value,onchange:a=>{const h=a.target.checked;u.onChange(h)}},u.config.label)}),Li=()=>({view:({attrs:u})=>Y("wa-input.number-input",{label:u.config.label,hint:u.config.helpText,type:"number",inputmode:"numeric",size:"small",disabled:u.disabled,value:u.value,min:u.config.min,max:u.config.max,onchange:a=>{const s=a.target,h=parseFloat(s.value??"");u.onChange(isNaN(h)?void 0:h)}})}),yu=()=>({view:({attrs:u})=>Y("wa-slider.range-input",{label:u.config.label,hint:u.config.helpText,disabled:u.disabled,value:u.value,min:u.config.min,max:u.config.max,step:u.config.step,"with-tooltip":!0,onchange:a=>{const h=a.target.value;u.onChange(isNaN(h)?void 0:h)}})}),bu=()=>({view:({attrs:u})=>Y("wa-input.string-input",{label:u.config.label,hint:u.config.helpText,type:"text",inputmode:"text",size:"small",disabled:u.disabled,value:u.value,onchange:a=>{const h=a.target.value??"";u.onChange(h.length>0?h:void 0)}})}),ka=()=>({view:({attrs:u})=>{const a=u.registry.getAvailableGenerators();return Y(".generator-picker",Y("wa-tab-group",{active:u.generator,"onwa-tab-show":s=>{const h=s.detail.name;u.generator!==h&&u.onGeneratorChange(h)}},[...a.map(s=>{const h=u.registry.getUIMetadata(s.name),c=Y("wa-tab",{panel:s.name},s.displayName),o=Y("wa-tab-panel",{name:s.name},Y(".controls",[h?.description?Y("p",h.description):null,...h?.controls.map(d=>{switch(d.type){case"range":return Y(yu,{config:d,value:u.config?.[d.name]??d.defaultValue,onChange:_=>{u.onConfigChange(d.name,_)}});case"boolean":return Y(is,{config:d,value:(u.config?.[d.name]??d.defaultValue)===!0,onChange:_=>{u.onConfigChange(d.name,_)}});case"number":return Y(Li,{config:d,value:u.config?.[d.name]??d.defaultValue,onChange:_=>{u.onConfigChange(d.name,_)}});case"string":return Y(bu,{config:d,value:u.config?.[d.name]??d.defaultValue,onChange:_=>{u.onConfigChange(d.name,_)}})}})??[],!h?.description&&h?.controls.length==0?Y("p","No controls for this strategy."):null]));return[c,o]})]))}}),Ls=[["Square","1:1",1],["Classic Photo","5:4",5/4],["Standard Photo","4:3",4/3],["35mm/DSLR","3:2",3/2],["Widescreen","16:9",16/9],["UltraWide","21:9",21/9],["Panorama","2:1",2/1],["Instagram Portrait","4:5",4/5],["Classic Portrait","3:4",3/4],["DSLR Portrait","2:3",2/3],["Phone Portrait","9:16",9/16],["Tall Poster","9:21",9/21],["Tall Panorama","1:2",1/2]],Ea={view:({attrs:u})=>{const a=!Ls.some(([,,h])=>h===u.ratio),s=Ls.map(([h,c,o])=>Y("wa-option",{value:String(o)},`${h} [${c}]`));return a&&s.unshift(Y("wa-option",{value:"custom"},"Custom")),Y(".aspect-ratio-picker",[Y("wa-select",{label:"Aspect Ratio",size:"small",disabled:u.disabled,value:a?"custom":String(u.ratio),onchange:h=>{h.redraw=!1;const o=h.target.value;o&&o!=="custom"&&u.onChange(Number(o))}},s),Y("wa-slider",{min:.25,max:4,step:.01,"with-tooltip":!0,size:"small",disabled:u.disabled,value:u.ratio,onchange:h=>{h.redraw=!1;const c=h.target;u.onChange(c.value)}})])}},rr={view:({attrs:u})=>Y("wa-color-picker",{label:u.label,value:u.color,size:u.size??"medium",format:"rgb",onchange:a=>{a.redraw=!1;const s=a.target;u.onUpdate(s.value??"")}})},xu=[["rectangle","Rectangle"],["circle","Circle"],["ellipse","Ellipse"],["rounded-rect","Rounded Rectangle"]],Aa={view:({attrs:u})=>{const a=xu.map(([s,h])=>Y("wa-option",{value:s},h));return Y("wa-select",{label:"Border Shape",size:"small",disabled:u.disabled,value:u.shape,onchange:s=>{s.redraw=!1;const c=s.target.value;c&&u.onChange(c)}},a)}};var zr,Ns;function Ta(){if(Ns)return zr;Ns=1;function u(s){var h=s.length,c=1,o=new Array(h),d;for(d=h;d>0;d--)o[d-1]=c,c=c*s[d-1];return{stride:o,data:new Uint32Array(c)}}function a(s){var h=s.length,c=1,o=new Array(h),d=[],_,b;for(_=h;_>0;_--)o[_-1]=c,c=c*s[_-1];for(b=0;b<c;b++)d.push([]);return{stride:o,data:d}}return zr={integer:u,array:a},zr}var Lr,Os;function Ma(){if(Os)return Lr;Os=1,Lr=u;function u(a,s){var h=new Array(a),c=Math.floor(a/2)<<1,o=0,d,_,b,C,S;for(S=0;S<c;S+=2)d=-2*Math.log(s()),_=Math.sqrt(d),b=2*Math.PI*s(),o+=d,h[S]=_*Math.cos(b),h[S+1]=_*Math.sin(b);if(a%2){var P=Math.sqrt(-2*Math.log(s()))*Math.cos(2*Math.PI*s());h[a-1]=P,o+=Math.pow(P,2)}for(C=1/Math.sqrt(o),S=0;S<a;++S)h[S]*=C;return h}return Lr}var Nr,Rs;function wu(){return Rs||(Rs=1,Nr=function(a,s){a=a||1,s=s||2;for(var h=a*2+1,c=Math.pow(h,s)-1,o=new Array(c),d=0;d<c;d++)for(var _=o[d]=new Array(s),b=d<c/2?d:d+1,C=1;C<=s;C++){var S=b%Math.pow(h,C);_[C-1]=S/Math.pow(h,C-1)-a,b-=S}return o}),Nr}var Or,Ds;function za(){if(Ds)return Or;Ds=1;var u=wu();function a(c){var o=u(2,c),d=[],_;for(o=o.filter(function(b){for(var C=0,S=0;S<c;S++)C+=Math.pow(Math.max(0,Math.abs(b[S])-1),2);return C<c}),_=0;_<c;_++)d.push(0);return o.push(d),o.sort(function(b,C){var S=0,P=0,D;for(D=0;D<c;D++)S+=Math.pow(b[D],2),P+=Math.pow(C[D],2);return S<P?-1:S>P?1:0}),o}var s={};function h(c){return s[c]||(s[c]=a(c)),s[c]}return Or=h,Or}var Rr,Vs;function Cu(){if(Vs)return Rr;Vs=1;var u=Ta().integer,a=Ma(),s=za();function h(o,d){for(var _=0,b=0;b<o.length;b++)_+=Math.pow(o[b]-d[b],2);return _}function c(o,d){if(typeof o.distanceFunction=="function")throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=o.shape,this.minDistance=o.minDistance,this.maxDistance=o.maxDistance||o.minDistance*2,this.maxTries=Math.ceil(Math.max(1,o.tries||30)),this.rng=d||Math.random;for(var _=0,b=0;b<this.shape.length;b++)_=Math.max(_,this.shape[b]);var C=Math.max(1,_/128|0),S=1e-14*C;this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+S,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=s(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var b=0;b<this.dimension;b++)this.gridShape.push(Math.ceil(this.shape[b]/this.cellSize));this.grid=u(this.gridShape)}return c.prototype.shape=null,c.prototype.dimension=null,c.prototype.minDistance=null,c.prototype.maxDistance=null,c.prototype.minDistancePlusEpsilon=null,c.prototype.squaredMinDistance=null,c.prototype.deltaDistance=null,c.prototype.cellSize=null,c.prototype.maxTries=null,c.prototype.rng=null,c.prototype.neighbourhood=null,c.prototype.currentPoint=null,c.prototype.processList=null,c.prototype.samplePoints=null,c.prototype.gridShape=null,c.prototype.grid=null,c.prototype.addRandomPoint=function(){for(var o=new Array(this.dimension),d=0;d<this.dimension;d++)o[d]=this.rng()*this.shape[d];return this.directAddPoint(o)},c.prototype.addPoint=function(o){var d,_=!0;if(o.length===this.dimension)for(d=0;d<this.dimension&&_;d++)_=o[d]>=0&&o[d]<this.shape[d];else _=!1;return _?this.directAddPoint(o):null},c.prototype.directAddPoint=function(o){var d=0,_=this.grid.stride,b;for(this.processList.push(o),this.samplePoints.push(o),b=0;b<this.dimension;b++)d+=(o[b]/this.cellSize|0)*_[b];return this.grid.data[d]=this.samplePoints.length,o},c.prototype.inNeighbourhood=function(o){var d=this.dimension,_=this.grid.stride,b,C,S,P,D;for(b=0;b<this.neighbourhood.length;b++){for(C=0,S=0;S<d;S++){if(P=(o[S]/this.cellSize|0)+this.neighbourhood[b][S],P<0||P>=this.gridShape[S]){C=-1;break}C+=P*_[S]}if(C!==-1&&this.grid.data[C]!==0&&(D=this.samplePoints[this.grid.data[C]-1],h(o,D)<this.squaredMinDistance))return!0}return!1},c.prototype.next=function(){for(var o,d,_,b,C,S,P;this.processList.length>0;){for(this.currentPoint===null&&(this.currentPoint=this.processList.shift()),b=this.currentPoint,o=0;o<this.maxTries;o++){for(S=!0,_=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),this.dimension===2?(d=this.rng()*Math.PI*2,C=[Math.cos(d),Math.sin(d)]):C=a(this.dimension,this.rng),P=0;S&&P<this.dimension;P++)C[P]=b[P]+C[P]*_,S=C[P]>=0&&C[P]<this.shape[P];if(S&&!this.inNeighbourhood(C))return this.directAddPoint(C)}o===this.maxTries&&(this.currentPoint=null)}return null},c.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},c.prototype.getAllPoints=function(){return this.samplePoints},c.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},c.prototype.reset=function(){var o=this.grid.data,d=0;for(d=0;d<o.length;d++)o[d]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},Rr=c,Rr}var Dr,Fs;function Su(){if(Fs)return Dr;Fs=1;var u=Ta().array,a=Ma(),s=za();function h(o,d){for(var _=0,b=0;b<o.length;b++)_+=Math.pow(o[b]-d[b],2);return Math.sqrt(_)}function c(o,d){if(typeof o.distanceFunction!="function")throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=o.shape,this.minDistance=o.minDistance,this.maxDistance=o.maxDistance||o.minDistance*2,this.maxTries=Math.ceil(Math.max(1,o.tries||30)),this.distanceFunction=o.distanceFunction,this.bias=Math.max(0,Math.min(1,o.bias||0)),this.rng=d||Math.random;for(var _=0,b=0;b<this.shape.length;b++)_=Math.max(_,this.shape[b]);var C=Math.max(1,_/128|0),S=1e-14*C;this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+S,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=s(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var b=0;b<this.dimension;b++)this.gridShape.push(Math.ceil(this.shape[b]/this.cellSize));this.grid=u(this.gridShape)}return c.prototype.shape=null,c.prototype.dimension=null,c.prototype.minDistance=null,c.prototype.maxDistance=null,c.prototype.minDistancePlusEpsilon=null,c.prototype.deltaDistance=null,c.prototype.cellSize=null,c.prototype.maxTries=null,c.prototype.distanceFunction=null,c.prototype.bias=null,c.prototype.rng=null,c.prototype.neighbourhood=null,c.prototype.currentPoint=null,c.prototype.currentDistance=null,c.prototype.processList=null,c.prototype.samplePoints=null,c.prototype.sampleDistance=null,c.prototype.gridShape=null,c.prototype.grid=null,c.prototype.addRandomPoint=function(){for(var o=new Array(this.dimension),d=0;d<this.dimension;d++)o[d]=this.rng()*this.shape[d];return this.directAddPoint(o)},c.prototype.addPoint=function(o){var d,_=!0;if(o.length===this.dimension)for(d=0;d<this.dimension&&_;d++)_=o[d]>=0&&o[d]<this.shape[d];else _=!1;return _?this.directAddPoint(o):null},c.prototype.directAddPoint=function(o){var d=0,_=this.grid.stride,b=this.samplePoints.length,C;for(this.processList.push(b),this.samplePoints.push(o),this.sampleDistance.push(this.distanceFunction(o)),C=0;C<this.dimension;C++)d+=(o[C]/this.cellSize|0)*_[C];return this.grid.data[d].push(b),o},c.prototype.inNeighbourhood=function(o){var d=this.dimension,_=this.grid.stride,b,C,S,P,D,z,J=this.distanceFunction(o);for(b=0;b<this.neighbourhood.length;b++){for(C=0,S=0;S<d;S++){if(P=(o[S]/this.cellSize|0)+this.neighbourhood[b][S],P<0||P>=this.gridShape[S]){C=-1;break}C+=P*_[S]}if(C!==-1&&this.grid.data[C].length>0)for(var j=0;j<this.grid.data[C].length;j++){D=this.samplePoints[this.grid.data[C][j]],z=this.sampleDistance[this.grid.data[C][j]];var re=Math.min(z,J),K=Math.max(z,J),ce=re+(K-re)*this.bias;if(h(o,D)<this.minDistance+this.deltaDistance*ce)return!0}}return!1},c.prototype.next=function(){for(var o,d,_,b,C,S,P,D;this.processList.length>0;){if(this.currentPoint===null){var z=this.processList.shift();this.currentPoint=this.samplePoints[z],this.currentDistance=this.sampleDistance[z]}for(b=this.currentPoint,C=this.currentDistance,o=0;o<this.maxTries;o++){for(P=!0,_=this.minDistancePlusEpsilon+this.deltaDistance*(C+(1-C)*this.bias),this.dimension===2?(d=this.rng()*Math.PI*2,S=[Math.cos(d),Math.sin(d)]):S=a(this.dimension,this.rng),D=0;P&&D<this.dimension;D++)S[D]=b[D]+S[D]*_,P=S[D]>=0&&S[D]<this.shape[D];if(P&&!this.inNeighbourhood(S))return this.directAddPoint(S)}o===this.maxTries&&(this.currentPoint=null)}return null},c.prototype.fill=function(){for(this.samplePoints.length===0&&this.addRandomPoint();this.next(););return this.samplePoints},c.prototype.getAllPoints=function(){return this.samplePoints},c.prototype.getAllPointsWithDistance=function(){var o=new Array(this.samplePoints.length),d=0,_=0,b;for(d=0;d<this.samplePoints.length;d++){for(b=new Array(this.dimension+1),_=0;_<this.dimension;_++)b[_]=this.samplePoints[d][_];b[this.dimension]=this.sampleDistance[d],o[d]=b}return o},c.prototype.reset=function(){var o=this.grid.data,d=0;for(d=0;d<o.length;d++)o[d]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},Dr=c,Dr}var Vr,Bs;function Pu(){if(Bs)return Vr;Bs=1;var u=Cu(),a=Su();function s(h,c){this.shape=h.shape,typeof h.distanceFunction=="function"?this.implementation=new a(h,c):this.implementation=new u(h,c)}return s.prototype.implementation=null,s.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},s.prototype.addPoint=function(h){return this.implementation.addPoint(h)},s.prototype.next=function(){return this.implementation.next()},s.prototype.fill=function(){return this.implementation.fill()},s.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},s.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},s.prototype.reset=function(){this.implementation.reset()},Vr=s,Vr}var Iu=Pu();const ku=Jr(Iu),hr="PoissonPointGenerator",Eu={name:hr,displayName:"Poisson",description:"Generate seed points using Poisson disk sampling. The algorithm produces points that are tightly-packed, but no closer to each other than a specified minimum distance (the piece size), resulting in a natural, organic look.",sortHint:1,controls:[]},Au=(u,a,s)=>({generatePoints(c){const{width:o,height:d,pieceSize:_,random:b,border:C}=c;return new ku({shape:[o,d],minDistance:_,tries:20},b).fill().filter(z=>ri(z,C))}});vi.register(hr,Au,Eu);const ai=11102230246251565e-32,zt=134217729,Tu=(3+8*ai)*ai;function Fr(u,a,s,h,c){let o,d,_,b,C=a[0],S=h[0],P=0,D=0;S>C==S>-C?(o=C,C=a[++P]):(o=S,S=h[++D]);let z=0;if(P<u&&D<s)for(S>C==S>-C?(d=C+o,_=o-(d-C),C=a[++P]):(d=S+o,_=o-(d-S),S=h[++D]),o=d,_!==0&&(c[z++]=_);P<u&&D<s;)S>C==S>-C?(d=o+C,b=d-o,_=o-(d-b)+(C-b),C=a[++P]):(d=o+S,b=d-o,_=o-(d-b)+(S-b),S=h[++D]),o=d,_!==0&&(c[z++]=_);for(;P<u;)d=o+C,b=d-o,_=o-(d-b)+(C-b),C=a[++P],o=d,_!==0&&(c[z++]=_);for(;D<s;)d=o+S,b=d-o,_=o-(d-b)+(S-b),S=h[++D],o=d,_!==0&&(c[z++]=_);return(o!==0||z===0)&&(c[z++]=o),z}function Mu(u,a){let s=a[0];for(let h=1;h<u;h++)s+=a[h];return s}function An(u){return new Float64Array(u)}const zu=(3+16*ai)*ai,Lu=(2+12*ai)*ai,Nu=(9+64*ai)*ai*ai,ji=An(4),Us=An(8),qs=An(12),Hs=An(16),Rt=An(4);function Ou(u,a,s,h,c,o,d){let _,b,C,S,P,D,z,J,j,re,K,ce,ue,fe,ae,I,le,_e;const de=u-c,Pe=s-c,be=a-o,Ce=h-o;fe=de*Ce,D=zt*de,z=D-(D-de),J=de-z,D=zt*Ce,j=D-(D-Ce),re=Ce-j,ae=J*re-(fe-z*j-J*j-z*re),I=be*Pe,D=zt*be,z=D-(D-be),J=be-z,D=zt*Pe,j=D-(D-Pe),re=Pe-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,ji[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,ji[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,ji[2]=ce-(_e-P)+(K-P),ji[3]=_e;let ke=Mu(4,ji),we=Lu*d;if(ke>=we||-ke>=we||(P=u-de,_=u-(de+P)+(P-c),P=s-Pe,C=s-(Pe+P)+(P-c),P=a-be,b=a-(be+P)+(P-o),P=h-Ce,S=h-(Ce+P)+(P-o),_===0&&b===0&&C===0&&S===0)||(we=Nu*d+Tu*Math.abs(ke),ke+=de*S+Ce*_-(be*C+Pe*b),ke>=we||-ke>=we))return ke;fe=_*Ce,D=zt*_,z=D-(D-_),J=_-z,D=zt*Ce,j=D-(D-Ce),re=Ce-j,ae=J*re-(fe-z*j-J*j-z*re),I=b*Pe,D=zt*b,z=D-(D-b),J=b-z,D=zt*Pe,j=D-(D-Pe),re=Pe-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Rt[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Rt[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Rt[2]=ce-(_e-P)+(K-P),Rt[3]=_e;const Ue=Fr(4,ji,4,Rt,Us);fe=de*S,D=zt*de,z=D-(D-de),J=de-z,D=zt*S,j=D-(D-S),re=S-j,ae=J*re-(fe-z*j-J*j-z*re),I=be*C,D=zt*be,z=D-(D-be),J=be-z,D=zt*C,j=D-(D-C),re=C-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Rt[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Rt[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Rt[2]=ce-(_e-P)+(K-P),Rt[3]=_e;const pe=Fr(Ue,Us,4,Rt,qs);fe=_*S,D=zt*_,z=D-(D-_),J=_-z,D=zt*S,j=D-(D-S),re=S-j,ae=J*re-(fe-z*j-J*j-z*re),I=b*C,D=zt*b,z=D-(D-b),J=b-z,D=zt*C,j=D-(D-C),re=C-j,le=J*re-(I-z*j-J*j-z*re),K=ae-le,P=ae-K,Rt[0]=ae-(K+P)+(P-le),ce=fe+K,P=ce-fe,ue=fe-(ce-P)+(K-P),K=ue-I,P=ue-K,Rt[1]=ue-(K+P)+(P-I),_e=ce+K,P=_e-ce,Rt[2]=ce-(_e-P)+(K-P),Rt[3]=_e;const He=Fr(pe,qs,4,Rt,Hs);return Hs[He-1]}function Kn(u,a,s,h,c,o){const d=(a-o)*(s-c),_=(u-c)*(h-o),b=d-_,C=Math.abs(d+_);return Math.abs(b)>=zu*C?b:-Ou(u,a,s,h,c,o,C)}const Gs=Math.pow(2,-52),Xn=new Uint32Array(512);class sr{static from(a,s=Bu,h=Uu){const c=a.length,o=new Float64Array(c*2);for(let d=0;d<c;d++){const _=a[d];o[2*d]=s(_),o[2*d+1]=h(_)}return new sr(o)}constructor(a){const s=a.length>>1;if(s>0&&typeof a[0]!="number")throw new Error("Expected coords to contain numbers.");this.coords=a;const h=Math.max(2*s-5,0);this._triangles=new Uint32Array(h*3),this._halfedges=new Int32Array(h*3),this._hashSize=Math.ceil(Math.sqrt(s)),this._hullPrev=new Uint32Array(s),this._hullNext=new Uint32Array(s),this._hullTri=new Uint32Array(s),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(s),this._dists=new Float64Array(s),this.update()}update(){const{coords:a,_hullPrev:s,_hullNext:h,_hullTri:c,_hullHash:o}=this,d=a.length>>1;let _=1/0,b=1/0,C=-1/0,S=-1/0;for(let de=0;de<d;de++){const Pe=a[2*de],be=a[2*de+1];Pe<_&&(_=Pe),be<b&&(b=be),Pe>C&&(C=Pe),be>S&&(S=be),this._ids[de]=de}const P=(_+C)/2,D=(b+S)/2;let z,J,j;for(let de=0,Pe=1/0;de<d;de++){const be=Br(P,D,a[2*de],a[2*de+1]);be<Pe&&(z=de,Pe=be)}const re=a[2*z],K=a[2*z+1];for(let de=0,Pe=1/0;de<d;de++){if(de===z)continue;const be=Br(re,K,a[2*de],a[2*de+1]);be<Pe&&be>0&&(J=de,Pe=be)}let ce=a[2*J],ue=a[2*J+1],fe=1/0;for(let de=0;de<d;de++){if(de===z||de===J)continue;const Pe=Vu(re,K,ce,ue,a[2*de],a[2*de+1]);Pe<fe&&(j=de,fe=Pe)}let ae=a[2*j],I=a[2*j+1];if(fe===1/0){for(let be=0;be<d;be++)this._dists[be]=a[2*be]-a[0]||a[2*be+1]-a[1];Zi(this._ids,this._dists,0,d-1);const de=new Uint32Array(d);let Pe=0;for(let be=0,Ce=-1/0;be<d;be++){const ke=this._ids[be],we=this._dists[ke];we>Ce&&(de[Pe++]=ke,Ce=we)}this.hull=de.subarray(0,Pe),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(Kn(re,K,ce,ue,ae,I)<0){const de=J,Pe=ce,be=ue;J=j,ce=ae,ue=I,j=de,ae=Pe,I=be}const le=Fu(re,K,ce,ue,ae,I);this._cx=le.x,this._cy=le.y;for(let de=0;de<d;de++)this._dists[de]=Br(a[2*de],a[2*de+1],le.x,le.y);Zi(this._ids,this._dists,0,d-1),this._hullStart=z;let _e=3;h[z]=s[j]=J,h[J]=s[z]=j,h[j]=s[J]=z,c[z]=0,c[J]=1,c[j]=2,o.fill(-1),o[this._hashKey(re,K)]=z,o[this._hashKey(ce,ue)]=J,o[this._hashKey(ae,I)]=j,this.trianglesLen=0,this._addTriangle(z,J,j,-1,-1,-1);for(let de=0,Pe,be;de<this._ids.length;de++){const Ce=this._ids[de],ke=a[2*Ce],we=a[2*Ce+1];if(de>0&&Math.abs(ke-Pe)<=Gs&&Math.abs(we-be)<=Gs||(Pe=ke,be=we,Ce===z||Ce===J||Ce===j))continue;let Ue=0;for(let it=0,Lt=this._hashKey(ke,we);it<this._hashSize&&(Ue=o[(Lt+it)%this._hashSize],!(Ue!==-1&&Ue!==h[Ue]));it++);Ue=s[Ue];let pe=Ue,He;for(;He=h[pe],Kn(ke,we,a[2*pe],a[2*pe+1],a[2*He],a[2*He+1])>=0;)if(pe=He,pe===Ue){pe=-1;break}if(pe===-1)continue;let et=this._addTriangle(pe,Ce,h[pe],-1,-1,c[pe]);c[Ce]=this._legalize(et+2),c[pe]=et,_e++;let Ve=h[pe];for(;He=h[Ve],Kn(ke,we,a[2*Ve],a[2*Ve+1],a[2*He],a[2*He+1])<0;)et=this._addTriangle(Ve,Ce,He,c[Ce],-1,c[Ve]),c[Ce]=this._legalize(et+2),h[Ve]=Ve,_e--,Ve=He;if(pe===Ue)for(;He=s[pe],Kn(ke,we,a[2*He],a[2*He+1],a[2*pe],a[2*pe+1])<0;)et=this._addTriangle(He,Ce,pe,-1,c[pe],c[He]),this._legalize(et+2),c[He]=et,h[pe]=pe,_e--,pe=He;this._hullStart=s[Ce]=pe,h[pe]=s[Ve]=Ce,h[Ce]=Ve,o[this._hashKey(ke,we)]=Ce,o[this._hashKey(a[2*pe],a[2*pe+1])]=pe}this.hull=new Uint32Array(_e);for(let de=0,Pe=this._hullStart;de<_e;de++)this.hull[de]=Pe,Pe=h[Pe];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(a,s){return Math.floor(Ru(a-this._cx,s-this._cy)*this._hashSize)%this._hashSize}_legalize(a){const{_triangles:s,_halfedges:h,coords:c}=this;let o=0,d=0;for(;;){const _=h[a],b=a-a%3;if(d=b+(a+2)%3,_===-1){if(o===0)break;a=Xn[--o];continue}const C=_-_%3,S=b+(a+1)%3,P=C+(_+2)%3,D=s[d],z=s[a],J=s[S],j=s[P];if(Du(c[2*D],c[2*D+1],c[2*z],c[2*z+1],c[2*J],c[2*J+1],c[2*j],c[2*j+1])){s[a]=j,s[_]=D;const K=h[P];if(K===-1){let ue=this._hullStart;do{if(this._hullTri[ue]===P){this._hullTri[ue]=a;break}ue=this._hullPrev[ue]}while(ue!==this._hullStart)}this._link(a,K),this._link(_,h[d]),this._link(d,P);const ce=C+(_+1)%3;o<Xn.length&&(Xn[o++]=ce)}else{if(o===0)break;a=Xn[--o]}}return d}_link(a,s){this._halfedges[a]=s,s!==-1&&(this._halfedges[s]=a)}_addTriangle(a,s,h,c,o,d){const _=this.trianglesLen;return this._triangles[_]=a,this._triangles[_+1]=s,this._triangles[_+2]=h,this._link(_,c),this._link(_+1,o),this._link(_+2,d),this.trianglesLen+=3,_}}function Ru(u,a){const s=u/(Math.abs(u)+Math.abs(a));return(a>0?3-s:1+s)/4}function Br(u,a,s,h){const c=u-s,o=a-h;return c*c+o*o}function Du(u,a,s,h,c,o,d,_){const b=u-d,C=a-_,S=s-d,P=h-_,D=c-d,z=o-_,J=b*b+C*C,j=S*S+P*P,re=D*D+z*z;return b*(P*re-j*z)-C*(S*re-j*D)+J*(S*z-P*D)<0}function Vu(u,a,s,h,c,o){const d=s-u,_=h-a,b=c-u,C=o-a,S=d*d+_*_,P=b*b+C*C,D=.5/(d*C-_*b),z=(C*S-_*P)*D,J=(d*P-b*S)*D;return z*z+J*J}function Fu(u,a,s,h,c,o){const d=s-u,_=h-a,b=c-u,C=o-a,S=d*d+_*_,P=b*b+C*C,D=.5/(d*C-_*b),z=u+(C*S-_*P)*D,J=a+(d*P-b*S)*D;return{x:z,y:J}}function Zi(u,a,s,h){if(h-s<=20)for(let c=s+1;c<=h;c++){const o=u[c],d=a[o];let _=c-1;for(;_>=s&&a[u[_]]>d;)u[_+1]=u[_--];u[_+1]=o}else{const c=s+h>>1;let o=s+1,d=h;mn(u,c,o),a[u[s]]>a[u[h]]&&mn(u,s,h),a[u[o]]>a[u[h]]&&mn(u,o,h),a[u[s]]>a[u[o]]&&mn(u,s,o);const _=u[o],b=a[_];for(;;){do o++;while(a[u[o]]<b);do d--;while(a[u[d]]>b);if(d<o)break;mn(u,o,d)}u[s+1]=u[d],u[d]=_,h-o+1>=d-s?(Zi(u,a,o,h),Zi(u,a,s,d-1)):(Zi(u,a,s,d-1),Zi(u,a,o,h))}}function mn(u,a,s){const h=u[a];u[a]=u[s],u[s]=h}function Bu(u){return u[0]}function Uu(u){return u[1]}const js=1e-6;class Mi{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(a,s){this._+=`M${this._x0=this._x1=+a},${this._y0=this._y1=+s}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(a,s){this._+=`L${this._x1=+a},${this._y1=+s}`}arc(a,s,h){a=+a,s=+s,h=+h;const c=a+h,o=s;if(h<0)throw new Error("negative radius");this._x1===null?this._+=`M${c},${o}`:(Math.abs(this._x1-c)>js||Math.abs(this._y1-o)>js)&&(this._+="L"+c+","+o),h&&(this._+=`A${h},${h},0,1,1,${a-h},${s}A${h},${h},0,1,1,${this._x1=c},${this._y1=o}`)}rect(a,s,h,c){this._+=`M${this._x0=this._x1=+a},${this._y0=this._y1=+s}h${+h}v${+c}h${-h}Z`}value(){return this._||null}}class Kr{constructor(){this._=[]}moveTo(a,s){this._.push([a,s])}closePath(){this._.push(this._[0].slice())}lineTo(a,s){this._.push([a,s])}value(){return this._.length?this._:null}}class qu{constructor(a,[s,h,c,o]=[0,0,960,500]){if(!((c=+c)>=(s=+s))||!((o=+o)>=(h=+h)))throw new Error("invalid bounds");this.delaunay=a,this._circumcenters=new Float64Array(a.points.length*2),this.vectors=new Float64Array(a.points.length*2),this.xmax=c,this.xmin=s,this.ymax=o,this.ymin=h,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:a,hull:s,triangles:h},vectors:c}=this;let o,d;const _=this.circumcenters=this._circumcenters.subarray(0,h.length/3*2);for(let j=0,re=0,K=h.length,ce,ue;j<K;j+=3,re+=2){const fe=h[j]*2,ae=h[j+1]*2,I=h[j+2]*2,le=a[fe],_e=a[fe+1],de=a[ae],Pe=a[ae+1],be=a[I],Ce=a[I+1],ke=de-le,we=Pe-_e,Ue=be-le,pe=Ce-_e,He=(ke*pe-we*Ue)*2;if(Math.abs(He)<1e-9){if(o===void 0){o=d=0;for(const Ve of s)o+=a[Ve*2],d+=a[Ve*2+1];o/=s.length,d/=s.length}const et=1e9*Math.sign((o-le)*pe-(d-_e)*Ue);ce=(le+be)/2-et*pe,ue=(_e+Ce)/2+et*Ue}else{const et=1/He,Ve=ke*ke+we*we,it=Ue*Ue+pe*pe;ce=le+(pe*Ve-we*it)*et,ue=_e+(ke*it-Ue*Ve)*et}_[re]=ce,_[re+1]=ue}let b=s[s.length-1],C,S=b*4,P,D=a[2*b],z,J=a[2*b+1];c.fill(0);for(let j=0;j<s.length;++j)b=s[j],C=S,P=D,z=J,S=b*4,D=a[2*b],J=a[2*b+1],c[C+2]=c[S]=z-J,c[C+3]=c[S+1]=D-P}render(a){const s=a==null?a=new Mi:void 0,{delaunay:{halfedges:h,inedges:c,hull:o},circumcenters:d,vectors:_}=this;if(o.length<=1)return null;for(let S=0,P=h.length;S<P;++S){const D=h[S];if(D<S)continue;const z=Math.floor(S/3)*2,J=Math.floor(D/3)*2,j=d[z],re=d[z+1],K=d[J],ce=d[J+1];this._renderSegment(j,re,K,ce,a)}let b,C=o[o.length-1];for(let S=0;S<o.length;++S){b=C,C=o[S];const P=Math.floor(c[C]/3)*2,D=d[P],z=d[P+1],J=b*4,j=this._project(D,z,_[J+2],_[J+3]);j&&this._renderSegment(D,z,j[0],j[1],a)}return s&&s.value()}renderBounds(a){const s=a==null?a=new Mi:void 0;return a.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),s&&s.value()}renderCell(a,s){const h=s==null?s=new Mi:void 0,c=this._clip(a);if(c===null||!c.length)return;s.moveTo(c[0],c[1]);let o=c.length;for(;c[0]===c[o-2]&&c[1]===c[o-1]&&o>1;)o-=2;for(let d=2;d<o;d+=2)(c[d]!==c[d-2]||c[d+1]!==c[d-1])&&s.lineTo(c[d],c[d+1]);return s.closePath(),h&&h.value()}*cellPolygons(){const{delaunay:{points:a}}=this;for(let s=0,h=a.length/2;s<h;++s){const c=this.cellPolygon(s);c&&(c.index=s,yield c)}}cellPolygon(a){const s=new Kr;return this.renderCell(a,s),s.value()}_renderSegment(a,s,h,c,o){let d;const _=this._regioncode(a,s),b=this._regioncode(h,c);_===0&&b===0?(o.moveTo(a,s),o.lineTo(h,c)):(d=this._clipSegment(a,s,h,c,_,b))&&(o.moveTo(d[0],d[1]),o.lineTo(d[2],d[3]))}contains(a,s,h){return s=+s,s!==s||(h=+h,h!==h)?!1:this.delaunay._step(a,s,h)===a}*neighbors(a){const s=this._clip(a);if(s)for(const h of this.delaunay.neighbors(a)){const c=this._clip(h);if(c){e:for(let o=0,d=s.length;o<d;o+=2)for(let _=0,b=c.length;_<b;_+=2)if(s[o]===c[_]&&s[o+1]===c[_+1]&&s[(o+2)%d]===c[(_+b-2)%b]&&s[(o+3)%d]===c[(_+b-1)%b]){yield h;break e}}}}_cell(a){const{circumcenters:s,delaunay:{inedges:h,halfedges:c,triangles:o}}=this,d=h[a];if(d===-1)return null;const _=[];let b=d;do{const C=Math.floor(b/3);if(_.push(s[C*2],s[C*2+1]),b=b%3===2?b-2:b+1,o[b]!==a)break;b=c[b]}while(b!==d&&b!==-1);return _}_clip(a){if(a===0&&this.delaunay.hull.length===1)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const s=this._cell(a);if(s===null)return null;const{vectors:h}=this,c=a*4;return this._simplify(h[c]||h[c+1]?this._clipInfinite(a,s,h[c],h[c+1],h[c+2],h[c+3]):this._clipFinite(a,s))}_clipFinite(a,s){const h=s.length;let c=null,o,d,_=s[h-2],b=s[h-1],C,S=this._regioncode(_,b),P,D=0;for(let z=0;z<h;z+=2)if(o=_,d=b,_=s[z],b=s[z+1],C=S,S=this._regioncode(_,b),C===0&&S===0)P=D,D=0,c?c.push(_,b):c=[_,b];else{let J,j,re,K,ce;if(C===0){if((J=this._clipSegment(o,d,_,b,C,S))===null)continue;[j,re,K,ce]=J}else{if((J=this._clipSegment(_,b,o,d,S,C))===null)continue;[K,ce,j,re]=J,P=D,D=this._edgecode(j,re),P&&D&&this._edge(a,P,D,c,c.length),c?c.push(j,re):c=[j,re]}P=D,D=this._edgecode(K,ce),P&&D&&this._edge(a,P,D,c,c.length),c?c.push(K,ce):c=[K,ce]}if(c)P=D,D=this._edgecode(c[0],c[1]),P&&D&&this._edge(a,P,D,c,c.length);else if(this.contains(a,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return c}_clipSegment(a,s,h,c,o,d){const _=o<d;for(_&&([a,s,h,c,o,d]=[h,c,a,s,d,o]);;){if(o===0&&d===0)return _?[h,c,a,s]:[a,s,h,c];if(o&d)return null;let b,C,S=o||d;S&8?(b=a+(h-a)*(this.ymax-s)/(c-s),C=this.ymax):S&4?(b=a+(h-a)*(this.ymin-s)/(c-s),C=this.ymin):S&2?(C=s+(c-s)*(this.xmax-a)/(h-a),b=this.xmax):(C=s+(c-s)*(this.xmin-a)/(h-a),b=this.xmin),o?(a=b,s=C,o=this._regioncode(a,s)):(h=b,c=C,d=this._regioncode(h,c))}}_clipInfinite(a,s,h,c,o,d){let _=Array.from(s),b;if((b=this._project(_[0],_[1],h,c))&&_.unshift(b[0],b[1]),(b=this._project(_[_.length-2],_[_.length-1],o,d))&&_.push(b[0],b[1]),_=this._clipFinite(a,_))for(let C=0,S=_.length,P,D=this._edgecode(_[S-2],_[S-1]);C<S;C+=2)P=D,D=this._edgecode(_[C],_[C+1]),P&&D&&(C=this._edge(a,P,D,_,C),S=_.length);else this.contains(a,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(_=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return _}_edge(a,s,h,c,o){for(;s!==h;){let d,_;switch(s){case 5:s=4;continue;case 4:s=6,d=this.xmax,_=this.ymin;break;case 6:s=2;continue;case 2:s=10,d=this.xmax,_=this.ymax;break;case 10:s=8;continue;case 8:s=9,d=this.xmin,_=this.ymax;break;case 9:s=1;continue;case 1:s=5,d=this.xmin,_=this.ymin;break}(c[o]!==d||c[o+1]!==_)&&this.contains(a,d,_)&&(c.splice(o,0,d,_),o+=2)}return o}_project(a,s,h,c){let o=1/0,d,_,b;if(c<0){if(s<=this.ymin)return null;(d=(this.ymin-s)/c)<o&&(b=this.ymin,_=a+(o=d)*h)}else if(c>0){if(s>=this.ymax)return null;(d=(this.ymax-s)/c)<o&&(b=this.ymax,_=a+(o=d)*h)}if(h>0){if(a>=this.xmax)return null;(d=(this.xmax-a)/h)<o&&(_=this.xmax,b=s+(o=d)*c)}else if(h<0){if(a<=this.xmin)return null;(d=(this.xmin-a)/h)<o&&(_=this.xmin,b=s+(o=d)*c)}return[_,b]}_edgecode(a,s){return(a===this.xmin?1:a===this.xmax?2:0)|(s===this.ymin?4:s===this.ymax?8:0)}_regioncode(a,s){return(a<this.xmin?1:a>this.xmax?2:0)|(s<this.ymin?4:s>this.ymax?8:0)}_simplify(a){if(a&&a.length>4){for(let s=0;s<a.length;s+=2){const h=(s+2)%a.length,c=(s+4)%a.length;(a[s]===a[h]&&a[h]===a[c]||a[s+1]===a[h+1]&&a[h+1]===a[c+1])&&(a.splice(h,2),s-=2)}a.length||(a=null)}return a}}const Hu=2*Math.PI,Wi=Math.pow;function Gu(u){return u[0]}function ju(u){return u[1]}function Wu(u){const{triangles:a,coords:s}=u;for(let h=0;h<a.length;h+=3){const c=2*a[h],o=2*a[h+1],d=2*a[h+2];if((s[d]-s[c])*(s[o+1]-s[c+1])-(s[o]-s[c])*(s[d+1]-s[c+1])>1e-10)return!1}return!0}function Zu(u,a,s){return[u+Math.sin(u+a)*s,a+Math.cos(u-a)*s]}class ns{static from(a,s=Gu,h=ju,c){return new ns("length"in a?$u(a,s,h,c):Float64Array.from(Ku(a,s,h,c)))}constructor(a){this._delaunator=new sr(a),this.inedges=new Int32Array(a.length/2),this._hullIndex=new Int32Array(a.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const a=this._delaunator,s=this.points;if(a.hull&&a.hull.length>2&&Wu(a)){this.collinear=Int32Array.from({length:s.length/2},(D,z)=>z).sort((D,z)=>s[2*D]-s[2*z]||s[2*D+1]-s[2*z+1]);const b=this.collinear[0],C=this.collinear[this.collinear.length-1],S=[s[2*b],s[2*b+1],s[2*C],s[2*C+1]],P=1e-8*Math.hypot(S[3]-S[1],S[2]-S[0]);for(let D=0,z=s.length/2;D<z;++D){const J=Zu(s[2*D],s[2*D+1],P);s[2*D]=J[0],s[2*D+1]=J[1]}this._delaunator=new sr(s)}else delete this.collinear;const h=this.halfedges=this._delaunator.halfedges,c=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,d=this.inedges.fill(-1),_=this._hullIndex.fill(-1);for(let b=0,C=h.length;b<C;++b){const S=o[b%3===2?b-2:b+1];(h[b]===-1||d[S]===-1)&&(d[S]=b)}for(let b=0,C=c.length;b<C;++b)_[c[b]]=b;c.length<=2&&c.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=c[0],d[c[0]]=1,c.length===2&&(d[c[1]]=0,this.triangles[1]=c[1],this.triangles[2]=c[1]))}voronoi(a){return new qu(this,a)}*neighbors(a){const{inedges:s,hull:h,_hullIndex:c,halfedges:o,triangles:d,collinear:_}=this;if(_){const P=_.indexOf(a);P>0&&(yield _[P-1]),P<_.length-1&&(yield _[P+1]);return}const b=s[a];if(b===-1)return;let C=b,S=-1;do{if(yield S=d[C],C=C%3===2?C-2:C+1,d[C]!==a)return;if(C=o[C],C===-1){const P=h[(c[a]+1)%h.length];P!==S&&(yield P);return}}while(C!==b)}find(a,s,h=0){if(a=+a,a!==a||(s=+s,s!==s))return-1;const c=h;let o;for(;(o=this._step(h,a,s))>=0&&o!==h&&o!==c;)h=o;return o}_step(a,s,h){const{inedges:c,hull:o,_hullIndex:d,halfedges:_,triangles:b,points:C}=this;if(c[a]===-1||!C.length)return(a+1)%(C.length>>1);let S=a,P=Wi(s-C[a*2],2)+Wi(h-C[a*2+1],2);const D=c[a];let z=D;do{let J=b[z];const j=Wi(s-C[J*2],2)+Wi(h-C[J*2+1],2);if(j<P&&(P=j,S=J),z=z%3===2?z-2:z+1,b[z]!==a)break;if(z=_[z],z===-1){if(z=o[(d[a]+1)%o.length],z!==J&&Wi(s-C[z*2],2)+Wi(h-C[z*2+1],2)<P)return z;break}}while(z!==D);return S}render(a){const s=a==null?a=new Mi:void 0,{points:h,halfedges:c,triangles:o}=this;for(let d=0,_=c.length;d<_;++d){const b=c[d];if(b<d)continue;const C=o[d]*2,S=o[b]*2;a.moveTo(h[C],h[C+1]),a.lineTo(h[S],h[S+1])}return this.renderHull(a),s&&s.value()}renderPoints(a,s){s===void 0&&(!a||typeof a.moveTo!="function")&&(s=a,a=null),s=s==null?2:+s;const h=a==null?a=new Mi:void 0,{points:c}=this;for(let o=0,d=c.length;o<d;o+=2){const _=c[o],b=c[o+1];a.moveTo(_+s,b),a.arc(_,b,s,0,Hu)}return h&&h.value()}renderHull(a){const s=a==null?a=new Mi:void 0,{hull:h,points:c}=this,o=h[0]*2,d=h.length;a.moveTo(c[o],c[o+1]);for(let _=1;_<d;++_){const b=2*h[_];a.lineTo(c[b],c[b+1])}return a.closePath(),s&&s.value()}hullPolygon(){const a=new Kr;return this.renderHull(a),a.value()}renderTriangle(a,s){const h=s==null?s=new Mi:void 0,{points:c,triangles:o}=this,d=o[a*=3]*2,_=o[a+1]*2,b=o[a+2]*2;return s.moveTo(c[d],c[d+1]),s.lineTo(c[_],c[_+1]),s.lineTo(c[b],c[b+1]),s.closePath(),h&&h.value()}*trianglePolygons(){const{triangles:a}=this;for(let s=0,h=a.length/3;s<h;++s)yield this.trianglePolygon(s)}trianglePolygon(a){const s=new Kr;return this.renderTriangle(a,s),s.value()}}function $u(u,a,s,h){const c=u.length,o=new Float64Array(c*2);for(let d=0;d<c;++d){const _=u[d];o[d*2]=a.call(h,_,d,u),o[d*2+1]=s.call(h,_,d,u)}return o}function*Ku(u,a,s,h){let c=0;for(const o of u)yield a.call(h,o,c,u),yield s.call(h,o,c,u),++c}function La(u){return{originalBorder:u,flattenedPolygon:ma(u)[0]}}function Xu(u){if(u.length===0)return[0,0];const a=u.reduce((s,h)=>[s[0]+h[0],s[1]+h[1]],[0,0]);return[a[0]/u.length,a[1]/u.length]}function Na(u,a,s){const h={id:u,site:Xu(a),halfEdge:-1,bounds:$r(a)},c=fu(a,u,s);return c.length>0&&(h.halfEdge=c[0].id),h}function Oa(u,a){const h=u.map(o=>ri(o,a.originalBorder)).filter(Boolean).length;return h===0?null:h===u.length?u:hu(u,a.flattenedPolygon)?.[0]??null}const cr="VoronoiPieceGenerator",Yu={name:cr,displayName:"Voronoi",description:"Construct pieces by building a Voronoi diagram from the seed points. Each piece consists of all area of the plane closer to its seed point than any other seed point. In practice, this creates irregular polygons with 3-8 sides.",sortHint:1,controls:[]};function Qu(u){return`${u[0].toPrecision(7)},${u[1].toPrecision(7)}`}function Ws(u,a){const h=a.flattenedPolygon;for(let c=0;c<h.length;c++){const o=h[c],d=h[(c+1)%h.length];if(Ju(u,o,d)<.001)return!0}return!1}function Ju(u,a,s){const[h,c]=u,[o,d]=a,[_,b]=s,C=_-o,S=b-d,P=C*C+S*S;if(P===0)return Math.hypot(h-o,c-d);let D=((h-o)*C+(c-d)*S)/P;D=Math.max(0,Math.min(1,D));const z=o+D*C,J=d+D*S;return Math.hypot(h-z,c-J)}const el=(u,a,s)=>{const{width:h,height:c}=a,o=La(u);return{generatePieces(_,b){const{border:C}=b;console.log(`VoronoiPieceGenerator using dimensions ${h}x${c}`);const P=ns.from(_).voronoi([0,0,h,c]),D={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:C},z=new Map;let J=0;for(let re=0;re<_.length;re++){const K=_[re],ce=P.cellPolygon(re);if(!ce)continue;const ue=Oa(ce,o);if(!ue)continue;const fe=J++,ae=Na(fe,ue,D);ae.site=K,D.pieces.set(fe,ae);const I=[];let le=ae.halfEdge;if(le!==-1){const _e=le;do{const de=D.halfEdges.get(le);I.push(de),le=de.next}while(le!==_e)}va(I,D,z,(_e,de)=>Ws(_e,o)&&Ws(de,o))}const j=new Map;for(const re of D.halfEdges.values()){const K=Qu(re.origin);j.has(K)||j.set(K,re.origin)}return D.vertices=Array.from(j.values()),D}}};Ni.register(cr,el,Yu);const Xi="SimpleTabPlacementStrategy",tl={name:Xi,displayName:"Simple",description:"Creates a single tab in the center of each edge with a random orientation.",sortHint:1,controls:[{type:"range",name:"tabSize",label:"Tab Size",optional:!0,min:.01,max:1,step:.01,defaultValue:.5,helpText:"The width of the tab as a fraction of the edge length"},{type:"number",name:"minEdgeLength",label:"Minimum Edge Length",optional:!0,defaultValue:15,helpText:"Edges shorter than this value will not have a tab"},{type:"number",name:"maxTabSize",label:"Maximum Tab Size",helpText:"Maximum width of a generated tab"}]};function Zs(u,a,s,h){if(u.tabs=void 0,!(u.heRight!==-1))return;const o=a.halfEdges.get(u.heLeft),d=a.halfEdges.get(u.heRight);if(!o||!d)return;const _=o.origin,b=d.origin,C=Math.hypot(b[0]-_[0],b[1]-_[1]);if(C>=s.minEdgeLength){let S=s.tabSize;s.maxTabSize&&C*S>s.maxTabSize&&(S=s.maxTabSize/C);const P={position:.5,size:S,convex:h()>.5};u.tabs=[P]}}const il=(u,a,s)=>{const{tabSize:h=.5,minEdgeLength:c=0,maxTabSize:o}=s,d={tabSize:h,minEdgeLength:c,maxTabSize:o};return{placeTabs(_){const{topology:b,random:C}=_;for(const S of b.edges.values())Zs(S,b,d,C)},updateTabPlacements(_,b){const{topology:C,random:S}=b;for(const P of _)Zs(P,C,d,S)}}};Oi.register(Xi,il,tl);const fr="TraditionalTabGenerator",nl={name:fr,displayName:"Traditional",description:"Creates a traditional rounded tab for each (internal) piece edge.",sortHint:1,controls:[{type:"range",name:"jitter",label:"Randomness",defaultValue:8,min:0,max:100,step:1,helpText:"Adds randomness to the tab shape. 0 means completely uniform tabs"},{type:"range",name:"heightToWidthRatio",label:"Tab Height",defaultValue:50,min:5,max:100,step:5,helpText:"The height of the tab as a percent of its width"}]};function rl(u,a,s,h,c,o=!1){const d=a[0]-u[0],_=a[1]-u[1],b=Math.hypot(d,_);if(b===0)return console.warn("Edge has zero length"),[];const C=[d/b,_/b],S=[-C[1],C[0]],P=(Ce,ke)=>[u[0]+(C[0]*Ce+S[0]*ke)*b,u[1]+(C[1]*Ce+S[1]*ke)*b],D=s/100,z=()=>(c()*2-1)*D,J=z(),j=z(),re=z(),K=z(),ce=z(),ue=.1625,fe=o?-1:1,ae=h,I=ae/3,_e=[[0,0],[.2,J*I],[.5+j+K,fe*(-I+re*ae)],[.5-ue+j,fe*(I+re*ae)],[.5-2*ue+j-K,fe*(ae+re*ae)],[.5+2*ue+j-K,fe*(ae+re*ae)],[.5+ue+j,fe*(I+re*ae)],[.5+j+K,fe*(-I+re*ae)],[.8,ce*I],[1,0]].map(([Ce,ke])=>P(Ce,ke)),de={type:"bezier",p1:_e[1],p2:_e[2],p3:_e[3]},Pe={type:"bezier",p1:_e[4],p2:_e[5],p3:_e[6]},be={type:"bezier",p1:_e[7],p2:_e[8],p3:_e[9]};return[de,Pe,be]}const sl=(u,a,s)=>{const{jitter:h=8,heightToWidthRatio:c=50}=s;return{createTabSegments(d,_,b,C){const S=!b.convex;return rl(d,_,h,c/100,C,S)}}};oi.register(fr,sl,nl);function al(u){return new Worker("/puzzle-generator/pr-preview/pr-8/assets/CheckGeometryWorker-B-2izMXZ.js",{name:u?.name})}function Ra(u,a){return new Promise((s,h)=>{const c=new al;c.onmessage=d=>{const _=d.data;switch(_.type){case"progress":a?.(_.processed,_.total);break;case"done":s(_.results),c.terminate();break;case"error":h(new Error(_.message)),c.terminate();break}},c.onerror=d=>{h(new Error(d.message)),c.terminate()};const o={topology:nu(u)};c.postMessage(o)})}const Da="GridJitterPointGenerator",ol={name:Da,displayName:"Grid",description:"Generate seed points using a grid with optional random jitter. Has a uniform, regular look, especially with low randomness values.",sortHint:2,controls:[{type:"range",name:"jitter",label:"Randomness",min:0,max:100,step:5,defaultValue:50,helpText:"Amount of jitter to apply to each grid point (0 to 100%)"}]},ul=(u,a,s)=>{const{jitter:h=50}=s;return{generatePoints(o){const{width:d,height:_,pieceSize:b,random:C,border:S}=o,P=[];for(let D=0;D<d;D+=b)for(let z=0;z<_;z+=b){const J=[D+b/2,z+b/2];h>0&&(J[0]+=(C()-.5)*(h/100)*b,J[1]+=(C()-.5)*(h/100)*b),ri(J,S)&&P.push(J)}return P}}};vi.register(Da,ul,ol);const ll=Math.sin(Math.PI/3),Va="TownscaperPointGenerator",hl={name:Va,displayName:"Townscaper",description:"Generate seed points using a triangular lattice inspired by Townscaper.",sortHint:3,controls:[{type:"range",name:"mergeProbability",label:"Merge Probability",min:0,max:100,step:5,defaultValue:35,helpText:"Chance that neighboring triangles merge into Townscaper-style blocks."},{type:"range",name:"relaxationIterations",label:"Relaxation Iterations",min:0,max:5,step:1,defaultValue:2,helpText:"Number of centroid smoothing passes applied to merged blocks."},{type:"range",name:"relaxationStrength",label:"Relaxation Strength",min:0,max:100,step:5,defaultValue:50,helpText:"How far each pass pulls a block center toward its neighbors."}]},cl=(u,a,s)=>{const{mergeProbability:h=35,relaxationIterations:c=2,relaxationStrength:o=50}=s,d=K=>Math.min(100,Math.max(0,K)),_=K=>{const ce=Math.max(K,4),ue=ce*ll;return{horizontal:ce,vertical:ue}},b=K=>{const{width:ce,height:ue,pieceSize:fe,border:ae}=K,{horizontal:I,vertical:le}=_(fe),_e=I,de=le,Pe=-_e,be=-de,Ce=Math.ceil((ce+_e*2)/I),ke=Math.ceil((ue+de*2)/le),we=[],Ue=new Map;for(let pe=0;pe<=ke;pe+=1){const He=be+pe*le,et=pe%2===0?0:I/2;for(let Ve=0;Ve<=Ce;Ve+=1){const Lt=[Pe+Ve*I+et,He];if(ri(Lt,ae)){const It={row:pe,column:Ve,position:Lt};Ue.set(`${pe}:${Ve}`,we.length),we.push(It)}}}return{points:we,indexByCoord:Ue,rowLimit:ke,columnLimit:Ce}},C=(K,ce)=>{for(let ue=K.length-1;ue>0;ue-=1){const fe=Math.floor(ce()*(ue+1)),ae=K[ue];K[ue]=K[fe],K[fe]=ae}},S=(K,ce)=>K<ce?`${K}:${ce}`:`${ce}:${K}`,P=(K,ce,ue,fe,ae)=>{const I=[],le=[],_e=new Map,de=(be,Ce,ke)=>{const we=ce.get(`${be[0]}:${be[1]}`),Ue=ce.get(`${Ce[0]}:${Ce[1]}`),pe=ce.get(`${ke[0]}:${ke[1]}`);if(we===void 0||Ue===void 0||pe===void 0)return;const He=[(K[we].position[0]+K[Ue].position[0]+K[pe].position[0])/3,(K[we].position[1]+K[Ue].position[1]+K[pe].position[1])/3];if(!ri(He,ae))return;const et=I.length;I.push({vertices:[we,Ue,pe],centroid:He}),le.push(new Set);const Ve=[[we,Ue],[Ue,pe],[pe,we]];for(const[it,Lt]of Ve){const It=S(it,Lt),Dt=_e.get(It);Dt!==void 0?(le[et].add(Dt),le[Dt].add(et)):_e.set(It,et)}};for(let be=0;be<ue;be+=1){const Ce=be%2===0;for(let ke=0;ke<fe;ke+=1)Ce?(de([be,ke],[be,ke+1],[be+1,ke]),de([be,ke+1],[be+1,ke+1],[be+1,ke])):(de([be,ke],[be+1,ke+1],[be+1,ke]),de([be,ke],[be,ke+1],[be+1,ke+1]))}const Pe=le.map(be=>Array.from(be));return{triangles:I,adjacency:Pe}},D=(K,ce,ue,fe)=>{const ae=new Array(K.length).fill(-1),I=[];for(let le=0;le<K.length;le+=1){if(ae[le]!==-1)continue;const _e=I.length,de=[le];ae[le]=_e;const Pe=[];for(;de.length>0;){const be=de.pop();Pe.push(be);const Ce=ce[be];C(Ce,fe);for(const ke of Ce)ae[ke]===-1&&fe()<ue&&(ae[ke]=_e,de.push(ke))}I.push(Pe)}return{clusters:I,assignments:ae}},z=(K,ce,ue)=>K.map(fe=>{if(fe.length===0)return[0,0];let ae=0,I=0;for(const de of fe){const Pe=ce[de].centroid;ae+=Pe[0],I+=Pe[1]}const le=[ae/fe.length,I/fe.length];return Number.isFinite(le[0])&&Number.isFinite(le[1])&&ri(le,ue)?le:ce[fe[0]].centroid}),J=(K,ce)=>{const ue=new Map,fe=I=>{const le=ue.get(I);if(le)return le;const _e=new Set;return ue.set(I,_e),_e},ae=(I,le)=>{I===le||I===-1||le===-1||(fe(I).add(le),fe(le).add(I))};return K.forEach((I,le)=>{const _e=ce[le];for(const de of I){const Pe=ce[de];ae(_e,Pe)}}),ue},j=(K,ce,ue,fe,ae)=>{if(fe<=0||ae<=0)return K;let I=K.slice();for(let le=0;le<fe;le+=1)I=I.map((de,Pe)=>{const be=ce.get(Pe);if(!be||be.size===0)return de;let Ce=0,ke=0,we=0;if(be.forEach(He=>{const et=I[He];et&&(Ce+=et[0],ke+=et[1],we+=1)}),we===0)return de;const Ue=[Ce/we,ke/we],pe=[de[0]+(Ue[0]-de[0])*ae,de[1]+(Ue[1]-de[1])*ae];return ri(pe,ue)?pe:de});return I};return{generatePoints(K){const{points:ce,indexByCoord:ue,rowLimit:fe,columnLimit:ae}=b(K);if(ce.length===0)return[];const{triangles:I,adjacency:le}=P(ce,ue,fe,ae,K.border);if(I.length===0)return ce.map(pe=>pe.position);const _e=d(h)/100,de=Math.max(0,Math.round(c)),Pe=d(o)/100,{clusters:be,assignments:Ce}=D(I,le,_e,K.random),ke=z(be,I,K.border),we=J(le,Ce);return j(ke,we,K.border,de,Pe)}}};vi.register(Va,cl,hl);const Fa="RectangularPieceGenerator",fl={name:Fa,displayName:"Rectangular",description:"Construct pieces from a regular grid. All pieces have 4 sides and are the same size (except when the border is irregular). This generator ignores seed points.",sortHint:2,controls:[]},dl=(u,a,s)=>{const{width:h,height:c}=a,o=La(u);return{generatePieces(_,b){const{pieceSize:C,border:S}=b,P={vertices:[],pieces:new Map,edges:new Map,halfEdges:new Map,boundary:[],borderPath:S},D=Math.ceil(h/C),z=Math.ceil(c/C),J=Math.round(h/D),j=Math.round(c/z),re=[];for(let ce=0;ce<=z;ce++){const ue=[];for(let fe=0;fe<=D;fe++){const ae=fe*J,I=ce*j;ue.push([ae,I])}re.push(ue)}P.vertices=re.flat();const K=new Map;for(let ce=0;ce<z;ce++)for(let ue=0;ue<D;ue++){const fe=ce*D+ue,ae=re[ce][ue],I=re[ce][ue+1],le=re[ce+1][ue],_e=re[ce+1][ue+1],Pe=Oa([ae,I,_e,le],o);if(!Pe)continue;const be=Na(fe,Pe,P);P.pieces.set(fe,be);const Ce=[];let ke=be.halfEdge;if(ke!==-1){const we=ke;do{const Ue=P.halfEdges.get(ke);Ce.push(Ue),ke=Ue.next}while(ke!==we)}va(Ce,P,K,(we,Ue)=>{const pe=(Lt,It)=>Math.abs(Lt-It)<1e-6,He=pe(we[1],ae[1])&&pe(Ue[1],ae[1]),et=pe(we[0],I[0])&&pe(Ue[0],I[0]),Ve=pe(we[1],le[1])&&pe(Ue[1],le[1]),it=pe(we[0],ae[0])&&pe(Ue[0],ae[0]);return!(He||et||Ve||it)})}return P}}};Ni.register(Fa,dl,fl);const Ba="NullTabGenerator",pl={name:Ba,displayName:"None",description:"Do not generate tabs. All pieces have straight edges.",sortHint:3,controls:[]},gl=(u,a,s)=>({createTabSegments(c,o,d,_){return[]}});oi.register(Ba,gl,pl);const Ua="TriangleTabGenerator",ml={name:Ua,displayName:"Triangle",description:"Creates a simple triangle between each (internal) piece edge.",sortHint:2,controls:[]},vl=(u,a,s)=>({createTabSegments(c,o,d,_){const b=[o[0]-c[0],o[1]-c[1]],C=Math.hypot(b[0],b[1]);if(C<1e-6)return[];const S=[b[0]/C,b[1]/C],P=[-S[1],S[0]],D=[c[0]+b[0]/2,c[1]+b[1]/2],z=d.convex?1:-1,J=C*d.size*z,j=[D[0]+P[0]*J,D[1]+P[1]*J],re=[];return re.push({type:"line",p:c}),re.push({type:"line",p:j}),re.push({type:"line",p:o}),re}});oi.register(Ua,vl,ml);let Xr=!1;const _l=window.matchMedia("(prefers-color-scheme: dark)");_l.matches&&(Xr=!0);const yl=()=>{const s=hr,h=cr,c=fr,o={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,aspectRatio:800/600,distance:40,color:Xr?"#DDDDDD":"#333333",drawPoints:!1,pointColor:Xr?"#FF0000":"#0000FF",borderShape:"rectangle",borderCornerRadius:50,geometryProblems:{autoCheck:!1,problems:void 0,progress:void 0},dirty:!0,generators:{point:{label:"Seed Points",registry:vi,name:s,config:vi.getDefaultConfig(s,800,600)},piece:{label:"Piece Generation",registry:Ni,name:h,config:Ni.getDefaultConfig(h,800,600)},placement:{label:"Tab Placement",registry:Oi,name:Xi,config:Oi.getDefaultConfig(Xi,800,600)},tab:{label:"Tabs",registry:oi,name:c,config:oi.getDefaultConfig(c,800,600)}},puzzle:void 0,backgroundImageUrl:void 0,backgroundImageName:""};function d(){const{canvasWidth:b,canvasHeight:C,borderShape:S,borderCornerRadius:P}=o;switch(S){case"rectangle":return Ki(b,C);case"circle":return ba(Math.min(b,C));case"ellipse":return xa(b,C);case"rounded-rect":return wa(b,C,P);default:return Ki(b,C)}}function _(){o.puzzle&&(o.geometryProblems.progress=0,Y.redraw(),Ra(o.puzzle,(b,C)=>{o.geometryProblems.progress=b/C*100,Y.redraw()}).then(b=>{o.geometryProblems.problems=b.length,o.geometryProblems.progress=void 0,o.puzzle&&(o.puzzle.problems=b),Y.redraw()}).catch(b=>{o.geometryProblems.progress=void 0,console.error(b),Y.redraw()}))}return{oncreate:()=>{Ri({bounds:{width:o.canvasWidth,height:o.canvasHeight},border:d(),pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,placementConfig:o.generators.placement.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(b=>{o.puzzle=b,Y.redraw(),o.geometryProblems.autoCheck&&_()}).catch(b=>{console.error(b)})},onupdate:()=>{o.dirty&&(o.dirty=!1,Ri({bounds:{width:o.canvasWidth,height:o.canvasHeight},border:d(),pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,placementConfig:o.generators.placement.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(b=>{o.geometryProblems.problems=void 0,o.geometryProblems.progress=void 0,o.puzzle=b,Y.redraw(),o.geometryProblems.autoCheck&&_()}).catch(b=>{console.error(b)}))},onremove:()=>{o.backgroundImageUrl&&(URL.revokeObjectURL(o.backgroundImageUrl),o.backgroundImageUrl=void 0)},view:()=>Y(".page",[Y("h1","Puzzle Generator"),Y(".container",[o.puzzle&&Y(".puzzle-stack",[Y(gu,{width:o.canvasWidth,height:o.canvasHeight,color:o.color,imageUrl:o.backgroundImageUrl,puzzle:o.puzzle,isDirty:o.dirty,pointColor:o.drawPoints?o.pointColor:void 0,onPuzzleChanged:b=>{o.puzzle=b,Y.redraw()},onSeedPointMoved:(b,C)=>{o.dirty=!1,o.puzzle&&ya(o.puzzle,b,C).then(S=>{o.geometryProblems.problems=void 0,o.geometryProblems.progress=void 0,o.puzzle=S,Y.redraw(),o.geometryProblems.autoCheck&&_()}).catch(S=>{console.error("Failed to rebuild puzzle with updated seed point:",S)})}}),Y(".actions",[Y(Sa,{puzzle:o.puzzle,width:o.canvasWidth,height:o.canvasHeight,color:o.color}),Y(Pa,{autoCheck:o.geometryProblems.autoCheck,problems:o.geometryProblems.problems,progressPercent:o.geometryProblems.progress,onCheckRequested:()=>{o.dirty||_(),Y.redraw()},onAutocheckChanged:b=>{b!==o.geometryProblems.autoCheck&&(o.geometryProblems.autoCheck=b,Y.redraw())}})])]),Y(".controls",[Y(".background-image",[Y(Ia,{label:"Background Image",onUpload:(b,C,S,P)=>{o.backgroundImageUrl&&URL.revokeObjectURL(o.backgroundImageUrl),o.canvasWidth=S,o.canvasHeight=P,o.aspectRatio=S/P,o.backgroundImageUrl=b,o.backgroundImageName=C,o.dirty=!0,Y.redraw()},onClear:()=>{o.backgroundImageUrl&&URL.revokeObjectURL(o.backgroundImageUrl),o.backgroundImageUrl=void 0,o.backgroundImageName="",o.dirty=!0,Y.redraw()}})]),Y(Ea,{ratio:o.aspectRatio,disabled:o.backgroundImageUrl!==void 0,onChange:b=>{o.aspectRatio=b,o.canvasWidth=o.canvasHeight*b,o.dirty=!0,Y.redraw()}}),Y(Aa,{shape:o.borderShape,disabled:o.backgroundImageUrl!==void 0,onChange:b=>{o.borderShape=b,o.dirty=!0,Y.redraw()}}),o.borderShape==="rounded-rect"&&Y(Li,{config:{name:"cornerRadius",label:"Corner Radius",type:"number"},value:o.borderCornerRadius,onChange:b=>{o.borderCornerRadius=b??50,o.dirty=!0,Y.redraw()}}),Y(Li,{config:{name:"seed",label:"Seed",type:"number"},value:o.seed,onChange:b=>{o.seed=b??0,o.dirty=!0,Y.redraw()}}),Y(Li,{config:{name:"pieceSize",label:"Piece size",type:"number"},value:o.distance,onChange:b=>{o.distance=b??0,o.dirty=!0,Y.redraw()}}),Y(rr,{label:"Piece color",color:o.color,size:"small",onUpdate:b=>{o.color=b,Y.redraw()}}),Y(".draw-points",[Y(is,{config:{name:"drawPoints",label:"Draw seed points",type:"boolean"},value:o.drawPoints,onChange:b=>{o.drawPoints=b,Y.redraw()}}),o.drawPoints&&Y(rr,{label:"Seed points color",color:o.pointColor,size:"small",onUpdate:b=>{o.pointColor=b,Y.redraw()}})]),...Object.entries(o.generators).map(([b,C])=>Y("label",[C.label+":",Y(ka,{generator:C.name,registry:C.registry,config:C.config,onGeneratorChange:S=>{S!=C.name&&(console.log(`${b} generator changed to ${S}`),C.name=S,o.generators[b].config=C.registry.getDefaultConfig(S,o.canvasWidth,o.canvasHeight),o.dirty=!0,Y.redraw())},onConfigChange:(S,P)=>{console.log(`${b} generator config "${S}" changed to ${String(P)}`),C.config[S]=P,o.dirty=!0,Y.redraw()}})]))])])])}},$s=50,Ks=5,bl=Ks*Ks,xl="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function wl(u){throw new Error('Could not dynamically require "'+u+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Jn={exports:{}};const Cl={},Sl=Object.freeze(Object.defineProperty({__proto__:null,default:Cl},Symbol.toStringTag,{value:"Module"})),Xs=go(Sl);var vn={exports:{}},Pl=vn.exports,Ys;function Il(){return Ys||(Ys=1,(function(u,a){(function(s,h){h(a)})(Pl,(function(s){var h=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],c=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],o="-----------------------------------------------------------------------------------------------------------------------------------------------------",d="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",_={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},b="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",C={5:b,"5module":b+" export import",6:b+" const class extends export import super"},S=/^in(stanceof)?$/,P=new RegExp("["+d+"]"),D=new RegExp("["+d+o+"]");function z(n,p){for(var T=65536,B=0;B<p.length;B+=2){if(T+=p[B],T>n)return!1;if(T+=p[B+1],T>=n)return!0}return!1}function J(n,p){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&P.test(String.fromCharCode(n)):p===!1?!1:z(n,c)}function j(n,p){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&D.test(String.fromCharCode(n)):p===!1?!1:z(n,c)||z(n,h)}var re=function(p,T){T===void 0&&(T={}),this.label=p,this.keyword=T.keyword,this.beforeExpr=!!T.beforeExpr,this.startsExpr=!!T.startsExpr,this.isLoop=!!T.isLoop,this.isAssign=!!T.isAssign,this.prefix=!!T.prefix,this.postfix=!!T.postfix,this.binop=T.binop||null,this.updateContext=null};function K(n,p){return new re(n,{beforeExpr:!0,binop:p})}var ce={beforeExpr:!0},ue={startsExpr:!0},fe={};function ae(n,p){return p===void 0&&(p={}),p.keyword=n,fe[n]=new re(n,p)}var I={num:new re("num",ue),regexp:new re("regexp",ue),string:new re("string",ue),name:new re("name",ue),privateId:new re("privateId",ue),eof:new re("eof"),bracketL:new re("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new re("]"),braceL:new re("{",{beforeExpr:!0,startsExpr:!0}),braceR:new re("}"),parenL:new re("(",{beforeExpr:!0,startsExpr:!0}),parenR:new re(")"),comma:new re(",",ce),semi:new re(";",ce),colon:new re(":",ce),dot:new re("."),question:new re("?",ce),questionDot:new re("?."),arrow:new re("=>",ce),template:new re("template"),invalidTemplate:new re("invalidTemplate"),ellipsis:new re("...",ce),backQuote:new re("`",ue),dollarBraceL:new re("${",{beforeExpr:!0,startsExpr:!0}),eq:new re("=",{beforeExpr:!0,isAssign:!0}),assign:new re("_=",{beforeExpr:!0,isAssign:!0}),incDec:new re("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new re("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:K("||",1),logicalAND:K("&&",2),bitwiseOR:K("|",3),bitwiseXOR:K("^",4),bitwiseAND:K("&",5),equality:K("==/!=/===/!==",6),relational:K("</>/<=/>=",7),bitShift:K("<</>>/>>>",8),plusMin:new re("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:K("%",10),star:K("*",10),slash:K("/",10),starstar:new re("**",{beforeExpr:!0}),coalesce:K("??",1),_break:ae("break"),_case:ae("case",ce),_catch:ae("catch"),_continue:ae("continue"),_debugger:ae("debugger"),_default:ae("default",ce),_do:ae("do",{isLoop:!0,beforeExpr:!0}),_else:ae("else",ce),_finally:ae("finally"),_for:ae("for",{isLoop:!0}),_function:ae("function",ue),_if:ae("if"),_return:ae("return",ce),_switch:ae("switch"),_throw:ae("throw",ce),_try:ae("try"),_var:ae("var"),_const:ae("const"),_while:ae("while",{isLoop:!0}),_with:ae("with"),_new:ae("new",{beforeExpr:!0,startsExpr:!0}),_this:ae("this",ue),_super:ae("super",ue),_class:ae("class",ue),_extends:ae("extends",ce),_export:ae("export"),_import:ae("import",ue),_null:ae("null",ue),_true:ae("true",ue),_false:ae("false",ue),_in:ae("in",{beforeExpr:!0,binop:7}),_instanceof:ae("instanceof",{beforeExpr:!0,binop:7}),_typeof:ae("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ae("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ae("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},le=/\r\n?|\n|\u2028|\u2029/,_e=new RegExp(le.source,"g");function de(n){return n===10||n===13||n===8232||n===8233}function Pe(n,p,T){T===void 0&&(T=n.length);for(var B=p;B<T;B++){var Z=n.charCodeAt(B);if(de(Z))return B<T-1&&Z===13&&n.charCodeAt(B+1)===10?B+2:B+1}return-1}var be=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ce=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,ke=Object.prototype,we=ke.hasOwnProperty,Ue=ke.toString,pe=Object.hasOwn||(function(n,p){return we.call(n,p)}),He=Array.isArray||(function(n){return Ue.call(n)==="[object Array]"}),et=Object.create(null);function Ve(n){return et[n]||(et[n]=new RegExp("^(?:"+n.replace(/ /g,"|")+")$"))}function it(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var Lt=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,It=function(p,T){this.line=p,this.column=T};It.prototype.offset=function(p){return new It(this.line,this.column+p)};var Dt=function(p,T,B){this.start=T,this.end=B,p.sourceFile!==null&&(this.source=p.sourceFile)};function Yi(n,p){for(var T=1,B=0;;){var Z=Pe(n,B,p);if(Z<0)return new It(T,p-B);++T,B=Z}}var dt={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},yi=!1;function Qi(n){var p={};for(var T in dt)p[T]=n&&pe(n,T)?n[T]:dt[T];if(p.ecmaVersion==="latest"?p.ecmaVersion=1e8:p.ecmaVersion==null?(!yi&&typeof console=="object"&&console.warn&&(yi=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),p.ecmaVersion=11):p.ecmaVersion>=2015&&(p.ecmaVersion-=2009),p.allowReserved==null&&(p.allowReserved=p.ecmaVersion<5),(!n||n.allowHashBang==null)&&(p.allowHashBang=p.ecmaVersion>=14),He(p.onToken)){var B=p.onToken;p.onToken=function(Z){return B.push(Z)}}return He(p.onComment)&&(p.onComment=Ji(p,p.onComment)),p}function Ji(n,p){return function(T,B,Z,he,me,Ee){var Ne={type:T?"Block":"Line",value:B,start:Z,end:he};n.locations&&(Ne.loc=new Dt(this,me,Ee)),n.ranges&&(Ne.range=[Z,he]),p.push(Ne)}}var at=1,ut=2,lt=4,Tn=8,ui=16,Mn=32,bi=64,zn=128,Qt=256,xi=512,Di=at|ut|Qt;function Vi(n,p){return ut|(n?lt:0)|(p?Tn:0)}var pt=0,wi=1,rt=2,en=3,Qe=4,e=5,i=function(p,T,B){this.options=p=Qi(p),this.sourceFile=p.sourceFile,this.keywords=Ve(C[p.ecmaVersion>=6?6:p.sourceType==="module"?"5module":5]);var Z="";p.allowReserved!==!0&&(Z=_[p.ecmaVersion>=6?6:p.ecmaVersion===5?5:3],p.sourceType==="module"&&(Z+=" await")),this.reservedWords=Ve(Z);var he=(Z?Z+" ":"")+_.strict;this.reservedWordsStrict=Ve(he),this.reservedWordsStrictBind=Ve(he+" "+_.strictBind),this.input=String(T),this.containsEsc=!1,B?(this.pos=B,this.lineStart=this.input.lastIndexOf(`
`,B-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(le).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=I.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=p.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&p.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(at),this.regexpState=null,this.privateNameStack=[]},r={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};i.prototype.parse=function(){var p=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(p)},r.inFunction.get=function(){return(this.currentVarScope().flags&ut)>0},r.inGenerator.get=function(){return(this.currentVarScope().flags&Tn)>0},r.inAsync.get=function(){return(this.currentVarScope().flags&lt)>0},r.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var p=this.scopeStack[n],T=p.flags;if(T&(Qt|xi))return!1;if(T&ut)return(T&lt)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction},r.allowSuper.get=function(){var n=this.currentThisScope(),p=n.flags;return(p&bi)>0||this.options.allowSuperOutsideMethod},r.allowDirectSuper.get=function(){return(this.currentThisScope().flags&zn)>0},r.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},r.allowNewDotTarget.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var p=this.scopeStack[n],T=p.flags;if(T&(Qt|xi)||T&ut&&!(T&ui))return!0}return!1},r.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&Qt)>0},i.extend=function(){for(var p=[],T=arguments.length;T--;)p[T]=arguments[T];for(var B=this,Z=0;Z<p.length;Z++)B=p[Z](B);return B},i.parse=function(p,T){return new this(T,p).parse()},i.parseExpressionAt=function(p,T,B){var Z=new this(B,p,T);return Z.nextToken(),Z.parseExpression()},i.tokenizer=function(p,T){return new this(T,p)},Object.defineProperties(i.prototype,r);var l=i.prototype,f=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;l.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){Ce.lastIndex=n,n+=Ce.exec(this.input)[0].length;var p=f.exec(this.input.slice(n));if(!p)return!1;if((p[1]||p[2])==="use strict"){Ce.lastIndex=n+p[0].length;var T=Ce.exec(this.input),B=T.index+T[0].length,Z=this.input.charAt(B);return Z===";"||Z==="}"||le.test(T[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(Z)||Z==="!"&&this.input.charAt(B+1)==="=")}n+=p[0].length,Ce.lastIndex=n,n+=Ce.exec(this.input)[0].length,this.input[n]===";"&&n++}},l.eat=function(n){return this.type===n?(this.next(),!0):!1},l.isContextual=function(n){return this.type===I.name&&this.value===n&&!this.containsEsc},l.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1},l.expectContextual=function(n){this.eatContextual(n)||this.unexpected()},l.canInsertSemicolon=function(){return this.type===I.eof||this.type===I.braceR||le.test(this.input.slice(this.lastTokEnd,this.start))},l.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},l.semicolon=function(){!this.eat(I.semi)&&!this.insertSemicolon()&&this.unexpected()},l.afterTrailingComma=function(n,p){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),p||this.next(),!0},l.expect=function(n){this.eat(n)||this.unexpected()},l.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var g=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};l.checkPatternErrors=function(n,p){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var T=p?n.parenthesizedAssign:n.parenthesizedBind;T>-1&&this.raiseRecoverable(T,p?"Assigning to rvalue":"Parenthesized pattern")}},l.checkExpressionErrors=function(n,p){if(!n)return!1;var T=n.shorthandAssign,B=n.doubleProto;if(!p)return T>=0||B>=0;T>=0&&this.raise(T,"Shorthand property assignments are valid only in destructuring patterns"),B>=0&&this.raiseRecoverable(B,"Redefinition of __proto__ property")},l.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},l.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var m=i.prototype;m.parseTopLevel=function(n){var p=Object.create(null);for(n.body||(n.body=[]);this.type!==I.eof;){var T=this.parseStatement(null,!0,p);n.body.push(T)}if(this.inModule)for(var B=0,Z=Object.keys(this.undefinedExports);B<Z.length;B+=1){var he=Z[B];this.raiseRecoverable(this.undefinedExports[he].start,"Export '"+he+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var v={kind:"loop"},y={kind:"switch"};m.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ce.lastIndex=this.pos;var p=Ce.exec(this.input),T=this.pos+p[0].length,B=this.input.charCodeAt(T);if(B===91||B===92)return!0;if(n)return!1;if(B===123||B>55295&&B<56320)return!0;if(J(B,!0)){for(var Z=T+1;j(B=this.input.charCodeAt(Z),!0);)++Z;if(B===92||B>55295&&B<56320)return!0;var he=this.input.slice(T,Z);if(!S.test(he))return!0}return!1},m.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ce.lastIndex=this.pos;var n=Ce.exec(this.input),p=this.pos+n[0].length,T;return!le.test(this.input.slice(this.pos,p))&&this.input.slice(p,p+8)==="function"&&(p+8===this.input.length||!(j(T=this.input.charCodeAt(p+8))||T>55295&&T<56320))},m.isUsingKeyword=function(n,p){if(this.options.ecmaVersion<17||!this.isContextual(n?"await":"using"))return!1;Ce.lastIndex=this.pos;var T=Ce.exec(this.input),B=this.pos+T[0].length;if(le.test(this.input.slice(this.pos,B)))return!1;if(n){var Z=B+5,he;if(this.input.slice(B,Z)!=="using"||Z===this.input.length||j(he=this.input.charCodeAt(Z))||he>55295&&he<56320)return!1;Ce.lastIndex=Z;var me=Ce.exec(this.input);if(me&&le.test(this.input.slice(Z,Z+me[0].length)))return!1}if(p){var Ee=B+2,Ne;if(this.input.slice(B,Ee)==="of"&&(Ee===this.input.length||!j(Ne=this.input.charCodeAt(Ee))&&!(Ne>55295&&Ne<56320)))return!1}var We=this.input.charCodeAt(B);return J(We,!0)||We===92},m.isAwaitUsing=function(n){return this.isUsingKeyword(!0,n)},m.isUsing=function(n){return this.isUsingKeyword(!1,n)},m.parseStatement=function(n,p,T){var B=this.type,Z=this.startNode(),he;switch(this.isLet(n)&&(B=I._var,he="let"),B){case I._break:case I._continue:return this.parseBreakContinueStatement(Z,B.keyword);case I._debugger:return this.parseDebuggerStatement(Z);case I._do:return this.parseDoStatement(Z);case I._for:return this.parseForStatement(Z);case I._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(Z,!1,!n);case I._class:return n&&this.unexpected(),this.parseClass(Z,!0);case I._if:return this.parseIfStatement(Z);case I._return:return this.parseReturnStatement(Z);case I._switch:return this.parseSwitchStatement(Z);case I._throw:return this.parseThrowStatement(Z);case I._try:return this.parseTryStatement(Z);case I._const:case I._var:return he=he||this.value,n&&he!=="var"&&this.unexpected(),this.parseVarStatement(Z,he);case I._while:return this.parseWhileStatement(Z);case I._with:return this.parseWithStatement(Z);case I.braceL:return this.parseBlock(!0,Z);case I.semi:return this.parseEmptyStatement(Z);case I._export:case I._import:if(this.options.ecmaVersion>10&&B===I._import){Ce.lastIndex=this.pos;var me=Ce.exec(this.input),Ee=this.pos+me[0].length,Ne=this.input.charCodeAt(Ee);if(Ne===40||Ne===46)return this.parseExpressionStatement(Z,this.parseExpression())}return this.options.allowImportExportEverywhere||(p||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),B===I._import?this.parseImport(Z):this.parseExport(Z,T);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(Z,!0,!n);var We=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(We)return p&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),We==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(Z,!1,We),this.semicolon(),this.finishNode(Z,"VariableDeclaration");var Je=this.value,ot=this.parseExpression();return B===I.name&&ot.type==="Identifier"&&this.eat(I.colon)?this.parseLabeledStatement(Z,Je,ot,n):this.parseExpressionStatement(Z,ot)}},m.parseBreakContinueStatement=function(n,p){var T=p==="break";this.next(),this.eat(I.semi)||this.insertSemicolon()?n.label=null:this.type!==I.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var B=0;B<this.labels.length;++B){var Z=this.labels[B];if((n.label==null||Z.name===n.label.name)&&(Z.kind!=null&&(T||Z.kind==="loop")||n.label&&T))break}return B===this.labels.length&&this.raise(n.start,"Unsyntactic "+p),this.finishNode(n,T?"BreakStatement":"ContinueStatement")},m.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")},m.parseDoStatement=function(n){return this.next(),this.labels.push(v),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(I._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(I.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")},m.parseForStatement=function(n){this.next();var p=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(v),this.enterScope(0),this.expect(I.parenL),this.type===I.semi)return p>-1&&this.unexpected(p),this.parseFor(n,null);var T=this.isLet();if(this.type===I._var||this.type===I._const||T){var B=this.startNode(),Z=T?"let":this.value;return this.next(),this.parseVar(B,!0,Z),this.finishNode(B,"VariableDeclaration"),this.parseForAfterInit(n,B,p)}var he=this.isContextual("let"),me=!1,Ee=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(Ee){var Ne=this.startNode();return this.next(),Ee==="await using"&&this.next(),this.parseVar(Ne,!0,Ee),this.finishNode(Ne,"VariableDeclaration"),this.parseForAfterInit(n,Ne,p)}var We=this.containsEsc,Je=new g,ot=this.start,Ct=p>-1?this.parseExprSubscripts(Je,"await"):this.parseExpression(!0,Je);return this.type===I._in||(me=this.options.ecmaVersion>=6&&this.isContextual("of"))?(p>-1?(this.type===I._in&&this.unexpected(p),n.await=!0):me&&this.options.ecmaVersion>=8&&(Ct.start===ot&&!We&&Ct.type==="Identifier"&&Ct.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(n.await=!1)),he&&me&&this.raise(Ct.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(Ct,!1,Je),this.checkLValPattern(Ct),this.parseForIn(n,Ct)):(this.checkExpressionErrors(Je,!0),p>-1&&this.unexpected(p),this.parseFor(n,Ct))},m.parseForAfterInit=function(n,p,T){return(this.type===I._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&p.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===I._in?T>-1&&this.unexpected(T):n.await=T>-1),this.parseForIn(n,p)):(T>-1&&this.unexpected(T),this.parseFor(n,p))},m.parseFunctionStatement=function(n,p,T){return this.next(),this.parseFunction(n,M|(T?0:L),!1,p)},m.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(I._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")},m.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(I.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")},m.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(I.braceL),this.labels.push(y),this.enterScope(0);for(var p,T=!1;this.type!==I.braceR;)if(this.type===I._case||this.type===I._default){var B=this.type===I._case;p&&this.finishNode(p,"SwitchCase"),n.cases.push(p=this.startNode()),p.consequent=[],this.next(),B?p.test=this.parseExpression():(T&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),T=!0,p.test=null),this.expect(I.colon)}else p||this.unexpected(),p.consequent.push(this.parseStatement(null));return this.exitScope(),p&&this.finishNode(p,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")},m.parseThrowStatement=function(n){return this.next(),le.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var x=[];m.parseCatchClauseParam=function(){var n=this.parseBindingAtom(),p=n.type==="Identifier";return this.enterScope(p?Mn:0),this.checkLValPattern(n,p?Qe:rt),this.expect(I.parenR),n},m.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===I._catch){var p=this.startNode();this.next(),this.eat(I.parenL)?p.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),p.param=null,this.enterScope(0)),p.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(p,"CatchClause")}return n.finalizer=this.eat(I._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")},m.parseVarStatement=function(n,p,T){return this.next(),this.parseVar(n,!1,p,T),this.semicolon(),this.finishNode(n,"VariableDeclaration")},m.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(v),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")},m.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")},m.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")},m.parseLabeledStatement=function(n,p,T,B){for(var Z=0,he=this.labels;Z<he.length;Z+=1){var me=he[Z];me.name===p&&this.raise(T.start,"Label '"+p+"' is already declared")}for(var Ee=this.type.isLoop?"loop":this.type===I._switch?"switch":null,Ne=this.labels.length-1;Ne>=0;Ne--){var We=this.labels[Ne];if(We.statementStart===n.start)We.statementStart=this.start,We.kind=Ee;else break}return this.labels.push({name:p,kind:Ee,statementStart:this.start}),n.body=this.parseStatement(B?B.indexOf("label")===-1?B+"label":B:"label"),this.labels.pop(),n.label=T,this.finishNode(n,"LabeledStatement")},m.parseExpressionStatement=function(n,p){return n.expression=p,this.semicolon(),this.finishNode(n,"ExpressionStatement")},m.parseBlock=function(n,p,T){for(n===void 0&&(n=!0),p===void 0&&(p=this.startNode()),p.body=[],this.expect(I.braceL),n&&this.enterScope(0);this.type!==I.braceR;){var B=this.parseStatement(null);p.body.push(B)}return T&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(p,"BlockStatement")},m.parseFor=function(n,p){return n.init=p,this.expect(I.semi),n.test=this.type===I.semi?null:this.parseExpression(),this.expect(I.semi),n.update=this.type===I.parenR?null:this.parseExpression(),this.expect(I.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")},m.parseForIn=function(n,p){var T=this.type===I._in;return this.next(),p.type==="VariableDeclaration"&&p.declarations[0].init!=null&&(!T||this.options.ecmaVersion<8||this.strict||p.kind!=="var"||p.declarations[0].id.type!=="Identifier")&&this.raise(p.start,(T?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=p,n.right=T?this.parseExpression():this.parseMaybeAssign(),this.expect(I.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,T?"ForInStatement":"ForOfStatement")},m.parseVar=function(n,p,T,B){for(n.declarations=[],n.kind=T;;){var Z=this.startNode();if(this.parseVarId(Z,T),this.eat(I.eq)?Z.init=this.parseMaybeAssign(p):!B&&T==="const"&&!(this.type===I._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!B&&(T==="using"||T==="await using")&&this.options.ecmaVersion>=17&&this.type!==I._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+T+" declaration"):!B&&Z.id.type!=="Identifier"&&!(p&&(this.type===I._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):Z.init=null,n.declarations.push(this.finishNode(Z,"VariableDeclarator")),!this.eat(I.comma))break}return n},m.parseVarId=function(n,p){n.id=p==="using"||p==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(n.id,p==="var"?wi:rt,!1)};var M=1,L=2,E=4;m.parseFunction=function(n,p,T,B,Z){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!B)&&(this.type===I.star&&p&L&&this.unexpected(),n.generator=this.eat(I.star)),this.options.ecmaVersion>=8&&(n.async=!!B),p&M&&(n.id=p&E&&this.type!==I.name?null:this.parseIdent(),n.id&&!(p&L)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?wi:rt:en));var he=this.yieldPos,me=this.awaitPos,Ee=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Vi(n.async,n.generator)),p&M||(n.id=this.type===I.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,T,!1,Z),this.yieldPos=he,this.awaitPos=me,this.awaitIdentPos=Ee,this.finishNode(n,p&M?"FunctionDeclaration":"FunctionExpression")},m.parseFunctionParams=function(n){this.expect(I.parenL),n.params=this.parseBindingList(I.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},m.parseClass=function(n,p){this.next();var T=this.strict;this.strict=!0,this.parseClassId(n,p),this.parseClassSuper(n);var B=this.enterClassBody(),Z=this.startNode(),he=!1;for(Z.body=[],this.expect(I.braceL);this.type!==I.braceR;){var me=this.parseClassElement(n.superClass!==null);me&&(Z.body.push(me),me.type==="MethodDefinition"&&me.kind==="constructor"?(he&&this.raiseRecoverable(me.start,"Duplicate constructor in the same class"),he=!0):me.key&&me.key.type==="PrivateIdentifier"&&k(B,me)&&this.raiseRecoverable(me.key.start,"Identifier '#"+me.key.name+"' has already been declared"))}return this.strict=T,this.next(),n.body=this.finishNode(Z,"ClassBody"),this.exitClassBody(),this.finishNode(n,p?"ClassDeclaration":"ClassExpression")},m.parseClassElement=function(n){if(this.eat(I.semi))return null;var p=this.options.ecmaVersion,T=this.startNode(),B="",Z=!1,he=!1,me="method",Ee=!1;if(this.eatContextual("static")){if(p>=13&&this.eat(I.braceL))return this.parseClassStaticBlock(T),T;this.isClassElementNameStart()||this.type===I.star?Ee=!0:B="static"}if(T.static=Ee,!B&&p>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===I.star)&&!this.canInsertSemicolon()?he=!0:B="async"),!B&&(p>=9||!he)&&this.eat(I.star)&&(Z=!0),!B&&!he&&!Z){var Ne=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?me=Ne:B=Ne)}if(B?(T.computed=!1,T.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),T.key.name=B,this.finishNode(T.key,"Identifier")):this.parseClassElementName(T),p<13||this.type===I.parenL||me!=="method"||Z||he){var We=!T.static&&U(T,"constructor"),Je=We&&n;We&&me!=="method"&&this.raise(T.key.start,"Constructor can't have get/set modifier"),T.kind=We?"constructor":me,this.parseClassMethod(T,Z,he,Je)}else this.parseClassField(T);return T},m.isClassElementNameStart=function(){return this.type===I.name||this.type===I.privateId||this.type===I.num||this.type===I.string||this.type===I.bracketL||this.type.keyword},m.parseClassElementName=function(n){this.type===I.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)},m.parseClassMethod=function(n,p,T,B){var Z=n.key;n.kind==="constructor"?(p&&this.raise(Z.start,"Constructor can't be a generator"),T&&this.raise(Z.start,"Constructor can't be an async method")):n.static&&U(n,"prototype")&&this.raise(Z.start,"Classes may not have a static property named prototype");var he=n.value=this.parseMethod(p,T,B);return n.kind==="get"&&he.params.length!==0&&this.raiseRecoverable(he.start,"getter should have no params"),n.kind==="set"&&he.params.length!==1&&this.raiseRecoverable(he.start,"setter should have exactly one param"),n.kind==="set"&&he.params[0].type==="RestElement"&&this.raiseRecoverable(he.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")},m.parseClassField=function(n){return U(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&U(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(I.eq)?(this.enterScope(xi|bi),n.value=this.parseMaybeAssign(),this.exitScope()):n.value=null,this.semicolon(),this.finishNode(n,"PropertyDefinition")},m.parseClassStaticBlock=function(n){n.body=[];var p=this.labels;for(this.labels=[],this.enterScope(Qt|bi);this.type!==I.braceR;){var T=this.parseStatement(null);n.body.push(T)}return this.next(),this.exitScope(),this.labels=p,this.finishNode(n,"StaticBlock")},m.parseClassId=function(n,p){this.type===I.name?(n.id=this.parseIdent(),p&&this.checkLValSimple(n.id,rt,!1)):(p===!0&&this.unexpected(),n.id=null)},m.parseClassSuper=function(n){n.superClass=this.eat(I._extends)?this.parseExprSubscripts(null,!1):null},m.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared},m.exitClassBody=function(){var n=this.privateNameStack.pop(),p=n.declared,T=n.used;if(this.options.checkPrivateFields)for(var B=this.privateNameStack.length,Z=B===0?null:this.privateNameStack[B-1],he=0;he<T.length;++he){var me=T[he];pe(p,me.name)||(Z?Z.used.push(me):this.raiseRecoverable(me.start,"Private field '#"+me.name+"' must be declared in an enclosing class"))}};function k(n,p){var T=p.key.name,B=n[T],Z="true";return p.type==="MethodDefinition"&&(p.kind==="get"||p.kind==="set")&&(Z=(p.static?"s":"i")+p.kind),B==="iget"&&Z==="iset"||B==="iset"&&Z==="iget"||B==="sget"&&Z==="sset"||B==="sset"&&Z==="sget"?(n[T]="true",!1):B?!0:(n[T]=Z,!1)}function U(n,p){var T=n.computed,B=n.key;return!T&&(B.type==="Identifier"&&B.name===p||B.type==="Literal"&&B.value===p)}m.parseExportAllDeclaration=function(n,p){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(p,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==I.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ExportAllDeclaration")},m.parseExport=function(n,p){if(this.next(),this.eat(I.star))return this.parseExportAllDeclaration(n,p);if(this.eat(I._default))return this.checkExport(p,"default",this.lastTokStart),n.declaration=this.parseExportDefaultDeclaration(),this.finishNode(n,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())n.declaration=this.parseExportDeclaration(n),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(p,n.declaration.declarations):this.checkExport(p,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[]);else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(p),this.eatContextual("from"))this.type!==I.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause());else{for(var T=0,B=n.specifiers;T<B.length;T+=1){var Z=B[T];this.checkUnreserved(Z.local),this.checkLocalExport(Z.local),Z.local.type==="Literal"&&this.raise(Z.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[])}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")},m.parseExportDeclaration=function(n){return this.parseStatement(null)},m.parseExportDefaultDeclaration=function(){var n;if(this.type===I._function||(n=this.isAsyncFunction())){var p=this.startNode();return this.next(),n&&this.next(),this.parseFunction(p,M|E,!1,n)}else if(this.type===I._class){var T=this.startNode();return this.parseClass(T,"nullableID")}else{var B=this.parseMaybeAssign();return this.semicolon(),B}},m.checkExport=function(n,p,T){n&&(typeof p!="string"&&(p=p.type==="Identifier"?p.name:p.value),pe(n,p)&&this.raiseRecoverable(T,"Duplicate export '"+p+"'"),n[p]=!0)},m.checkPatternExport=function(n,p){var T=p.type;if(T==="Identifier")this.checkExport(n,p,p.start);else if(T==="ObjectPattern")for(var B=0,Z=p.properties;B<Z.length;B+=1){var he=Z[B];this.checkPatternExport(n,he)}else if(T==="ArrayPattern")for(var me=0,Ee=p.elements;me<Ee.length;me+=1){var Ne=Ee[me];Ne&&this.checkPatternExport(n,Ne)}else T==="Property"?this.checkPatternExport(n,p.value):T==="AssignmentPattern"?this.checkPatternExport(n,p.left):T==="RestElement"&&this.checkPatternExport(n,p.argument)},m.checkVariableExport=function(n,p){if(n)for(var T=0,B=p;T<B.length;T+=1){var Z=B[T];this.checkPatternExport(n,Z.id)}},m.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},m.parseExportSpecifier=function(n){var p=this.startNode();return p.local=this.parseModuleExportName(),p.exported=this.eatContextual("as")?this.parseModuleExportName():p.local,this.checkExport(n,p.exported,p.exported.start),this.finishNode(p,"ExportSpecifier")},m.parseExportSpecifiers=function(n){var p=[],T=!0;for(this.expect(I.braceL);!this.eat(I.braceR);){if(T)T=!1;else if(this.expect(I.comma),this.afterTrailingComma(I.braceR))break;p.push(this.parseExportSpecifier(n))}return p},m.parseImport=function(n){return this.next(),this.type===I.string?(n.specifiers=x,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===I.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ImportDeclaration")},m.parseImportSpecifier=function(){var n=this.startNode();return n.imported=this.parseModuleExportName(),this.eatContextual("as")?n.local=this.parseIdent():(this.checkUnreserved(n.imported),n.local=n.imported),this.checkLValSimple(n.local,rt),this.finishNode(n,"ImportSpecifier")},m.parseImportDefaultSpecifier=function(){var n=this.startNode();return n.local=this.parseIdent(),this.checkLValSimple(n.local,rt),this.finishNode(n,"ImportDefaultSpecifier")},m.parseImportNamespaceSpecifier=function(){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,rt),this.finishNode(n,"ImportNamespaceSpecifier")},m.parseImportSpecifiers=function(){var n=[],p=!0;if(this.type===I.name&&(n.push(this.parseImportDefaultSpecifier()),!this.eat(I.comma)))return n;if(this.type===I.star)return n.push(this.parseImportNamespaceSpecifier()),n;for(this.expect(I.braceL);!this.eat(I.braceR);){if(p)p=!1;else if(this.expect(I.comma),this.afterTrailingComma(I.braceR))break;n.push(this.parseImportSpecifier())}return n},m.parseWithClause=function(){var n=[];if(!this.eat(I._with))return n;this.expect(I.braceL);for(var p={},T=!0;!this.eat(I.braceR);){if(T)T=!1;else if(this.expect(I.comma),this.afterTrailingComma(I.braceR))break;var B=this.parseImportAttribute(),Z=B.key.type==="Identifier"?B.key.name:B.key.value;pe(p,Z)&&this.raiseRecoverable(B.key.start,"Duplicate attribute key '"+Z+"'"),p[Z]=!0,n.push(B)}return n},m.parseImportAttribute=function(){var n=this.startNode();return n.key=this.type===I.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(I.colon),this.type!==I.string&&this.unexpected(),n.value=this.parseExprAtom(),this.finishNode(n,"ImportAttribute")},m.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===I.string){var n=this.parseLiteral(this.value);return Lt.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)},m.adaptDirectivePrologue=function(n){for(var p=0;p<n.length&&this.isDirectiveCandidate(n[p]);++p)n[p].directive=n[p].expression.raw.slice(1,-1)},m.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var N=i.prototype;N.toAssignable=function(n,p,T){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",T&&this.checkPatternErrors(T,!0);for(var B=0,Z=n.properties;B<Z.length;B+=1){var he=Z[B];this.toAssignable(he,p),he.type==="RestElement"&&(he.argument.type==="ArrayPattern"||he.argument.type==="ObjectPattern")&&this.raise(he.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,p);break;case"ArrayExpression":n.type="ArrayPattern",T&&this.checkPatternErrors(T,!0),this.toAssignableList(n.elements,p);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,p),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,p);break;case"ParenthesizedExpression":this.toAssignable(n.expression,p,T);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!p)break;default:this.raise(n.start,"Assigning to rvalue")}else T&&this.checkPatternErrors(T,!0);return n},N.toAssignableList=function(n,p){for(var T=n.length,B=0;B<T;B++){var Z=n[B];Z&&this.toAssignable(Z,p)}if(T){var he=n[T-1];this.options.ecmaVersion===6&&p&&he&&he.type==="RestElement"&&he.argument.type!=="Identifier"&&this.unexpected(he.argument.start)}return n},N.parseSpread=function(n){var p=this.startNode();return this.next(),p.argument=this.parseMaybeAssign(!1,n),this.finishNode(p,"SpreadElement")},N.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==I.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")},N.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case I.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(I.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case I.braceL:return this.parseObj(!0)}return this.parseIdent()},N.parseBindingList=function(n,p,T,B){for(var Z=[],he=!0;!this.eat(n);)if(he?he=!1:this.expect(I.comma),p&&this.type===I.comma)Z.push(null);else{if(T&&this.afterTrailingComma(n))break;if(this.type===I.ellipsis){var me=this.parseRestBinding();this.parseBindingListItem(me),Z.push(me),this.type===I.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else Z.push(this.parseAssignableListItem(B))}return Z},N.parseAssignableListItem=function(n){var p=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(p),p},N.parseBindingListItem=function(n){return n},N.parseMaybeDefault=function(n,p,T){if(T=T||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(I.eq))return T;var B=this.startNodeAt(n,p);return B.left=T,B.right=this.parseMaybeAssign(),this.finishNode(B,"AssignmentPattern")},N.checkLValSimple=function(n,p,T){p===void 0&&(p=pt);var B=p!==pt;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(B?"Binding ":"Assigning to ")+n.name+" in strict mode"),B&&(p===rt&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),T&&(pe(T,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),T[n.name]=!0),p!==e&&this.declareName(n.name,p,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":B&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return B&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,p,T);default:this.raise(n.start,(B?"Binding":"Assigning to")+" rvalue")}},N.checkLValPattern=function(n,p,T){switch(p===void 0&&(p=pt),n.type){case"ObjectPattern":for(var B=0,Z=n.properties;B<Z.length;B+=1){var he=Z[B];this.checkLValInnerPattern(he,p,T)}break;case"ArrayPattern":for(var me=0,Ee=n.elements;me<Ee.length;me+=1){var Ne=Ee[me];Ne&&this.checkLValInnerPattern(Ne,p,T)}break;default:this.checkLValSimple(n,p,T)}},N.checkLValInnerPattern=function(n,p,T){switch(p===void 0&&(p=pt),n.type){case"Property":this.checkLValInnerPattern(n.value,p,T);break;case"AssignmentPattern":this.checkLValPattern(n.left,p,T);break;case"RestElement":this.checkLValPattern(n.argument,p,T);break;default:this.checkLValPattern(n,p,T)}};var F=function(p,T,B,Z,he){this.token=p,this.isExpr=!!T,this.preserveSpace=!!B,this.override=Z,this.generator=!!he},A={b_stat:new F("{",!1),b_expr:new F("{",!0),b_tmpl:new F("${",!1),p_stat:new F("(",!1),p_expr:new F("(",!0),q_tmpl:new F("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new F("function",!1),f_expr:new F("function",!0),f_expr_gen:new F("function",!0,!1,null,!0),f_gen:new F("function",!1,!1,null,!0)},R=i.prototype;R.initialContext=function(){return[A.b_stat]},R.curContext=function(){return this.context[this.context.length-1]},R.braceIsBlock=function(n){var p=this.curContext();return p===A.f_expr||p===A.f_stat?!0:n===I.colon&&(p===A.b_stat||p===A.b_expr)?!p.isExpr:n===I._return||n===I.name&&this.exprAllowed?le.test(this.input.slice(this.lastTokEnd,this.start)):n===I._else||n===I.semi||n===I.eof||n===I.parenR||n===I.arrow?!0:n===I.braceL?p===A.b_stat:n===I._var||n===I._const||n===I.name?!1:!this.exprAllowed},R.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var p=this.context[n];if(p.token==="function")return p.generator}return!1},R.updateContext=function(n){var p,T=this.type;T.keyword&&n===I.dot?this.exprAllowed=!1:(p=T.updateContext)?p.call(this,n):this.exprAllowed=T.beforeExpr},R.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)},I.parenR.updateContext=I.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===A.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr},I.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?A.b_stat:A.b_expr),this.exprAllowed=!0},I.dollarBraceL.updateContext=function(){this.context.push(A.b_tmpl),this.exprAllowed=!0},I.parenL.updateContext=function(n){var p=n===I._if||n===I._for||n===I._with||n===I._while;this.context.push(p?A.p_stat:A.p_expr),this.exprAllowed=!0},I.incDec.updateContext=function(){},I._function.updateContext=I._class.updateContext=function(n){n.beforeExpr&&n!==I._else&&!(n===I.semi&&this.curContext()!==A.p_stat)&&!(n===I._return&&le.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===I.colon||n===I.braceL)&&this.curContext()===A.b_stat)?this.context.push(A.f_expr):this.context.push(A.f_stat),this.exprAllowed=!1},I.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0},I.backQuote.updateContext=function(){this.curContext()===A.q_tmpl?this.context.pop():this.context.push(A.q_tmpl),this.exprAllowed=!1},I.star.updateContext=function(n){if(n===I._function){var p=this.context.length-1;this.context[p]===A.f_expr?this.context[p]=A.f_expr_gen:this.context[p]=A.f_gen}this.exprAllowed=!0},I.name.updateContext=function(n){var p=!1;this.options.ecmaVersion>=6&&n!==I.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(p=!0),this.exprAllowed=p};var w=i.prototype;w.checkPropClash=function(n,p,T){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var B=n.key,Z;switch(B.type){case"Identifier":Z=B.name;break;case"Literal":Z=String(B.value);break;default:return}var he=n.kind;if(this.options.ecmaVersion>=6){Z==="__proto__"&&he==="init"&&(p.proto&&(T?T.doubleProto<0&&(T.doubleProto=B.start):this.raiseRecoverable(B.start,"Redefinition of __proto__ property")),p.proto=!0);return}Z="$"+Z;var me=p[Z];if(me){var Ee;he==="init"?Ee=this.strict&&me.init||me.get||me.set:Ee=me.init||me[he],Ee&&this.raiseRecoverable(B.start,"Redefinition of property")}else me=p[Z]={init:!1,get:!1,set:!1};me[he]=!0}},w.parseExpression=function(n,p){var T=this.start,B=this.startLoc,Z=this.parseMaybeAssign(n,p);if(this.type===I.comma){var he=this.startNodeAt(T,B);for(he.expressions=[Z];this.eat(I.comma);)he.expressions.push(this.parseMaybeAssign(n,p));return this.finishNode(he,"SequenceExpression")}return Z},w.parseMaybeAssign=function(n,p,T){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var B=!1,Z=-1,he=-1,me=-1;p?(Z=p.parenthesizedAssign,he=p.trailingComma,me=p.doubleProto,p.parenthesizedAssign=p.trailingComma=-1):(p=new g,B=!0);var Ee=this.start,Ne=this.startLoc;(this.type===I.parenL||this.type===I.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var We=this.parseMaybeConditional(n,p);if(T&&(We=T.call(this,We,Ee,Ne)),this.type.isAssign){var Je=this.startNodeAt(Ee,Ne);return Je.operator=this.value,this.type===I.eq&&(We=this.toAssignable(We,!1,p)),B||(p.parenthesizedAssign=p.trailingComma=p.doubleProto=-1),p.shorthandAssign>=We.start&&(p.shorthandAssign=-1),this.type===I.eq?this.checkLValPattern(We):this.checkLValSimple(We),Je.left=We,this.next(),Je.right=this.parseMaybeAssign(n),me>-1&&(p.doubleProto=me),this.finishNode(Je,"AssignmentExpression")}else B&&this.checkExpressionErrors(p,!0);return Z>-1&&(p.parenthesizedAssign=Z),he>-1&&(p.trailingComma=he),We},w.parseMaybeConditional=function(n,p){var T=this.start,B=this.startLoc,Z=this.parseExprOps(n,p);if(this.checkExpressionErrors(p))return Z;if(this.eat(I.question)){var he=this.startNodeAt(T,B);return he.test=Z,he.consequent=this.parseMaybeAssign(),this.expect(I.colon),he.alternate=this.parseMaybeAssign(n),this.finishNode(he,"ConditionalExpression")}return Z},w.parseExprOps=function(n,p){var T=this.start,B=this.startLoc,Z=this.parseMaybeUnary(p,!1,!1,n);return this.checkExpressionErrors(p)||Z.start===T&&Z.type==="ArrowFunctionExpression"?Z:this.parseExprOp(Z,T,B,-1,n)},w.parseExprOp=function(n,p,T,B,Z){var he=this.type.binop;if(he!=null&&(!Z||this.type!==I._in)&&he>B){var me=this.type===I.logicalOR||this.type===I.logicalAND,Ee=this.type===I.coalesce;Ee&&(he=I.logicalAND.binop);var Ne=this.value;this.next();var We=this.start,Je=this.startLoc,ot=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,Z),We,Je,he,Z),Ct=this.buildBinary(p,T,n,ot,Ne,me||Ee);return(me&&this.type===I.coalesce||Ee&&(this.type===I.logicalOR||this.type===I.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ct,p,T,B,Z)}return n},w.buildBinary=function(n,p,T,B,Z,he){B.type==="PrivateIdentifier"&&this.raise(B.start,"Private identifier can only be left side of binary expression");var me=this.startNodeAt(n,p);return me.left=T,me.operator=Z,me.right=B,this.finishNode(me,he?"LogicalExpression":"BinaryExpression")},w.parseMaybeUnary=function(n,p,T,B){var Z=this.start,he=this.startLoc,me;if(this.isContextual("await")&&this.canAwait)me=this.parseAwait(B),p=!0;else if(this.type.prefix){var Ee=this.startNode(),Ne=this.type===I.incDec;Ee.operator=this.value,Ee.prefix=!0,this.next(),Ee.argument=this.parseMaybeUnary(null,!0,Ne,B),this.checkExpressionErrors(n,!0),Ne?this.checkLValSimple(Ee.argument):this.strict&&Ee.operator==="delete"&&O(Ee.argument)?this.raiseRecoverable(Ee.start,"Deleting local variable in strict mode"):Ee.operator==="delete"&&q(Ee.argument)?this.raiseRecoverable(Ee.start,"Private fields can not be deleted"):p=!0,me=this.finishNode(Ee,Ne?"UpdateExpression":"UnaryExpression")}else if(!p&&this.type===I.privateId)(B||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),me=this.parsePrivateIdent(),this.type!==I._in&&this.unexpected();else{if(me=this.parseExprSubscripts(n,B),this.checkExpressionErrors(n))return me;for(;this.type.postfix&&!this.canInsertSemicolon();){var We=this.startNodeAt(Z,he);We.operator=this.value,We.prefix=!1,We.argument=me,this.checkLValSimple(me),this.next(),me=this.finishNode(We,"UpdateExpression")}}if(!T&&this.eat(I.starstar))if(p)this.unexpected(this.lastTokStart);else return this.buildBinary(Z,he,me,this.parseMaybeUnary(null,!1,!1,B),"**",!1);else return me};function O(n){return n.type==="Identifier"||n.type==="ParenthesizedExpression"&&O(n.expression)}function q(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&q(n.expression)||n.type==="ParenthesizedExpression"&&q(n.expression)}w.parseExprSubscripts=function(n,p){var T=this.start,B=this.startLoc,Z=this.parseExprAtom(n,p);if(Z.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return Z;var he=this.parseSubscripts(Z,T,B,!1,p);return n&&he.type==="MemberExpression"&&(n.parenthesizedAssign>=he.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=he.start&&(n.parenthesizedBind=-1),n.trailingComma>=he.start&&(n.trailingComma=-1)),he},w.parseSubscripts=function(n,p,T,B,Z){for(var he=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,me=!1;;){var Ee=this.parseSubscript(n,p,T,B,he,me,Z);if(Ee.optional&&(me=!0),Ee===n||Ee.type==="ArrowFunctionExpression"){if(me){var Ne=this.startNodeAt(p,T);Ne.expression=Ee,Ee=this.finishNode(Ne,"ChainExpression")}return Ee}n=Ee}},w.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(I.arrow)},w.parseSubscriptAsyncArrow=function(n,p,T,B){return this.parseArrowExpression(this.startNodeAt(n,p),T,!0,B)},w.parseSubscript=function(n,p,T,B,Z,he,me){var Ee=this.options.ecmaVersion>=11,Ne=Ee&&this.eat(I.questionDot);B&&Ne&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var We=this.eat(I.bracketL);if(We||Ne&&this.type!==I.parenL&&this.type!==I.backQuote||this.eat(I.dot)){var Je=this.startNodeAt(p,T);Je.object=n,We?(Je.property=this.parseExpression(),this.expect(I.bracketR)):this.type===I.privateId&&n.type!=="Super"?Je.property=this.parsePrivateIdent():Je.property=this.parseIdent(this.options.allowReserved!=="never"),Je.computed=!!We,Ee&&(Je.optional=Ne),n=this.finishNode(Je,"MemberExpression")}else if(!B&&this.eat(I.parenL)){var ot=new g,Ct=this.yieldPos,Pi=this.awaitPos,ti=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Xt=this.parseExprList(I.parenR,this.options.ecmaVersion>=8,!1,ot);if(Z&&!Ne&&this.shouldParseAsyncArrow())return this.checkPatternErrors(ot,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Ct,this.awaitPos=Pi,this.awaitIdentPos=ti,this.parseSubscriptAsyncArrow(p,T,Xt,me);this.checkExpressionErrors(ot,!0),this.yieldPos=Ct||this.yieldPos,this.awaitPos=Pi||this.awaitPos,this.awaitIdentPos=ti||this.awaitIdentPos;var hi=this.startNodeAt(p,T);hi.callee=n,hi.arguments=Xt,Ee&&(hi.optional=Ne),n=this.finishNode(hi,"CallExpression")}else if(this.type===I.backQuote){(Ne||he)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var ci=this.startNodeAt(p,T);ci.tag=n,ci.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(ci,"TaggedTemplateExpression")}return n},w.parseExprAtom=function(n,p,T){this.type===I.slash&&this.readRegexp();var B,Z=this.potentialArrowAt===this.start;switch(this.type){case I._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),B=this.startNode(),this.next(),this.type===I.parenL&&!this.allowDirectSuper&&this.raise(B.start,"super() call outside constructor of a subclass"),this.type!==I.dot&&this.type!==I.bracketL&&this.type!==I.parenL&&this.unexpected(),this.finishNode(B,"Super");case I._this:return B=this.startNode(),this.next(),this.finishNode(B,"ThisExpression");case I.name:var he=this.start,me=this.startLoc,Ee=this.containsEsc,Ne=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ee&&Ne.name==="async"&&!this.canInsertSemicolon()&&this.eat(I._function))return this.overrideContext(A.f_expr),this.parseFunction(this.startNodeAt(he,me),0,!1,!0,p);if(Z&&!this.canInsertSemicolon()){if(this.eat(I.arrow))return this.parseArrowExpression(this.startNodeAt(he,me),[Ne],!1,p);if(this.options.ecmaVersion>=8&&Ne.name==="async"&&this.type===I.name&&!Ee&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return Ne=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(I.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(he,me),[Ne],!0,p)}return Ne;case I.regexp:var We=this.value;return B=this.parseLiteral(We.value),B.regex={pattern:We.pattern,flags:We.flags},B;case I.num:case I.string:return this.parseLiteral(this.value);case I._null:case I._true:case I._false:return B=this.startNode(),B.value=this.type===I._null?null:this.type===I._true,B.raw=this.type.keyword,this.next(),this.finishNode(B,"Literal");case I.parenL:var Je=this.start,ot=this.parseParenAndDistinguishExpression(Z,p);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ot)&&(n.parenthesizedAssign=Je),n.parenthesizedBind<0&&(n.parenthesizedBind=Je)),ot;case I.bracketL:return B=this.startNode(),this.next(),B.elements=this.parseExprList(I.bracketR,!0,!0,n),this.finishNode(B,"ArrayExpression");case I.braceL:return this.overrideContext(A.b_expr),this.parseObj(!1,n);case I._function:return B=this.startNode(),this.next(),this.parseFunction(B,0);case I._class:return this.parseClass(this.startNode(),!1);case I._new:return this.parseNew();case I.backQuote:return this.parseTemplate();case I._import:return this.options.ecmaVersion>=11?this.parseExprImport(T):this.unexpected();default:return this.parseExprAtomDefault()}},w.parseExprAtomDefault=function(){this.unexpected()},w.parseExprImport=function(n){var p=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===I.parenL&&!n)return this.parseDynamicImport(p);if(this.type===I.dot){var T=this.startNodeAt(p.start,p.loc&&p.loc.start);return T.name="import",p.meta=this.finishNode(T,"Identifier"),this.parseImportMeta(p)}else this.unexpected()},w.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(I.parenR)?n.options=null:(this.expect(I.comma),this.afterTrailingComma(I.parenR)?n.options=null:(n.options=this.parseMaybeAssign(),this.eat(I.parenR)||(this.expect(I.comma),this.afterTrailingComma(I.parenR)||this.unexpected())));else if(!this.eat(I.parenR)){var p=this.start;this.eat(I.comma)&&this.eat(I.parenR)?this.raiseRecoverable(p,"Trailing comma is not allowed in import()"):this.unexpected(p)}return this.finishNode(n,"ImportExpression")},w.parseImportMeta=function(n){this.next();var p=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),p&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")},w.parseLiteral=function(n){var p=this.startNode();return p.value=n,p.raw=this.input.slice(this.start,this.end),p.raw.charCodeAt(p.raw.length-1)===110&&(p.bigint=p.value!=null?p.value.toString():p.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(p,"Literal")},w.parseParenExpression=function(){this.expect(I.parenL);var n=this.parseExpression();return this.expect(I.parenR),n},w.shouldParseArrow=function(n){return!this.canInsertSemicolon()},w.parseParenAndDistinguishExpression=function(n,p){var T=this.start,B=this.startLoc,Z,he=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var me=this.start,Ee=this.startLoc,Ne=[],We=!0,Je=!1,ot=new g,Ct=this.yieldPos,Pi=this.awaitPos,ti;for(this.yieldPos=0,this.awaitPos=0;this.type!==I.parenR;)if(We?We=!1:this.expect(I.comma),he&&this.afterTrailingComma(I.parenR,!0)){Je=!0;break}else if(this.type===I.ellipsis){ti=this.start,Ne.push(this.parseParenItem(this.parseRestBinding())),this.type===I.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else Ne.push(this.parseMaybeAssign(!1,ot,this.parseParenItem));var Xt=this.lastTokEnd,hi=this.lastTokEndLoc;if(this.expect(I.parenR),n&&this.shouldParseArrow(Ne)&&this.eat(I.arrow))return this.checkPatternErrors(ot,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Ct,this.awaitPos=Pi,this.parseParenArrowList(T,B,Ne,p);(!Ne.length||Je)&&this.unexpected(this.lastTokStart),ti&&this.unexpected(ti),this.checkExpressionErrors(ot,!0),this.yieldPos=Ct||this.yieldPos,this.awaitPos=Pi||this.awaitPos,Ne.length>1?(Z=this.startNodeAt(me,Ee),Z.expressions=Ne,this.finishNodeAt(Z,"SequenceExpression",Xt,hi)):Z=Ne[0]}else Z=this.parseParenExpression();if(this.options.preserveParens){var ci=this.startNodeAt(T,B);return ci.expression=Z,this.finishNode(ci,"ParenthesizedExpression")}else return Z},w.parseParenItem=function(n){return n},w.parseParenArrowList=function(n,p,T,B){return this.parseArrowExpression(this.startNodeAt(n,p),T,!1,B)};var H=[];w.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===I.dot){var p=this.startNodeAt(n.start,n.loc&&n.loc.start);p.name="new",n.meta=this.finishNode(p,"Identifier"),this.next();var T=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),T&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var B=this.start,Z=this.startLoc;return n.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),B,Z,!0,!1),this.eat(I.parenL)?n.arguments=this.parseExprList(I.parenR,this.options.ecmaVersion>=8,!1):n.arguments=H,this.finishNode(n,"NewExpression")},w.parseTemplateElement=function(n){var p=n.isTagged,T=this.startNode();return this.type===I.invalidTemplate?(p||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),T.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):T.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),T.tail=this.type===I.backQuote,this.finishNode(T,"TemplateElement")},w.parseTemplate=function(n){n===void 0&&(n={});var p=n.isTagged;p===void 0&&(p=!1);var T=this.startNode();this.next(),T.expressions=[];var B=this.parseTemplateElement({isTagged:p});for(T.quasis=[B];!B.tail;)this.type===I.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(I.dollarBraceL),T.expressions.push(this.parseExpression()),this.expect(I.braceR),T.quasis.push(B=this.parseTemplateElement({isTagged:p}));return this.next(),this.finishNode(T,"TemplateLiteral")},w.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===I.name||this.type===I.num||this.type===I.string||this.type===I.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===I.star)&&!le.test(this.input.slice(this.lastTokEnd,this.start))},w.parseObj=function(n,p){var T=this.startNode(),B=!0,Z={};for(T.properties=[],this.next();!this.eat(I.braceR);){if(B)B=!1;else if(this.expect(I.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(I.braceR))break;var he=this.parseProperty(n,p);n||this.checkPropClash(he,Z,p),T.properties.push(he)}return this.finishNode(T,n?"ObjectPattern":"ObjectExpression")},w.parseProperty=function(n,p){var T=this.startNode(),B,Z,he,me;if(this.options.ecmaVersion>=9&&this.eat(I.ellipsis))return n?(T.argument=this.parseIdent(!1),this.type===I.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(T,"RestElement")):(T.argument=this.parseMaybeAssign(!1,p),this.type===I.comma&&p&&p.trailingComma<0&&(p.trailingComma=this.start),this.finishNode(T,"SpreadElement"));this.options.ecmaVersion>=6&&(T.method=!1,T.shorthand=!1,(n||p)&&(he=this.start,me=this.startLoc),n||(B=this.eat(I.star)));var Ee=this.containsEsc;return this.parsePropertyName(T),!n&&!Ee&&this.options.ecmaVersion>=8&&!B&&this.isAsyncProp(T)?(Z=!0,B=this.options.ecmaVersion>=9&&this.eat(I.star),this.parsePropertyName(T)):Z=!1,this.parsePropertyValue(T,n,B,Z,he,me,p,Ee),this.finishNode(T,"Property")},w.parseGetterSetter=function(n){var p=n.key.name;this.parsePropertyName(n),n.value=this.parseMethod(!1),n.kind=p;var T=n.kind==="get"?0:1;if(n.value.params.length!==T){var B=n.value.start;n.kind==="get"?this.raiseRecoverable(B,"getter should have no params"):this.raiseRecoverable(B,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")},w.parsePropertyValue=function(n,p,T,B,Z,he,me,Ee){(T||B)&&this.type===I.colon&&this.unexpected(),this.eat(I.colon)?(n.value=p?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,me),n.kind="init"):this.options.ecmaVersion>=6&&this.type===I.parenL?(p&&this.unexpected(),n.method=!0,n.value=this.parseMethod(T,B),n.kind="init"):!p&&!Ee&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==I.comma&&this.type!==I.braceR&&this.type!==I.eq?((T||B)&&this.unexpected(),this.parseGetterSetter(n)):this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((T||B)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Z),p?n.value=this.parseMaybeDefault(Z,he,this.copyNode(n.key)):this.type===I.eq&&me?(me.shorthandAssign<0&&(me.shorthandAssign=this.start),n.value=this.parseMaybeDefault(Z,he,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.kind="init",n.shorthand=!0):this.unexpected()},w.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(I.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(I.bracketR),n.key;n.computed=!1}return n.key=this.type===I.num||this.type===I.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},w.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)},w.parseMethod=function(n,p,T){var B=this.startNode(),Z=this.yieldPos,he=this.awaitPos,me=this.awaitIdentPos;return this.initFunction(B),this.options.ecmaVersion>=6&&(B.generator=n),this.options.ecmaVersion>=8&&(B.async=!!p),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Vi(p,B.generator)|bi|(T?zn:0)),this.expect(I.parenL),B.params=this.parseBindingList(I.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(B,!1,!0,!1),this.yieldPos=Z,this.awaitPos=he,this.awaitIdentPos=me,this.finishNode(B,"FunctionExpression")},w.parseArrowExpression=function(n,p,T,B){var Z=this.yieldPos,he=this.awaitPos,me=this.awaitIdentPos;return this.enterScope(Vi(T,!1)|ui),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(p,!0),this.parseFunctionBody(n,!0,!1,B),this.yieldPos=Z,this.awaitPos=he,this.awaitIdentPos=me,this.finishNode(n,"ArrowFunctionExpression")},w.parseFunctionBody=function(n,p,T,B){var Z=p&&this.type!==I.braceL,he=this.strict,me=!1;if(Z)n.body=this.parseMaybeAssign(B),n.expression=!0,this.checkParams(n,!1);else{var Ee=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!he||Ee)&&(me=this.strictDirective(this.end),me&&Ee&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ne=this.labels;this.labels=[],me&&(this.strict=!0),this.checkParams(n,!he&&!me&&!p&&!T&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,e),n.body=this.parseBlock(!1,void 0,me&&!he),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=Ne}this.exitScope()},w.isSimpleParamList=function(n){for(var p=0,T=n;p<T.length;p+=1){var B=T[p];if(B.type!=="Identifier")return!1}return!0},w.checkParams=function(n,p){for(var T=Object.create(null),B=0,Z=n.params;B<Z.length;B+=1){var he=Z[B];this.checkLValInnerPattern(he,wi,p?null:T)}},w.parseExprList=function(n,p,T,B){for(var Z=[],he=!0;!this.eat(n);){if(he)he=!1;else if(this.expect(I.comma),p&&this.afterTrailingComma(n))break;var me=void 0;T&&this.type===I.comma?me=null:this.type===I.ellipsis?(me=this.parseSpread(B),B&&this.type===I.comma&&B.trailingComma<0&&(B.trailingComma=this.start)):me=this.parseMaybeAssign(!1,B),Z.push(me)}return Z},w.checkUnreserved=function(n){var p=n.start,T=n.end,B=n.name;if(this.inGenerator&&B==="yield"&&this.raiseRecoverable(p,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&B==="await"&&this.raiseRecoverable(p,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&Di)&&B==="arguments"&&this.raiseRecoverable(p,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(B==="arguments"||B==="await")&&this.raise(p,"Cannot use "+B+" in class static initialization block"),this.keywords.test(B)&&this.raise(p,"Unexpected keyword '"+B+"'"),!(this.options.ecmaVersion<6&&this.input.slice(p,T).indexOf("\\")!==-1)){var Z=this.strict?this.reservedWordsStrict:this.reservedWords;Z.test(B)&&(!this.inAsync&&B==="await"&&this.raiseRecoverable(p,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(p,"The keyword '"+B+"' is reserved"))}},w.parseIdent=function(n){var p=this.parseIdentNode();return this.next(!!n),this.finishNode(p,"Identifier"),n||(this.checkUnreserved(p),p.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=p.start)),p},w.parseIdentNode=function(){var n=this.startNode();return this.type===I.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,(n.name==="class"||n.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=I.name):this.unexpected(),n},w.parsePrivateIdent=function(){var n=this.startNode();return this.type===I.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n)),n},w.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var p=this.startNode();return this.next(),this.type===I.semi||this.canInsertSemicolon()||this.type!==I.star&&!this.type.startsExpr?(p.delegate=!1,p.argument=null):(p.delegate=this.eat(I.star),p.argument=this.parseMaybeAssign(n)),this.finishNode(p,"YieldExpression")},w.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var p=this.startNode();return this.next(),p.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(p,"AwaitExpression")};var V=i.prototype;V.raise=function(n,p){var T=Yi(this.input,n);p+=" ("+T.line+":"+T.column+")",this.sourceFile&&(p+=" in "+this.sourceFile);var B=new SyntaxError(p);throw B.pos=n,B.loc=T,B.raisedAt=this.pos,B},V.raiseRecoverable=V.raise,V.curPosition=function(){if(this.options.locations)return new It(this.curLine,this.pos-this.lineStart)};var G=i.prototype,$=function(p){this.flags=p,this.var=[],this.lexical=[],this.functions=[]};G.enterScope=function(n){this.scopeStack.push(new $(n))},G.exitScope=function(){this.scopeStack.pop()},G.treatFunctionsAsVarInScope=function(n){return n.flags&ut||!this.inModule&&n.flags&at},G.declareName=function(n,p,T){var B=!1;if(p===rt){var Z=this.currentScope();B=Z.lexical.indexOf(n)>-1||Z.functions.indexOf(n)>-1||Z.var.indexOf(n)>-1,Z.lexical.push(n),this.inModule&&Z.flags&at&&delete this.undefinedExports[n]}else if(p===Qe){var he=this.currentScope();he.lexical.push(n)}else if(p===en){var me=this.currentScope();this.treatFunctionsAsVar?B=me.lexical.indexOf(n)>-1:B=me.lexical.indexOf(n)>-1||me.var.indexOf(n)>-1,me.functions.push(n)}else for(var Ee=this.scopeStack.length-1;Ee>=0;--Ee){var Ne=this.scopeStack[Ee];if(Ne.lexical.indexOf(n)>-1&&!(Ne.flags&Mn&&Ne.lexical[0]===n)||!this.treatFunctionsAsVarInScope(Ne)&&Ne.functions.indexOf(n)>-1){B=!0;break}if(Ne.var.push(n),this.inModule&&Ne.flags&at&&delete this.undefinedExports[n],Ne.flags&Di)break}B&&this.raiseRecoverable(T,"Identifier '"+n+"' has already been declared")},G.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)},G.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},G.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var p=this.scopeStack[n];if(p.flags&(Di|xi|Qt))return p}},G.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var p=this.scopeStack[n];if(p.flags&(Di|xi|Qt)&&!(p.flags&ui))return p}};var X=function(p,T,B){this.type="",this.start=T,this.end=0,p.options.locations&&(this.loc=new Dt(p,B)),p.options.directSourceFile&&(this.sourceFile=p.options.directSourceFile),p.options.ranges&&(this.range=[T,0])},te=i.prototype;te.startNode=function(){return new X(this,this.start,this.startLoc)},te.startNodeAt=function(n,p){return new X(this,n,p)};function W(n,p,T,B){return n.type=p,n.end=T,this.options.locations&&(n.loc.end=B),this.options.ranges&&(n.range[1]=T),n}te.finishNode=function(n,p){return W.call(this,n,p,this.lastTokEnd,this.lastTokEndLoc)},te.finishNodeAt=function(n,p,T,B){return W.call(this,n,p,T,B)},te.copyNode=function(n){var p=new X(this,n.start,this.startLoc);for(var T in n)p[T]=n[T];return p};var ee="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",ie="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",se=ie+" Extended_Pictographic",oe=se,ge=oe+" EBase EComp EMod EPres ExtPict",Ie=ge,Ae=Ie,ze={9:ie,10:se,11:oe,12:ge,13:Ie,14:Ae},Oe="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",ye={9:"",10:"",11:"",12:"",13:"",14:Oe},xe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Le="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",De=Le+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Re=De+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",qe=Re+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Be=qe+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",Ze=Be+" "+ee,Ye={9:Le,10:De,11:Re,12:qe,13:Be,14:Ze},Ge={};function _t(n){var p=Ge[n]={binary:Ve(ze[n]+" "+xe),binaryOfStrings:Ve(ye[n]),nonBinary:{General_Category:Ve(xe),Script:Ve(Ye[n])}};p.nonBinary.Script_Extensions=p.nonBinary.Script,p.nonBinary.gc=p.nonBinary.General_Category,p.nonBinary.sc=p.nonBinary.Script,p.nonBinary.scx=p.nonBinary.Script_Extensions}for(var gt=0,xt=[9,10,11,12,13,14];gt<xt.length;gt+=1){var mt=xt[gt];_t(mt)}var Te=i.prototype,ht=function(p,T){this.parent=p,this.base=T||this};ht.prototype.separatedFrom=function(p){for(var T=this;T;T=T.parent)for(var B=p;B;B=B.parent)if(T.base===B.base&&T!==B)return!0;return!1},ht.prototype.sibling=function(){return new ht(this.parent,this.base)};var ct=function(p){this.parser=p,this.validFlags="gim"+(p.options.ecmaVersion>=6?"uy":"")+(p.options.ecmaVersion>=9?"s":"")+(p.options.ecmaVersion>=13?"d":"")+(p.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Ge[p.options.ecmaVersion>=14?14:p.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};ct.prototype.reset=function(p,T,B){var Z=B.indexOf("v")!==-1,he=B.indexOf("u")!==-1;this.start=p|0,this.source=T+"",this.flags=B,Z&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=he&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=he&&this.parser.options.ecmaVersion>=9)},ct.prototype.raise=function(p){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+p)},ct.prototype.at=function(p,T){T===void 0&&(T=!1);var B=this.source,Z=B.length;if(p>=Z)return-1;var he=B.charCodeAt(p);if(!(T||this.switchU)||he<=55295||he>=57344||p+1>=Z)return he;var me=B.charCodeAt(p+1);return me>=56320&&me<=57343?(he<<10)+me-56613888:he},ct.prototype.nextIndex=function(p,T){T===void 0&&(T=!1);var B=this.source,Z=B.length;if(p>=Z)return Z;var he=B.charCodeAt(p),me;return!(T||this.switchU)||he<=55295||he>=57344||p+1>=Z||(me=B.charCodeAt(p+1))<56320||me>57343?p+1:p+2},ct.prototype.current=function(p){return p===void 0&&(p=!1),this.at(this.pos,p)},ct.prototype.lookahead=function(p){return p===void 0&&(p=!1),this.at(this.nextIndex(this.pos,p),p)},ct.prototype.advance=function(p){p===void 0&&(p=!1),this.pos=this.nextIndex(this.pos,p)},ct.prototype.eat=function(p,T){return T===void 0&&(T=!1),this.current(T)===p?(this.advance(T),!0):!1},ct.prototype.eatChars=function(p,T){T===void 0&&(T=!1);for(var B=this.pos,Z=0,he=p;Z<he.length;Z+=1){var me=he[Z],Ee=this.at(B,T);if(Ee===-1||Ee!==me)return!1;B=this.nextIndex(B,T)}return this.pos=B,!0},Te.validateRegExpFlags=function(n){for(var p=n.validFlags,T=n.flags,B=!1,Z=!1,he=0;he<T.length;he++){var me=T.charAt(he);p.indexOf(me)===-1&&this.raise(n.start,"Invalid regular expression flag"),T.indexOf(me,he+1)>-1&&this.raise(n.start,"Duplicate regular expression flag"),me==="u"&&(B=!0),me==="v"&&(Z=!0)}this.options.ecmaVersion>=15&&B&&Z&&this.raise(n.start,"Invalid regular expression flag")};function yt(n){for(var p in n)return!0;return!1}Te.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&yt(n.groupNames)&&(n.switchN=!0,this.regexp_pattern(n))},Te.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames=Object.create(null),n.backReferenceNames.length=0,n.branchID=null,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var p=0,T=n.backReferenceNames;p<T.length;p+=1){var B=T[p];n.groupNames[B]||n.raise("Invalid named capture referenced")}},Te.regexp_disjunction=function(n){var p=this.options.ecmaVersion>=16;for(p&&(n.branchID=new ht(n.branchID,null)),this.regexp_alternative(n);n.eat(124);)p&&(n.branchID=n.branchID.sibling()),this.regexp_alternative(n);p&&(n.branchID=n.branchID.parent),this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")},Te.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););},Te.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1},Te.regexp_eatAssertion=function(n){var p=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=p}if(n.eat(40)&&n.eat(63)){var T=!1;if(this.options.ecmaVersion>=9&&(T=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!T,!0}return n.pos=p,!1},Te.regexp_eatQuantifier=function(n,p){return p===void 0&&(p=!1),this.regexp_eatQuantifierPrefix(n,p)?(n.eat(63),!0):!1},Te.regexp_eatQuantifierPrefix=function(n,p){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,p)},Te.regexp_eatBracedQuantifier=function(n,p){var T=n.pos;if(n.eat(123)){var B=0,Z=-1;if(this.regexp_eatDecimalDigits(n)&&(B=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(Z=n.lastIntValue),n.eat(125)))return Z!==-1&&Z<B&&!p&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!p&&n.raise("Incomplete quantifier"),n.pos=T}return!1},Te.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)},Te.regexp_eatReverseSolidusAtomEscape=function(n){var p=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=p}return!1},Te.regexp_eatUncapturingGroup=function(n){var p=n.pos;if(n.eat(40)){if(n.eat(63)){if(this.options.ecmaVersion>=16){var T=this.regexp_eatModifiers(n),B=n.eat(45);if(T||B){for(var Z=0;Z<T.length;Z++){var he=T.charAt(Z);T.indexOf(he,Z+1)>-1&&n.raise("Duplicate regular expression modifiers")}if(B){var me=this.regexp_eatModifiers(n);!T&&!me&&n.current()===58&&n.raise("Invalid regular expression modifiers");for(var Ee=0;Ee<me.length;Ee++){var Ne=me.charAt(Ee);(me.indexOf(Ne,Ee+1)>-1||T.indexOf(Ne)>-1)&&n.raise("Duplicate regular expression modifiers")}}}}if(n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}}n.pos=p}return!1},Te.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1},Te.regexp_eatModifiers=function(n){for(var p="",T=0;(T=n.current())!==-1&&Vt(T);)p+=it(T),n.advance();return p};function Vt(n){return n===105||n===109||n===115}Te.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)},Te.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1},Te.regexp_eatSyntaxCharacter=function(n){var p=n.current();return Wt(p)?(n.lastIntValue=p,n.advance(),!0):!1};function Wt(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}Te.regexp_eatPatternCharacters=function(n){for(var p=n.pos,T=0;(T=n.current())!==-1&&!Wt(T);)n.advance();return n.pos!==p},Te.regexp_eatExtendedPatternCharacter=function(n){var p=n.current();return p!==-1&&p!==36&&!(p>=40&&p<=43)&&p!==46&&p!==63&&p!==91&&p!==94&&p!==124?(n.advance(),!0):!1},Te.regexp_groupSpecifier=function(n){if(n.eat(63)){this.regexp_eatGroupName(n)||n.raise("Invalid group");var p=this.options.ecmaVersion>=16,T=n.groupNames[n.lastStringValue];if(T)if(p)for(var B=0,Z=T;B<Z.length;B+=1){var he=Z[B];he.separatedFrom(n.branchID)||n.raise("Duplicate capture group name")}else n.raise("Duplicate capture group name");p?(T||(n.groupNames[n.lastStringValue]=[])).push(n.branchID):n.groupNames[n.lastStringValue]=!0}},Te.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1},Te.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=it(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=it(n.lastIntValue);return!0}return!1},Te.regexp_eatRegExpIdentifierStart=function(n){var p=n.pos,T=this.options.ecmaVersion>=11,B=n.current(T);return n.advance(T),B===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,T)&&(B=n.lastIntValue),Ft(B)?(n.lastIntValue=B,!0):(n.pos=p,!1)};function Ft(n){return J(n,!0)||n===36||n===95}Te.regexp_eatRegExpIdentifierPart=function(n){var p=n.pos,T=this.options.ecmaVersion>=11,B=n.current(T);return n.advance(T),B===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,T)&&(B=n.lastIntValue),Bt(B)?(n.lastIntValue=B,!0):(n.pos=p,!1)};function Bt(n){return j(n,!0)||n===36||n===95||n===8204||n===8205}Te.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)},Te.regexp_eatBackReference=function(n){var p=n.pos;if(this.regexp_eatDecimalEscape(n)){var T=n.lastIntValue;if(n.switchU)return T>n.maxBackReference&&(n.maxBackReference=T),!0;if(T<=n.numCapturingParens)return!0;n.pos=p}return!1},Te.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1},Te.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)},Te.regexp_eatCControlLetter=function(n){var p=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=p}return!1},Te.regexp_eatZero=function(n){return n.current()===48&&!li(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1},Te.regexp_eatControlEscape=function(n){var p=n.current();return p===116?(n.lastIntValue=9,n.advance(),!0):p===110?(n.lastIntValue=10,n.advance(),!0):p===118?(n.lastIntValue=11,n.advance(),!0):p===102?(n.lastIntValue=12,n.advance(),!0):p===114?(n.lastIntValue=13,n.advance(),!0):!1},Te.regexp_eatControlLetter=function(n){var p=n.current();return kt(p)?(n.lastIntValue=p%32,n.advance(),!0):!1};function kt(n){return n>=65&&n<=90||n>=97&&n<=122}Te.regexp_eatRegExpUnicodeEscapeSequence=function(n,p){p===void 0&&(p=!1);var T=n.pos,B=p||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var Z=n.lastIntValue;if(B&&Z>=55296&&Z<=56319){var he=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var me=n.lastIntValue;if(me>=56320&&me<=57343)return n.lastIntValue=(Z-55296)*1024+(me-56320)+65536,!0}n.pos=he,n.lastIntValue=Z}return!0}if(B&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&Nt(n.lastIntValue))return!0;B&&n.raise("Invalid unicode escape"),n.pos=T}return!1};function Nt(n){return n>=0&&n<=1114111}Te.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var p=n.current();return p!==99&&(!n.switchN||p!==107)?(n.lastIntValue=p,n.advance(),!0):!1},Te.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var p=n.current();if(p>=49&&p<=57){do n.lastIntValue=10*n.lastIntValue+(p-48),n.advance();while((p=n.current())>=48&&p<=57);return!0}return!1};var Zt=0,bt=1,Et=2;Te.regexp_eatCharacterClassEscape=function(n){var p=n.current();if(Ln(p))return n.lastIntValue=-1,n.advance(),bt;var T=!1;if(n.switchU&&this.options.ecmaVersion>=9&&((T=p===80)||p===112)){n.lastIntValue=-1,n.advance();var B;if(n.eat(123)&&(B=this.regexp_eatUnicodePropertyValueExpression(n))&&n.eat(125))return T&&B===Et&&n.raise("Invalid property name"),B;n.raise("Invalid property name")}return Zt};function Ln(n){return n===100||n===68||n===115||n===83||n===119||n===87}Te.regexp_eatUnicodePropertyValueExpression=function(n){var p=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var T=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var B=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,T,B),bt}}if(n.pos=p,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var Z=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,Z)}return Zt},Te.regexp_validateUnicodePropertyNameAndValue=function(n,p,T){pe(n.unicodeProperties.nonBinary,p)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[p].test(T)||n.raise("Invalid property value")},Te.regexp_validateUnicodePropertyNameOrValue=function(n,p){if(n.unicodeProperties.binary.test(p))return bt;if(n.switchV&&n.unicodeProperties.binaryOfStrings.test(p))return Et;n.raise("Invalid property name")},Te.regexp_eatUnicodePropertyName=function(n){var p=0;for(n.lastStringValue="";tn(p=n.current());)n.lastStringValue+=it(p),n.advance();return n.lastStringValue!==""};function tn(n){return kt(n)||n===95}Te.regexp_eatUnicodePropertyValue=function(n){var p=0;for(n.lastStringValue="";Nn(p=n.current());)n.lastStringValue+=it(p),n.advance();return n.lastStringValue!==""};function Nn(n){return tn(n)||li(n)}Te.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)},Te.regexp_eatCharacterClass=function(n){if(n.eat(91)){var p=n.eat(94),T=this.regexp_classContents(n);return n.eat(93)||n.raise("Unterminated character class"),p&&T===Et&&n.raise("Negated character class may contain strings"),!0}return!1},Te.regexp_classContents=function(n){return n.current()===93?bt:n.switchV?this.regexp_classSetExpression(n):(this.regexp_nonEmptyClassRanges(n),bt)},Te.regexp_nonEmptyClassRanges=function(n){for(;this.regexp_eatClassAtom(n);){var p=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var T=n.lastIntValue;n.switchU&&(p===-1||T===-1)&&n.raise("Invalid character class"),p!==-1&&T!==-1&&p>T&&n.raise("Range out of order in character class")}}},Te.regexp_eatClassAtom=function(n){var p=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var T=n.current();(T===99||Jt(T))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=p}var B=n.current();return B!==93?(n.lastIntValue=B,n.advance(),!0):!1},Te.regexp_eatClassEscape=function(n){var p=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=p}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)},Te.regexp_classSetExpression=function(n){var p=bt,T;if(!this.regexp_eatClassSetRange(n))if(T=this.regexp_eatClassSetOperand(n)){T===Et&&(p=Et);for(var B=n.pos;n.eatChars([38,38]);){if(n.current()!==38&&(T=this.regexp_eatClassSetOperand(n))){T!==Et&&(p=bt);continue}n.raise("Invalid character in character class")}if(B!==n.pos)return p;for(;n.eatChars([45,45]);)this.regexp_eatClassSetOperand(n)||n.raise("Invalid character in character class");if(B!==n.pos)return p}else n.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(n)){if(T=this.regexp_eatClassSetOperand(n),!T)return p;T===Et&&(p=Et)}},Te.regexp_eatClassSetRange=function(n){var p=n.pos;if(this.regexp_eatClassSetCharacter(n)){var T=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassSetCharacter(n)){var B=n.lastIntValue;return T!==-1&&B!==-1&&T>B&&n.raise("Range out of order in character class"),!0}n.pos=p}return!1},Te.regexp_eatClassSetOperand=function(n){return this.regexp_eatClassSetCharacter(n)?bt:this.regexp_eatClassStringDisjunction(n)||this.regexp_eatNestedClass(n)},Te.regexp_eatNestedClass=function(n){var p=n.pos;if(n.eat(91)){var T=n.eat(94),B=this.regexp_classContents(n);if(n.eat(93))return T&&B===Et&&n.raise("Negated character class may contain strings"),B;n.pos=p}if(n.eat(92)){var Z=this.regexp_eatCharacterClassEscape(n);if(Z)return Z;n.pos=p}return null},Te.regexp_eatClassStringDisjunction=function(n){var p=n.pos;if(n.eatChars([92,113])){if(n.eat(123)){var T=this.regexp_classStringDisjunctionContents(n);if(n.eat(125))return T}else n.raise("Invalid escape");n.pos=p}return null},Te.regexp_classStringDisjunctionContents=function(n){for(var p=this.regexp_classString(n);n.eat(124);)this.regexp_classString(n)===Et&&(p=Et);return p},Te.regexp_classString=function(n){for(var p=0;this.regexp_eatClassSetCharacter(n);)p++;return p===1?bt:Et},Te.regexp_eatClassSetCharacter=function(n){var p=n.pos;if(n.eat(92))return this.regexp_eatCharacterEscape(n)||this.regexp_eatClassSetReservedPunctuator(n)?!0:n.eat(98)?(n.lastIntValue=8,!0):(n.pos=p,!1);var T=n.current();return T<0||T===n.lookahead()&&On(T)||Rn(T)?!1:(n.advance(),n.lastIntValue=T,!0)};function On(n){return n===33||n>=35&&n<=38||n>=42&&n<=44||n===46||n>=58&&n<=64||n===94||n===96||n===126}function Rn(n){return n===40||n===41||n===45||n===47||n>=91&&n<=93||n>=123&&n<=125}Te.regexp_eatClassSetReservedPunctuator=function(n){var p=n.current();return Fi(p)?(n.lastIntValue=p,n.advance(),!0):!1};function Fi(n){return n===33||n===35||n===37||n===38||n===44||n===45||n>=58&&n<=62||n===64||n===96||n===126}Te.regexp_eatClassControlLetter=function(n){var p=n.current();return li(p)||p===95?(n.lastIntValue=p%32,n.advance(),!0):!1},Te.regexp_eatHexEscapeSequence=function(n){var p=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=p}return!1},Te.regexp_eatDecimalDigits=function(n){var p=n.pos,T=0;for(n.lastIntValue=0;li(T=n.current());)n.lastIntValue=10*n.lastIntValue+(T-48),n.advance();return n.pos!==p};function li(n){return n>=48&&n<=57}Te.regexp_eatHexDigits=function(n){var p=n.pos,T=0;for(n.lastIntValue=0;Ci(T=n.current());)n.lastIntValue=16*n.lastIntValue+Si(T),n.advance();return n.pos!==p};function Ci(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function Si(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}Te.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var p=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var T=n.lastIntValue;p<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=p*64+T*8+n.lastIntValue:n.lastIntValue=p*8+T}else n.lastIntValue=p;return!0}return!1},Te.regexp_eatOctalDigit=function(n){var p=n.current();return Jt(p)?(n.lastIntValue=p-48,n.advance(),!0):(n.lastIntValue=0,!1)};function Jt(n){return n>=48&&n<=55}Te.regexp_eatFixedHexDigits=function(n,p){var T=n.pos;n.lastIntValue=0;for(var B=0;B<p;++B){var Z=n.current();if(!Ci(Z))return n.pos=T,!1;n.lastIntValue=16*n.lastIntValue+Si(Z),n.advance()}return!0};var Ht=function(p){this.type=p.type,this.value=p.value,this.start=p.start,this.end=p.end,p.options.locations&&(this.loc=new Dt(p,p.startLoc,p.endLoc)),p.options.ranges&&(this.range=[p.start,p.end])},Ke=i.prototype;Ke.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ht(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ke.getToken=function(){return this.next(),new Ht(this)},typeof Symbol<"u"&&(Ke[Symbol.iterator]=function(){var n=this;return{next:function(){var p=n.getToken();return{done:p.type===I.eof,value:p}}}}),Ke.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(I.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())},Ke.readToken=function(n){return J(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)},Ke.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var p=this.input.charCodeAt(this.pos+1);return p<=56319||p>=57344?n:(n<<10)+p-56613888},Ke.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),p=this.pos,T=this.input.indexOf("*/",this.pos+=2);if(T===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=T+2,this.options.locations)for(var B=void 0,Z=p;(B=Pe(this.input,Z,this.pos))>-1;)++this.curLine,Z=this.lineStart=B;this.options.onComment&&this.options.onComment(!0,this.input.slice(p+2,T),p,this.pos,n,this.curPosition())},Ke.skipLineComment=function(n){for(var p=this.pos,T=this.options.onComment&&this.curPosition(),B=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!de(B);)B=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(p+n,this.pos),p,this.pos,T,this.curPosition())},Ke.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&be.test(String.fromCharCode(n)))++this.pos;else break e}}},Ke.finishToken=function(n,p){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var T=this.type;this.type=n,this.value=p,this.updateContext(T)},Ke.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var p=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&p===46?(this.pos+=3,this.finishToken(I.ellipsis)):(++this.pos,this.finishToken(I.dot))},Ke.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(I.assign,2):this.finishOp(I.slash,1)},Ke.readToken_mult_modulo_exp=function(n){var p=this.input.charCodeAt(this.pos+1),T=1,B=n===42?I.star:I.modulo;return this.options.ecmaVersion>=7&&n===42&&p===42&&(++T,B=I.starstar,p=this.input.charCodeAt(this.pos+2)),p===61?this.finishOp(I.assign,T+1):this.finishOp(B,T)},Ke.readToken_pipe_amp=function(n){var p=this.input.charCodeAt(this.pos+1);if(p===n){if(this.options.ecmaVersion>=12){var T=this.input.charCodeAt(this.pos+2);if(T===61)return this.finishOp(I.assign,3)}return this.finishOp(n===124?I.logicalOR:I.logicalAND,2)}return p===61?this.finishOp(I.assign,2):this.finishOp(n===124?I.bitwiseOR:I.bitwiseAND,1)},Ke.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(I.assign,2):this.finishOp(I.bitwiseXOR,1)},Ke.readToken_plus_min=function(n){var p=this.input.charCodeAt(this.pos+1);return p===n?p===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||le.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(I.incDec,2):p===61?this.finishOp(I.assign,2):this.finishOp(I.plusMin,1)},Ke.readToken_lt_gt=function(n){var p=this.input.charCodeAt(this.pos+1),T=1;return p===n?(T=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+T)===61?this.finishOp(I.assign,T+1):this.finishOp(I.bitShift,T)):p===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(p===61&&(T=2),this.finishOp(I.relational,T))},Ke.readToken_eq_excl=function(n){var p=this.input.charCodeAt(this.pos+1);return p===61?this.finishOp(I.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&p===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(I.arrow)):this.finishOp(n===61?I.eq:I.prefix,1)},Ke.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var p=this.input.charCodeAt(this.pos+1);if(p===46){var T=this.input.charCodeAt(this.pos+2);if(T<48||T>57)return this.finishOp(I.questionDot,2)}if(p===63){if(n>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(I.assign,3)}return this.finishOp(I.coalesce,2)}}return this.finishOp(I.question,1)},Ke.readToken_numberSign=function(){var n=this.options.ecmaVersion,p=35;if(n>=13&&(++this.pos,p=this.fullCharCodeAtPos(),J(p,!0)||p===92))return this.finishToken(I.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+it(p)+"'")},Ke.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(I.parenL);case 41:return++this.pos,this.finishToken(I.parenR);case 59:return++this.pos,this.finishToken(I.semi);case 44:return++this.pos,this.finishToken(I.comma);case 91:return++this.pos,this.finishToken(I.bracketL);case 93:return++this.pos,this.finishToken(I.bracketR);case 123:return++this.pos,this.finishToken(I.braceL);case 125:return++this.pos,this.finishToken(I.braceR);case 58:return++this.pos,this.finishToken(I.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(I.backQuote);case 48:var p=this.input.charCodeAt(this.pos+1);if(p===120||p===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(p===111||p===79)return this.readRadixNumber(8);if(p===98||p===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(I.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+it(n)+"'")},Ke.finishOp=function(n,p){var T=this.input.slice(this.pos,this.pos+p);return this.pos+=p,this.finishToken(n,T)},Ke.readRegexp=function(){for(var n,p,T=this.pos;;){this.pos>=this.input.length&&this.raise(T,"Unterminated regular expression");var B=this.input.charAt(this.pos);if(le.test(B)&&this.raise(T,"Unterminated regular expression"),n)n=!1;else{if(B==="[")p=!0;else if(B==="]"&&p)p=!1;else if(B==="/"&&!p)break;n=B==="\\"}++this.pos}var Z=this.input.slice(T,this.pos);++this.pos;var he=this.pos,me=this.readWord1();this.containsEsc&&this.unexpected(he);var Ee=this.regexpState||(this.regexpState=new ct(this));Ee.reset(T,Z,me),this.validateRegExpFlags(Ee),this.validateRegExpPattern(Ee);var Ne=null;try{Ne=new RegExp(Z,me)}catch{}return this.finishToken(I.regexp,{pattern:Z,flags:me,value:Ne})},Ke.readInt=function(n,p,T){for(var B=this.options.ecmaVersion>=12&&p===void 0,Z=T&&this.input.charCodeAt(this.pos)===48,he=this.pos,me=0,Ee=0,Ne=0,We=p??1/0;Ne<We;++Ne,++this.pos){var Je=this.input.charCodeAt(this.pos),ot=void 0;if(B&&Je===95){Z&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ee===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ne===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ee=Je;continue}if(Je>=97?ot=Je-97+10:Je>=65?ot=Je-65+10:Je>=48&&Je<=57?ot=Je-48:ot=1/0,ot>=n)break;Ee=Je,me=me*n+ot}return B&&Ee===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===he||p!=null&&this.pos-he!==p?null:me};function Ut(n,p){return p?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function Gt(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}Ke.readRadixNumber=function(n){var p=this.pos;this.pos+=2;var T=this.readInt(n);return T==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(T=Gt(this.input.slice(p,this.pos)),++this.pos):J(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(I.num,T)},Ke.readNumber=function(n){var p=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(p,"Invalid number");var T=this.pos-p>=2&&this.input.charCodeAt(p)===48;T&&this.strict&&this.raise(p,"Invalid number");var B=this.input.charCodeAt(this.pos);if(!T&&!n&&this.options.ecmaVersion>=11&&B===110){var Z=Gt(this.input.slice(p,this.pos));return++this.pos,J(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(I.num,Z)}T&&/[89]/.test(this.input.slice(p,this.pos))&&(T=!1),B===46&&!T&&(++this.pos,this.readInt(10),B=this.input.charCodeAt(this.pos)),(B===69||B===101)&&!T&&(B=this.input.charCodeAt(++this.pos),(B===43||B===45)&&++this.pos,this.readInt(10)===null&&this.raise(p,"Invalid number")),J(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var he=Ut(this.input.slice(p,this.pos),T);return this.finishToken(I.num,he)},Ke.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),p;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var T=++this.pos;p=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,p>1114111&&this.invalidStringToken(T,"Code point out of bounds")}else p=this.readHexChar(4);return p},Ke.readString=function(n){for(var p="",T=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var B=this.input.charCodeAt(this.pos);if(B===n)break;B===92?(p+=this.input.slice(T,this.pos),p+=this.readEscapedChar(!1),T=this.pos):B===8232||B===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(de(B)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return p+=this.input.slice(T,this.pos++),this.finishToken(I.string,p)};var qt={};Ke.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===qt)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1},Ke.invalidStringToken=function(n,p){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw qt;this.raise(n,p)},Ke.readTmplToken=function(){for(var n="",p=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var T=this.input.charCodeAt(this.pos);if(T===96||T===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===I.template||this.type===I.invalidTemplate)?T===36?(this.pos+=2,this.finishToken(I.dollarBraceL)):(++this.pos,this.finishToken(I.backQuote)):(n+=this.input.slice(p,this.pos),this.finishToken(I.template,n));if(T===92)n+=this.input.slice(p,this.pos),n+=this.readEscapedChar(!0),p=this.pos;else if(de(T)){switch(n+=this.input.slice(p,this.pos),++this.pos,T){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(T);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),p=this.pos}else++this.pos}},Ke.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(I.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")},Ke.readEscapedChar=function(n){var p=this.input.charCodeAt(++this.pos);switch(++this.pos,p){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return it(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var T=this.pos-1;this.invalidStringToken(T,"Invalid escape sequence in template string")}default:if(p>=48&&p<=55){var B=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],Z=parseInt(B,8);return Z>255&&(B=B.slice(0,-1),Z=parseInt(B,8)),this.pos+=B.length-1,p=this.input.charCodeAt(this.pos),(B!=="0"||p===56||p===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-B.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(Z)}return de(p)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(p)}},Ke.readHexChar=function(n){var p=this.pos,T=this.readInt(16,n);return T===null&&this.invalidStringToken(p,"Bad character escape sequence"),T},Ke.readWord1=function(){this.containsEsc=!1;for(var n="",p=!0,T=this.pos,B=this.options.ecmaVersion>=6;this.pos<this.input.length;){var Z=this.fullCharCodeAtPos();if(j(Z,B))this.pos+=Z<=65535?1:2;else if(Z===92){this.containsEsc=!0,n+=this.input.slice(T,this.pos);var he=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var me=this.readCodePoint();(p?J:j)(me,B)||this.invalidStringToken(he,"Invalid Unicode escape"),n+=it(me),T=this.pos}else break;p=!1}return n+this.input.slice(T,this.pos)},Ke.readWord=function(){var n=this.readWord1(),p=I.name;return this.keywords.test(n)&&(p=fe[n]),this.finishToken(p,n)};var ei="8.15.0";i.acorn={Parser:i,version:ei,defaultOptions:dt,Position:It,SourceLocation:Dt,getLineInfo:Yi,Node:X,TokenType:re,tokTypes:I,keywordTypes:fe,TokContext:F,tokContexts:A,isIdentifierChar:j,isIdentifierStart:J,Token:Ht,isNewLine:de,lineBreak:le,lineBreakG:_e,nonASCIIwhitespace:be};function nn(n,p){return i.parse(n,p)}function rn(n,p,T){return i.parseExpressionAt(n,p,T)}function sn(n,p){return i.tokenizer(n,p)}s.Node=X,s.Parser=i,s.Position=It,s.SourceLocation=Dt,s.TokContext=F,s.Token=Ht,s.TokenType=re,s.defaultOptions=dt,s.getLineInfo=Yi,s.isIdentifierChar=j,s.isIdentifierStart=J,s.isNewLine=de,s.keywordTypes=fe,s.lineBreak=le,s.lineBreakG=_e,s.nonASCIIwhitespace=be,s.parse=nn,s.parseExpressionAt=rn,s.tokContexts=A,s.tokTypes=I,s.tokenizer=sn,s.version=ei}))})(vn,vn.exports)),vn.exports}/*!
 * Paper.js v0.12.18 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jrg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Wed Jul 17 14:57:24 2024 +0200
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jrg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */var kl=Jn.exports,Qs;function El(){return Qs||(Qs=1,(function(u){(function(a,s){a=a||Xs;var h=a.window,c=a.document,o=new function(){var e=/^(statics|enumerable|beans|preserve)$/,i=[],r=i.slice,l=Object.create,f=Object.getOwnPropertyDescriptor,g=Object.defineProperty,m=i.forEach||function(E,k){for(var U=0,N=this.length;U<N;U++)E.call(k,this[U],U,this)},v=function(E,k){for(var U in this)this.hasOwnProperty(U)&&E.call(k,this[U],U,this)},y=Object.assign||function(E){for(var k=1,U=arguments.length;k<U;k++){var N=arguments[k];for(var F in N)N.hasOwnProperty(F)&&(E[F]=N[F])}return E},x=function(E,k,U){if(E){var N=f(E,"length");(N&&typeof N.value=="number"?m:v).call(E,k,U=U||E)}return U};function M(E,k,U,N,F){var A={};function R(V,G){G=G||(G=f(k,V))&&(G.get?G:G.value),typeof G=="string"&&G[0]==="#"&&(G=E[G.substring(1)]||G);var $=typeof G=="function",X=G,te=F||$&&!G.base?G&&G.get?V in E:E[V]:null,W;(!F||!te)&&($&&te&&(G.base=te),$&&N!==!1&&(W=V.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(A[W[3].toLowerCase()+W[4]]=W[2]),(!X||$||!X.get||typeof X.get!="function"||!L.isPlainObject(X))&&(X={value:X,writable:!0}),(f(E,V)||{configurable:!0}).configurable&&(X.configurable=!0,X.enumerable=U??!W),g(E,V,X))}if(k){for(var w in k)k.hasOwnProperty(w)&&!e.test(w)&&R(w);for(var w in A){var O=A[w],q=E["set"+O],H=E["get"+O]||q&&E["is"+O];H&&(N===!0||H.length===0)&&R(w,{get:H,set:q})}}return E}function L(){for(var E=0,k=arguments.length;E<k;E++){var U=arguments[E];U&&y(this,U)}return this}return M(L,{inject:function(E){if(E){var k=E.statics===!0?E:E.statics,U=E.beans,N=E.preserve;k!==E&&M(this.prototype,E,E.enumerable,U,N),M(this,k,null,U,N)}for(var F=1,A=arguments.length;F<A;F++)this.inject(arguments[F]);return this},extend:function(){for(var E=this,k,U,N=0,F,A=arguments.length;N<A&&!(k&&U);N++)F=arguments[N],k=k||F.initialize,U=U||F.prototype;return k=k||function(){E.apply(this,arguments)},U=k.prototype=U||l(this.prototype),g(U,"constructor",{value:k,writable:!0,configurable:!0}),M(k,this),arguments.length&&this.inject.apply(k,arguments),k.base=E,k}}).inject({enumerable:!1,initialize:L,set:L,inject:function(){for(var E=0,k=arguments.length;E<k;E++){var U=arguments[E];U&&M(this,U,U.enumerable,U.beans,U.preserve)}return this},extend:function(){var E=l(this);return E.inject.apply(E,arguments)},each:function(E,k){return x(this,E,k)},clone:function(){return new this.constructor(this)},statics:{set:y,each:x,create:l,define:g,describe:f,clone:function(E){return y(new E.constructor,E)},isPlainObject:function(E){var k=E!=null&&E.constructor;return k&&(k===Object||k===L||k.name==="Object")},pick:function(E,k){return E!==s?E:k},slice:function(E,k,U){return r.call(E,k,U)}}})};u.exports=o,o.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+o.each(this,function(e,i){if(!/^_/.test(i)){var r=typeof e;this.push(i+": "+(r==="number"?S.instance.number(e):r==="string"?"'"+e+"'":e))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(e){return o.importJSON(e,this)},exportJSON:function(e){return o.exportJSON(this,e)},toJSON:function(){return o.serialize(this)},set:function(e,i){return e&&o.filter(this,e,i,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function e(){var i=e.base.apply(this,arguments),r=i.prototype._class;return r&&!o.exports[r]&&(o.exports[r]=i),i},equals:function(e,i){if(e===i)return!0;if(e&&e.equals)return e.equals(i);if(i&&i.equals)return i.equals(e);if(e&&i&&typeof e=="object"&&typeof i=="object"){if(Array.isArray(e)&&Array.isArray(i)){var r=e.length;if(r!==i.length)return!1;for(;r--;)if(!o.equals(e[r],i[r]))return!1}else{var l=Object.keys(e),r=l.length;if(r!==Object.keys(i).length)return!1;for(;r--;){var f=l[r];if(!(i.hasOwnProperty(f)&&o.equals(e[f],i[f])))return!1}}return!0}return!1},read:function(e,i,r,l){if(this===o){var f=this.peek(e,i);return e.__index++,f}var g=this.prototype,m=g._readIndex,v=i||m&&e.__index||0,y=e.length,x=e[v];if(l=l||y-v,x instanceof this||r&&r.readNull&&x==null&&l<=1)return m&&(e.__index=v+1),x&&r&&r.clone?x.clone():x;if(x=o.create(g),m&&(x.__read=!0),x=x.initialize.apply(x,v>0||v+l<y?o.slice(e,v,v+l):e)||x,m){e.__index=v+x.__read;var M=x.__filtered;M&&(e.__filtered=M,x.__filtered=s),x.__read=s}return x},peek:function(e,i){return e[e.__index=i||e.__index||0]},remain:function(e){return e.length-(e.__index||0)},readList:function(e,i,r,l){for(var f=[],g,m=i||0,v=l?m+l:e.length,y=m;y<v;y++)f.push(Array.isArray(g=e[y])?this.read(g,0,r):this.read(e,y,r,1));return f},readNamed:function(e,i,r,l,f){var g=this.getNamed(e,i),m=g!==s;if(m){var v=e.__filtered;if(!v){var y=this.getSource(e);v=e.__filtered=o.create(y),v.__unfiltered=y}v[i]=s}return this.read(m?[g]:e,r,l,f)},readSupported:function(e,i){var r=this.getSource(e),l=this,f=!1;return r&&Object.keys(r).forEach(function(g){if(g in i){var m=l.readNamed(e,g);m!==s&&(i[g]=m),f=!0}}),f},getSource:function(e){var i=e.__source;if(i===s){var r=e.length===1&&e[0];i=e.__source=r&&o.isPlainObject(r)?r:null}return i},getNamed:function(e,i){var r=this.getSource(e);if(r)return i?r[i]:e.__filtered||r},hasNamed:function(e,i){return!!this.getNamed(e,i)},filter:function(e,i,r,l){var f;function g(M){if(!(r&&M in r)&&!(f&&M in f)){var L=i[M];L!==s&&(e[M]=L)}}if(l){for(var m={},v=0,y,x=l.length;v<x;v++)(y=l[v])in i&&(g(y),m[y]=!0);f=m}return Object.keys(i.__unfiltered||i).forEach(g),e},isPlainValue:function(e,i){return o.isPlainObject(e)||Array.isArray(e)||i&&typeof e=="string"},serialize:function(e,i,r,l){i=i||{};var f=!l,g;if(f&&(i.formatter=new S(i.precision),l={length:0,definitions:{},references:{},add:function(L,E){var k="#"+L._id,U=this.references[k];if(!U){this.length++;var N=E.call(L),F=L._class;F&&N[0]!==F&&N.unshift(F),this.definitions[k]=N,U=this.references[k]=[k]}return U}}),e&&e._serialize){g=e._serialize(i,l);var m=e._class;m&&!e._compactSerialize&&(f||!r)&&g[0]!==m&&g.unshift(m)}else if(Array.isArray(e)){g=[];for(var v=0,y=e.length;v<y;v++)g[v]=o.serialize(e[v],i,r,l)}else if(o.isPlainObject(e)){g={};for(var x=Object.keys(e),v=0,y=x.length;v<y;v++){var M=x[v];g[M]=o.serialize(e[M],i,r,l)}}else typeof e=="number"?g=i.formatter.number(e,i.precision):g=e;return f&&l.length>0?[["dictionary",l.definitions],g]:g},deserialize:function(e,i,r,l,f){var g=e,m=!r,v=m&&e&&e.length&&e[0][0]==="dictionary";if(r=r||{},Array.isArray(e)){var y=e[0],x=y==="dictionary";if(e.length==1&&/^#/.test(y))return r.dictionary[y];y=o.exports[y],g=[];for(var M=y?1:0,L=e.length;M<L;M++)g.push(o.deserialize(e[M],i,r,x,v));if(y){var E=g;i?g=i(y,E,m||f):g=new y(E)}}else if(o.isPlainObject(e)){g={},l&&(r.dictionary=g);for(var k in e)g[k]=o.deserialize(e[k],i,r)}return v?g[1]:g},exportJSON:function(e,i){var r=o.serialize(e,i);return i&&i.asString==!1?r:JSON.stringify(r)},importJSON:function(e,i){return o.deserialize(typeof e=="string"?JSON.parse(e):e,function(r,l,f){var g=f&&i&&i.constructor===r,m=g?i:o.create(r.prototype);if(l.length===1&&m instanceof I&&(g||!(m instanceof _e))){var v=l[0];o.isPlainObject(v)&&(v.insert=!1,g&&(l=l.concat([I.INSERT])))}return(g?m.set:r).apply(m,l),g&&(i=null),m})},push:function(e,i){var r=i.length;if(r<4096)e.push.apply(e,i);else{var l=e.length;e.length+=r;for(var f=0;f<r;f++)e[l+f]=i[f]}return e},splice:function(e,i,r,l){var f=i&&i.length,g=r===s;r=g?e.length:r,r>e.length&&(r=e.length);for(var m=0;m<f;m++)i[m]._index=r+m;if(g)return o.push(e,i),[];var v=[r,l];i&&o.push(v,i);for(var y=e.splice.apply(e,v),m=0,x=y.length;m<x;m++)y[m]._index=s;for(var m=r+f,x=e.length;m<x;m++)e[m]._index=m;return y},capitalize:function(e){return e.replace(/\b[a-z]/g,function(i){return i.toUpperCase()})},camelize:function(e){return e.replace(/-(.)/g,function(i,r){return r.toUpperCase()})},hyphenate:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var d={on:function(e,i){if(typeof e!="string")o.each(e,function(g,m){this.on(m,g)},this);else{var r=this._eventTypes,l=r&&r[e],f=this._callbacks=this._callbacks||{};f=f[e]=f[e]||[],f.indexOf(i)===-1&&(f.push(i),l&&l.install&&f.length===1&&l.install.call(this,e))}return this},off:function(e,i){if(typeof e!="string"){o.each(e,function(m,v){this.off(v,m)},this);return}var r=this._eventTypes,l=r&&r[e],f=this._callbacks&&this._callbacks[e],g;return f&&(!i||(g=f.indexOf(i))!==-1&&f.length===1?(l&&l.uninstall&&l.uninstall.call(this,e),delete this._callbacks[e]):g!==-1&&f.splice(g,1)),this},once:function(e,i){return this.on(e,function r(){i.apply(this,arguments),this.off(e,r)})},emit:function(e,i){var r=this._callbacks&&this._callbacks[e];if(!r)return!1;var l=o.slice(arguments,1),f=i&&i.target&&!i.currentTarget;r=r.slice(),f&&(i.currentTarget=this);for(var g=0,m=r.length;g<m;g++)if(r[g].apply(this,l)==!1){i&&i.stop&&i.stop();break}return f&&delete i.currentTarget,!0},responds:function(e){return!!(this._callbacks&&this._callbacks[e])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(e){var i=this._eventTypes,r=this._callbacks,l=e?"install":"uninstall";if(i){for(var f in r)if(r[f].length>0){var g=i[f],m=g&&g[l];m&&m.call(this,f)}}},statics:{inject:function e(i){var r=i._events;if(r){var l={};o.each(r,function(f,g){var m=typeof f=="string",v=m?f:g,y=o.capitalize(v),x=v.substring(2).toLowerCase();l[x]=m?{}:f,v="_"+v,i["get"+y]=function(){return this[v]},i["set"+y]=function(M){var L=this[v];L&&this.off(x,L),M&&this.on(x,M),this[v]=M}}),i._eventTypes=l}return e.base.apply(this,arguments)}}},_=o.extend({_class:"PaperScope",initialize:function e(){Qe=this,this.settings=new o({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=e._id++,e._scopes[this._id]=this;var i=e.prototype;if(!this.support){var r=pt.getContext(1,1)||{};i.support={nativeDash:"setLineDash"in r||"mozDash"in r,nativeBlendModes:wi.nativeModes},pt.release(r)}if(!this.agent){var l=a.navigator.userAgent.toLowerCase(),f=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(l)||[])[0],g=f==="darwin"?"mac":f,m=i.agent=i.browser={platform:g};g&&(m[g]=!0),l.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(v,y,x,M,L){if(!m.chrome){var E=y==="opera"?M:/^(node|trident)$/.test(y)?L:x;m.version=E,m.versionNumber=parseFloat(E),y={trident:"msie",jsdom:"node"}[y]||y,m.name=y,m[y]=!0}}),m.chrome&&delete m.webkit,m.atom&&delete m.chrome}},version:"0.12.18",getView:function(){var e=this.project;return e&&e._view},getPaper:function(){return this},execute:function(e,i){var r=Qe.PaperScript.execute(e,this,i);return lt.updateFocus(),r},install:function(e){var i=this;o.each(["project","view","tool"],function(l){o.define(e,l,{configurable:!0,get:function(){return i[l]}})});for(var r in this)!/^_/.test(r)&&this[r]&&(e[r]=this[r])},setup:function(e){return Qe=this,this.project=new ae(e),this},createCanvas:function(e,i){return pt.getCanvas(e,i)},activate:function(){Qe=this},clear:function(){for(var e=this.projects,i=this.tools,r=e.length-1;r>=0;r--)e[r].remove();for(var r=i.length-1;r>=0;r--)i[r].remove()},remove:function(){this.clear(),delete _._scopes[this._id]},statics:new function(){function e(i){return i+="Attribute",function(r,l){return r[i](l)||r[i]("data-paper-"+l)}}return{_scopes:{},_id:0,get:function(i){return this._scopes[i]||null},getAttribute:e("get"),hasAttribute:e("has")}}}),b=o.extend(d,{initialize:function(e){this._scope=Qe,this._index=this._scope[this._list].push(this)-1,(e||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var e=this._scope[this._reference];return e&&e!==this&&e.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",e),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(o.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),C={findItemBoundsCollisions:function(e,i,r){function l(m){for(var v=new Array(m.length),y=0;y<m.length;y++){var x=m[y].getBounds();v[y]=[x.left,x.top,x.right,x.bottom]}return v}var f=l(e),g=!i||i===e?f:l(i);return this.findBoundsCollisions(f,g,r||0)},findCurveBoundsCollisions:function(e,i,r,l){function f(E){for(var k=Math.min,U=Math.max,N=new Array(E.length),F=0;F<E.length;F++){var A=E[F];N[F]=[k(A[0],A[2],A[4],A[6]),k(A[1],A[3],A[5],A[7]),U(A[0],A[2],A[4],A[6]),U(A[1],A[3],A[5],A[7])]}return N}var g=f(e),m=!i||i===e?g:f(i);if(l){for(var v=this.findBoundsCollisions(g,m,r||0,!1,!0),y=this.findBoundsCollisions(g,m,r||0,!0,!0),x=[],M=0,L=v.length;M<L;M++)x[M]={hor:v[M],ver:y[M]};return x}return this.findBoundsCollisions(g,m,r||0)},findBoundsCollisions:function(e,i,r,l,f){var g=!i||e===i,m=g?e:e.concat(i),v=e.length,y=m.length;function x(Ae,ze,Oe){for(var ye=0,xe=Ae.length;ye<xe;){var Le=xe+ye>>>1;m[Ae[Le]][ze]<Oe?ye=Le+1:xe=Le}return ye-1}for(var M=l?1:0,L=M+2,E=l?0:1,k=E+2,U=new Array(y),N=0;N<y;N++)U[N]=N;U.sort(function(Ae,ze){return m[Ae][M]-m[ze][M]});for(var F=[],A=new Array(v),N=0;N<y;N++){var R=U[N],w=m[R],O=g?R:R-v,q=R<v,H=g||!q,V=q?[]:null;if(F.length){var G=x(F,L,w[M]-r)+1;if(F.splice(0,G),g&&f){V=V.concat(F);for(var $=0;$<F.length;$++){var X=F[$];A[X].push(O)}}else for(var te=w[k],W=w[E],$=0;$<F.length;$++){var X=F[$],ee=m[X],ie=X<v,se=g||X>=v;(f||(q&&se||H&&ie)&&te>=ee[E]-r&&W<=ee[k]+r)&&(q&&se&&V.push(g?X:X-v),H&&ie&&A[X].push(O))}}if(q&&(e===i&&V.push(R),A[R]=V),F.length){var oe=w[L],ge=x(F,L,oe);F.splice(ge+1,0,R)}else F.push(R)}for(var N=0;N<A.length;N++){var Ie=A[N];Ie&&Ie.sort(function(ze,Oe){return ze-Oe})}return A}},S=o.extend({initialize:function(e){this.precision=o.pick(e,5),this.multiplier=Math.pow(10,this.precision)},number:function(e){return this.precision<16?Math.round(e*this.multiplier)/this.multiplier:e},pair:function(e,i,r){return this.number(e)+(r||",")+this.number(i)},point:function(e,i){return this.number(e.x)+(i||",")+this.number(e.y)},size:function(e,i){return this.number(e.width)+(i||",")+this.number(e.height)},rectangle:function(e,i){return this.point(e,i)+(i||",")+this.size(e,i)}});S.instance=new S;var P=new function(){var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],i=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],r=Math.abs,l=Math.sqrt,f=Math.pow,g=Math.log2||function(L){return Math.log(L)*Math.LOG2E},m=1e-12,v=112e-18;function y(L,E,k){return L<E?E:L>k?k:L}function x(L,E,k){function U(G){var $=G*134217729,X=G-$,te=X+$,W=G-te;return[te,W]}var N=E*E-L*k,F=E*E+L*k;if(r(N)*3<F){var A=U(L),R=U(E),w=U(k),O=E*E,q=R[0]*R[0]-O+2*R[0]*R[1]+R[1]*R[1],H=L*k,V=A[0]*w[0]-H+A[0]*w[1]+A[1]*w[0]+A[1]*w[1];N=O-H+(q-V)}return N}function M(){var L=Math.max.apply(Math,arguments);return L&&(L<1e-8||L>1e8)?f(2,-Math.round(g(L))):0}return{EPSILON:m,MACHINE_EPSILON:v,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(l(2)-1)/3,isZero:function(L){return L>=-m&&L<=m},isMachineZero:function(L){return L>=-v&&L<=v},clamp:y,integrate:function(L,E,k,U){for(var N=e[U-2],F=i[U-2],A=(k-E)*.5,R=A+E,w=0,O=U+1>>1,q=U&1?F[w++]*L(R):0;w<O;){var H=A*N[w];q+=F[w++]*(L(R+H)+L(R-H))}return A*q},findRoot:function(L,E,k,U,N,F,A){for(var R=0;R<F;R++){var w=L(k),O=w/E(k),q=k-O;if(r(O)<A){k=q;break}w>0?(N=k,k=q<=U?(U+N)*.5:q):(U=k,k=q>=N?(U+N)*.5:q)}return y(k,U,N)},solveQuadratic:function(L,E,k,U,N,F){var A,R=1/0;if(r(L)<m){if(r(E)<m)return r(k)<m?-1:0;A=-k/E}else{E*=-.5;var w=x(L,E,k);if(w&&r(w)<v){var O=M(r(L),r(E),r(k));O&&(L*=O,E*=O,k*=O,w=x(L,E,k))}if(w>=-v){var q=w<0?0:l(w),H=E+(E<0?-q:q);H===0?(A=k/L,R=-A):(A=H/L,R=k/H)}}var V=0,G=N==null,$=N-m,X=F+m;return isFinite(A)&&(G||A>$&&A<X)&&(U[V++]=G?A:y(A,N,F)),R!==A&&isFinite(R)&&(G||R>$&&R<X)&&(U[V++]=G?R:y(R,N,F)),V},solveCubic:function(L,E,k,U,N,F,A){var R=M(r(L),r(E),r(k),r(U)),w,O,q,H,V;R&&(L*=R,E*=R,k*=R,U*=R);function G(ge){w=ge;var Ie=L*w;O=Ie+E,q=O*w+k,H=(Ie+O)*w+q,V=q*w+U}if(r(L)<m)L=E,O=k,q=U,w=1/0;else if(r(U)<m)O=E,q=k,w=0;else{G(-(E/L)/3);var $=V/L,X=f(r($),1/3),te=$<0?-1:1,W=-H/L,ee=W>0?1.324717957244746*Math.max(X,l(W)):X,ie=w-te*ee;if(ie!==w){do G(ie),ie=H===0?w:w-V/H/(1+v);while(te*ie>te*w);r(L)*w*w>r(U/w)&&(q=-U/w,O=(q-k)/w)}}var se=P.solveQuadratic(L,O,q,N,F,A),oe=F==null;return isFinite(w)&&(se===0||se>0&&w!==N[0]&&w!==N[1])&&(oe||w>F-m&&w<A+m)&&(N[se++]=oe?w:y(w,F,A)),se}}},D={_id:1,_pools:{},get:function(e){if(e){var i=this._pools[e];return i||(i=this._pools[e]={_id:1}),i._id++}else return this._id++}},z=o.extend({_class:"Point",_readIndex:!0,initialize:function(i,r){var l=typeof i,f=this.__read,g=0;if(l==="number"){var m=typeof r=="number";this._set(i,m?r:i),f&&(g=m?2:1)}else if(l==="undefined"||i===null)this._set(0,0),f&&(g=i===null?1:0);else{var v=l==="string"?i.split(/[\s,]+/)||[]:i;g=1,Array.isArray(v)?this._set(+v[0],+(v.length>1?v[1]:v[0])):"x"in v?this._set(v.x||0,v.y||0):"width"in v?this._set(v.width||0,v.height||0):"angle"in v?(this._set(v.length||0,0),this.setAngle(v.angle||0)):(this._set(0,0),g=0)}return f&&(this.__read=g),this},set:"#initialize",_set:function(e,i){return this.x=e,this.y=i,this},equals:function(e){return this===e||e&&(this.x===e.x&&this.y===e.y||Array.isArray(e)&&this.x===e[0]&&this.y===e[1])||!1},clone:function(){return new z(this.x,this.y)},toString:function(){var e=S.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.x),i.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(e){if(this.isZero()){var i=this._angle||0;this._set(Math.cos(i)*e,Math.sin(i)*e)}else{var r=e/this.getLength();P.isZero(r)&&this.getAngle(),this._set(this.x*r,this.y*r)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(e){this.setAngleInRadians.call(this,e*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var e=z.read(arguments),i=this.getLength()*e.getLength();if(P.isZero(i))return NaN;var r=this.dot(e)/i;return Math.acos(r<-1?-1:r>1?1:r)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(e){if(this._angle=e,!this.isZero()){var i=this.getLength();this._set(Math.cos(e)*i,Math.sin(e)*i)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var e=z.read(arguments);return Math.atan2(this.cross(e),this.dot(e))*180/Math.PI},getDistance:function(){var e=arguments,i=z.read(e),r=i.x-this.x,l=i.y-this.y,f=r*r+l*l,g=o.read(e);return g?f:Math.sqrt(f)},normalize:function(e){e===s&&(e=1);var i=this.getLength(),r=i!==0?e/i:0,l=new z(this.x*r,this.y*r);return r>=0&&(l._angle=this._angle),l},rotate:function(e,i){if(e===0)return this.clone();e=e*Math.PI/180;var r=i?this.subtract(i):this,l=Math.sin(e),f=Math.cos(e);return r=new z(r.x*f-r.y*l,r.x*l+r.y*f),i?r.add(i):r},transform:function(e){return e?e._transformPoint(this):this},add:function(){var e=z.read(arguments);return new z(this.x+e.x,this.y+e.y)},subtract:function(){var e=z.read(arguments);return new z(this.x-e.x,this.y-e.y)},multiply:function(){var e=z.read(arguments);return new z(this.x*e.x,this.y*e.y)},divide:function(){var e=z.read(arguments);return new z(this.x/e.x,this.y/e.y)},modulo:function(){var e=z.read(arguments);return new z(this.x%e.x,this.y%e.y)},negate:function(){return new z(-this.x,-this.y)},isInside:function(){return K.read(arguments).contains(this)},isClose:function(){var e=arguments,i=z.read(e),r=o.read(e);return this.getDistance(i)<=r},isCollinear:function(){var e=z.read(arguments);return z.isCollinear(this.x,this.y,e.x,e.y)},isColinear:"#isCollinear",isOrthogonal:function(){var e=z.read(arguments);return z.isOrthogonal(this.x,this.y,e.x,e.y)},isZero:function(){var e=P.isZero;return e(this.x)&&e(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(e){return this.x*(e>1&&e<4?-1:1)>=0&&this.y*(e>2?-1:1)>=0},dot:function(){var e=z.read(arguments);return this.x*e.x+this.y*e.y},cross:function(){var e=z.read(arguments);return this.x*e.y-this.y*e.x},project:function(){var e=z.read(arguments),i=e.isZero()?0:this.dot(e)/e.dot(e);return new z(e.x*i,e.y*i)},statics:{min:function(){var e=arguments,i=z.read(e),r=z.read(e);return new z(Math.min(i.x,r.x),Math.min(i.y,r.y))},max:function(){var e=arguments,i=z.read(e),r=z.read(e);return new z(Math.max(i.x,r.x),Math.max(i.y,r.y))},random:function(){return new z(Math.random(),Math.random())},isCollinear:function(e,i,r,l){return Math.abs(e*l-i*r)<=Math.sqrt((e*e+i*i)*(r*r+l*l))*1e-8},isOrthogonal:function(e,i,r,l){return Math.abs(e*r+i*l)<=Math.sqrt((e*e+i*i)*(r*r+l*l))*1e-8}}},o.each(["round","ceil","floor","abs"],function(e){var i=Math[e];this[e]=function(){return new z(i(this.x),i(this.y))}},{})),J=z.extend({initialize:function(i,r,l,f){this._x=i,this._y=r,this._owner=l,this._setter=f},_set:function(e,i,r){return this._x=e,this._y=i,r||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),j=o.extend({_class:"Size",_readIndex:!0,initialize:function(i,r){var l=typeof i,f=this.__read,g=0;if(l==="number"){var m=typeof r=="number";this._set(i,m?r:i),f&&(g=m?2:1)}else if(l==="undefined"||i===null)this._set(0,0),f&&(g=i===null?1:0);else{var v=l==="string"?i.split(/[\s,]+/)||[]:i;g=1,Array.isArray(v)?this._set(+v[0],+(v.length>1?v[1]:v[0])):"width"in v?this._set(v.width||0,v.height||0):"x"in v?this._set(v.x||0,v.y||0):(this._set(0,0),g=0)}return f&&(this.__read=g),this},set:"#initialize",_set:function(e,i){return this.width=e,this.height=i,this},equals:function(e){return e===this||e&&(this.width===e.width&&this.height===e.height||Array.isArray(e)&&this.width===e[0]&&this.height===e[1])||!1},clone:function(){return new j(this.width,this.height)},toString:function(){var e=S.instance;return"{ width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.width),i.number(this.height)]},add:function(){var e=j.read(arguments);return new j(this.width+e.width,this.height+e.height)},subtract:function(){var e=j.read(arguments);return new j(this.width-e.width,this.height-e.height)},multiply:function(){var e=j.read(arguments);return new j(this.width*e.width,this.height*e.height)},divide:function(){var e=j.read(arguments);return new j(this.width/e.width,this.height/e.height)},modulo:function(){var e=j.read(arguments);return new j(this.width%e.width,this.height%e.height)},negate:function(){return new j(-this.width,-this.height)},isZero:function(){var e=P.isZero;return e(this.width)&&e(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(e,i){return new j(Math.min(e.width,i.width),Math.min(e.height,i.height))},max:function(e,i){return new j(Math.max(e.width,i.width),Math.max(e.height,i.height))},random:function(){return new j(Math.random(),Math.random())}}},o.each(["round","ceil","floor","abs"],function(e){var i=Math[e];this[e]=function(){return new j(i(this.width),i(this.height))}},{})),re=j.extend({initialize:function(i,r,l,f){this._width=i,this._height=r,this._owner=l,this._setter=f},_set:function(e,i,r){return this._width=e,this._height=i,r||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)}}),K=o.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(i,r,l,f){var g=arguments,m=typeof i,v;if(m==="number"?(this._set(i,r,l,f),v=4):m==="undefined"||i===null?(this._set(0,0,0,0),v=i===null?1:0):g.length===1&&(Array.isArray(i)?(this._set.apply(this,i),v=1):i.x!==s||i.width!==s?(this._set(i.x||0,i.y||0,i.width||0,i.height||0),v=1):i.from===s&&i.to===s&&(this._set(0,0,0,0),o.readSupported(g,this)&&(v=1))),v===s){var y=z.readNamed(g,"from"),x=o.peek(g),M=y.x,L=y.y,E,k;if(x&&x.x!==s||o.hasNamed(g,"to")){var U=z.readNamed(g,"to");E=U.x-M,k=U.y-L,E<0&&(M=U.x,E=-E),k<0&&(L=U.y,k=-k)}else{var N=j.read(g);E=N.width,k=N.height}this._set(M,L,E,k),v=g.__index}var F=g.__filtered;return F&&(this.__filtered=F),this.__read&&(this.__read=v),this},set:"#initialize",_set:function(e,i,r,l){return this.x=e,this.y=i,this.width=r,this.height=l,this},clone:function(){return new K(this.x,this.y,this.width,this.height)},equals:function(e){var i=o.isPlainValue(e)?K.read(arguments):e;return i===this||i&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height||!1},toString:function(){var e=S.instance;return"{ x: "+e.number(this.x)+", y: "+e.number(this.y)+", width: "+e.number(this.width)+", height: "+e.number(this.height)+" }"},_serialize:function(e){var i=e.formatter;return[i.number(this.x),i.number(this.y),i.number(this.width),i.number(this.height)]},getPoint:function(e){var i=e?z:J;return new i(this.x,this.y,this,"setPoint")},setPoint:function(){var e=z.read(arguments);this.x=e.x,this.y=e.y},getSize:function(e){var i=e?j:re;return new i(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var e=j.read(arguments),i=this._sx,r=this._sy,l=e.width,f=e.height;i&&(this.x+=(this.width-l)*i),r&&(this.y+=(this.height-f)*r),this.width=l,this.height=f,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(e){if(!this._fw){var i=e-this.x;this.width-=this._sx===.5?i*2:i}this.x=e,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(e){if(!this._fh){var i=e-this.y;this.height-=this._sy===.5?i*2:i}this.y=e,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(e){if(!this._fw){var i=e-this.x;this.width=this._sx===.5?i*2:i}this.x=e-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(e){if(!this._fh){var i=e-this.y;this.height=this._sy===.5?i*2:i}this.y=e-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(e){this._fw||this._sx===.5?this.x=e-this.width/2:(this._sx&&(this.x+=(e-this.x)*2*this._sx),this.width=(e-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(e){this._fh||this._sy===.5?this.y=e-this.height/2:(this._sy&&(this.y+=(e-this.y)*2*this._sy),this.height=(e-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(e){var i=e?z:J;return new i(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var e=z.read(arguments);return this.setCenterX(e.x),this.setCenterY(e.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(e){return e&&e.width!==s||(Array.isArray(e)?e:arguments).length===4?this._containsRectangle(K.read(arguments)):this._containsPoint(z.read(arguments))},_containsPoint:function(e){var i=e.x,r=e.y;return i>=this.x&&r>=this.y&&i<=this.x+this.width&&r<=this.y+this.height},_containsRectangle:function(e){var i=e.x,r=e.y;return i>=this.x&&r>=this.y&&i+e.width<=this.x+this.width&&r+e.height<=this.y+this.height},intersects:function(){var e=K.read(arguments),i=o.read(arguments)||0;return e.x+e.width>this.x-i&&e.y+e.height>this.y-i&&e.x<this.x+this.width+i&&e.y<this.y+this.height+i},intersect:function(){var e=K.read(arguments),i=Math.max(this.x,e.x),r=Math.max(this.y,e.y),l=Math.min(this.x+this.width,e.x+e.width),f=Math.min(this.y+this.height,e.y+e.height);return new K(i,r,l-i,f-r)},unite:function(){var e=K.read(arguments),i=Math.min(this.x,e.x),r=Math.min(this.y,e.y),l=Math.max(this.x+this.width,e.x+e.width),f=Math.max(this.y+this.height,e.y+e.height);return new K(i,r,l-i,f-r)},include:function(){var e=z.read(arguments),i=Math.min(this.x,e.x),r=Math.min(this.y,e.y),l=Math.max(this.x+this.width,e.x),f=Math.max(this.y+this.height,e.y);return new K(i,r,l-i,f-r)},expand:function(){var e=j.read(arguments),i=e.width,r=e.height;return new K(this.x-i/2,this.y-r/2,this.width+i,this.height+r)},scale:function(e,i){return this.expand(this.width*e-this.width,this.height*(i===s?e:i)-this.height)}},o.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(e,i){var r=e.join(""),l=/^[RL]/.test(r);i>=4&&(e[1]+=l?"Y":"X");var f=e[l?0:1],g=e[l?1:0],m="get"+f,v="get"+g,y="set"+f,x="set"+g,M="get"+r,L="set"+r;this[M]=function(E){var k=E?z:J;return new k(this[m](),this[v](),this,L)},this[L]=function(){var E=z.read(arguments);this[y](E.x),this[x](E.y)}},{beans:!0})),ce=K.extend({initialize:function(i,r,l,f,g,m){this._set(i,r,l,f,!0),this._owner=g,this._setter=m},_set:function(e,i,r,l,f){return this._x=e,this._y=i,this._width=r,this._height=l,f||this._owner[this._setter](this),this}},new function(){var e=K.prototype;return o.each(["x","y","width","height"],function(i){var r=o.capitalize(i),l="_"+i;this["get"+r]=function(){return this[l]},this["set"+r]=function(f){this[l]=f,this._dontNotify||this._owner[this._setter](this)}},o.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(i){var r="set"+i;this[r]=function(){this._dontNotify=!0,e[r].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(i){var r=this._owner;r._changeSelection&&r._changeSelection(2,i)}}))}),ue=o.extend({_class:"Matrix",initialize:function e(i,r){var l=arguments,f=l.length,g=!0;if(f>=6?this._set.apply(this,l):f===1||f===2?i instanceof e?this._set(i._a,i._b,i._c,i._d,i._tx,i._ty,r):Array.isArray(i)?this._set.apply(this,r?i.concat([r]):i):g=!1:f?g=!1:this.reset(),!g)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(e,i,r,l,f,g,m){return this._a=e,this._b=i,this._c=r,this._d=l,this._tx=f,this._ty=g,m||this._changed(),this},_serialize:function(e,i){return o.serialize(this.getValues(),e,!0,i)},_changed:function(){var e=this._owner;e&&(e._applyMatrix?e.transform(null,!0):e._changed(25))},clone:function(){return new ue(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(e){return e===this||e&&this._a===e._a&&this._b===e._b&&this._c===e._c&&this._d===e._d&&this._tx===e._tx&&this._ty===e._ty},toString:function(){var e=S.instance;return"[["+[e.number(this._a),e.number(this._c),e.number(this._tx)].join(", ")+"], ["+[e.number(this._b),e.number(this._d),e.number(this._ty)].join(", ")+"]]"},reset:function(e){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,e||this._changed(),this},apply:function(e,i){var r=this._owner;return r?(r.transform(null,o.pick(e,!0),i),this.isIdentity()):!1},translate:function(){var e=z.read(arguments),i=e.x,r=e.y;return this._tx+=i*this._a+r*this._c,this._ty+=i*this._b+r*this._d,this._changed(),this},scale:function(){var e=arguments,i=z.read(e),r=z.read(e,0,{readNull:!0});return r&&this.translate(r),this._a*=i.x,this._b*=i.x,this._c*=i.y,this._d*=i.y,r&&this.translate(r.negate()),this._changed(),this},rotate:function(e){e*=Math.PI/180;var i=z.read(arguments,1),r=i.x,l=i.y,f=Math.cos(e),g=Math.sin(e),m=r-r*f+l*g,v=l-r*g-l*f,y=this._a,x=this._b,M=this._c,L=this._d;return this._a=f*y+g*M,this._b=f*x+g*L,this._c=-g*y+f*M,this._d=-g*x+f*L,this._tx+=m*y+v*M,this._ty+=m*x+v*L,this._changed(),this},shear:function(){var e=arguments,i=z.read(e),r=z.read(e,0,{readNull:!0});r&&this.translate(r);var l=this._a,f=this._b;return this._a+=i.y*this._c,this._b+=i.y*this._d,this._c+=i.x*l,this._d+=i.x*f,r&&this.translate(r.negate()),this._changed(),this},skew:function(){var e=arguments,i=z.read(e),r=z.read(e,0,{readNull:!0}),l=Math.PI/180,f=new z(Math.tan(i.x*l),Math.tan(i.y*l));return this.shear(f,r)},append:function(e,i){if(e){var r=this._a,l=this._b,f=this._c,g=this._d,m=e._a,v=e._c,y=e._b,x=e._d,M=e._tx,L=e._ty;this._a=m*r+y*f,this._c=v*r+x*f,this._b=m*l+y*g,this._d=v*l+x*g,this._tx+=M*r+L*f,this._ty+=M*l+L*g,i||this._changed()}return this},prepend:function(e,i){if(e){var r=this._a,l=this._b,f=this._c,g=this._d,m=this._tx,v=this._ty,y=e._a,x=e._c,M=e._b,L=e._d,E=e._tx,k=e._ty;this._a=y*r+x*l,this._c=y*f+x*g,this._b=M*r+L*l,this._d=M*f+L*g,this._tx=y*m+x*v+E,this._ty=M*m+L*v+k,i||this._changed()}return this},appended:function(e){return this.clone().append(e)},prepended:function(e){return this.clone().prepend(e)},invert:function(){var e=this._a,i=this._b,r=this._c,l=this._d,f=this._tx,g=this._ty,m=e*l-i*r,v=null;return m&&!isNaN(m)&&isFinite(f)&&isFinite(g)&&(this._a=l/m,this._b=-i/m,this._c=-r/m,this._d=e/m,this._tx=(r*g-l*f)/m,this._ty=(i*f-e*g)/m,v=this),v},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new ue(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var e=this._a*this._d-this._c*this._b;return e&&!isNaN(e)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(e,i,r){return arguments.length<3?this._transformPoint(z.read(arguments)):this._transformCoordinates(e,i,r)},_transformPoint:function(e,i,r){var l=e.x,f=e.y;return i||(i=new z),i._set(l*this._a+f*this._c+this._tx,l*this._b+f*this._d+this._ty,r)},_transformCoordinates:function(e,i,r){for(var l=0,f=2*r;l<f;l+=2){var g=e[l],m=e[l+1];i[l]=g*this._a+m*this._c+this._tx,i[l+1]=g*this._b+m*this._d+this._ty}return i},_transformCorners:function(e){var i=e.x,r=e.y,l=i+e.width,f=r+e.height,g=[i,r,l,r,l,f,i,f];return this._transformCoordinates(g,g,4)},_transformBounds:function(e,i,r){for(var l=this._transformCorners(e),f=l.slice(0,2),g=f.slice(),m=2;m<8;m++){var v=l[m],y=m&1;v<f[y]?f[y]=v:v>g[y]&&(g[y]=v)}return i||(i=new K),i._set(f[0],f[1],g[0]-f[0],g[1]-f[1],r)},inverseTransform:function(){return this._inverseTransform(z.read(arguments))},_inverseTransform:function(e,i,r){var l=this._a,f=this._b,g=this._c,m=this._d,v=this._tx,y=this._ty,x=l*m-f*g,M=null;if(x&&!isNaN(x)&&isFinite(v)&&isFinite(y)){var L=e.x-this._tx,E=e.y-this._ty;i||(i=new z),M=i._set((L*m-E*g)/x,(E*l-L*f)/x,r)}return M},decompose:function(){var e=this._a,i=this._b,r=this._c,l=this._d,f=e*l-i*r,g=Math.sqrt,m=Math.atan2,v=180/Math.PI,y,x,M;if(e!==0||i!==0){var L=g(e*e+i*i);y=Math.acos(e/L)*(i>0?1:-1),x=[L,f/L],M=[m(e*r+i*l,L*L),0]}else if(r!==0||l!==0){var E=g(r*r+l*l);y=Math.asin(r/E)*(l>0?1:-1),x=[f/E,E],M=[0,m(e*r+i*l,E*E)]}else y=0,M=x=[0,0];return{translation:this.getTranslation(),rotation:y*v,scaling:new z(x),skewing:new z(M[0]*v,M[1]*v)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new z(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(e){this.isIdentity()||e.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},o.each(["a","b","c","d","tx","ty"],function(e){var i=o.capitalize(e),r="_"+e;this["get"+i]=function(){return this[r]},this["set"+i]=function(l){this[r]=l,this._changed()}},{})),fe=o.extend({_class:"Line",initialize:function(i,r,l,f,g){var m=!1;arguments.length>=4?(this._px=i,this._py=r,this._vx=l,this._vy=f,m=g):(this._px=i.x,this._py=i.y,this._vx=r.x,this._vy=r.y,m=l),m||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new z(this._px,this._py)},getVector:function(){return new z(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(e,i){return fe.intersect(this._px,this._py,this._vx,this._vy,e._px,e._py,e._vx,e._vy,!0,i)},getSide:function(e,i){return fe.getSide(this._px,this._py,this._vx,this._vy,e.x,e.y,!0,i)},getDistance:function(e){return Math.abs(this.getSignedDistance(e))},getSignedDistance:function(e){return fe.getSignedDistance(this._px,this._py,this._vx,this._vy,e.x,e.y,!0)},isCollinear:function(e){return z.isCollinear(this._vx,this._vy,e._vx,e._vy)},isOrthogonal:function(e){return z.isOrthogonal(this._vx,this._vy,e._vx,e._vy)},statics:{intersect:function(e,i,r,l,f,g,m,v,y,x){y||(r-=e,l-=i,m-=f,v-=g);var M=r*v-l*m;if(!P.isMachineZero(M)){var L=e-f,E=i-g,k=(m*E-v*L)/M,U=(r*E-l*L)/M,N=1e-12,F=-N,A=1+N;if(x||F<k&&k<A&&F<U&&U<A)return x||(k=k<=0?0:k>=1?1:k),new z(e+k*r,i+k*l)}},getSide:function(e,i,r,l,f,g,m,v){m||(r-=e,l-=i);var y=f-e,x=g-i,M=y*l-x*r;return!v&&P.isMachineZero(M)&&(M=(y*r+y*r)/(r*r+l*l),M>=0&&M<=1&&(M=0)),M<0?-1:M>0?1:0},getSignedDistance:function(e,i,r,l,f,g,m){return m||(r-=e,l-=i),r===0?l>0?f-e:e-f:l===0?r<0?g-i:i-g:((f-e)*l-(g-i)*r)/(l>r?l*Math.sqrt(1+r*r/(l*l)):r*Math.sqrt(1+l*l/(r*r)))},getDistance:function(e,i,r,l,f,g,m){return Math.abs(fe.getSignedDistance(e,i,r,l,f,g,m))}}}),ae=b.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(i){b.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new Ji(null,null,this),this._view=lt.create(this,i||pt.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(e,i){return o.serialize(this._children,e,!0,i)},_changed:function(e,i){if(e&1){var r=this._view;r&&(r._needsUpdate=!0,!r._requested&&r._autoUpdate&&r.requestUpdate())}var l=this._changes;if(l&&i){var f=this._changesById,g=i._id,m=f[g];m?m.flags|=e:l.push(f[g]={item:i,flags:e})}},clear:function(){for(var e=this._children,i=e.length-1;i>=0;i--)e[i].remove()},isEmpty:function(){return!this._children.length},remove:function e(){return e.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.set(e)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new _e({project:this,insert:!0})},getSymbolDefinitions:function(){var e=[],i={};return this.getItems({class:be,match:function(r){var l=r._definition,f=l._id;return i[f]||(i[f]=!0,e.push(l)),!1}}),e},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var e=this._selectionItems,i=[];for(var r in e){var l=e[r],f=l._selection;f&1&&l.isInserted()?i.push(l):f||this._updateSelection(l)}return i},_updateSelection:function(e){var i=e._id,r=this._selectionItems;e._selection?r[i]!==e&&(this._selectionCount++,r[i]=e):r[i]===e&&(this._selectionCount--,delete r[i])},selectAll:function(){for(var e=this._children,i=0,r=e.length;i<r;i++)e[i].setFullySelected(!0)},deselectAll:function(){var e=this._selectionItems;for(var i in e)e[i].setFullySelected(!1)},addLayer:function(e){return this.insertLayer(s,e)},insertLayer:function(e,i){if(i instanceof _e){i._remove(!1,!0),o.splice(this._children,[i],e,0),i._setProject(this,!0);var r=i._name;r&&i.setName(r),this._changes&&i._changed(5),this._activeLayer||(this._activeLayer=i)}else i=null;return i},_insertItem:function(e,i,r){return i=this.insertLayer(e,i)||(this._activeLayer||this._insertItem(s,new _e(I.NO_INSERT),!0)).insertChild(e,i),r&&i.activate&&i.activate(),i},getItems:function(e){return I._getItems(this,e)},getItem:function(e){return I._getItems(this,e,null,null,!0)[0]||null},importJSON:function(e){this.activate();var i=this._activeLayer;return o.importJSON(e,i&&i.isEmpty()&&i)},removeOn:function(e){var i=this._removeSets;if(i){e==="mouseup"&&(i.mousedrag=null);var r=i[e];if(r){for(var l in r){var f=r[l];for(var g in i){var m=i[g];m&&m!=r&&delete m[f._id]}f.remove()}i[e]=null}}},draw:function(e,i,r){this._updateVersion++,e.save(),i.applyToContext(e);for(var l=this._children,f=new o({offset:new z(0,0),pixelRatio:r,viewMatrix:i.isIdentity()?null:i,matrices:[new ue],updateMatrix:!0}),g=0,m=l.length;g<m;g++)l[g].draw(e,f);if(e.restore(),this._selectionCount>0){e.save(),e.strokeWidth=1;var v=this._selectionItems,y=this._scope.settings.handleSize,x=this._updateVersion;for(var M in v)v[M]._drawSelection(e,i,y,v,x);e.restore()}}}),I=o.extend(d,{statics:{extend:function e(i){return i._serializeFields&&(i._serializeFields=o.set({},this.prototype._serializeFields,i._serializeFields)),e.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new ue,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var e=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return o.each(e,function(i){this._events[i]={install:function(r){this.getView()._countItemEvent(r,1)},uninstall:function(r){this.getView()._countItemEvent(r,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:e}})},{initialize:function(){},_initialize:function(e,i){var r=e&&o.isPlainObject(e),l=r&&e.internal===!0,f=this._matrix=new ue,g=r&&e.project||Qe.project,m=Qe.settings;return this._id=l?null:D.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&m.applyMatrix,i&&f.translate(i),f._owner=this,this._style=new Ji(g._currentStyle,this,g),l||r&&e.insert==!1||!m.insertItems&&!(r&&e.insert==!0)?this._setProject(g):(r&&e.parent||g)._insertItem(s,this,!0),r&&e!==I.NO_INSERT&&e!==I.INSERT&&this.set(e,{internal:!0,insert:!0,project:!0,parent:!0}),r},_serialize:function(e,i){var r={},l=this;function f(g){for(var m in g){var v=l[m];o.equals(v,m==="leading"?g.fontSize*1.2:g[m])||(r[m]=o.serialize(v,e,m!=="data",i))}}return f(this._serializeFields),this instanceof le||f(this._style._defaults),[this._class,r]},_changed:function(e){var i=this._symbol,r=this._parent||i,l=this._project;e&8&&(this._bounds=this._position=this._decomposed=s),e&16&&(this._globalMatrix=s),r&&e&72&&I._clearBoundsCache(r),e&2&&I._clearBoundsCache(this),l&&l._changed(e,this),i&&i._changed(e)},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){if(this._name&&this._removeNamed(),e===+e+"")throw new Error("Names consisting only of numbers are not supported.");var i=this._getOwner();if(e&&i){var r=i._children,l=i._namedChildren;(l[e]=l[e]||[]).push(this),e in r||(r[e]=this)}this._name=e||s,this._changed(256)},getStyle:function(){return this._style},setStyle:function(e){this.getStyle().set(e)}},o.each(["locked","visible","blendMode","opacity","guide"],function(e){var i=o.capitalize(e),r="_"+e,l={locked:256,visible:265};this["get"+i]=function(){return this[r]},this["set"+i]=function(f){f!=this[r]&&(this[r]=f,this._changed(l[e]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(e){if(e!==this._selection){this._selection=e;var i=this._project;i&&(i._updateSelection(this),this._changed(257))}},_changeSelection:function(e,i){var r=this._selection;this.setSelection(i?r|e:r&~e)},isSelected:function(){if(this._selectChildren){for(var e=this._children,i=0,r=e.length;i<r;i++)if(e[i].isSelected())return!0}return!!(this._selection&1)},setSelected:function(e){if(this._selectChildren)for(var i=this._children,r=0,l=i.length;r<l;r++)i[r].setSelected(e);this._changeSelection(1,e)},isFullySelected:function(){var e=this._children,i=!!(this._selection&1);if(e&&i){for(var r=0,l=e.length;r<l;r++)if(!e[r].isFullySelected())return!1;return!0}return i},setFullySelected:function(e){var i=this._children;if(i)for(var r=0,l=i.length;r<l;r++)i[r].setFullySelected(e);this._changeSelection(1,e)},isClipMask:function(){return this._clipMask},setClipMask:function(e){this._clipMask!=(e=!!e)&&(this._clipMask=e,e&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(e){this._data=e},getPosition:function(e){var i=e?z:J,r=this._position||(this._position=this._getPositionFromBounds());return new i(r.x,r.y,this,"setPosition")},setPosition:function(){this.translate(z.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(e){return this._pivot?this._matrix._transformPoint(this._pivot):(e||this.getBounds()).getCenter(!0)},getPivot:function(){var e=this._pivot;return e?new J(e.x,e.y,this,"setPivot"):null},setPivot:function(){this._pivot=z.read(arguments,0,{clone:!0,readNull:!0}),this._position=s}},o.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(e,i){this[i]=function(r){return this.getBounds(r,e)}},{beans:!0,getBounds:function(e,i){var r=i||e instanceof ue,l=o.set({},r?i:e,this._boundsOptions);(!l.stroke||this.getStrokeScaling())&&(l.cacheItem=this);var f=this._getCachedBounds(r&&e,l).rect;return arguments.length?f:new ce(f.x,f.y,f.width,f.height,this,"setBounds")},setBounds:function(){var e=K.read(arguments),i=this.getBounds(),r=this._matrix,l=new ue,f=e.getCenter();l.translate(f),(e.width!=i.width||e.height!=i.height)&&(r.isInvertible()||(r.set(r._backup||new ue().translate(r.getTranslation())),i=this.getBounds()),l.scale(i.width!==0?e.width/i.width:0,i.height!==0?e.height/i.height:0)),f=i.getCenter(),l.translate(-f.x,-f.y),this.transform(l)},_getBounds:function(e,i){var r=this._children;return!r||!r.length?new K:(I._updateBoundsCache(this,i.cacheItem),I._getBounds(r,e,i))},_getBoundsCacheKey:function(e,i){return[e.stroke?1:0,e.handle?1:0,i?1:0].join("")},_getCachedBounds:function(e,i,r){e=e&&e._orNullIfIdentity();var l=i.internal&&!r,f=i.cacheItem,g=l?null:this._matrix._orNullIfIdentity(),m=f&&(!e||e.equals(g))&&this._getBoundsCacheKey(i,l),v=this._bounds;if(I._updateBoundsCache(this._parent||this._symbol,f),m&&v&&m in v){var y=v[m];return{rect:y.rect.clone(),nonscaling:y.nonscaling}}var x=this._getBounds(e||g,i),M=x.rect||x,L=this._style,E=x.nonscaling||L.hasStroke()&&!L.getStrokeScaling();if(m){v||(this._bounds=v={});var y=v[m]={rect:M.clone(),nonscaling:E,internal:l}}return{rect:M,nonscaling:E}},_getStrokeMatrix:function(e,i){var r=this.getStrokeScaling()?null:i&&i.internal?this:this._parent||this._symbol&&this._symbol._item,l=r?r.getViewMatrix().invert():e;return l&&l._shiftless()},statics:{_updateBoundsCache:function(e,i){if(e&&i){var r=i._id,l=e._boundsCache=e._boundsCache||{ids:{},list:[]};l.ids[r]||(l.list.push(i),l.ids[r]=i)}},_clearBoundsCache:function(e){var i=e._boundsCache;if(i){e._bounds=e._position=e._boundsCache=s;for(var r=0,l=i.list,f=l.length;r<f;r++){var g=l[r];g!==e&&(g._bounds=g._position=s,g._boundsCache&&I._clearBoundsCache(g))}}},_getBounds:function(e,i,r){var l=1/0,f=-l,g=l,m=f,v=!1;r=r||{};for(var y=0,x=e.length;y<x;y++){var M=e[y];if(M._visible&&!M.isEmpty(!0)){var L=M._getCachedBounds(i&&i.appended(M._matrix),r,!0),E=L.rect;l=Math.min(E.x,l),g=Math.min(E.y,g),f=Math.max(E.x+E.width,f),m=Math.max(E.y+E.height,m),L.nonscaling&&(v=!0)}}return{rect:isFinite(l)?new K(l,g,f-l,m-g):new K,nonscaling:v}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var e=this._decompose();return e?e.rotation:0},setRotation:function(e){var i=this.getRotation();if(i!=null&&e!=null){var r=this._decomposed;this.rotate(e-i),r&&(r.rotation=e,this._decomposed=r)}},getScaling:function(){var e=this._decompose(),i=e&&e.scaling;return new J(i?i.x:1,i?i.y:1,this,"setScaling")},setScaling:function(){var e=this.getScaling(),i=z.read(arguments,0,{clone:!0,readNull:!0});if(e&&i&&!e.equals(i)){var r=this.getRotation(),l=this._decomposed,f=new ue,g=P.isZero;if(g(e.x)||g(e.y))f.translate(l.translation),r&&f.rotate(r),f.scale(i.x,i.y),this._matrix.set(f);else{var m=this.getPosition(!0);f.translate(m),r&&f.rotate(r),f.scale(i.x/e.x,i.y/e.y),r&&f.rotate(-r),f.translate(m.negate()),this.transform(f)}l&&(l.scaling=i,this._decomposed=l)}},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},getGlobalMatrix:function(e){var i=this._globalMatrix;if(i)for(var r=this._parent,l=[];r;){if(!r._globalMatrix){i=null;for(var f=0,g=l.length;f<g;f++)l[f]._globalMatrix=null;break}l.push(r),r=r._parent}if(!i){i=this._globalMatrix=this._matrix.clone();var r=this._parent;r&&i.prepend(r.getGlobalMatrix(!0))}return e?i:i.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(e){(this._applyMatrix=this._canApplyMatrix&&!!e)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(e,i){if(this._project!==e){this._project&&this._installEvents(!1),this._project=e;for(var r=this._children,l=0,f=r&&r.length;l<f;l++)r[l]._setProject(e);i=!0}i&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function e(i){e.base.call(this,i);for(var r=this._children,l=0,f=r&&r.length;l<f;l++)r[l]._installEvents(i)},getLayer:function(){for(var e=this;e=e._parent;)if(e instanceof _e)return e;return null},getParent:function(){return this._parent},setParent:function(e){return e.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var e=this._getOwner();return e&&e._children[this._index+1]||null},getPreviousSibling:function(){var e=this._getOwner();return e&&e._children[this._index-1]||null},getIndex:function(){return this._index},setIndex:function(e){var i=this._parent,r=i&&i._children;r&&i.insertChildren(e in r?e:s,[this])},equals:function(e){return e===this||e&&this._class===e._class&&this._style.equals(e._style)&&this._matrix.equals(e._matrix)&&this._locked===e._locked&&this._visible===e._visible&&this._blendMode===e._blendMode&&this._opacity===e._opacity&&this._clipMask===e._clipMask&&this._guide===e._guide&&this._equals(e)||!1},_equals:function(e){return o.equals(this._children,e._children)},clone:function(e){var i=new this.constructor(I.NO_INSERT),r=this._children,l=o.pick(e?e.insert:s,e===s||e===!0),f=o.pick(e?e.deep:s,!0);r&&i.copyAttributes(this),(!r||f)&&i.copyContent(this),r||i.copyAttributes(this),l&&i.insertAbove(this);var g=this._name,m=this._parent;if(g&&m){for(var r=m._children,v=g,y=1;r[g];)g=v+" "+y++;g!==v&&i.setName(g)}return i},copyContent:function(e){for(var i=e._children,r=0,l=i&&i.length;r<l;r++)this.addChild(i[r].clone(!1),!0)},copyAttributes:function(e,i){this.setStyle(e._style);for(var r=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],l=0,f=r.length;l<f;l++){var g=r[l];e.hasOwnProperty(g)&&(this[g]=e[g])}i||this._matrix.set(e._matrix,!0),this.setApplyMatrix(e._applyMatrix),this.setPivot(e._pivot),this.setSelection(e._selection);var m=e._data,v=e._name;this._data=m?o.clone(m):null,v&&this.setName(v)},rasterize:function(e,i){var r,l,f;o.isPlainObject(e)?(r=e.resolution,l=e.insert,f=e.raster):(r=e,l=i),f||(f=new Pe(I.NO_INSERT));var g=this.getStrokeBounds(),m=(r||this.getView().getResolution())/72,v=g.getTopLeft().floor(),y=g.getBottomRight().ceil(),x=new j(y.subtract(v)),M=x.multiply(m);if(f.setSize(M,!0),!M.isZero()){var L=f.getContext(!0),E=new ue().scale(m).translate(v.negate());L.save(),E.applyToContext(L),this.draw(L,new o({matrices:[E]})),L.restore()}return f._matrix.set(new ue().translate(v.add(x.divide(2))).scale(1/m)),(l===s||l)&&f.insertAbove(this),f},contains:function(){var e=this._matrix;return e.isInvertible()&&!!this._contains(e._inverseTransform(z.read(arguments)))},_contains:function(e){var i=this._children;if(i){for(var r=i.length-1;r>=0;r--)if(i[r].contains(e))return!0;return!1}return e.isInside(this.getInternalBounds())},isInside:function(){return K.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ve.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(e,i){return e instanceof I?this._asPathItem().getIntersections(e._asPathItem(),null,i,!0).length>0:!1}},new function(){function e(){var l=arguments;return this._hitTest(z.read(l),ke.getOptions(l))}function i(){var l=arguments,f=z.read(l),g=ke.getOptions(l),m=[];return this._hitTest(f,new o({all:m},g)),m}function r(l,f,g,m){var v=this._children;if(v)for(var y=v.length-1;y>=0;y--){var x=v[y],M=x!==m&&x._hitTest(l,f,g);if(M&&!f.all)return M}return null}return ae.inject({hitTest:e,hitTestAll:i,_hitTest:r}),{hitTest:e,hitTestAll:i,_hitTestChildren:r}},{_hitTest:function(e,i,r){if(this._locked||!this._visible||this._guide&&!i.guides||this.isEmpty())return null;var l=this._matrix,f=r?r.appended(l):this.getGlobalMatrix().prepend(this.getView()._matrix),g=Math.max(i.tolerance,1e-12),m=i._tolerancePadding=new j(Ve._getStrokePadding(g,l._shiftless().invert()));if(e=l._inverseTransform(e),!e||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(m.multiply(2))._containsPoint(e))return null;var v=!(i.guides&&!this._guide||i.selected&&!this.isSelected()||i.type&&i.type!==o.hyphenate(this._class)||i.class&&!(this instanceof i.class)),y=i.match,x=this,M,L;function E(w){return w&&y&&!y(w)&&(w=null),w&&i.all&&i.all.push(w),w}function k(w,O){var q=O?M["get"+O]():x.getPosition();if(e.subtract(q).divide(m).length<=1)return new ke(w,x,{name:O?o.hyphenate(O):w,point:q})}var U=i.position,N=i.center,F=i.bounds;if(v&&this._parent&&(U||N||F)){if((N||F)&&(M=this.getInternalBounds()),L=U&&k("position")||N&&k("center","Center"),!L&&F)for(var A=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],R=0;R<8&&!L;R++)L=k("bounds",A[R]);L=E(L)}return L||(L=this._hitTestChildren(e,i,f)||v&&E(this._hitTestSelf(e,i,f,this.getStrokeScaling()?null:f._shiftless().invert()))||null),L&&L.point&&(L.point=l.transform(L.point)),L},_hitTestSelf:function(e,i){if(i.fill&&this.hasFill()&&this._contains(e))return new ke("fill",this)},matches:function(e,i){function r(m,v){for(var y in m)if(m.hasOwnProperty(y)){var x=m[y],M=v[y];if(o.isPlainObject(x)&&o.isPlainObject(M)){if(!r(x,M))return!1}else if(!o.equals(x,M))return!1}return!0}var l=typeof e;if(l==="object"){for(var f in e)if(e.hasOwnProperty(f)&&!this.matches(f,e[f]))return!1;return!0}else{if(l==="function")return e(this);if(e==="match")return i(this);var g=/^(empty|editable)$/.test(e)?this["is"+o.capitalize(e)]():e==="type"?o.hyphenate(this._class):this[e];if(e==="class"){if(typeof i=="function")return this instanceof i;g=this._class}if(typeof i=="function")return!!i(g);if(i){if(i.test)return i.test(g);if(o.isPlainObject(i))return r(i,g)}return o.equals(g,i)}},getItems:function(e){return I._getItems(this,e,this._matrix)},getItem:function(e){return I._getItems(this,e,this._matrix,null,!0)[0]||null},statics:{_getItems:function e(i,r,l,f,g){if(!f){var m=typeof r=="object"&&r,v=m&&m.overlapping,y=m&&m.inside,x=v||y,E=x&&K.read([x]);f={items:[],recursive:m&&m.recursive!==!1,inside:!!y,overlapping:!!v,rect:E,path:v&&new Ve.Rectangle({rectangle:E,insert:!1})},m&&(r=o.filter({},r,{recursive:!0,inside:!0,overlapping:!0}))}var M=i._children,L=f.items,E=f.rect;l=E&&(l||new ue);for(var k=0,U=M&&M.length;k<U;k++){var N=M[k],F=l&&l.appended(N._matrix),A=!0;if(E){var x=N.getBounds(F);if(!E.intersects(x))continue;E.contains(x)||f.overlapping&&(x.contains(E)||f.path.intersects(N,F))||(A=!1)}if(A&&N.matches(r)&&(L.push(N),g)||(f.recursive!==!1&&e(N,r,F,f,g),g&&L.length>0))break}return L}}},{importJSON:function(e){var i=o.importJSON(e,this);return i!==this?this.addChild(i):i},addChild:function(e){return this.insertChild(s,e)},insertChild:function(e,i){var r=i?this.insertChildren(e,[i]):null;return r&&r[0]},addChildren:function(e){return this.insertChildren(this._children.length,e)},insertChildren:function(e,i){var r=this._children;if(r&&i&&i.length>0){i=o.slice(i);for(var l={},f=i.length-1;f>=0;f--){var g=i[f],m=g&&g._id;!g||l[m]?i.splice(f,1):(g._remove(!1,!0),l[m]=!0)}o.splice(r,i,e,0);for(var v=this._project,y=v._changes,f=0,x=i.length;f<x;f++){var g=i[f],M=g._name;g._parent=this,g._setProject(v,!0),M&&g.setName(M),y&&g._changed(5)}this._changed(11)}else i=null;return i},_insertItem:"#insertChild",_insertAt:function(e,i){var r=e&&e._getOwner(),l=e!==this&&r?this:null;return l&&(l._remove(!1,!0),r._insertItem(e._index+i,l)),l},insertAbove:function(e){return this._insertAt(e,1)},insertBelow:function(e){return this._insertAt(e,0)},sendToBack:function(){var e=this._getOwner();return e?e._insertItem(0,this):null},bringToFront:function(){var e=this._getOwner();return e?e._insertItem(s,this):null},appendTop:"#addChild",appendBottom:function(e){return this.insertChild(0,e)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(e){return e._insertItem(s,this)},copyTo:function(e){return this.clone(!1).addTo(e)},reduce:function(e){var i=this._children;if(i&&i.length===1){var r=i[0].reduce(e);return this._parent?(r.insertAbove(this),this.remove()):r.remove(),r}return this},_removeNamed:function(){var e=this._getOwner();if(e){var i=e._children,r=e._namedChildren,l=this._name,f=r[l],g=f?f.indexOf(this):-1;g!==-1&&(i[l]==this&&delete i[l],f.splice(g,1),f.length?i[l]=f[0]:delete r[l])}},_remove:function(e,i){var r=this._getOwner(),l=this._project,f=this._index;return this._style&&this._style._dispose(),r?(this._name&&this._removeNamed(),f!=null&&(l._activeLayer===this&&(l._activeLayer=this.getNextSibling()||this.getPreviousSibling()),o.splice(r._children,null,f,1)),this._installEvents(!1),e&&l._changes&&this._changed(5),i&&r._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(e){var i=e&&e.insertBelow(this);return i&&this.remove(),i},removeChildren:function(e,i){if(!this._children)return null;e=e||0,i=o.pick(i,this._children.length);for(var r=o.splice(this._children,null,e,i-e),l=r.length-1;l>=0;l--)r[l]._remove(!0,!1);return r.length>0&&this._changed(11),r},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,i=this._children.length;e<i;e++)this._children[e]._index=e;this._changed(11)}},isEmpty:function(e){var i=this._children,r=i?i.length:0;if(e){for(var l=0;l<r;l++)if(!i[l].isEmpty(e))return!1;return!0}return!r},isEditable:function(){for(var e=this;e;){if(!e._visible||e._locked)return!1;e=e._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(e){function i(m){var v=[];do v.unshift(m);while(m=m._parent);return v}for(var r=i(this),l=i(e),f=0,g=Math.min(r.length,l.length);f<g;f++)if(r[f]!=l[f])return r[f]._index<l[f]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(e){return this._getOrder(e)===-1},isBelow:function(e){return this._getOrder(e)===1},isParent:function(e){return this._parent===e},isChild:function(e){return e&&e._parent===this},isDescendant:function(e){for(var i=this;i=i._parent;)if(i===e)return!0;return!1},isAncestor:function(e){return e?e.isDescendant(this):!1},isSibling:function(e){return this._parent===e._parent},isGroupedWith:function(e){for(var i=this._parent;i;){if(i._parent&&/^(Group|Layer|CompoundPath)$/.test(i._class)&&e.isDescendant(i))return!0;i=i._parent}return!1}},o.each(["rotate","scale","shear","skew"],function(e){var i=e==="rotate";this[e]=function(){var r=arguments,l=(i?o:z).read(r),f=z.read(r,0,{readNull:!0});return this.transform(new ue()[e](l,f||this.getPosition(!0)))}},{translate:function(){var e=new ue;return this.transform(e.translate.apply(e,arguments))},transform:function(e,i,r){var l=this._matrix,f=e&&!e.isIdentity(),g=r&&this._canApplyMatrix||this._applyMatrix&&(f||!l.isIdentity()||i&&this._children);if(!f&&!g)return this;if(f){!e.isInvertible()&&l.isInvertible()&&(l._backup=l.getValues()),l.prepend(e,!0);var m=this._style,v=m.getFillColor(!0),y=m.getStrokeColor(!0);v&&v.transform(e),y&&y.transform(e)}if(g&&(g=this._transformContent(l,i,r))){var x=this._pivot;x&&l._transformPoint(x,x,!0),l.reset(!0),r&&this._canApplyMatrix&&(this._applyMatrix=!0)}var M=this._bounds,L=this._position;(f||g)&&this._changed(25);var E=f&&M&&e.decompose();if(E&&E.skewing.isZero()&&E.rotation%90===0){for(var k in M){var U=M[k];if(U.nonscaling)delete M[k];else if(g||!U.internal){var N=U.rect;e._transformBounds(N,N)}}this._bounds=M;var F=M[this._getBoundsCacheKey(this._boundsOptions||{})];F&&(this._position=this._getPositionFromBounds(F.rect))}else f&&L&&this._pivot&&(this._position=e._transformPoint(L,L));return this},_transformContent:function(e,i,r){var l=this._children;if(l){for(var f=0,g=l.length;f<g;f++)l[f].transform(e,i,r);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(z.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(z.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(z.read(arguments))},localToParent:function(){return this._matrix._transformPoint(z.read(arguments))},fitBounds:function(e,i){e=K.read(arguments);var r=this.getBounds(),l=r.height/r.width,f=e.height/e.width,g=(i?l>f:l<f)?e.width/r.width:e.height/r.height,m=new K(new z,new j(r.width*g,r.height*g));m.setCenter(e.getCenter()),this.setBounds(m)}}),{_setStyles:function(e,i,r){var l=this._style,f=this._matrix;if(l.hasFill()&&(e.fillStyle=l.getFillColor().toCanvasStyle(e,f)),l.hasStroke()){e.strokeStyle=l.getStrokeColor().toCanvasStyle(e,f),e.lineWidth=l.getStrokeWidth();var g=l.getStrokeJoin(),m=l.getStrokeCap(),v=l.getMiterLimit();if(g&&(e.lineJoin=g),m&&(e.lineCap=m),v&&(e.miterLimit=v),Qe.support.nativeDash){var y=l.getDashArray(),x=l.getDashOffset();y&&y.length&&("setLineDash"in e?(e.setLineDash(y),e.lineDashOffset=x):(e.mozDash=y,e.mozDashOffset=x))}}if(l.hasShadow()){var M=i.pixelRatio||1,L=r._shiftless().prepend(new ue().scale(M,M)),E=L.transform(new z(l.getShadowBlur(),0)),k=L.transform(this.getShadowOffset());e.shadowColor=l.getShadowColor().toCanvasStyle(e),e.shadowBlur=E.getLength(),e.shadowOffsetX=k.x,e.shadowOffsetY=k.y}},draw:function(e,i,r){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var l=i.matrices,f=i.viewMatrix,g=this._matrix,m=l[l.length-1].appended(g);if(m.isInvertible()){f=f?f.appended(m):m,l.push(m),i.updateMatrix&&(this._globalMatrix=m);var v=this._blendMode,y=P.clamp(this._opacity,0,1),x=v==="normal",M=wi.nativeModes[v],L=x&&y===1||i.dontStart||i.clip||(M||x&&y<1)&&this._canComposite(),E=i.pixelRatio||1,k,U,N;if(!L){var F=this.getStrokeBounds(f);if(!F.width||!F.height){l.pop();return}N=i.offset,U=i.offset=F.getTopLeft().floor(),k=e,e=pt.getContext(F.getSize().ceil().add(1).multiply(E)),E!==1&&e.scale(E,E)}e.save();var A=r?r.appended(g):this._canScaleStroke&&!this.getStrokeScaling(!0)&&f,R=!L&&i.clipItem,w=!A||R;if(L?(e.globalAlpha=y,M&&(e.globalCompositeOperation=v)):w&&e.translate(-U.x,-U.y),w&&(L?g:f).applyToContext(e),R&&i.clipItem.draw(e,i.extend({clip:!0})),A){e.setTransform(E,0,0,E,0,0);var O=i.offset;O&&e.translate(-O.x,-O.y)}this._draw(e,i,f,A),e.restore(),l.pop(),i.clip&&!i.dontFinish&&e.clip(this.getFillRule()),L||(wi.process(v,e,k,y,U.subtract(N).multiply(E)),pt.release(e),i.offset=N)}}},_isUpdated:function(e){var i=this._parent;if(i instanceof it)return i._isUpdated(e);var r=this._updateVersion===e;return!r&&i&&i._visible&&i._isUpdated(e)&&(this._updateVersion=e,r=!0),r},_drawSelection:function(e,i,r,l,f){var g=this._selection,m=g&1,v=g&2||m&&this._selectBounds,y=g&4;if(this._drawSelected||(m=!1),(m||v||y)&&this._isUpdated(f)){var x,M=this.getSelectedColor(!0)||(x=this.getLayer())&&x.getSelectedColor(!0),L=i.appended(this.getGlobalMatrix(!0)),E=r/2;if(e.strokeStyle=e.fillStyle=M?M.toCanvasStyle(e):"#009dec",m&&this._drawSelected(e,L,l),y){var k=this.getPosition(!0),U=this._parent,N=U?U.localToGlobal(k):k,F=N.x,A=N.y;e.beginPath(),e.arc(F,A,E,0,Math.PI*2,!0),e.stroke();for(var R=[[0,-1],[1,0],[0,1],[-1,0]],w=E,O=r+1,q=0;q<4;q++){var H=R[q],V=H[0],G=H[1];e.moveTo(F+V*w,A+G*w),e.lineTo(F+V*O,A+G*O),e.stroke()}}if(v){var $=L._transformCorners(this.getInternalBounds());e.beginPath();for(var q=0;q<8;q++)e[q?"lineTo":"moveTo"]($[q],$[++q]);e.closePath(),e.stroke();for(var q=0;q<8;q++)e.fillRect($[q]-E,$[++q]-E,r,r)}}},_canComposite:function(){return!1}},o.each(["down","drag","up","move"],function(e){this["removeOn"+o.capitalize(e)]=function(){var i={};return i[e]=!0,this.removeOn(i)}},{removeOn:function(e){for(var i in e)if(e[i]){var r="mouse"+i,l=this._project,f=l._removeSets=l._removeSets||{};f[r]=f[r]||{},f[r][this._id]=this}return this}}),{tween:function(e,i,r){r||(r=i,i=e,e=null,r||(r=i,i=null));var l=r&&r.easing,f=r&&r.start,g=r!=null&&(typeof r=="number"?r:r.duration),m=new Di(this,e,i,g,l,f);function v(y){m._handleFrame(y.time*1e3),m.running||this.off("frame",v)}return g&&this.on("frame",v),m},tweenTo:function(e,i){return this.tween(null,e,i)},tweenFrom:function(e,i){return this.tween(e,null,i)}}),le=I.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(i){this._children=[],this._namedChildren={},this._initialize(i)||this.addChildren(Array.isArray(i)?i:arguments)},_changed:function e(i){e.base.call(this,i),i&2050&&(this._clipItem=s)},_getClipItem:function(){var e=this._clipItem;if(e===s){e=null;for(var i=this._children,r=0,l=i.length;r<l;r++)if(i[r]._clipMask){e=i[r];break}this._clipItem=e}return e},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var i=this.getFirstChild();i&&i.setClipMask(e)},_getBounds:function e(i,r){var l=this._getClipItem();return l?l._getCachedBounds(l._matrix.prepended(i),o.set({},r,{stroke:!1})):e.base.call(this,i,r)},_hitTestChildren:function e(i,r,l){var f=this._getClipItem();return(!f||f.contains(i))&&e.base.call(this,i,r,l,f)},_draw:function(e,i){var r=i.clip,l=!r&&this._getClipItem();i=i.extend({clipItem:l,clip:!1}),r?(e.beginPath(),i.dontStart=i.dontFinish=!0):l&&l.draw(e,i.extend({clip:!0}));for(var f=this._children,g=0,m=f.length;g<m;g++){var v=f[g];v!==l&&v.draw(e,i)}}}),_e=le.extend({_class:"Layer",initialize:function(){le.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function e(){return this._parent?e.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),de=I.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(i,r){this._initialize(i,r)},_equals:function(e){return this._type===e._type&&this._size.equals(e._size)&&o.equals(this._radius,e._radius)},copyContent:function(e){this.setType(e._type),this.setSize(e._size),this.setRadius(e._radius)},getType:function(){return this._type},setType:function(e){this._type=e},getShape:"#getType",setShape:"#setType",getSize:function(){var e=this._size;return new re(e.width,e.height,this,"setSize")},setSize:function(){var e=j.read(arguments);if(!this._size)this._size=e.clone();else if(!this._size.equals(e)){var i=this._type,r=e.width,l=e.height;i==="rectangle"?this._radius.set(j.min(this._radius,e.divide(2).abs())):i==="circle"?(r=l=(r+l)/2,this._radius=r/2):i==="ellipse"&&this._radius._set(r/2,l/2),this._size._set(r,l),this._changed(9)}},getRadius:function(){var e=this._radius;return this._type==="circle"?e:new re(e.width,e.height,this,"setRadius")},setRadius:function(e){var i=this._type;if(i==="circle"){if(e===this._radius)return;var r=e*2;this._radius=e,this._size._set(r,r)}else if(e=j.read(arguments),!this._radius)this._radius=e.clone();else{if(this._radius.equals(e))return;if(this._radius.set(e),i==="rectangle"){var r=j.max(this._size,e.multiply(2));this._size.set(r)}else i==="ellipse"&&this._size._set(e.width*2,e.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(e){var i=new Ve[o.capitalize(this._type)]({center:new z,size:this._size,radius:this._radius,insert:!1});return i.copyAttributes(this),Qe.settings.applyMatrix&&i.setApplyMatrix(!0),(e===s||e)&&i.insertAbove(this),i},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(e,i,r,l){var f=this._style,g=f.hasFill(),m=f.hasStroke(),v=i.dontFinish||i.clip,y=!l;if(g||m||v){var x=this._type,M=this._radius,L=x==="circle";if(i.dontStart||e.beginPath(),y&&L)e.arc(0,0,M,0,Math.PI*2,!0);else{var E=L?M:M.width,k=L?M:M.height,U=this._size,N=U.width,F=U.height;if(y&&x==="rectangle"&&E===0&&k===0)e.rect(-N/2,-F/2,N,F);else{var A=N/2,R=F/2,w=1-.5522847498307936,O=E*w,q=k*w,H=[-A,-R+k,-A,-R+q,-A+O,-R,-A+E,-R,A-E,-R,A-O,-R,A,-R+q,A,-R+k,A,R-k,A,R-q,A-O,R,A-E,R,-A+E,R,-A+O,R,-A,R-q,-A,R-k];l&&l.transform(H,H,32),e.moveTo(H[0],H[1]),e.bezierCurveTo(H[2],H[3],H[4],H[5],H[6],H[7]),A!==E&&e.lineTo(H[8],H[9]),e.bezierCurveTo(H[10],H[11],H[12],H[13],H[14],H[15]),R!==k&&e.lineTo(H[16],H[17]),e.bezierCurveTo(H[18],H[19],H[20],H[21],H[22],H[23]),A!==E&&e.lineTo(H[24],H[25]),e.bezierCurveTo(H[26],H[27],H[28],H[29],H[30],H[31])}}e.closePath()}!v&&(g||m)&&(this._setStyles(e,i,r),g&&(e.fill(f.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),m&&e.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(e,i){var r=new K(this._size).setCenter(0,0),l=this._style,f=i.stroke&&l.hasStroke()&&l.getStrokeWidth();return e&&(r=e._transformBounds(r)),f?r.expand(Ve._getStrokePadding(f,this._getStrokeMatrix(e,i))):r}},new function(){function e(r,l,f){var g=r._radius;if(!g.isZero())for(var m=r._size.divide(2),v=1;v<=4;v++){var y=new z(v>1&&v<4?-1:1,v>2?-1:1),x=y.multiply(m),M=x.subtract(y.multiply(g)),L=new K(f?x.add(y.multiply(f)):x,M);if(L.contains(l))return{point:M,quadrant:v}}}function i(r,l,f,g){var m=r.divide(l);return(!g||m.isInQuadrant(g))&&m.subtract(m.normalize()).multiply(l).divide(f).length<=1}return{_contains:function r(l){if(this._type==="rectangle"){var f=e(this,l);return f?l.subtract(f.point).divide(this._radius).getLength()<=1:r.base.call(this,l)}else return l.divide(this.size).getLength()<=.5},_hitTestSelf:function r(l,f,g,m){var v=!1,y=this._style,x=f.stroke&&y.hasStroke(),M=f.fill&&y.hasFill();if(x||M){var L=this._type,E=this._radius,k=x?y.getStrokeWidth()/2:0,U=f._tolerancePadding.add(Ve._getStrokePadding(k,!y.getStrokeScaling()&&m));if(L==="rectangle"){var N=U.multiply(2),F=e(this,l,N);if(F)v=i(l.subtract(F.point),E,U,F.quadrant);else{var A=new K(this._size).setCenter(0,0),R=A.expand(N),w=A.expand(N.negate());v=R._containsPoint(l)&&!w._containsPoint(l)}}else v=i(l,E,U)}return v?new ke(x?"stroke":"fill",this):r.base.apply(this,arguments)}}},{statics:new function(){function e(i,r,l,f,g){var m=o.create(de.prototype);return m._type=i,m._size=l,m._radius=f,m._initialize(o.getNamed(g),r),m}return{Circle:function(){var i=arguments,r=z.readNamed(i,"center"),l=o.readNamed(i,"radius");return e("circle",r,new j(l*2),l,i)},Rectangle:function(){var i=arguments,r=K.readNamed(i,"rectangle"),l=j.min(j.readNamed(i,"radius"),r.getSize(!0).divide(2));return e("rectangle",r.getCenter(!0),r.getSize(!0),l,i)},Ellipse:function(){var i=arguments,r=de._readEllipse(i),l=r.radius;return e("ellipse",r.center,l.multiply(2),l,i)},_readEllipse:function(i){var r,l;if(o.hasNamed(i,"radius"))r=z.readNamed(i,"center"),l=j.readNamed(i,"radius");else{var f=K.readNamed(i,"rectangle");r=f.getCenter(!0),l=f.getSize(!0).divide(2)}return{center:r,radius:l}}}}}),Pe=I.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(i,r){if(!this._initialize(i,r!==s&&z.read(arguments))){var l,f=typeof i,g=f==="string"?c.getElementById(i):f==="object"?i:null;if(g&&g!==I.NO_INSERT){if(g.getContext||g.naturalHeight!=null)l=g;else if(g){var m=j.read(arguments);m.isZero()||(l=pt.getCanvas(m))}}l?this.setImage(l):this.setSource(i)}this._size||(this._size=new j,this._loaded=!1)},_equals:function(e){return this.getSource()===e.getSource()},copyContent:function(e){var i=e._image,r=e._canvas;if(i)this._setImage(i);else if(r){var l=pt.getCanvas(e._size);l.getContext("2d").drawImage(r,0,0),this._setImage(l)}this._crossOrigin=e._crossOrigin},getSize:function(){var e=this._size;return new re(e?e.width:0,e?e.height:0,this,"setSize")},setSize:function(e,i){var r=j.read(arguments);if(r.equals(this._size))i&&this.clear();else if(r.width>0&&r.height>0){var l=!i&&this.getElement();this._setImage(pt.getCanvas(r)),l&&this.getContext(!0).drawImage(l,0,0,r.width,r.height)}else this._canvas&&pt.release(this._canvas),this._size=r.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(e){this.setSize(e,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(e){this.setSize(this.getWidth(),e)},getLoaded:function(){return this._loaded},isEmpty:function(){var e=this._size;return!e||e.width===0&&e.height===0},getResolution:function(){var e=this._matrix,i=new z(0,0).transform(e),r=new z(1,0).transform(e).subtract(i),l=new z(0,1).transform(e).subtract(i);return new j(72/r.getLength(),72/l.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(e){var i=this;function r(l){var f=i.getView(),g=l&&l.type||"load";f&&i.responds(g)&&(Qe=f._scope,i.emit(g,new ui(l)))}this._setImage(e),this._loaded?setTimeout(r,0):e&&ut.add(e,{load:function(l){i._setImage(e),r(l)},error:r})},_setImage:function(e){this._canvas&&pt.release(this._canvas),e&&e.getContext?(this._image=null,this._canvas=e,this._loaded=!0):(this._image=e,this._canvas=null,this._loaded=!!(e&&e.src&&e.complete)),this._size=new j(e?e.naturalWidth||e.width:0,e?e.naturalHeight||e.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var e=pt.getContext(this._size);try{this._image&&e.drawImage(this._image,0,0),this._canvas=e.canvas}catch{pt.release(e)}}return this._canvas},setCanvas:"#setImage",getContext:function(e){return this._context||(this._context=this.getCanvas().getContext("2d")),e&&(this._image=null,this._changed(1025)),this._context},setContext:function(e){this._context=e},getSource:function(){var e=this._image;return e&&e.src||this.toDataURL()},setSource:function(e){var i=new a.Image,r=this._crossOrigin;r&&(i.crossOrigin=r),e&&(i.src=e),this.setImage(i)},getCrossOrigin:function(){var e=this._image;return e&&e.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(e){this._crossOrigin=e;var i=this._image;i&&(i.crossOrigin=e)},getSmoothing:function(){return this._smoothing},setSmoothing:function(e){this._smoothing=typeof e=="string"?e:e?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var e=K.read(arguments),i=pt.getContext(e.getSize());return i.drawImage(this.getCanvas(),e.x,e.y,e.width,e.height,0,0,e.width,e.height),i.canvas},getSubRaster:function(){var e=K.read(arguments),i=new Pe(I.NO_INSERT);return i._setImage(this.getSubCanvas(e)),i.translate(e.getCenter().subtract(this.getSize().divide(2))),i._matrix.prepend(this._matrix),i.insertAbove(this),i},toDataURL:function(){var e=this._image,i=e&&e.src;if(/^data:/.test(i))return i;var r=this.getCanvas();return r?r.toDataURL.apply(r,arguments):null},drawImage:function(e){var i=z.read(arguments,1);this.getContext(!0).drawImage(e,i.x,i.y)},getAverageColor:function(e){var i,r;if(e?e instanceof et?(r=e,i=e.getBounds()):typeof e=="object"&&("width"in e?i=new K(e):"x"in e&&(i=new K(e.x-.5,e.y-.5,1,1))):i=this.getBounds(),!i)return null;var l=32,f=Math.min(i.width,l),g=Math.min(i.height,l),m=Pe._sampleContext;m?m.clearRect(0,0,l+1,l+1):m=Pe._sampleContext=pt.getContext(new j(l)),m.save();var v=new ue().scale(f/i.width,g/i.height).translate(-i.x,-i.y);v.applyToContext(m),r&&r.draw(m,new o({clip:!0,matrices:[v]})),this._matrix.applyToContext(m);var y=this.getElement(),x=this._size;y&&m.drawImage(y,-x.width/2,-x.height/2),m.restore();for(var M=m.getImageData(.5,.5,Math.ceil(f),Math.ceil(g)).data,L=[0,0,0],E=0,k=0,U=M.length;k<U;k+=4){var N=M[k+3];E+=N,N/=255,L[0]+=M[k]*N,L[1]+=M[k+1]*N,L[2]+=M[k+2]*N}for(var k=0;k<3;k++)L[k]/=E;return E?dt.read(L):null},getPixel:function(){var e=z.read(arguments),i=this.getContext().getImageData(e.x,e.y,1,1).data;return new dt("rgb",[i[0]/255,i[1]/255,i[2]/255],i[3]/255)},setPixel:function(){var e=arguments,i=z.read(e),r=dt.read(e),l=r._convert("rgb"),f=r._alpha,g=this.getContext(!0),m=g.createImageData(1,1),v=m.data;v[0]=l[0]*255,v[1]=l[1]*255,v[2]=l[2]*255,v[3]=f!=null?f*255:255,g.putImageData(m,i.x,i.y)},clear:function(){var e=this._size;this.getContext(!0).clearRect(0,0,e.width+1,e.height+1)},createImageData:function(){var e=j.read(arguments);return this.getContext().createImageData(e.width,e.height)},getImageData:function(){var e=K.read(arguments);return e.isEmpty()&&(e=new K(this._size)),this.getContext().getImageData(e.x,e.y,e.width,e.height)},putImageData:function(e){var i=z.read(arguments,1);this.getContext(!0).putImageData(e,i.x,i.y)},setImageData:function(e){this.setSize(e),this.getContext(!0).putImageData(e,0,0)},_getBounds:function(e,i){var r=new K(this._size).setCenter(0,0);return e?e._transformBounds(r):r},_hitTestSelf:function(e){if(this._contains(e)){var i=this;return new ke("pixel",i,{offset:e.add(i._size.divide(2)).round(),color:{get:function(){return i.getPixel(this.offset)}}})}},_draw:function(e,i,r){var l=this.getElement();if(l&&l.width>0&&l.height>0){e.globalAlpha=P.clamp(this._opacity,0,1),this._setStyles(e,i,r);var f=this._smoothing,g=f==="off";at.setPrefixed(e,g?"imageSmoothingEnabled":"imageSmoothingQuality",g?!1:f),e.drawImage(l,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),be=I.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(i,r){this._initialize(i,r!==s&&z.read(arguments,1))||this.setDefinition(i instanceof Ce?i:new Ce(i))},_equals:function(e){return this._definition===e._definition},copyContent:function(e){this.setDefinition(e._definition)},getDefinition:function(){return this._definition},setDefinition:function(e){this._definition=e,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(e,i){var r=this._definition._item;return r._getCachedBounds(r._matrix.prepended(e),i)},_hitTestSelf:function(e,i,r){var l=i.extend({all:!1}),f=this._definition._item._hitTest(e,l,r);return f&&(f.item=this),f},_draw:function(e,i){this._definition._item.draw(e,i)}}),Ce=o.extend({_class:"SymbolDefinition",initialize:function(i,r){this._id=D.get(),this.project=Qe.project,i&&this.setItem(i,r)},_serialize:function(e,i){return i.add(this,function(){return o.serialize([this._class,this._item],e,!1,i)})},_changed:function(e){e&8&&I._clearBoundsCache(this),e&1&&this.project._changed(e)},getItem:function(){return this._item},setItem:function(e,i){e._symbol&&(e=e.clone()),this._item&&(this._item._symbol=null),this._item=e,e.remove(),e.setSelected(!1),i||e.setPosition(new z),e._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(e){return new be(this,e)},clone:function(){return new Ce(this._item.clone(!1))},equals:function(e){return e===this||e&&this._item.equals(e._item)||!1}}),ke=o.extend({_class:"HitResult",initialize:function(i,r,l){this.type=i,this.item=r,l&&this.inject(l)},statics:{getOptions:function(e){var i=e&&o.read(e);return new o({type:null,tolerance:Qe.settings.hitTolerance,fill:!i,stroke:!i,segments:!i,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},i)}}}),we=o.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(i,r,l,f,g,m){var v=arguments.length,y,x,M,L;v>0&&(i==null||typeof i=="object"?v===1&&i&&"point"in i?(y=i.point,x=i.handleIn,M=i.handleOut,L=i.selection):(y=i,x=r,M=l,L=f):(y=[i,r],x=l!==s?[l,f]:null,M=g!==s?[g,m]:null)),new Ue(y,this,"_point"),new Ue(x,this,"_handleIn"),new Ue(M,this,"_handleOut"),L&&this.setSelection(L)},_serialize:function(e,i){var r=this._point,l=this._selection,f=l||this.hasHandles()?[r,this._handleIn,this._handleOut]:r;return l&&f.push(l),o.serialize(f,e,!0,i)},_changed:function(e){var i=this._path;if(i){var r=i._curves,l=this._index,f;r&&((!e||e===this._point||e===this._handleIn)&&(f=l>0?r[l-1]:i._closed?r[r.length-1]:null)&&f._changed(),(!e||e===this._point||e===this._handleOut)&&(f=r[l])&&f._changed()),i._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(z.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(z.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(z.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var e=this._handleIn,i=this._handleOut;return!e.isZero()&&!i.isZero()&&e.isCollinear(i)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(e){var i=this._selection,r=this._path;this._selection=e=e||0,r&&e!==i&&(r._updateSelection(this,i,e),r._changed(257))},_changeSelection:function(e,i){var r=this._selection;this.setSelection(i?r|e:r&~e)},isSelected:function(){return!!(this._selection&7)},setSelected:function(e){this._changeSelection(7,e)},getIndex:function(){return this._index!==s?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var e=this._path,i=this._index;return e?(i>0&&!e._closed&&i===e._segments.length-1&&i--,e.getCurves()[i]||null):null},getLocation:function(){var e=this.getCurve();return e?new He(e,this===e._segment1?0:1):null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},smooth:function(e,i,r){var l=e||{},f=l.type,g=l.factor,m=this.getPrevious(),v=this.getNext(),y=(m||this)._point,x=this._point,M=(v||this)._point,L=y.getDistance(x),E=x.getDistance(M);if(!f||f==="catmull-rom"){var k=g===s?.5:g,U=Math.pow(L,k),N=U*U,F=Math.pow(E,k),A=F*F;if(!i&&m){var R=2*A+3*F*U+N,w=3*F*(F+U);this.setHandleIn(w!==0?new z((A*y._x+R*x._x-N*M._x)/w-x._x,(A*y._y+R*x._y-N*M._y)/w-x._y):new z)}if(!r&&v){var R=2*N+3*U*F+A,w=3*U*(U+F);this.setHandleOut(w!==0?new z((N*M._x+R*x._x-A*y._x)/w-x._x,(N*M._y+R*x._y-A*y._y)/w-x._y):new z)}}else if(f==="geometric"){if(m&&v){var O=y.subtract(M),q=g===s?.4:g,H=q*L/(L+E);i||this.setHandleIn(O.multiply(H)),r||this.setHandleOut(O.multiply(H-q))}}else throw new Error("Smoothing method '"+f+"' not supported.")},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var e=this._path;return e&&this._index===e._segments.length-1||!1},reverse:function(){var e=this._handleIn,i=this._handleOut,r=e.clone();e.set(i),i.set(r)},reversed:function(){return new we(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new we(this._point,this._handleIn,this._handleOut)},equals:function(e){return e===this||e&&this._class===e._class&&this._point.equals(e._point)&&this._handleIn.equals(e._handleIn)&&this._handleOut.equals(e._handleOut)||!1},toString:function(){var e=["point: "+this._point];return this._handleIn.isZero()||e.push("handleIn: "+this._handleIn),this._handleOut.isZero()||e.push("handleOut: "+this._handleOut),"{ "+e.join(", ")+" }"},transform:function(e){this._transformCoordinates(e,new Array(6),!0),this._changed()},interpolate:function(e,i,r){var l=1-r,f=r,g=e._point,m=i._point,v=e._handleIn,y=i._handleIn,x=i._handleOut,M=e._handleOut;this._point._set(l*g._x+f*m._x,l*g._y+f*m._y,!0),this._handleIn._set(l*v._x+f*y._x,l*v._y+f*y._y,!0),this._handleOut._set(l*M._x+f*x._x,l*M._y+f*x._y,!0),this._changed()},_transformCoordinates:function(e,i,r){var l=this._point,f=!r||!this._handleIn.isZero()?this._handleIn:null,g=!r||!this._handleOut.isZero()?this._handleOut:null,m=l._x,v=l._y,y=2;return i[0]=m,i[1]=v,f&&(i[y++]=f._x+m,i[y++]=f._y+v),g&&(i[y++]=g._x+m,i[y++]=g._y+v),e&&(e._transformCoordinates(i,i,y/2),m=i[0],v=i[1],r?(l._x=m,l._y=v,y=2,f&&(f._x=i[y++]-m,f._y=i[y++]-v),g&&(g._x=i[y++]-m,g._y=i[y++]-v)):(f||(i[y++]=m,i[y++]=v),g||(i[y++]=m,i[y++]=v))),i}}),Ue=z.extend({initialize:function(i,r,l){var f,g,m;if(!i)f=g=0;else if((f=i[0])!==s)g=i[1];else{var v=i;(f=v.x)===s&&(v=z.read(arguments),f=v.x),g=v.y,m=v.selected}this._x=f,this._y=g,this._owner=r,r[l]=this,m&&this.setSelected(!0)},_set:function(e,i){return this._x=e,this._y=i,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){var e=P.isZero;return e(this._x)&&e(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(e){this._owner._changeSelection(this._getSelection(),e)},_getSelection:function(){var e=this._owner;return this===e._point?1:this===e._handleIn?2:this===e._handleOut?4:0}}),pe=o.extend({_class:"Curve",beans:!0,initialize:function(i,r,l,f,g,m,v,y){var x=arguments.length,M,L,E,k,U,N;x===3?(this._path=i,M=r,L=l):x?x===1?"segment1"in i?(M=new we(i.segment1),L=new we(i.segment2)):"point1"in i?(E=i.point1,U=i.handle1,N=i.handle2,k=i.point2):Array.isArray(i)&&(E=[i[0],i[1]],k=[i[6],i[7]],U=[i[2]-i[0],i[3]-i[1]],N=[i[4]-i[6],i[5]-i[7]]):x===2?(M=new we(i),L=new we(r)):x===4?(E=i,U=r,N=l,k=f):x===8&&(E=[i,r],k=[v,y],U=[l-i,f-r],N=[g-v,m-y]):(M=new we,L=new we),this._segment1=M||new we(E,null,U),this._segment2=L||new we(k,N,null)},_serialize:function(e,i){return o.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],e,!0,i)},_changed:function(){this._length=this._bounds=s},clone:function(){return new pe(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||e.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||e.push("handle2: "+this._segment2._handleIn),e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},classify:function(){return pe.classify(this.getValues())},remove:function(){var e=!1;if(this._path){var i=this._segment2,r=i._handleOut;e=i.remove(),e&&this._segment1._handleOut.set(r)}return e},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(z.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(z.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(z.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(z.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var e=this._path;return e&&this._segment1._index===e._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(e){this.getPoint1().setSelected(e),this.getHandle1().setSelected(e),this.getHandle2().setSelected(e),this.getPoint2().setSelected(e)},getValues:function(e){return pe.getValues(this._segment1,this._segment2,e)},getPoints:function(){for(var e=this.getValues(),i=[],r=0;r<8;r+=2)i.push(new z(e[r],e[r+1]));return i}},{getLength:function(){return this._length==null&&(this._length=pe.getLength(this.getValues(),0,1)),this._length},getArea:function(){return pe.getArea(this.getValues())},getLine:function(){return new fe(this._segment1._point,this._segment2._point)},getPart:function(e,i){return new pe(pe.getPart(this.getValues(),e,i))},getPartLength:function(e,i){return pe.getLength(this.getValues(),e,i)},divideAt:function(e){return this.divideAtTime(e&&e.curve===this?e.time:this.getTimeAt(e))},divideAtTime:function(e,i){var r=1e-8,l=1-r,f=null;if(e>=r&&e<=l){var g=pe.subdivide(this.getValues(),e),m=g[0],v=g[1],y=i||this.hasHandles(),x=this._segment1,M=this._segment2,L=this._path;y&&(x._handleOut._set(m[2]-m[0],m[3]-m[1]),M._handleIn._set(v[4]-v[6],v[5]-v[7]));var E=m[6],k=m[7],U=new we(new z(E,k),y&&new z(m[4]-E,m[5]-k),y&&new z(v[2]-E,v[3]-k));L?(L.insert(x._index+1,U),f=this.getNext()):(this._segment2=U,this._changed(),f=new pe(U,M))}return f},splitAt:function(e){var i=this._path;return i?i.splitAt(e):null},splitAtTime:function(e){return this.splitAt(this.getLocationAtTime(e))},divide:function(e,i){return this.divideAtTime(e===s?.5:i?e:this.getTimeAt(e))},split:function(e,i){return this.splitAtTime(e===s?.5:i?e:this.getTimeAt(e))},reversed:function(){return new pe(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(e,i,r,l){var f=e._point,g=e._handleOut,m=i._handleIn,v=i._point,y=f.x,x=f.y,M=v.x,L=v.y,E=l?[y,x,y,x,M,L,M,L]:[y,x,y+g._x,x+g._y,M+m._x,L+m._y,M,L];return r&&r._transformCoordinates(E,E,4),E},subdivide:function(e,i){var r=e[0],l=e[1],f=e[2],g=e[3],m=e[4],v=e[5],y=e[6],x=e[7];i===s&&(i=.5);var M=1-i,L=M*r+i*f,E=M*l+i*g,k=M*f+i*m,U=M*g+i*v,N=M*m+i*y,F=M*v+i*x,A=M*L+i*k,R=M*E+i*U,w=M*k+i*N,O=M*U+i*F,q=M*A+i*w,H=M*R+i*O;return[[r,l,L,E,A,R,q,H],[q,H,w,O,N,F,y,x]]},getMonoCurves:function(e,i){var r=[],l=i?0:1,f=e[l+0],g=e[l+2],m=e[l+4],v=e[l+6];if(f>=g==g>=m&&g>=m==m>=v||pe.isStraight(e))r.push(e);else{var y=3*(g-m)-f+v,x=2*(f+m)-4*g,M=g-f,L=1e-8,E=1-L,k=[],U=P.solveQuadratic(y,x,M,k,L,E);if(!U)r.push(e);else{k.sort();var N=k[0],F=pe.subdivide(e,N);r.push(F[0]),U>1&&(N=(k[1]-N)/(1-N),F=pe.subdivide(F[1],N),r.push(F[0])),r.push(F[1])}}return r},solveCubic:function(e,i,r,l,f,g){var m=e[i],v=e[i+2],y=e[i+4],x=e[i+6],M=0;if(!(m<r&&x<r&&v<r&&y<r||m>r&&x>r&&v>r&&y>r)){var L=3*(v-m),E=3*(y-v)-L,k=x-m-L-E;M=P.solveCubic(k,E,L,m-r,l,f,g)}return M},getTimeOf:function(e,i){var r=new z(e[0],e[1]),l=new z(e[6],e[7]),f=1e-12,g=1e-7,m=i.isClose(r,f)?0:i.isClose(l,f)?1:null;if(m===null)for(var v=[i.x,i.y],y=[],x=0;x<2;x++)for(var M=pe.solveCubic(e,x,v[x],y,0,1),L=0;L<M;L++){var E=y[L];if(i.isClose(pe.getPoint(e,E),g))return E}return i.isClose(r,g)?0:i.isClose(l,g)?1:null},getNearestTime:function(e,i){if(pe.isStraight(e)){var r=e[0],l=e[1],f=e[6],g=e[7],m=f-r,v=g-l,y=m*m+v*v;if(y===0)return 0;var x=((i.x-r)*m+(i.y-l)*v)/y;return x<1e-12?0:x>.999999999999?1:pe.getTimeOf(e,new z(r+x*m,l+x*v))}var M=100,L=1/0,E=0;function k(F){if(F>=0&&F<=1){var A=i.getDistance(pe.getPoint(e,F),!0);if(A<L)return L=A,E=F,!0}}for(var U=0;U<=M;U++)k(U/M);for(var N=1/(M*2);N>1e-8;)!k(E-N)&&!k(E+N)&&(N/=2);return E},getPart:function(e,i,r){var l=i>r;if(l){var f=i;i=r,r=f}return i>0&&(e=pe.subdivide(e,i)[1]),r<1&&(e=pe.subdivide(e,(r-i)/(1-i))[0]),l?[e[6],e[7],e[4],e[5],e[2],e[3],e[0],e[1]]:e},isFlatEnough:function(e,i){var r=e[0],l=e[1],f=e[2],g=e[3],m=e[4],v=e[5],y=e[6],x=e[7],M=3*f-2*r-y,L=3*g-2*l-x,E=3*m-2*y-r,k=3*v-2*x-l;return Math.max(M*M,E*E)+Math.max(L*L,k*k)<=16*i*i},getArea:function(e){var i=e[0],r=e[1],l=e[2],f=e[3],g=e[4],m=e[5],v=e[6],y=e[7];return 3*((y-r)*(l+g)-(v-i)*(f+m)+f*(i-g)-l*(r-m)+y*(g+i/3)-v*(m+r/3))/20},getBounds:function(e){for(var i=e.slice(0,2),r=i.slice(),l=[0,0],f=0;f<2;f++)pe._addBounds(e[f],e[f+2],e[f+4],e[f+6],f,0,i,r,l);return new K(i[0],i[1],r[0]-i[0],r[1]-i[1])},_addBounds:function(e,i,r,l,f,g,m,v,y){function x(q,H){var V=q-H,G=q+H;V<m[f]&&(m[f]=V),G>v[f]&&(v[f]=G)}g/=2;var M=m[f]+g,L=v[f]-g;if(e<M||i<M||r<M||l<M||e>L||i>L||r>L||l>L)if(i<e!=i<l&&r<e!=r<l)x(e,0),x(l,0);else{var E=3*(i-r)-e+l,k=2*(e+r)-4*i,U=i-e,N=P.solveQuadratic(E,k,U,y),F=1e-8,A=1-F;x(l,0);for(var R=0;R<N;R++){var w=y[R],O=1-w;F<=w&&w<=A&&x(O*O*O*e+3*O*O*w*i+3*O*w*w*r+w*w*w*l,g)}}}}},o.each(["getBounds","getStrokeBounds","getHandleBounds"],function(e){this[e]=function(){this._bounds||(this._bounds={});var i=this._bounds[e];return i||(i=this._bounds[e]=Ve[e]([this._segment1,this._segment2],!1,this._path)),i.clone()}},{}),o.each({isStraight:function(e,i,r,l){if(i.isZero()&&r.isZero())return!0;var f=l.subtract(e);if(f.isZero())return!1;if(f.isCollinear(i)&&f.isCollinear(r)){var g=new fe(e,l),m=1e-7;if(g.getDistance(e.add(i))<m&&g.getDistance(l.add(r))<m){var v=f.dot(f),y=f.dot(i)/v,x=f.dot(r)/v;return y>=0&&y<=1&&x<=0&&x>=-1}}return!1},isLinear:function(e,i,r,l){var f=l.subtract(e).divide(3);return i.equals(f)&&r.negate().equals(f)}},function(e,i){this[i]=function(r){var l=this._segment1,f=this._segment2;return e(l._point,l._handleOut,f._handleIn,f._point,r)},this.statics[i]=function(r,l){var f=r[0],g=r[1],m=r[6],v=r[7];return e(new z(f,g),new z(r[2]-f,r[3]-g),new z(r[4]-m,r[5]-v),new z(m,v),l)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(e){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(e||0)},isCollinear:function(e){return e&&this.isStraight()&&e.isStraight()&&this.getLine().isCollinear(e.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(e,i){return this.getLocationAtTime(i?e:this.getTimeAt(e))},getLocationAtTime:function(e){return e!=null&&e>=0&&e<=1?new He(this,e):null},getTimeAt:function(e,i){return pe.getTimeAt(this.getValues(),e,i)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var e=z.read(arguments);return e.isZero()?[]:pe.getTimesWithTangent(this.getValues(),e)},getOffsetAtTime:function(e){return this.getPartLength(0,e)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(z.read(arguments)))},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getTimeOf:function(){return pe.getTimeOf(this.getValues(),z.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var e=z.read(arguments),i=this.getValues(),r=pe.getNearestTime(i,e),l=pe.getPoint(i,r);return new He(this,r,l,null,e.getDistance(l))},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e&&e.getPoint()}},new function(){var e=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return o.each(e,function(i){this[i+"At"]=function(r,l){var f=this.getValues();return pe[i](f,l?r:pe.getTimeAt(f,r))},this[i+"AtTime"]=function(r){return pe[i](this.getValues(),r)}},{statics:{_evaluateMethods:e}})},new function(){function e(l){var f=l[0],g=l[1],m=l[2],v=l[3],y=l[4],x=l[5],M=l[6],L=l[7],E=9*(m-y)+3*(M-f),k=6*(f+y)-12*m,U=3*(m-f),N=9*(v-x)+3*(L-g),F=6*(g+x)-12*v,A=3*(v-g);return function(R){var w=(E*R+k)*R+U,O=(N*R+F)*R+A;return Math.sqrt(w*w+O*O)}}function i(l,f){return Math.max(2,Math.min(16,Math.ceil(Math.abs(f-l)*32)))}function r(l,f,g,m){if(f==null||f<0||f>1)return null;var v=l[0],y=l[1],x=l[2],M=l[3],L=l[4],E=l[5],k=l[6],U=l[7],N=P.isZero;N(x-v)&&N(M-y)&&(x=v,M=y),N(L-k)&&N(E-U)&&(L=k,E=U);var F=3*(x-v),A=3*(L-x)-F,R=k-v-F-A,w=3*(M-y),O=3*(E-M)-w,q=U-y-w-O,H,V;if(g===0)H=f===0?v:f===1?k:((R*f+A)*f+F)*f+v,V=f===0?y:f===1?U:((q*f+O)*f+w)*f+y;else{var G=1e-8,$=1-G;if(f<G?(H=F,V=w):f>$?(H=3*(k-L),V=3*(U-E)):(H=(3*R*f+2*A)*f+F,V=(3*q*f+2*O)*f+w),m){H===0&&V===0&&(f<G||f>$)&&(H=L-x,V=E-M);var X=Math.sqrt(H*H+V*V);X&&(H/=X,V/=X)}if(g===3){var L=6*R*f+2*A,E=6*q*f+2*O,te=Math.pow(H*H+V*V,3/2);H=te!==0?(H*E-V*L)/te:0,V=0}}return g===2?new z(V,-H):new z(H,V)}return{statics:{classify:function(l){var f=l[0],g=l[1],m=l[2],v=l[3],y=l[4],x=l[5],M=l[6],L=l[7],E=f*(L-x)+g*(y-M)+M*x-L*y,k=m*(g-L)+v*(M-f)+f*L-g*M,U=y*(v-g)+x*(f-m)+m*g-v*f,N=3*U,F=N-k,A=F-k+E,R=Math.sqrt(A*A+F*F+N*N),w=R!==0?1/R:0,O=P.isZero,q="serpentine";A*=w,F*=w,N*=w;function H(X,te,W){var ee=te!==s,ie=ee&&te>0&&te<1,se=ee&&W>0&&W<1;return ee&&(!(ie||se)||X==="loop"&&!(ie&&se))&&(X="arch",ie=se=!1),{type:X,roots:ie||se?ie&&se?te<W?[te,W]:[W,te]:[ie?te:W]:null}}if(O(A))return O(F)?H(O(N)?"line":"quadratic"):H(q,N/(3*F));var V=3*F*F-4*A*N;if(O(V))return H("cusp",F/(2*A));var G=V>0?Math.sqrt(V/3):Math.sqrt(-V),$=2*A;return H(V>0?q:"loop",(F+G)/$,(F-G)/$)},getLength:function(l,f,g,m){if(f===s&&(f=0),g===s&&(g=1),pe.isStraight(l)){var v=l;g<1&&(v=pe.subdivide(v,g)[0],f/=g),f>0&&(v=pe.subdivide(v,f)[1]);var y=v[6]-v[0],x=v[7]-v[1];return Math.sqrt(y*y+x*x)}return P.integrate(m||e(l),f,g,i(f,g))},getTimeAt:function(l,f,g){if(g===s&&(g=f<0?1:0),f===0)return g;var m=Math.abs,v=1e-12,y=f>0,x=y?g:0,M=y?1:g,L=e(l),E=pe.getLength(l,x,M,L),k=m(f)-E;if(m(k)<v)return y?M:x;if(k>v)return null;var U=f/E,N=0;function F(A){return N+=P.integrate(L,g,A,i(g,A)),g=A,N-f}return P.findRoot(F,L,g+U,x,M,32,1e-12)},getPoint:function(l,f){return r(l,f,0,!1)},getTangent:function(l,f){return r(l,f,1,!0)},getWeightedTangent:function(l,f){return r(l,f,1,!1)},getNormal:function(l,f){return r(l,f,2,!0)},getWeightedNormal:function(l,f){return r(l,f,2,!1)},getCurvature:function(l,f){return r(l,f,3,!1).x},getPeaks:function(l){var f=l[0],g=l[1],m=l[2],v=l[3],y=l[4],x=l[5],M=l[6],L=l[7],E=-f+3*m-3*y+M,k=3*f-6*m+3*y,U=-3*f+3*m,N=-g+3*v-3*x+L,F=3*g-6*v+3*x,A=-3*g+3*v,R=1e-8,w=1-R,O=[];return P.solveCubic(9*(E*E+N*N),9*(E*k+F*N),2*(k*k+F*F)+3*(U*E+A*N),U*k+F*A,O,R,w),O.sort()}}}},new function(){function e(k,U,N,F,A,R,w){var O=!w&&N.getPrevious()===A,q=!w&&N!==A&&N.getNext()===A,H=1e-8,V=1-H;if(F!==null&&F>=(O?H:0)&&F<=(q?V:1)&&R!==null&&R>=(q?H:0)&&R<=(O?V:1)){var G=new He(N,F,null,w),$=new He(A,R,null,w);G._intersection=$,$._intersection=G,(!U||U(G))&&He.insert(k,G,!0)}}function i(k,U,N,F,A,R,w,O,q,H,V,G,$){if(++q>=4096||++O>=40)return q;var X=1e-9,te=U[0],W=U[1],ee=U[6],ie=U[7],se=fe.getSignedDistance,oe=se(te,W,ee,ie,U[2],U[3]),ge=se(te,W,ee,ie,U[4],U[5]),Ie=oe*ge>0?3/4:4/9,Ae=Ie*Math.min(0,oe,ge),ze=Ie*Math.max(0,oe,ge),Oe=se(te,W,ee,ie,k[0],k[1]),ye=se(te,W,ee,ie,k[2],k[3]),xe=se(te,W,ee,ie,k[4],k[5]),Le=se(te,W,ee,ie,k[6],k[7]),De=r(Oe,ye,xe,Le),Re=De[0],qe=De[1],Be,Ze;if(oe===0&&ge===0&&Oe===0&&ye===0&&xe===0&&Le===0||(Be=l(Re,qe,Ae,ze))==null||(Ze=l(Re.reverse(),qe.reverse(),Ae,ze))==null)return q;var Ye=H+(V-H)*Be,Ge=H+(V-H)*Ze;if(Math.max($-G,Ge-Ye)<X){var _t=(Ye+Ge)/2,gt=(G+$)/2;e(A,R,w?F:N,w?gt:_t,w?N:F,w?_t:gt)}else{k=pe.getPart(k,Be,Ze);var xt=$-G;if(Ze-Be>.8)if(Ge-Ye>xt){var mt=pe.subdivide(k,.5),_t=(Ye+Ge)/2;q=i(U,mt[0],F,N,A,R,!w,O,q,G,$,Ye,_t),q=i(U,mt[1],F,N,A,R,!w,O,q,G,$,_t,Ge)}else{var mt=pe.subdivide(U,.5),gt=(G+$)/2;q=i(mt[0],k,F,N,A,R,!w,O,q,G,gt,Ye,Ge),q=i(mt[1],k,F,N,A,R,!w,O,q,gt,$,Ye,Ge)}else xt===0||xt>=X?q=i(U,k,F,N,A,R,!w,O,q,G,$,Ye,Ge):q=i(k,U,N,F,A,R,w,O,q,Ye,Ge,G,$)}return q}function r(k,U,N,F){var A=[0,k],R=[1/3,U],w=[2/3,N],O=[1,F],q=U-(2*k+F)/3,H=N-(k+2*F)/3,V;if(q*H<0)V=[[A,R,O],[A,w,O]];else{var G=q/H;V=[G>=2?[A,R,O]:G<=.5?[A,w,O]:[A,R,w,O],[A,O]]}return(q||H)<0?V.reverse():V}function l(k,U,N,F){return k[0][1]<N?f(k,!0,N):U[0][1]>F?f(U,!1,F):k[0][0]}function f(k,U,N){for(var F=k[0][0],A=k[0][1],R=1,w=k.length;R<w;R++){var O=k[R][0],q=k[R][1];if(U?q>=N:q<=N)return q===N?O:F+(N-A)*(O-F)/(q-A);F=O,A=q}return null}function g(k,U,N,F,A){var R=P.isZero;if(R(F)&&R(A)){var w=pe.getTimeOf(k,new z(U,N));return w===null?[]:[w]}for(var O=Math.atan2(-A,F),q=Math.sin(O),H=Math.cos(O),V=[],G=[],$=0;$<8;$+=2){var X=k[$]-U,te=k[$+1]-N;V.push(X*H-te*q,X*q+te*H)}return pe.solveCubic(V,1,0,G,0,1),G}function m(k,U,N,F,A,R,w){for(var O=U[0],q=U[1],H=U[6],V=U[7],G=g(k,O,q,H-O,V-q),$=0,X=G.length;$<X;$++){var te=G[$],W=pe.getPoint(k,te),ee=pe.getTimeOf(U,W);ee!==null&&e(A,R,w?F:N,w?ee:te,w?N:F,w?te:ee)}}function v(k,U,N,F,A,R){var w=fe.intersect(k[0],k[1],k[6],k[7],U[0],U[1],U[6],U[7]);w&&e(A,R,N,pe.getTimeOf(k,w),F,pe.getTimeOf(U,w))}function y(k,U,N,F,A,R){var w=1e-12,O=Math.min,q=Math.max;if(q(k[0],k[2],k[4],k[6])+w>O(U[0],U[2],U[4],U[6])&&O(k[0],k[2],k[4],k[6])-w<q(U[0],U[2],U[4],U[6])&&q(k[1],k[3],k[5],k[7])+w>O(U[1],U[3],U[5],U[7])&&O(k[1],k[3],k[5],k[7])-w<q(U[1],U[3],U[5],U[7])){var H=L(k,U);if(H)for(var V=0;V<2;V++){var G=H[V];e(A,R,N,G[0],F,G[1],!0)}else{var $=pe.isStraight(k),X=pe.isStraight(U),te=$&&X,W=$&&!X,ee=A.length;if((te?v:$||X?m:i)(W?U:k,W?k:U,W?F:N,W?N:F,A,R,W,0,0,0,1,0,1),!te||A.length===ee)for(var V=0;V<4;V++){var ie=V>>1,se=V&1,oe=ie*6,ge=se*6,Ie=new z(k[oe],k[oe+1]),Ae=new z(U[ge],U[ge+1]);Ie.isClose(Ae,w)&&e(A,R,N,ie,F,se)}}}return A}function x(k,U,N,F){var A=pe.classify(k);if(A.type==="loop"){var R=A.roots;e(N,F,U,R[0],U,R[1])}return N}function M(k,U,N,F,A,R){var w=1e-7,O=!U;O&&(U=k);for(var q=k.length,H=U.length,V=new Array(q),G=O?V:new Array(H),$=[],X=0;X<q;X++)V[X]=k[X].getValues(F);if(!O)for(var X=0;X<H;X++)G[X]=U[X].getValues(A);for(var te=C.findCurveBoundsCollisions(V,G,w),W=0;W<q;W++){var ee=k[W],ie=V[W];O&&x(ie,ee,$,N);var se=te[W];if(se)for(var oe=0;oe<se.length;oe++){if(R&&$.length)return $;var ge=se[oe];if(!O||ge>W){var Ie=U[ge],Ae=G[ge];y(ie,Ae,ee,Ie,$,N)}}}return $}function L(k,U){function N(Le){var De=Le[6]-Le[0],Re=Le[7]-Le[1];return De*De+Re*Re}var F=Math.abs,A=fe.getDistance,R=1e-8,w=1e-7,O=pe.isStraight(k),q=pe.isStraight(U),H=O&&q,V=N(k)<N(U),G=V?U:k,$=V?k:U,X=G[0],te=G[1],W=G[6]-X,ee=G[7]-te;if(A(X,te,W,ee,$[0],$[1],!0)<w&&A(X,te,W,ee,$[6],$[7],!0)<w)!H&&A(X,te,W,ee,G[2],G[3],!0)<w&&A(X,te,W,ee,G[4],G[5],!0)<w&&A(X,te,W,ee,$[2],$[3],!0)<w&&A(X,te,W,ee,$[4],$[5],!0)<w&&(O=q=H=!0);else if(H)return null;if(O^q)return null;for(var ie=[k,U],se=[],oe=0;oe<4&&se.length<2;oe++){var ge=oe&1,Ie=ge^1,Ae=oe>>1,ze=pe.getTimeOf(ie[ge],new z(ie[Ie][Ae?6:0],ie[Ie][Ae?7:1]));if(ze!=null){var Oe=ge?[Ae,ze]:[ze,Ae];(!se.length||F(Oe[0]-se[0][0])>R&&F(Oe[1]-se[0][1])>R)&&se.push(Oe)}if(oe>2&&!se.length)break}if(se.length!==2)se=null;else if(!H){var ye=pe.getPart(k,se[0][0],se[1][0]),xe=pe.getPart(U,se[0][1],se[1][1]);(F(xe[2]-ye[2])>w||F(xe[3]-ye[3])>w||F(xe[4]-ye[4])>w||F(xe[5]-ye[5])>w)&&(se=null)}return se}function E(k,U){var N=k[0],F=k[1],A=k[2],R=k[3],w=k[4],O=k[5],q=k[6],H=k[7],V=U.normalize(),G=V.x,$=V.y,X=3*q-9*w+9*A-3*N,te=3*H-9*O+9*R-3*F,W=6*w-12*A+6*N,ee=6*O-12*R+6*F,ie=3*A-3*N,se=3*R-3*F,oe=2*X*$-2*te*G,ge=[];if(Math.abs(oe)<P.CURVETIME_EPSILON){var Ie=X*se-te*ie,oe=X*ee-te*W;if(oe!=0){var Ae=-Ie/oe;Ae>=0&&Ae<=1&&ge.push(Ae)}}else{var ze=(W*W-4*X*ie)*$*$+(-2*W*ee+4*te*ie+4*X*se)*G*$+(ee*ee-4*te*se)*G*G,Oe=W*$-ee*G;if(ze>=0&&oe!=0){var ye=Math.sqrt(ze),xe=-(Oe+ye)/oe,Le=(-Oe+ye)/oe;xe>=0&&xe<=1&&ge.push(xe),Le>=0&&Le<=1&&ge.push(Le)}}return ge}return{getIntersections:function(k){var U=this.getValues(),N=k&&k!==this&&k.getValues();return N?y(U,N,this,k,[]):x(U,this,[])},statics:{getOverlaps:L,getIntersections:M,getCurveLineIntersections:g,getTimesWithTangent:E}}}),He=o.extend({_class:"CurveLocation",initialize:function(i,r,l,f,g){if(r>=.99999999){var m=i.getNext();m&&(r=0,i=m)}this._setCurve(i),this._time=r,this._point=l||i.getPointAtTime(r),this._overlap=f,this._distance=g,this._intersection=this._next=this._previous=null},_setPath:function(e){this._path=e,this._version=e?e._version:0},_setCurve:function(e){this._setPath(e._path),this._curve=e,this._segment=null,this._segment1=e._segment1,this._segment2=e._segment2},_setSegment:function(e){var i=e.getCurve();i?this._setCurve(i):(this._setPath(e._path),this._segment1=e,this._segment2=null),this._segment=e,this._time=e===this._segment1?0:1,this._point=e._point.clone()},getSegment:function(){var e=this._segment;if(!e){var i=this.getCurve(),r=this.getTime();r===0?e=i._segment1:r===1?e=i._segment2:r!=null&&(e=i.getPartLength(0,r)<i.getPartLength(r,1)?i._segment1:i._segment2),this._segment=e}return e},getCurve:function(){var e=this._path,i=this;e&&e._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function r(l){var f=l&&l.getCurve();if(f&&(i._time=f.getTimeOf(i._point))!=null)return i._setCurve(f),f}return this._curve||r(this._segment)||r(this._segment1)||r(this._segment2.getPrevious())},getPath:function(){var e=this.getCurve();return e&&e._path},getIndex:function(){var e=this.getCurve();return e&&e.getIndex()},getTime:function(){var e=this.getCurve(),i=this._time;return e&&i==null?this._time=e.getTimeOf(this._point):i},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var e=this._offset;if(e==null){e=0;var i=this.getPath(),r=this.getIndex();if(i&&r!=null)for(var l=i.getCurves(),f=0;f<r;f++)e+=l[f].getLength();this._offset=e+=this.getCurveOffset()}return e},getCurveOffset:function(){var e=this._curveOffset;if(e==null){var i=this.getCurve(),r=this.getTime();this._curveOffset=e=r!=null&&i&&i.getPartLength(0,r)}return e},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var e=this.getCurve(),i=e&&e.divideAtTime(this.getTime());return i&&this._setSegment(i._segment1),i},split:function(){var e=this.getCurve(),i=e._path,r=e&&e.splitAtTime(this.getTime());return r&&this._setSegment(i.getLastSegment()),r},equals:function(e,i){var r=this===e;if(!r&&e instanceof He){var l=this.getCurve(),f=e.getCurve(),g=l._path,m=f._path;if(g===m){var v=Math.abs,y=1e-7,x=v(this.getOffset()-e.getOffset()),M=!i&&this._intersection,L=!i&&e._intersection;r=(x<y||g&&v(g.getLength()-x)<y)&&(!M&&!L||M&&L&&M.equals(L,!0))}}return r},toString:function(){var e=[],i=this.getPoint(),r=S.instance;i&&e.push("point: "+i);var l=this.getIndex();l!=null&&e.push("index: "+l);var f=this.getTime();return f!=null&&e.push("time: "+r.number(f)),this._distance!=null&&e.push("distance: "+r.number(this._distance)),"{ "+e.join(", ")+" }"},isTouching:function(){var e=this._intersection;if(e&&this.getTangent().isCollinear(e.getTangent())){var i=this.getCurve(),r=e.getCurve();return!(i.isStraight()&&r.isStraight()&&i.getLine().intersect(r.getLine()))}return!1},isCrossing:function(){var e=this._intersection;if(!e)return!1;var i=this.getTime(),r=e.getTime(),l=1e-8,f=1-l,g=i>=l&&i<=f,m=r>=l&&r<=f;if(g&&m)return!this.isTouching();var v=this.getCurve(),y=v&&i<l?v.getPrevious():v,x=e.getCurve(),M=x&&r<l?x.getPrevious():x;if(i>f&&(v=v.getNext()),r>f&&(x=x.getNext()),!y||!v||!M||!x)return!1;var L=[];function E(G,$){var X=G.getValues(),te=pe.classify(X).roots||pe.getPeaks(X),W=te.length,ee=pe.getLength(X,$&&W?te[W-1]:0,!$&&W?te[0]:1);L.push(W?ee:ee/32)}function k(G,$,X){return $<X?G>$&&G<X:G>$||G<X}g||(E(y,!0),E(v,!1)),m||(E(M,!0),E(x,!1));var U=this.getPoint(),N=Math.min.apply(Math,L),F=g?v.getTangentAtTime(i):v.getPointAt(N).subtract(U),A=g?F.negate():y.getPointAt(-N).subtract(U),R=m?x.getTangentAtTime(r):x.getPointAt(N).subtract(U),w=m?R.negate():M.getPointAt(-N).subtract(U),O=A.getAngle(),q=F.getAngle(),H=w.getAngle(),V=R.getAngle();return!!(g?k(O,H,V)^k(q,H,V)&&k(O,V,H)^k(q,V,H):k(H,O,q)^k(V,O,q)&&k(H,q,O)^k(V,q,O))},hasOverlap:function(){return!!this._overlap}},o.each(pe._evaluateMethods,function(e){var i=e+"At";this[e]=function(){var r=this.getCurve(),l=this.getTime();return l!=null&&r&&r[i](l,!0)}},{preserve:!0}),new function(){function e(i,r,l){var f=i.length,g=0,m=f-1;function v(U,N){for(var F=U+N;F>=-1&&F<=f;F+=N){var A=i[(F%f+f)%f];if(!r.getPoint().isClose(A.getPoint(),1e-7))break;if(r.equals(A))return A}return null}for(;g<=m;){var y=g+m>>>1,x=i[y],M;if(l&&(M=r.equals(x)?x:v(y,-1)||v(y,1)))return r._overlap&&(M._overlap=M._intersection._overlap=!0),M;var L=r.getPath(),E=x.getPath(),k=L!==E?L._id-E._id:r.getIndex()+r.getTime()-(x.getIndex()+x.getTime());k<0?m=y-1:g=y+1}return i.splice(g,0,r),r}return{statics:{insert:e,expand:function(i){for(var r=i.slice(),l=i.length-1;l>=0;l--)e(r,i[l]._intersection,!1);return r}}}}),et=I.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(e){var i,r,l;if(o.isPlainObject(e)?(r=e.segments,i=e.pathData):Array.isArray(e)?r=e:typeof e=="string"&&(i=e),r){var f=r[0];l=f&&Array.isArray(f[0])}else i&&(l=(i.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(i));var g=l?it:Ve;return new g(e)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(e){this.isClockwise()!=(e=!!e)&&this.reverse()},setPathData:function(e){var i=e&&e.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),r,l=!1,f,g,m=new z,v=new z;function y(w,O){var q=+r[w];return l&&(q+=m[O]),q}function x(w){return new z(y(w,"x"),y(w+1,"y"))}this.clear();for(var M=0,L=i&&i.length;M<L;M++){var E=i[M],k=E[0],U=k.toLowerCase();r=E.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var N=r&&r.length;switch(l=k===U,f==="z"&&!/[mz]/.test(U)&&this.moveTo(m),U){case"m":case"l":for(var F=U==="m",A=0;A<N;A+=2)this[F?"moveTo":"lineTo"](m=x(A)),F&&(v=m,F=!1);g=m;break;case"h":case"v":var R=U==="h"?"x":"y";m=m.clone();for(var A=0;A<N;A++)m[R]=y(A,R),this.lineTo(m);g=m;break;case"c":for(var A=0;A<N;A+=6)this.cubicCurveTo(x(A),g=x(A+2),m=x(A+4));break;case"s":for(var A=0;A<N;A+=4)this.cubicCurveTo(/[cs]/.test(f)?m.multiply(2).subtract(g):m,g=x(A),m=x(A+2)),f=U;break;case"q":for(var A=0;A<N;A+=4)this.quadraticCurveTo(g=x(A),m=x(A+2));break;case"t":for(var A=0;A<N;A+=2)this.quadraticCurveTo(g=/[qt]/.test(f)?m.multiply(2).subtract(g):m,m=x(A)),f=U;break;case"a":for(var A=0;A<N;A+=7)this.arcTo(m=x(A+5),new j(+r[A],+r[A+1]),+r[A+2],+r[A+4],+r[A+3]);break;case"z":this.closePath(1e-12),m=v;break}f=U}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(e){var i=e.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(e):{};return i.onPath||!!(this.getFillRule()==="evenodd"?i.windingL&1||i.windingR&1:i.winding)},getIntersections:function(e,i,r,l){var f=this===e||!e,g=this._matrix._orNullIfIdentity(),m=f?g:(r||e._matrix)._orNullIfIdentity();return f||this.getBounds(g).intersects(e.getBounds(m),1e-12)?pe.getIntersections(this.getCurves(),!f&&e.getCurves(),i,g,m,l):[]},getCrossings:function(e){return this.getIntersections(e,function(i){return i.isCrossing()})},getNearestLocation:function(){for(var e=z.read(arguments),i=this.getCurves(),r=1/0,l=null,f=0,g=i.length;f<g;f++){var m=i[f].getNearestLocation(e);m._distance<r&&(r=m._distance,l=m)}return l},getNearestPoint:function(){var e=this.getNearestLocation.apply(this,arguments);return e&&e.getPoint()},interpolate:function(e,i,r){var l=!this._children,f=l?"_segments":"_children",g=e[f],m=i[f],v=this[f];if(!g||!m||g.length!==m.length)throw new Error("Invalid operands in interpolate() call: "+e+", "+i);var y=v.length,x=m.length;if(y<x)for(var M=l?we:Ve,L=y;L<x;L++)this.add(new M);else y>x&&this[l?"removeSegments":"removeChildren"](x,y);for(var L=0;L<x;L++)v[L].interpolate(g[L],m[L],r);l&&(this.setClosed(e._closed),this._changed(9))},compare:function(e){var i=!1;if(e){var r=this._children||[this],l=e._children?e._children.slice():[e],f=r.length,g=l.length,m=[],v=0;i=!0;for(var y=C.findItemBoundsCollisions(r,l,P.GEOMETRIC_EPSILON),x=f-1;x>=0&&i;x--){var M=r[x];i=!1;var L=y[x];if(L)for(var E=L.length-1;E>=0&&!i;E--)M.compare(l[L[E]])&&(m[L[E]]||(m[L[E]]=!0,v++),i=!0)}i=i&&v===g}return i}}),Ve=et.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(i){this._closed=!1,this._segments=[],this._version=0;var r=arguments,l=Array.isArray(i)?typeof i[0]=="object"?i:r:i&&i.size===s&&(i.x!==s||i.point!==s)?r:null;l&&l.length>0?this.setSegments(l):(this._curves=s,this._segmentSelection=0,!l&&typeof i=="string"&&(this.setPathData(i),i=null)),this._initialize(!l&&i)},_equals:function(e){return this._closed===e._closed&&o.equals(this._segments,e._segments)},copyContent:function(e){this.setSegments(e._segments),this._closed=e._closed},_changed:function e(i){if(e.base.call(this,i),i&8){if(this._length=this._area=s,i&32)this._version++;else if(this._curves)for(var r=0,l=this._curves.length;r<l;r++)this._curves[r]._changed()}else i&64&&(this._bounds=s)},getStyle:function(){var e=this._parent;return(e instanceof it?e:this)._style},getSegments:function(){return this._segments},setSegments:function(e){var i=this.isFullySelected(),r=e&&e.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=s,r){var l=e[r-1];typeof l=="boolean"&&(this.setClosed(l),r--),this._add(we.readList(e,0,{},r))}i&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var e=this._curves,i=this._segments;if(!e){var r=this._countCurves();e=this._curves=new Array(r);for(var l=0;l<r;l++)e[l]=new pe(this,i[l],i[l+1]||i[0])}return e},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},isClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){if(this._closed=e,this._curves){var i=this._curves.length=this._countCurves();e&&(this._curves[i-1]=new pe(this,this._segments[i-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(e,i){var r=this._segments,l=r.length,f=new S(i),g=new Array(6),m=!0,v,y,x,M,L,E,k,U,N=[];function F(R,w){if(R._transformCoordinates(e,g),v=g[0],y=g[1],m)N.push("M"+f.pair(v,y)),m=!1;else if(L=g[2],E=g[3],L===v&&E===y&&k===x&&U===M){if(!w){var O=v-x,q=y-M;N.push(O===0?"v"+f.number(q):q===0?"h"+f.number(O):"l"+f.pair(O,q))}}else N.push("c"+f.pair(k-x,U-M)+" "+f.pair(L-x,E-M)+" "+f.pair(v-x,y-M));x=v,M=y,k=g[4],U=g[5]}if(!l)return"";for(var A=0;A<l;A++)F(r[A]);return this._closed&&l>0&&(F(r[0],!0),N.push("z")),N.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(e){for(var i=this._segments,r=new Array(6),l=0,f=i.length;l<f;l++)i[l]._transformCoordinates(e,r,!0);return!0},_add:function(e,m){for(var r=this._segments,l=this._curves,f=e.length,g=m==null,m=g?r.length:m,v=0;v<f;v++){var y=e[v];y._path&&(y=e[v]=y.clone()),y._path=this,y._index=m+v,y._selection&&this._updateSelection(y,0,y._selection)}if(g)o.push(r,e);else{r.splice.apply(r,[m,0].concat(e));for(var v=m+f,x=r.length;v<x;v++)r[v]._index=v}if(l){var M=this._countCurves(),L=m>0&&m+f-1===M?m-1:m,E=L,k=Math.min(L+f,M);e._curves&&(l.splice.apply(l,[L,0].concat(e._curves)),E+=e._curves.length);for(var v=E;v<k;v++)l.splice(v,0,new pe(this,null,null));this._adjustCurves(L,k)}return this._changed(41),e},_adjustCurves:function(e,i){for(var r=this._segments,l=this._curves,f,g=e;g<i;g++)f=l[g],f._path=this,f._segment1=r[g],f._segment2=r[g+1]||r[0],f._changed();(f=l[this._closed&&!e?r.length-1:e-1])&&(f._segment2=r[e]||r[0],f._changed()),(f=l[i])&&(f._segment1=r[i],f._changed())},_countCurves:function(){var e=this._segments.length;return!this._closed&&e>0?e-1:e},add:function(e){var i=arguments;return i.length>1&&typeof e!="number"?this._add(we.readList(i)):this._add([we.read(i)])[0]},insert:function(e,i){var r=arguments;return r.length>2&&typeof i!="number"?this._add(we.readList(r,1),e):this._add([we.read(r,1)],e)[0]},addSegment:function(){return this._add([we.read(arguments)])[0]},insertSegment:function(e){return this._add([we.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(we.readList(e))},insertSegments:function(e,i){return this._add(we.readList(i),e)},removeSegment:function(e){return this.removeSegments(e,e+1)[0]||null},removeSegments:function(e,i,r){e=e||0,i=o.pick(i,this._segments.length);var l=this._segments,f=this._curves,g=l.length,m=l.splice(e,i-e),v=m.length;if(!v)return m;for(var y=0;y<v;y++){var x=m[y];x._selection&&this._updateSelection(x,x._selection,0),x._index=x._path=null}for(var y=e,M=l.length;y<M;y++)l[y]._index=y;if(f){for(var L=e>0&&i===g+(this._closed?1:0)?e-1:e,f=f.splice(L,v),y=f.length-1;y>=0;y--)f[y]._path=null;r&&(m._curves=f.slice(1)),this._adjustCurves(L,L)}return this._changed(41),m},clear:"#removeSegments",hasHandles:function(){for(var e=this._segments,i=0,r=e.length;i<r;i++)if(e[i].hasHandles())return!0;return!1},clearHandles:function(){for(var e=this._segments,i=0,r=e.length;i<r;i++)e[i].clearHandles()},getLength:function(){if(this._length==null){for(var e=this.getCurves(),i=0,r=0,l=e.length;r<l;r++)i+=e[r].getLength();this._length=i}return this._length},getArea:function(){var e=this._area;if(e==null){var i=this._segments,r=this._closed;e=0;for(var l=0,f=i.length;l<f;l++){var g=l+1===f;e+=pe.getArea(pe.getValues(i[l],i[g?0:l+1],null,g&&!r))}this._area=e}return e},isFullySelected:function(){var e=this._segments.length;return this.isSelected()&&e>0&&this._segmentSelection===e*7},setFullySelected:function(e){e&&this._selectSegments(!0),this.setSelected(e)},setSelection:function e(i){i&1||this._selectSegments(!1),e.base.call(this,i)},_selectSegments:function(e){var i=this._segments,r=i.length,l=e?7:0;this._segmentSelection=l*r;for(var f=0;f<r;f++)i[f]._selection=l},_updateSelection:function(e,i,r){e._selection=r;var l=this._segmentSelection+=r-i;l>0&&this.setSelected(!0)},divideAt:function(e){var i=this.getLocationAt(e),r;return i&&(r=i.getCurve().divideAt(i.getCurveOffset()))?r._segment1:null},splitAt:function(e){var i=this.getLocationAt(e),r=i&&i.index,l=i&&i.time,f=1e-8,g=1-f;l>g&&(r++,l=0);var m=this.getCurves();if(r>=0&&r<m.length){l>=f&&m[r++].divideAtTime(l);var v=this.removeSegments(r,this._segments.length,!0),y;return this._closed?(this.setClosed(!1),y=this):(y=new Ve(I.NO_INSERT),y.insertAbove(this),y.copyAttributes(this)),y._add(v,0),this.addSegment(v[0]),y}return null},split:function(e,i){var r,l=i===s?e:(r=this.getCurves()[e])&&r.getLocationAtTime(i);return l!=null?this.splitAt(l):null},join:function(e,i){var r=i||0;if(e&&e!==this){var l=e._segments,f=this.getLastSegment(),g=e.getLastSegment();if(!g)return this;f&&f._point.isClose(g._point,r)&&e.reverse();var m=e.getFirstSegment();if(f&&f._point.isClose(m._point,r))f.setHandleOut(m._handleOut),this._add(l.slice(1));else{var v=this.getFirstSegment();v&&v._point.isClose(m._point,r)&&e.reverse(),g=e.getLastSegment(),v&&v._point.isClose(g._point,r)?(v.setHandleIn(g._handleIn),this._add(l.slice(0,l.length-1),0)):this._add(l.slice())}e._closed&&this._add([l[0]]),e.remove()}var y=this.getFirstSegment(),x=this.getLastSegment();return y!==x&&y._point.isClose(x._point,r)&&(y.setHandleIn(x._handleIn),x.remove(),this.setClosed(!0)),this},reduce:function(e){for(var i=this.getCurves(),r=e&&e.simplify,l=r?1e-7:0,f=i.length-1;f>=0;f--){var g=i[f];!g.hasHandles()&&(!g.hasLength(l)||r&&g.isCollinear(g.getNext()))&&g.remove()}return this},reverse:function(){this._segments.reverse();for(var e=0,i=this._segments.length;e<i;e++){var r=this._segments[e],l=r._handleIn;r._handleIn=r._handleOut,r._handleOut=l,r._index=e}this._curves=null,this._changed(9)},flatten:function(e){for(var i=new Lt(this,e||.25,256,!0),r=i.parts,l=r.length,f=[],g=0;g<l;g++)f.push(new we(r[g].curve.slice(0,2)));!this._closed&&l>0&&f.push(new we(r[l-1].curve.slice(6))),this.setSegments(f)},simplify:function(e){var i=new It(this).fit(e||2.5);return i&&this.setSegments(i),!!i},smooth:function(e){var i=this,r=e||{},l=r.type||"asymmetric",f=this._segments,g=f.length,m=this._closed;function v(Re,qe){var Be=Re&&Re.index;if(Be!=null){var Ze=Re.path;if(Ze&&Ze!==i)throw new Error(Re._class+" "+Be+" of "+Ze+" is not part of "+i);qe&&Re instanceof pe&&Be++}else Be=typeof Re=="number"?Re:qe;return Math.min(Be<0&&m?Be%g:Be<0?Be+g:Be,g-1)}var y=m&&r.from===s&&r.to===s,x=v(r.from,0),M=v(r.to,g-1);if(x>M)if(m)x-=g;else{var L=x;x=M,M=L}if(/^(?:asymmetric|continuous)$/.test(l)){var E=l==="asymmetric",k=Math.min,U=M-x+1,N=U-1,F=y?k(U,4):1,A=F,R=F,w=[];if(m||(A=k(1,x),R=k(1,g-M-1)),N+=A+R,N<=1)return;for(var O=0,q=x-A;O<=N;O++,q++)w[O]=f[(q<0?q+g:q)%g]._point;for(var H=w[0]._x+2*w[1]._x,V=w[0]._y+2*w[1]._y,G=2,$=N-1,X=[H],te=[V],W=[G],ee=[],ie=[],O=1;O<N;O++){var se=O<$,oe=se||E?1:2,ge=se?4:E?2:7,Ie=se?4:E?3:8,Ae=se?2:E?0:1,ze=oe/G;G=W[O]=ge-ze,H=X[O]=Ie*w[O]._x+Ae*w[O+1]._x-ze*H,V=te[O]=Ie*w[O]._y+Ae*w[O+1]._y-ze*V}ee[$]=X[$]/W[$],ie[$]=te[$]/W[$];for(var O=N-2;O>=0;O--)ee[O]=(X[O]-ee[O+1])/W[O],ie[O]=(te[O]-ie[O+1])/W[O];ee[N]=(3*w[N]._x-ee[$])/2,ie[N]=(3*w[N]._y-ie[$])/2;for(var O=A,Oe=N-R,q=x;O<=Oe;O++,q++){var ye=f[q<0?q+g:q],xe=ye._point,Le=ee[O]-xe._x,De=ie[O]-xe._y;(y||O<Oe)&&ye.setHandleOut(Le,De),(y||O>A)&&ye.setHandleIn(-Le,-De)}}else for(var O=x;O<=M;O++)f[O<0?O+g:O].smooth(r,!y&&O===x,!y&&O===M)},toShape:function(e){if(!this._closed)return null;var i=this._segments,r,l,f,g;function m(E,k){var U=i[E],N=U.getNext(),F=i[k],A=F.getNext();return U._handleOut.isZero()&&N._handleIn.isZero()&&F._handleOut.isZero()&&A._handleIn.isZero()&&N._point.subtract(U._point).isCollinear(A._point.subtract(F._point))}function v(E){var k=i[E],U=k.getPrevious(),N=k.getNext();return U._handleOut.isZero()&&k._handleIn.isZero()&&k._handleOut.isZero()&&N._handleIn.isZero()&&k._point.subtract(U._point).isOrthogonal(N._point.subtract(k._point))}function y(E){var k=i[E],U=k.getNext(),N=k._handleOut,F=U._handleIn,A=.5522847498307936;if(N.isOrthogonal(F)){var R=k._point,w=U._point,O=new fe(R,N,!0).intersect(new fe(w,F,!0),!0);return O&&P.isZero(N.getLength()/O.subtract(R).getLength()-A)&&P.isZero(F.getLength()/O.subtract(w).getLength()-A)}return!1}function x(E,k){return i[E]._point.getDistance(i[k]._point)}if(!this.hasHandles()&&i.length===4&&m(0,2)&&m(1,3)&&v(1)?(r=de.Rectangle,l=new j(x(0,3),x(0,1)),g=i[1]._point.add(i[2]._point).divide(2)):i.length===8&&y(0)&&y(2)&&y(4)&&y(6)&&m(1,5)&&m(3,7)?(r=de.Rectangle,l=new j(x(1,6),x(0,3)),f=l.subtract(new j(x(0,7),x(1,2))).divide(2),g=i[3]._point.add(i[4]._point).divide(2)):i.length===4&&y(0)&&y(1)&&y(2)&&y(3)&&(P.isZero(x(0,2)-x(1,3))?(r=de.Circle,f=x(0,2)/2):(r=de.Ellipse,f=new j(x(2,0)/2,x(3,1)/2)),g=i[1]._point),r){var M=this.getPosition(!0),L=new r({center:M,size:l,radius:f,insert:!1});return L.copyAttributes(this,!0),L._matrix.prepend(this._matrix),L.rotate(g.subtract(M).getAngle()+90),(e===s||e)&&L.insertAbove(this),L}return null},toPath:"#clone",compare:function e(i){if(!i||i instanceof it)return e.base.call(this,i);var r=this.getCurves(),l=i.getCurves(),f=r.length,g=l.length;if(!f||!g)return f==g;for(var m=r[0].getValues(),v=[],y=0,x,M=0,L,E=0;E<g;E++){var F=l[E].getValues();v.push(F);var k=pe.getOverlaps(m,F);if(k){x=!E&&k[0][0]>0?g-1:E,L=k[0][1];break}}for(var U=Math.abs,N=1e-8,F=v[x],A;m&&F;){var k=pe.getOverlaps(m,F);if(k){var R=k[0][0];if(U(R-M)<N){M=k[1][0],M===1&&(m=++y<f?r[y].getValues():null,M=0);var w=k[0][1];if(U(w-L)<N){if(A||(A=[x,w]),L=k[1][1],L===1&&(++x>=g&&(x=0),F=v[x]||l[x].getValues(),L=0),!m)return A[0]===x&&A[1]===L;continue}}}break}return!1},_hitTestSelf:function(e,i,r,l){var f=this,g=this.getStyle(),m=this._segments,v=m.length,y=this._closed,x=i._tolerancePadding,M=x,L,E,k,U,N,F,A=i.stroke&&g.hasStroke(),R=i.fill&&g.hasFill(),w=i.curves,O=A?g.getStrokeWidth()/2:R&&i.tolerance>0||w?0:null;O!==null&&(O>0?(L=g.getStrokeJoin(),E=g.getStrokeCap(),k=g.getMiterLimit(),M=M.add(Ve._getStrokePadding(O,l))):L=E="round");function q(ee,ie){return e.subtract(ee).divide(ie).length<=1}function H(ee,ie,se){if(!i.selected||ie.isSelected()){var oe=ee._point;if(ie!==oe&&(ie=ie.add(oe)),q(ie,M))return new ke(se,f,{segment:ee,point:ie})}}function V(ee,ie){return(ie||i.segments)&&H(ee,ee._point,"segment")||!ie&&i.handles&&(H(ee,ee._handleIn,"handle-in")||H(ee,ee._handleOut,"handle-out"))}function G(ee){U.add(ee)}function $(ee){var ie=y||ee._index>0&&ee._index<v-1;if((ie?L:E)==="round")return q(ee._point,M);if(U=new Ve({internal:!0,closed:!0}),ie?ee.isSmooth()||Ve._addBevelJoin(ee,L,O,k,null,l,G,!0):E==="square"&&Ve._addSquareCap(ee,E,O,null,l,G,!0),!U.isEmpty()){var se;return U.contains(e)||(se=U.getNearestLocation(e))&&q(se.getPoint(),x)}}if(i.ends&&!i.segments&&!y){if(F=V(m[0],!0)||V(m[v-1],!0))return F}else if(i.segments||i.handles){for(var X=0;X<v;X++)if(F=V(m[X]))return F}if(O!==null){if(N=this.getNearestLocation(e),N){var te=N.getTime();te===0||te===1&&v>1?$(N.getSegment())||(N=null):q(N.getPoint(),M)||(N=null)}if(!N&&L==="miter"&&v>1)for(var X=0;X<v;X++){var W=m[X];if(e.getDistance(W._point)<=k*O&&$(W)){N=W.getLocation();break}}}return!N&&R&&this._contains(e)||N&&!A&&!w?new ke("fill",this):N?new ke(A?"stroke":"curve",this,{location:N,point:N.getPoint()}):null}},o.each(pe._evaluateMethods,function(e){this[e+"At"]=function(i){var r=this.getLocationAt(i);return r&&r[e]()}},{beans:!1,getLocationOf:function(){for(var e=z.read(arguments),i=this.getCurves(),r=0,l=i.length;r<l;r++){var f=i[r].getLocationOf(e);if(f)return f}return null},getOffsetOf:function(){var e=this.getLocationOf.apply(this,arguments);return e?e.getOffset():null},getLocationAt:function(e){if(typeof e=="number"){for(var i=this.getCurves(),r=0,l=0,f=i.length;l<f;l++){var g=r,m=i[l];if(r+=m.getLength(),r>e)return m.getLocationAt(e-g)}if(i.length>0&&e<=this.getLength())return new He(i[i.length-1],1)}else if(e&&e.getPath&&e.getPath()===this)return e;return null},getOffsetsWithTangent:function(){var e=z.read(arguments);if(e.isZero())return[];for(var i=[],r=0,l=this.getCurves(),f=0,g=l.length;f<g;f++){for(var m=l[f],v=m.getTimesWithTangent(e),y=0,x=v.length;y<x;y++){var M=r+m.getOffsetAtTime(v[y]);i.indexOf(M)<0&&i.push(M)}r+=m.length}return i}}),new function(){function e(r,l,f,g){if(g<=0)return;var m=g/2,v=g-2,y=m-1,x=new Array(6),M,L;function E(R){var w=x[R],O=x[R+1];(M!=w||L!=O)&&(r.beginPath(),r.moveTo(M,L),r.lineTo(w,O),r.stroke(),r.beginPath(),r.arc(w,O,m,0,Math.PI*2,!0),r.fill())}for(var k=0,U=l.length;k<U;k++){var N=l[k],F=N._selection;if(N._transformCoordinates(f,x),M=x[0],L=x[1],F&2&&E(2),F&4&&E(4),r.fillRect(M-m,L-m,g,g),v>0&&!(F&1)){var A=r.fillStyle;r.fillStyle="#ffffff",r.fillRect(M-y,L-y,v,v),r.fillStyle=A}}}function i(r,l,f){var g=l._segments,m=g.length,v=new Array(6),y=!0,x,M,L,E,k,U,N,F;function A(w){if(f)w._transformCoordinates(f,v),x=v[0],M=v[1];else{var O=w._point;x=O._x,M=O._y}if(y)r.moveTo(x,M),y=!1;else{if(f)k=v[2],U=v[3];else{var q=w._handleIn;k=x+q._x,U=M+q._y}k===x&&U===M&&N===L&&F===E?r.lineTo(x,M):r.bezierCurveTo(N,F,k,U,x,M)}if(L=x,E=M,f)N=v[4],F=v[5];else{var q=w._handleOut;N=L+q._x,F=E+q._y}}for(var R=0;R<m;R++)A(g[R]);l._closed&&m>0&&A(g[0])}return{_draw:function(r,l,f,g){var m=l.dontStart,v=l.dontFinish||l.clip,y=this.getStyle(),x=y.hasFill(),M=y.hasStroke(),L=y.getDashArray(),E=!Qe.support.nativeDash&&M&&L&&L.length;m||r.beginPath(),(x||M&&!E||v)&&(i(r,this,g),this._closed&&r.closePath());function k(w){return L[(w%E+E)%E]}if(!v&&(x||M)&&(this._setStyles(r,l,f),x&&(r.fill(y.getFillRule()),r.shadowColor="rgba(0,0,0,0)"),M)){if(E){m||r.beginPath();for(var U=new Lt(this,.25,32,!1,g),N=U.length,F=-y.getDashOffset(),A,R=0;F>0;)F-=k(R--)+k(R--);for(;F<N;)A=F+k(R++),(F>0||A>0)&&U.drawPart(r,Math.max(F,0),Math.max(A,0)),F=A+k(R++)}r.stroke()}},_drawSelected:function(r,l){r.beginPath(),i(r,this,l),r.stroke(),e(r,this._segments,l,Qe.settings.handleSize)}}},new function(){function e(i){var r=i._segments;if(!r.length)throw new Error("Use a moveTo() command first");return r[r.length-1]}return{moveTo:function(){var i=this._segments;i.length===1&&this.removeSegment(0),i.length||this._add([new we(z.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new we(z.read(arguments))])},cubicCurveTo:function(){var i=arguments,r=z.read(i),l=z.read(i),f=z.read(i),g=e(this);g.setHandleOut(r.subtract(g._point)),this._add([new we(f,l.subtract(f))])},quadraticCurveTo:function(){var i=arguments,r=z.read(i),l=z.read(i),f=e(this)._point;this.cubicCurveTo(r.add(f.subtract(r).multiply(1/3)),r.add(l.subtract(r).multiply(1/3)),l)},curveTo:function(){var i=arguments,r=z.read(i),l=z.read(i),f=o.pick(o.read(i),.5),g=1-f,m=e(this)._point,v=r.subtract(m.multiply(g*g)).subtract(l.multiply(f*f)).divide(2*f*g);if(v.isNaN())throw new Error("Cannot put a curve through points with parameter = "+f);this.quadraticCurveTo(v,l)},arcTo:function(){var i=arguments,r=Math.abs,l=Math.sqrt,f=e(this),g=f._point,m=z.read(i),v,y=o.peek(i),x=o.pick(y,!0),M,L,E,k;if(typeof x=="boolean")var U=g.add(m).divide(2),v=U.add(U.subtract(g).rotate(x?-90:90));else if(o.remain(i)<=2)v=m,m=z.read(i);else if(!g.equals(m)){var N=j.read(i),F=P.isZero;if(F(N.width)||F(N.height))return this.lineTo(m);var A=o.read(i),x=!!o.read(i),R=!!o.read(i),U=g.add(m).divide(2),w=g.subtract(U).rotate(-A),O=w.x,q=w.y,H=r(N.width),V=r(N.height),G=H*H,$=V*V,X=O*O,te=q*q,W=l(X/G+te/$);if(W>1&&(H*=W,V*=W,G=H*H,$=V*V),W=(G*$-G*te-$*X)/(G*te+$*X),r(W)<1e-12&&(W=0),W<0)throw new Error("Cannot create an arc with the given arguments");M=new z(H*q/V,-V*O/H).multiply((R===x?-1:1)*l(W)).rotate(A).add(U),k=new ue().translate(M).rotate(A).scale(H,V),E=k._inverseTransform(g),L=E.getDirectedAngle(k._inverseTransform(m)),!x&&L>0?L-=360:x&&L<0&&(L+=360)}if(v){var ee=new fe(g.add(v).divide(2),v.subtract(g).rotate(90),!0),ie=new fe(v.add(m).divide(2),m.subtract(v).rotate(90),!0),se=new fe(g,m),oe=se.getSide(v);if(M=ee.intersect(ie,!0),!M){if(!oe)return this.lineTo(m);throw new Error("Cannot create an arc with the given arguments")}E=g.subtract(M),L=E.getDirectedAngle(m.subtract(M));var ge=se.getSide(M,!0);ge===0?L=oe*r(L):oe===ge&&(L+=L<0?360:-360)}if(L){for(var Ie=1e-5,Ae=r(L),ze=Ae>=360?4:Math.ceil((Ae-Ie)/90),Oe=L/ze,ye=Oe*Math.PI/360,xe=4/3*Math.sin(ye)/(1+Math.cos(ye)),Le=[],De=0;De<=ze;De++){var w=m,Re=null;if(De<ze&&(Re=E.rotate(90).multiply(xe),k?(w=k._transformPoint(E),Re=k._transformPoint(E.add(Re)).subtract(w)):w=M.add(E)),!De)f.setHandleOut(Re);else{var qe=E.rotate(-90).multiply(xe);k&&(qe=k._transformPoint(E.add(qe)).subtract(w)),Le.push(new we(w,qe,Re))}E=E.rotate(Oe)}this._add(Le)}},lineBy:function(){var i=z.read(arguments),r=e(this)._point;this.lineTo(r.add(i))},curveBy:function(){var i=arguments,r=z.read(i),l=z.read(i),f=o.read(i),g=e(this)._point;this.curveTo(g.add(r),g.add(l),f)},cubicCurveBy:function(){var i=arguments,r=z.read(i),l=z.read(i),f=z.read(i),g=e(this)._point;this.cubicCurveTo(g.add(r),g.add(l),g.add(f))},quadraticCurveBy:function(){var i=arguments,r=z.read(i),l=z.read(i),f=e(this)._point;this.quadraticCurveTo(f.add(r),f.add(l))},arcBy:function(){var i=arguments,r=e(this)._point,l=r.add(z.read(i)),f=o.pick(o.peek(i),!0);typeof f=="boolean"?this.arcTo(l,f):this.arcTo(l,r.add(z.read(i)))},closePath:function(i){this.setClosed(!0),this.join(this,i)}}},{_getBounds:function(e,i){var r=i.handle?"getHandleBounds":i.stroke?"getStrokeBounds":"getBounds";return Ve[r](this._segments,this._closed,this,e,i)},statics:{getBounds:function(e,i,r,l,f,g){var m=e[0];if(!m)return new K;var v=new Array(6),y=m._transformCoordinates(l,new Array(6)),x=y.slice(0,2),M=x.slice(),L=new Array(2);function E(N){N._transformCoordinates(l,v);for(var F=0;F<2;F++)pe._addBounds(y[F],y[F+4],v[F+2],v[F],F,g?g[F]:0,x,M,L);var A=y;y=v,v=A}for(var k=1,U=e.length;k<U;k++)E(e[k]);return i&&E(m),new K(x[0],x[1],M[0]-x[0],M[1]-x[1])},getStrokeBounds:function(e,i,r,l,f){var g=r.getStyle(),m=g.hasStroke(),v=g.getStrokeWidth(),y=m&&r._getStrokeMatrix(l,f),x=m&&Ve._getStrokePadding(v,y),M=Ve.getBounds(e,i,r,l,f,x);if(!m)return M;var L=v/2,E=g.getStrokeJoin(),k=g.getStrokeCap(),U=g.getMiterLimit(),N=new K(new j(x));function F(H){M=M.include(H)}function A(H){M=M.unite(N.setCenter(H._point.transform(l)))}function R(H,V){V==="round"||H.isSmooth()?A(H):Ve._addBevelJoin(H,V,L,U,l,y,F)}function w(H,V){V==="round"?A(H):Ve._addSquareCap(H,V,L,l,y,F)}var O=e.length-(i?0:1);if(O>0){for(var q=1;q<O;q++)R(e[q],E);i?R(e[0],E):(w(e[0],k),w(e[e.length-1],k))}return M},_getStrokePadding:function(e,i){if(!i)return[e,e];var r=new z(e,0).transform(i),l=new z(0,e).transform(i),f=r.getAngleInRadians(),g=r.getLength(),m=l.getLength(),v=Math.sin(f),y=Math.cos(f),x=Math.tan(f),M=Math.atan2(m*x,g),L=Math.atan2(m,x*g);return[Math.abs(g*Math.cos(M)*y+m*Math.sin(M)*v),Math.abs(m*Math.sin(L)*y+g*Math.cos(L)*v)]},_addBevelJoin:function(e,i,r,l,f,g,m,v){var y=e.getCurve(),x=y.getPrevious(),M=y.getPoint1().transform(f),L=x.getNormalAtTime(1).multiply(r).transform(g),E=y.getNormalAtTime(0).multiply(r).transform(g),k=L.getDirectedAngle(E);if((k<0||k>=180)&&(L=L.negate(),E=E.negate()),v&&m(M),m(M.add(L)),i==="miter"){var U=new fe(M.add(L),new z(-L.y,L.x),!0).intersect(new fe(M.add(E),new z(-E.y,E.x),!0),!0);U&&M.getDistance(U)<=l*r&&m(U)}m(M.add(E))},_addSquareCap:function(e,i,r,l,f,g,m){var v=e._point.transform(l),y=e.getLocation(),x=y.getNormal().multiply(y.getTime()===0?r:-r).transform(f);i==="square"&&(m&&(g(v.subtract(x)),g(v.add(x))),v=v.add(x.rotate(-90))),g(v.add(x)),g(v.subtract(x))},getHandleBounds:function(e,i,r,l,f){var g=r.getStyle(),m=f.stroke&&g.hasStroke(),v,y;if(m){var x=r._getStrokeMatrix(l,f),M=g.getStrokeWidth()/2,L=M;g.getStrokeJoin()==="miter"&&(L=M*g.getMiterLimit()),g.getStrokeCap()==="square"&&(L=Math.max(L,M*Math.SQRT2)),v=Ve._getStrokePadding(M,x),y=Ve._getStrokePadding(L,x)}for(var E=new Array(6),k=1/0,U=-k,N=k,F=U,A=0,R=e.length;A<R;A++){var w=e[A];w._transformCoordinates(l,E);for(var O=0;O<6;O+=2){var q=O?v:y,H=q?q[0]:0,V=q?q[1]:0,G=E[O],$=E[O+1],X=G-H,te=G+H,W=$-V,ee=$+V;X<k&&(k=X),te>U&&(U=te),W<N&&(N=W),ee>F&&(F=ee)}}return new K(k,N,U-k,F-N)}}});Ve.inject({statics:new function(){var e=.5522847498307936,i=[new we([-1,0],[0,e],[0,-e]),new we([0,-1],[-e,0],[e,0]),new we([1,0],[0,-e],[0,e]),new we([0,1],[e,0],[-e,0])];function r(f,g,m){var v=o.getNamed(m),y=new Ve(v&&(v.insert==!0?I.INSERT:v.insert==!1?I.NO_INSERT:null));return y._add(f),y._closed=g,y.set(v,I.INSERT)}function l(f,g,m){for(var v=new Array(4),y=0;y<4;y++){var x=i[y];v[y]=new we(x._point.multiply(g).add(f),x._handleIn.multiply(g),x._handleOut.multiply(g))}return r(v,!0,m)}return{Line:function(){var f=arguments;return r([new we(z.readNamed(f,"from")),new we(z.readNamed(f,"to"))],!1,f)},Circle:function(){var f=arguments,g=z.readNamed(f,"center"),m=o.readNamed(f,"radius");return l(g,new j(m),f)},Rectangle:function(){var f=arguments,g=K.readNamed(f,"rectangle"),m=j.readNamed(f,"radius",0,{readNull:!0}),v=g.getBottomLeft(!0),y=g.getTopLeft(!0),x=g.getTopRight(!0),M=g.getBottomRight(!0),L;if(!m||m.isZero())L=[new we(v),new we(y),new we(x),new we(M)];else{m=j.min(m,g.getSize(!0).divide(2));var E=m.width,k=m.height,U=E*e,N=k*e;L=[new we(v.add(E,0),null,[-U,0]),new we(v.subtract(0,k),[0,N]),new we(y.add(0,k),null,[0,-N]),new we(y.add(E,0),[-U,0],null),new we(x.subtract(E,0),null,[U,0]),new we(x.add(0,k),[0,-N],null),new we(M.subtract(0,k),null,[0,N]),new we(M.subtract(E,0),[U,0])]}return r(L,!0,f)},RoundRectangle:"#Rectangle",Ellipse:function(){var f=arguments,g=de._readEllipse(f);return l(g.center,g.radius,f)},Oval:"#Ellipse",Arc:function(){var f=arguments,g=z.readNamed(f,"from"),m=z.readNamed(f,"through"),v=z.readNamed(f,"to"),y=o.getNamed(f),x=new Ve(y&&y.insert==!1&&I.NO_INSERT);return x.moveTo(g),x.arcTo(m,v),x.set(y)},RegularPolygon:function(){for(var f=arguments,g=z.readNamed(f,"center"),m=o.readNamed(f,"sides"),v=o.readNamed(f,"radius"),y=360/m,x=m%3===0,M=new z(0,x?-v:v),L=x?-1:.5,E=new Array(m),k=0;k<m;k++)E[k]=new we(g.add(M.rotate((k+L)*y)));return r(E,!0,f)},Star:function(){for(var f=arguments,g=z.readNamed(f,"center"),m=o.readNamed(f,"points")*2,v=o.readNamed(f,"radius1"),y=o.readNamed(f,"radius2"),x=360/m,M=new z(0,-1),L=new Array(m),E=0;E<m;E++)L[E]=new we(g.add(M.rotate(x*E).multiply(E%2?y:v)));return r(L,!0,f)}}}});var it=et.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(i){this._children=[],this._namedChildren={},this._initialize(i)||(typeof i=="string"?this.setPathData(i):this.addChildren(Array.isArray(i)?i:arguments))},insertChildren:function e(i,r){var l=r,f=l[0];f&&typeof f[0]=="number"&&(l=[l]);for(var g=r.length-1;g>=0;g--){var m=l[g];l===r&&!(m instanceof Ve)&&(l=o.slice(l)),Array.isArray(m)?l[g]=new Ve({segments:m,insert:!1}):m instanceof it&&(l.splice.apply(l,[g,1].concat(m.removeChildren())),m.remove())}return e.base.call(this,i,l)},reduce:function e(i){for(var r=this._children,l=r.length-1;l>=0;l--){var f=r[l].reduce(i);f.isEmpty()&&f.remove()}if(!r.length){var f=new Ve(I.NO_INSERT);return f.copyAttributes(this),f.insertAbove(this),this.remove(),f}return e.base.call(this)},isClosed:function(){for(var e=this._children,i=0,r=e.length;i<r;i++)if(!e[i]._closed)return!1;return!0},setClosed:function(e){for(var i=this._children,r=0,l=i.length;r<l;r++)i[r].setClosed(e)},getFirstSegment:function(){var e=this.getFirstChild();return e&&e.getFirstSegment()},getLastSegment:function(){var e=this.getLastChild();return e&&e.getLastSegment()},getCurves:function(){for(var e=this._children,i=[],r=0,l=e.length;r<l;r++)o.push(i,e[r].getCurves());return i},getFirstCurve:function(){var e=this.getFirstChild();return e&&e.getFirstCurve()},getLastCurve:function(){var e=this.getLastChild();return e&&e.getLastCurve()},getArea:function(){for(var e=this._children,i=0,r=0,l=e.length;r<l;r++)i+=e[r].getArea();return i},getLength:function(){for(var e=this._children,i=0,r=0,l=e.length;r<l;r++)i+=e[r].getLength();return i},getPathData:function(e,i){for(var r=this._children,l=[],f=0,g=r.length;f<g;f++){var m=r[f],v=m._matrix;l.push(m.getPathData(e&&!v.isIdentity()?e.appended(v):e,i))}return l.join("")},_hitTestChildren:function e(i,r,l){return e.base.call(this,i,r.class===Ve||r.type==="path"?r:o.set({},r,{fill:!1}),l)},_draw:function(e,i,r,l){var f=this._children;if(f.length){i=i.extend({dontStart:!0,dontFinish:!0}),e.beginPath();for(var g=0,m=f.length;g<m;g++)f[g].draw(e,i,l);if(!i.clip){this._setStyles(e,i,r);var v=this._style;v.hasFill()&&(e.fill(v.getFillRule()),e.shadowColor="rgba(0,0,0,0)"),v.hasStroke()&&e.stroke()}}},_drawSelected:function(e,i,r){for(var l=this._children,f=0,g=l.length;f<g;f++){var m=l[f],v=m._matrix;r[m._id]||m._drawSelected(e,v.isIdentity()?i:i.appended(v))}}},new function(){function e(i,r){var l=i._children;if(r&&!l.length)throw new Error("Use a moveTo() command first");return l[l.length-1]}return o.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(i){this[i]=function(){var r=e(this,!0);r[i].apply(r,arguments)}},{moveTo:function(){var i=e(this),r=i&&i.isEmpty()?i:new Ve(I.NO_INSERT);r!==i&&this.addChild(r),r.moveTo.apply(r,arguments)},moveBy:function(){var i=e(this,!0),r=i&&i.getLastSegment(),l=z.read(arguments);this.moveTo(r?l.add(r._point):l)},closePath:function(i){e(this,!0).closePath(i)}})},o.each(["reverse","flatten","simplify","smooth"],function(e){this[e]=function(i){for(var r=this._children,l,f=0,g=r.length;f<g;f++)l=r[f][e](i)||l;return l}},{}));et.inject(new function(){var e=Math.min,i=Math.max,r=Math.abs,l={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function f(A){return A._children||[A]}function g(A,R){var w=A.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(R){for(var O=f(w),q=0,H=O.length;q<H;q++){var A=O[q];!A._closed&&!A.isEmpty()&&(A.closePath(1e-12),A.getFirstSegment().setHandleIn(0,0),A.getLastSegment().setHandleOut(0,0))}w=w.resolveCrossings().reorient(w.getFillRule()==="nonzero",!0)}return w}function m(A,R,w,O,q){var H=new it(I.NO_INSERT);return H.addChildren(A,!0),H=H.reduce({simplify:R}),q&&q.insert==!1||H.insertAbove(O&&w.isSibling(O)&&w.getIndex()<O.getIndex()?O:w),H.copyAttributes(w,!0),H}function v(A){return A.hasOverlap()||A.isCrossing()}function y(A,R,w,O){if(O&&(O.trace==!1||O.stroke)&&/^(subtract|intersect)$/.test(w))return x(A,R,w);var q=g(A,!0),H=R&&A!==R&&g(R,!0),V=l[w];V[w]=!0,H&&(V.subtract||V.exclude)^(H.isClockwise()^q.isClockwise())&&H.reverse();var G=k(He.expand(q.getIntersections(H,v))),$=f(q),X=H&&f(H),te=[],W=[],ee;function ie(Re){for(var qe=0,Be=Re.length;qe<Be;qe++){var Ze=Re[qe];o.push(te,Ze._segments),o.push(W,Ze.getCurves()),Ze._overlapsOnly=!0}}function se(Re){for(var qe=[],Be=0,Ze=Re&&Re.length;Be<Ze;Be++)qe.push(W[Re[Be]]);return qe}if(G.length){ie($),X&&ie(X);for(var oe=new Array(W.length),ge=0,Ie=W.length;ge<Ie;ge++)oe[ge]=W[ge].getValues();for(var Ae=C.findCurveBoundsCollisions(oe,oe,0,!0),ze={},ge=0;ge<W.length;ge++){var Oe=W[ge],ye=Oe._path._id,xe=ze[ye]=ze[ye]||{};xe[Oe.getIndex()]={hor:se(Ae[ge].hor),ver:se(Ae[ge].ver)}}for(var ge=0,Ie=G.length;ge<Ie;ge++)N(G[ge]._segment,q,H,ze,V);for(var ge=0,Ie=te.length;ge<Ie;ge++){var Le=te[ge],De=Le._intersection;Le._winding||N(Le,q,H,ze,V),De&&De._overlap||(Le._path._overlapsOnly=!1)}ee=F(te,V)}else ee=E(X?$.concat(X):$.slice(),function(Re){return!!V[Re]});return m(ee,!0,A,R,O)}function x(A,R,w){var O=g(A),q=g(R),H=O.getIntersections(q,v),V=w==="subtract",G=w==="divide",$={},X=[];function te(ie){if(!$[ie._id]&&(G||q.contains(ie.getPointAt(ie.getLength()/2))^V))return X.unshift(ie),$[ie._id]=!0}for(var W=H.length-1;W>=0;W--){var ee=H[W].split();ee&&(te(ee)&&ee.getFirstSegment().setHandleIn(0,0),O.getLastSegment().setHandleOut(0,0))}return te(O),m(X,!1,A,R)}function M(A,R){for(var w=A;w;){if(w===R)return;w=w._previous}for(;A._next&&A._next!==R;)A=A._next;if(!A._next){for(;R._previous;)R=R._previous;A._next=R,R._previous=A}}function L(A){for(var R=A.length-1;R>=0;R--)A[R].clearHandles()}function E(A,R,w){var O=A&&A.length;if(O){var q=o.each(A,function(Ae,ze){this[Ae._id]={container:null,winding:Ae.isClockwise()?1:-1,index:ze}},{}),H=A.slice().sort(function(Ae,ze){return r(ze.getArea())-r(Ae.getArea())}),V=H[0],G=C.findItemBoundsCollisions(H,null,P.GEOMETRIC_EPSILON);w==null&&(w=V.isClockwise());for(var $=0;$<O;$++){var X=H[$],te=q[X._id],W=0,ee=G[$];if(ee){for(var ie=null,se=ee.length-1;se>=0;se--)if(ee[se]<$){ie=ie||X.getInteriorPoint();var oe=H[ee[se]];if(oe.contains(ie)){var ge=q[oe._id];W=ge.winding,te.winding+=W,te.container=ge.exclude?ge.container:oe;break}}}if(R(te.winding)===R(W))te.exclude=!0,A[te.index]=null;else{var Ie=te.container;X.setClockwise(Ie?!Ie.isClockwise():w)}}}return A}function k(A,R,w){var O=R&&[],q=1e-8,H=1-q,V=!1,G=w||[],$=w&&{},X,te,W;function ee(qe){return qe._path._id+"."+qe._segment1._index}for(var ie=(w&&w.length)-1;ie>=0;ie--){var se=w[ie];se._path&&($[ee(se)]=!0)}for(var ie=A.length-1;ie>=0;ie--){var oe=A[ie],ge=oe._time,Ie=ge,Ae=R&&!R(oe),se=oe._curve,ze;if(se&&(se!==te?(V=!se.hasHandles()||$&&$[ee(se)],X=[],W=null,te=se):W>=q&&(ge/=W)),Ae){X&&X.push(oe);continue}else R&&O.unshift(oe);if(W=Ie,ge<q)ze=se._segment1;else if(ge>H)ze=se._segment2;else{var Oe=se.divideAtTime(ge,!0);V&&G.push(se,Oe),ze=Oe._segment1;for(var ye=X.length-1;ye>=0;ye--){var xe=X[ye];xe._time=(xe._time-ge)/(1-ge)}}oe._setSegment(ze);var Le=ze._intersection,De=oe._intersection;if(Le){M(Le,De);for(var Re=Le;Re;)M(Re._intersection,Le),Re=Re._next}else ze._intersection=De}return w||L(G),O||A}function U(A,R,w,O,q){var H=Array.isArray(R)?R:R[w?"hor":"ver"],V=w?1:0,G=V^1,$=[A.x,A.y],X=$[V],te=$[G],W=1e-9,ee=1e-6,ie=X-W,se=X+W,oe=0,ge=0,Ie=0,Ae=0,ze=!1,Oe=!1,ye=1,xe=[],Le,De;function Re(Te){var ht=Te[G+0],ct=Te[G+6];if(!(te<e(ht,ct)||te>i(ht,ct))){var yt=Te[V+0],Vt=Te[V+2],Wt=Te[V+4],Ft=Te[V+6];if(ht===ct){(yt<se&&Ft>ie||Ft<se&&yt>ie)&&(ze=!0);return}var Bt=te===ht?0:te===ct||ie>i(yt,Vt,Wt,Ft)||se<e(yt,Vt,Wt,Ft)?1:pe.solveCubic(Te,G,te,xe,0,1)>0?xe[0]:1,kt=Bt===0?yt:Bt===1?Ft:pe.getPoint(Te,Bt)[w?"y":"x"],Nt=ht>ct?1:-1,Zt=Le[G]>Le[G+6]?1:-1,bt=Le[V+6];return te!==ht?(kt<ie?Ie+=Nt:kt>se?Ae+=Nt:ze=!0,kt>X-ee&&kt<X+ee&&(ye/=2)):(Nt!==Zt?yt<ie?Ie+=Nt:yt>se&&(Ae+=Nt):yt!=bt&&(bt<se&&kt>se?(Ae+=Nt,ze=!0):bt>ie&&kt<ie&&(Ie+=Nt,ze=!0)),ye/=4),Le=Te,!q&&kt>ie&&kt<se&&pe.getTangent(Te,Bt)[w?"x":"y"]===0&&U(A,R,!w,O,!0)}}function qe(Te){var ht=Te[G+0],ct=Te[G+2],yt=Te[G+4],Vt=Te[G+6];if(te<=i(ht,ct,yt,Vt)&&te>=e(ht,ct,yt,Vt)){for(var Wt=Te[V+0],Ft=Te[V+2],Bt=Te[V+4],kt=Te[V+6],Nt=ie>i(Wt,Ft,Bt,kt)||se<e(Wt,Ft,Bt,kt)?[Te]:pe.getMonoCurves(Te,w),Zt,bt=0,Et=Nt.length;bt<Et;bt++)if(Zt=Re(Nt[bt]))return Zt}}for(var Be=0,Ze=H.length;Be<Ze;Be++){var Ye=H[Be],Ge=Ye._path,_t=Ye.getValues(),gt;if((!Be||H[Be-1]._path!==Ge)&&(Le=null,Ge._closed||(De=pe.getValues(Ge.getLastCurve().getSegment2(),Ye.getSegment1(),null,!O),De[G]!==De[G+6]&&(Le=De)),!Le)){Le=_t;for(var xt=Ge.getLastCurve();xt&&xt!==Ye;){var mt=xt.getValues();if(mt[G]!==mt[G+6]){Le=mt;break}xt=xt.getPrevious()}}if(gt=qe(_t))return gt;if(Be+1===Ze||H[Be+1]._path!==Ge){if(De&&(gt=qe(De)))return gt;ze&&!Ie&&!Ae&&(Ie=Ae=Ge.isClockwise(O)^w?1:-1),oe+=Ie,ge+=Ae,Ie=Ae=0,ze&&(Oe=!0,ze=!1),De=null}}return oe=r(oe),ge=r(ge),{winding:i(oe,ge),windingL:oe,windingR:ge,quality:ye,onPath:Oe}}function N(A,R,w,O,q){var H=[],V=A,G=0,W;do{var $=A.getCurve();if($){var X=$.getLength();H.push({segment:A,curve:$,length:X}),G+=X}A=A.getNext()}while(A&&!A._intersection&&A!==V);for(var te=[.5,.25,.75],W={winding:0,quality:-1},ee=.001,ie=1-ee,se=0;se<te.length&&W.quality<.5;se++)for(var X=G*te[se],oe=0,ge=H.length;oe<ge;oe++){var Ie=H[oe],Ae=Ie.length;if(X<=Ae){var $=Ie.curve,ze=$._path,Oe=ze._parent,ye=Oe instanceof it?Oe:ze,xe=P.clamp($.getTimeAt(X),ee,ie),Le=$.getPointAtTime(xe),De=r($.getTangentAtTime(xe).y)<Math.SQRT1_2,Re=null;if(q.subtract&&w){var qe=ye===R?w:R,Be=qe._getWinding(Le,De,!0);if(ye===R&&Be.winding||ye===w&&!Be.winding){if(Be.quality<1)continue;Re={winding:0,quality:1}}}Re=Re||U(Le,O[ze._id][$.getIndex()],De,!0),Re.quality>W.quality&&(W=Re);break}X-=Ae}for(var oe=H.length-1;oe>=0;oe--)H[oe].segment._winding=W}function F(A,R){var w=[],O;function q(Ze){var Ye;return!!(Ze&&!Ze._visited&&(!R||R[(Ye=Ze._winding||{}).winding]&&!(R.unite&&Ye.winding===2&&Ye.windingL&&Ye.windingR)))}function H(Ze){if(Ze){for(var Ye=0,Ge=O.length;Ye<Ge;Ye++)if(Ze===O[Ye])return!0}return!1}function V(Ze){for(var Ye=Ze._segments,Ge=0,_t=Ye.length;Ge<_t;Ge++)Ye[Ge]._visited=!0}function G(Ze,Ye){var Ge=Ze._intersection,_t=Ge,gt=[];Ye&&(O=[Ze]);function xt(mt,Te){for(;mt&&mt!==Te;){var ht=mt._segment,ct=ht&&ht._path;if(ct){var yt=ht.getNext()||ct.getFirstSegment(),Vt=yt._intersection;ht!==Ze&&(H(ht)||H(yt)||yt&&q(ht)&&(q(yt)||Vt&&q(Vt._segment)))&&gt.push(ht),Ye&&O.push(ht)}mt=mt._next}}if(Ge){for(xt(Ge);Ge&&Ge._previous;)Ge=Ge._previous;xt(Ge,_t)}return gt}A.sort(function(Ze,Ye){var Ge=Ze._intersection,_t=Ye._intersection,gt=!!(Ge&&Ge._overlap),xt=!!(_t&&_t._overlap),mt=Ze._path,Te=Ye._path;return gt^xt?gt?1:-1:!Ge^!_t?Ge?1:-1:mt!==Te?mt._id-Te._id:Ze._index-Ye._index});for(var $=0,X=A.length;$<X;$++){var te=A[$],W=q(te),ee=null,ie=!1,se=!0,oe=[],ge,Ie,Ae;if(W&&te._path._overlapsOnly){var ze=te._path,Oe=te._intersection._segment._path;ze.compare(Oe)&&(ze.getArea()&&w.push(ze.clone(!1)),V(ze),V(Oe),W=!1)}for(;W;){var ye=!ee,xe=G(te,ye),Le=xe.shift(),ie=!ye&&(H(te)||H(Le)),De=!ie&&Le;if(ye&&(ee=new Ve(I.NO_INSERT),ge=null),ie){(te.isFirst()||te.isLast())&&(se=te._path._closed),te._visited=!0;break}if(De&&ge&&(oe.push(ge),ge=null),ge||(De&&xe.push(te),ge={start:ee._segments.length,crossings:xe,visited:Ie=[],handleIn:Ae}),De&&(te=Le),!q(te)){ee.removeSegments(ge.start);for(var Re=0,qe=Ie.length;Re<qe;Re++)Ie[Re]._visited=!1;Ie.length=0;do te=ge&&ge.crossings.shift(),(!te||!te._path)&&(te=null,ge=oe.pop(),ge&&(Ie=ge.visited,Ae=ge.handleIn));while(ge&&!q(te));if(!te)break}var Be=te.getNext();ee.add(new we(te._point,Ae,Be&&te._handleOut)),te._visited=!0,Ie.push(te),te=Be||te._path.getFirstSegment(),Ae=Be&&Be._handleIn}ie&&(se&&(ee.getFirstSegment().setHandleIn(Ae),ee.setClosed(se)),ee.getArea()!==0&&w.push(ee))}return w}return{_getWinding:function(A,R,w){return U(A,this.getCurves(),R,w)},unite:function(A,R){return y(this,A,"unite",R)},intersect:function(A,R){return y(this,A,"intersect",R)},subtract:function(A,R){return y(this,A,"subtract",R)},exclude:function(A,R){return y(this,A,"exclude",R)},divide:function(A,R){return R&&(R.trace==!1||R.stroke)?x(this,A,"divide"):m([this.subtract(A,R),this.intersect(A,R)],!0,this,A,R)},resolveCrossings:function(){var A=this._children,R=A||[this];function w(ge,Ie){var Ae=ge&&ge._intersection;return Ae&&Ae._overlap&&Ae._path===Ie}var O=!1,q=!1,H=this.getIntersections(null,function(ge){return ge.hasOverlap()&&(O=!0)||ge.isCrossing()&&(q=!0)}),V=O&&q&&[];if(H=He.expand(H),O)for(var G=k(H,function(ge){return ge.hasOverlap()},V),$=G.length-1;$>=0;$--){var X=G[$],te=X._path,W=X._segment,ee=W.getPrevious(),ie=W.getNext();w(ee,te)&&w(ie,te)&&(W.remove(),ee._handleOut._set(0,0),ie._handleIn._set(0,0),ee!==W&&!ee.getCurve().hasLength()&&(ie._handleIn.set(ee._handleIn),ee.remove()))}q&&(k(H,O&&function(ge){var Ie=ge.getCurve(),Ae=ge.getSegment(),ze=ge._intersection,Oe=ze._curve,ye=ze._segment;if(Ie&&Oe&&Ie._path&&Oe._path)return!0;Ae&&(Ae._intersection=null),ye&&(ye._intersection=null)},V),V&&L(V),R=F(o.each(R,function(ge){o.push(this,ge._segments)},[])));var se=R.length,oe;return se>1&&A?(R!==A&&this.setChildren(R),oe=this):se===1&&!A&&(R[0]!==this&&this.setSegments(R[0].removeSegments()),oe=this),oe||(oe=new it(I.NO_INSERT),oe.addChildren(R),oe=oe.reduce(),oe.copyAttributes(this),this.replaceWith(oe)),oe},reorient:function(A,R){var w=this._children;return w&&w.length?this.setChildren(E(this.removeChildren(),function(O){return!!(A?O:O&1)},R)):R!==s&&this.setClockwise(R),this},getInteriorPoint:function(){var A=this.getBounds(),R=A.getCenter(!0);if(!this.contains(R)){for(var w=this.getCurves(),O=R.y,q=[],H=[],V=0,G=w.length;V<G;V++){var $=w[V].getValues(),X=$[1],te=$[3],W=$[5],ee=$[7];if(O>=e(X,te,W,ee)&&O<=i(X,te,W,ee))for(var ie=pe.getMonoCurves($),se=0,oe=ie.length;se<oe;se++){var ge=ie[se],Ie=ge[1],Ae=ge[7];if(Ie!==Ae&&(O>=Ie&&O<=Ae||O>=Ae&&O<=Ie)){var ze=O===Ie?ge[0]:O===Ae?ge[6]:pe.solveCubic(ge,1,O,H,0,1)===1?pe.getPoint(ge,H[0]).x:(ge[0]+ge[6])/2;q.push(ze)}}}q.length>1&&(q.sort(function(Oe,ye){return Oe-ye}),R.x=(q[0]+q[1])/2)}return R}}});var Lt=o.extend({_class:"PathFlattener",initialize:function(e,i,r,l,f){var g=[],m=[],v=0,y=1/(r||32),x=e._segments,M=x[0],L;function E(F,A){var R=pe.getValues(F,A,f);g.push(R),k(R,F._index,0,1)}function k(F,A,R,w){if(w-R>y&&!(l&&pe.isStraight(F))&&!pe.isFlatEnough(F,i||.25)){var O=pe.subdivide(F,.5),q=(R+w)/2;k(O[0],A,R,q),k(O[1],A,q,w)}else{var H=F[6]-F[0],V=F[7]-F[1],G=Math.sqrt(H*H+V*V);G>0&&(v+=G,m.push({offset:v,curve:F,index:A,time:w}))}}for(var U=1,N=x.length;U<N;U++)L=x[U],E(M,L),M=L;e._closed&&E(L||M,x[0]),this.curves=g,this.parts=m,this.length=v,this.index=0},_get:function(e){for(var i=this.parts,r=i.length,l,f=this.index;l=f,!(!f||i[--f].offset<e););for(;l<r;l++){var g=i[l];if(g.offset>=e){this.index=l;var m=i[l-1],v=m&&m.index===g.index?m.time:0,y=m?m.offset:0;return{index:g.index,time:v+(g.time-v)*(e-y)/(g.offset-y)}}}return{index:i[r-1].index,time:1}},drawPart:function(e,i,r){for(var l=this._get(i),f=this._get(r),g=l.index,m=f.index;g<=m;g++){var v=pe.getPart(this.curves[g],g===l.index?l.time:0,g===f.index?f.time:1);g===l.index&&e.moveTo(v[0],v[1]),e.bezierCurveTo.apply(e,v.slice(2))}}},o.each(pe._evaluateMethods,function(e){this[e+"At"]=function(i){var r=this._get(i);return pe[e](this.curves[r.index],r.time)}},{})),It=o.extend({initialize:function(e){for(var i=this.points=[],r=e._segments,l=e._closed,f=0,g,m=r.length;f<m;f++){var v=r[f].point;(!g||!g.equals(v))&&i.push(g=v.clone())}l&&(i.unshift(i[i.length-1]),i.push(i[1])),this.closed=l},fit:function(e){var i=this.points,r=i.length,l=null;return r>0&&(l=[new we(i[0])],r>1&&(this.fitCubic(l,e,0,r-1,i[1].subtract(i[0]),i[r-2].subtract(i[r-1])),this.closed&&(l.shift(),l.pop()))),l},fitCubic:function(e,i,r,l,f,g){var m=this.points;if(l-r===1){var v=m[r],y=m[l],x=v.getDistance(y)/3;this.addCurve(e,[v,v.add(f.normalize(x)),y.add(g.normalize(x)),y]);return}for(var M=this.chordLengthParameterize(r,l),L=Math.max(i,i*i),E,k=!0,U=0;U<=4;U++){var N=this.generateBezier(r,l,M,f,g),F=this.findMaxError(r,l,N,M);if(F.error<i&&k){this.addCurve(e,N);return}if(E=F.index,F.error>=L)break;k=this.reparameterize(r,l,M,N),L=F.error}var A=m[E-1].subtract(m[E+1]);this.fitCubic(e,i,r,E,f,A),this.fitCubic(e,i,E,l,A.negate(),g)},addCurve:function(e,i){var r=e[e.length-1];r.setHandleOut(i[1].subtract(i[0])),e.push(new we(i[3],i[2].subtract(i[3])))},generateBezier:function(e,i,r,l,f){for(var g=1e-12,m=Math.abs,v=this.points,y=v[e],x=v[i],M=[[0,0],[0,0]],L=[0,0],E=0,k=i-e+1;E<k;E++){var U=r[E],N=1-U,F=3*U*N,A=N*N*N,R=F*N,w=F*U,O=U*U*U,q=l.normalize(R),H=f.normalize(w),V=v[e+E].subtract(y.multiply(A+R)).subtract(x.multiply(w+O));M[0][0]+=q.dot(q),M[0][1]+=q.dot(H),M[1][0]=M[0][1],M[1][1]+=H.dot(H),L[0]+=q.dot(V),L[1]+=H.dot(V)}var G=M[0][0]*M[1][1]-M[1][0]*M[0][1],$,X;if(m(G)>g){var te=M[0][0]*L[1]-M[1][0]*L[0],W=L[0]*M[1][1]-L[1]*M[0][1];$=W/G,X=te/G}else{var ee=M[0][0]+M[0][1],ie=M[1][0]+M[1][1];$=X=m(ee)>g?L[0]/ee:m(ie)>g?L[1]/ie:0}var se=x.getDistance(y),oe=g*se,ge,Ie;if($<oe||X<oe)$=X=se/3;else{var Ae=x.subtract(y);ge=l.normalize($),Ie=f.normalize(X),ge.dot(Ae)-Ie.dot(Ae)>se*se&&($=X=se/3,ge=Ie=null)}return[y,y.add(ge||l.normalize($)),x.add(Ie||f.normalize(X)),x]},reparameterize:function(e,i,r,l){for(var f=e;f<=i;f++)r[f-e]=this.findRoot(l,this.points[f],r[f-e]);for(var f=1,g=r.length;f<g;f++)if(r[f]<=r[f-1])return!1;return!0},findRoot:function(e,i,r){for(var l=[],f=[],g=0;g<=2;g++)l[g]=e[g+1].subtract(e[g]).multiply(3);for(var g=0;g<=1;g++)f[g]=l[g+1].subtract(l[g]).multiply(2);var m=this.evaluate(3,e,r),v=this.evaluate(2,l,r),y=this.evaluate(1,f,r),x=m.subtract(i),M=v.dot(v)+x.dot(y);return P.isMachineZero(M)?r:r-x.dot(v)/M},evaluate:function(e,i,r){for(var l=i.slice(),f=1;f<=e;f++)for(var g=0;g<=e-f;g++)l[g]=l[g].multiply(1-r).add(l[g+1].multiply(r));return l[0]},chordLengthParameterize:function(e,i){for(var r=[0],l=e+1;l<=i;l++)r[l-e]=r[l-e-1]+this.points[l].getDistance(this.points[l-1]);for(var l=1,f=i-e;l<=f;l++)r[l]/=r[f];return r},findMaxError:function(e,i,r,l){for(var f=Math.floor((i-e+1)/2),g=0,m=e+1;m<i;m++){var v=this.evaluate(3,r,l[m-e]),y=v.subtract(this.points[m]),x=y.x*y.x+y.y*y.y;x>=g&&(g=x,f=m)}return{error:g,index:f}}}),Dt=I.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(i){this._content="",this._lines=[];var r=i&&o.isPlainObject(i)&&i.x===s&&i.y===s;this._initialize(r&&i,!r&&z.read(arguments))},_equals:function(e){return this._content===e._content},copyContent:function(e){this.setContent(e._content)},getContent:function(){return this._content},setContent:function(e){this._content=""+e,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Yi=Dt.extend({_class:"PointText",initialize:function(){Dt.apply(this,arguments)},getPoint:function(){var e=this._matrix.getTranslation();return new J(e.x,e.y,this,"setPoint")},setPoint:function(){var e=z.read(arguments);this.translate(e.subtract(this._matrix.getTranslation()))},_draw:function(e,i,r){if(this._content){this._setStyles(e,i,r);var l=this._lines,f=this._style,g=f.hasFill(),m=f.hasStroke(),v=f.getLeading(),y=e.shadowColor;e.font=f.getFontStyle(),e.textAlign=f.getJustification();for(var x=0,M=l.length;x<M;x++){e.shadowColor=y;var L=l[x];g&&(e.fillText(L,0,0),e.shadowColor="rgba(0,0,0,0)"),m&&e.strokeText(L,0,0),e.translate(0,v)}}},_getBounds:function(e,i){var r=this._style,l=this._lines,f=l.length,g=r.getJustification(),m=r.getLeading(),v=this.getView().getTextWidth(r.getFontStyle(),l),y=0;g!=="left"&&(y-=v/(g==="center"?2:1));var x=new K(y,f?-.75*m:0,v,f*m);return e?e._transformBounds(x,x):x}}),dt=o.extend(new function(){var e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},i={},r={transparent:[0,0,0,0]},l;function f(v){var y=v.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||v.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),x="rgb",M;if(y){var L=y[4]?4:3;M=new Array(L);for(var E=0;E<L;E++){var k=y[E+1];M[E]=parseInt(k.length==1?k+k:k,16)/255}}else if(y=v.match(/^(rgb|hsl)a?\((.*)\)$/)){x=y[1],M=y[2].trim().split(/[,\s]+/g);for(var U=x==="hsl",E=0,N=Math.min(M.length,4);E<N;E++){var F=M[E],k=parseFloat(F);if(U)if(E===0){var A=F.match(/([a-z]*)$/)[1];k*={turn:360,rad:180/Math.PI,grad:.9}[A]||1}else E<3&&(k/=100);else E<3&&(k/=/%$/.test(F)?100:255);M[E]=k}}else{var R=r[v];if(!R)if(h){l||(l=pt.getContext(1,1,{willReadFrequently:!0}),l.globalCompositeOperation="copy"),l.fillStyle="rgba(0,0,0,0)",l.fillStyle=v,l.fillRect(0,0,1,1);var w=l.getImageData(0,0,1,1).data;R=r[v]=[w[0]/255,w[1]/255,w[2]/255]}else R=[0,0,0];M=R.slice()}return[x,M]}var g=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],m={"rgb-hsb":function(v,y,x){var M=Math.max(v,y,x),L=Math.min(v,y,x),E=M-L,k=E===0?0:(M==v?(y-x)/E+(y<x?6:0):M==y?(x-v)/E+2:(v-y)/E+4)*60;return[k,M===0?0:E/M,M]},"hsb-rgb":function(v,y,x){v=(v/60%6+6)%6;var L=Math.floor(v),M=v-L,L=g[L],E=[x,x*(1-y),x*(1-y*M),x*(1-y*(1-M))];return[E[L[0]],E[L[1]],E[L[2]]]},"rgb-hsl":function(v,y,x){var M=Math.max(v,y,x),L=Math.min(v,y,x),E=M-L,k=E===0,U=k?0:(M==v?(y-x)/E+(y<x?6:0):M==y?(x-v)/E+2:(v-y)/E+4)*60,N=(M+L)/2,F=k?0:N<.5?E/(M+L):E/(2-M-L);return[U,F,N]},"hsl-rgb":function(v,y,x){if(v=(v/360%1+1)%1,y===0)return[x,x,x];for(var M=[v+1/3,v,v-1/3],L=x<.5?x*(1+y):x+y-x*y,E=2*x-L,k=[],U=0;U<3;U++){var N=M[U];N<0&&(N+=1),N>1&&(N-=1),k[U]=6*N<1?E+(L-E)*6*N:2*N<1?L:3*N<2?E+(L-E)*(2/3-N)*6:E}return k},"rgb-gray":function(v,y,x){return[v*.2989+y*.587+x*.114]},"gray-rgb":function(v){return[v,v,v]},"gray-hsb":function(v){return[0,0,v]},"gray-hsl":function(v){return[0,0,v]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return o.each(e,function(v,y){i[y]=[],o.each(v,function(x,M){var L=o.capitalize(x),E=/^(hue|saturation)$/.test(x),k=i[y][M]=y==="gradient"?x==="gradient"?function(U){var N=this._components[0];return U=yi.read(Array.isArray(U)?U:arguments,0,{readNull:!0}),N!==U&&(N&&N._removeOwner(this),U&&U._addOwner(this)),U}:function(){return z.read(arguments,0,{readNull:x==="highlight",clone:!0})}:function(U){return U==null||isNaN(U)?0:+U};this["get"+L]=function(){return this._type===y||E&&/^hs[bl]$/.test(this._type)?this._components[M]:this._convert(y)[M]},this["set"+L]=function(U){this._type!==y&&!(E&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(y),this._properties=e[y],this._type=y),this._components[M]=k.call(this,U),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function v(y){var x=arguments,M=this.__read,L=0,E,k,U,N;Array.isArray(y)&&(x=y,y=x[0]);var F=y!=null&&typeof y;if(F==="string"&&y in e&&(E=y,y=x[1],Array.isArray(y)?(k=y,U=x[2]):(M&&(L=1),x=o.slice(x,1),F=typeof y)),!k){if(N=F==="number"?x:F==="object"&&y.length!=null?y:null,N){E||(E=N.length>=3?"rgb":"gray");var A=e[E].length;U=N[A],M&&(L+=N===arguments?A+(U!=null?1:0):1),N.length>A&&(N=o.slice(N,0,A))}else if(F==="string"){var R=f(y);E=R[0],k=R[1],k.length===4&&(U=k[3],k.length--)}else if(F==="object")if(y.constructor===v){if(E=y._type,k=y._components.slice(),U=y._alpha,E==="gradient")for(var w=1,O=k.length;w<O;w++){var q=k[w];q&&(k[w]=q.clone())}}else if(y.constructor===yi)E="gradient",N=x;else{E="hue"in y?"lightness"in y?"hsl":"hsb":"gradient"in y||"stops"in y||"radial"in y?"gradient":"gray"in y?"gray":"rgb";var H=e[E],V=i[E];this._components=k=[];for(var w=0,O=H.length;w<O;w++){var G=y[H[w]];G==null&&!w&&E==="gradient"&&"stops"in y&&(G={stops:y.stops,radial:y.radial}),G=V[w].call(this,G),G!=null&&(k[w]=G)}U=y.alpha}M&&E&&(L=1)}if(this._type=E||"rgb",!k){this._components=k=[];for(var V=i[this._type],w=0,O=V.length;w<O;w++){var G=V[w].call(this,N&&N[w]);G!=null&&(k[w]=G)}}return this._components=k,this._properties=e[this._type],this._alpha=U,M&&(this.__read=L),this},set:"#initialize",_serialize:function(v,y){var x=this.getComponents();return o.serialize(/^(gray|rgb)$/.test(this._type)?x:[this._type].concat(x),v,!0,y)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(v){var y;return this._type===v?this._components.slice():(y=m[this._type+"-"+v])?y.apply(this,this._components):m["rgb-"+v].apply(this,m[this._type+"-rgb"].apply(this,this._components))},convert:function(v){return new dt(v,this._convert(v),this._alpha)},getType:function(){return this._type},setType:function(v){this._components=this._convert(v),this._properties=e[v],this._type=v},getComponents:function(){var v=this._components.slice();return this._alpha!=null&&v.push(this._alpha),v},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(v){this._alpha=v==null?null:Math.min(Math.max(v,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(v){var y=o.isPlainValue(v,!0)?dt.read(arguments):v;return y===this||y&&this._class===y._class&&this._type===y._type&&this.getAlpha()===y.getAlpha()&&o.equals(this._components,y._components)||!1},toString:function(){for(var v=this._properties,y=[],x=this._type==="gradient",M=S.instance,L=0,E=v.length;L<E;L++){var k=this._components[L];k!=null&&y.push(v[L]+": "+(x?k:M.number(k)))}return this._alpha!=null&&y.push("alpha: "+M.number(this._alpha)),"{ "+y.join(", ")+" }"},toCSS:function(v){var y=this._convert("rgb"),x=v||this._alpha==null?1:this._alpha;function M(L){return Math.round((L<0?0:L>1?1:L)*255)}return y=[M(y[0]),M(y[1]),M(y[2])],x<1&&y.push(x<0?0:x),v?"#"+((1<<24)+(y[0]<<16)+(y[1]<<8)+y[2]).toString(16).slice(1):(y.length==4?"rgba(":"rgb(")+y.join(",")+")"},toCanvasStyle:function(v,y){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var x=this._components,M=x[0],L=M._stops,E=x[1],k=x[2],U=x[3],N=y&&y.inverted(),F;if(N&&(E=N._transformPoint(E),k=N._transformPoint(k),U&&(U=N._transformPoint(U))),M._radial){var A=k.getDistance(E);if(U){var R=U.subtract(E);R.getLength()>A&&(U=E.add(R.normalize(A-.1)))}var w=U||E;F=v.createRadialGradient(w.x,w.y,0,E.x,E.y,A)}else F=v.createLinearGradient(E.x,E.y,k.x,k.y);for(var O=0,q=L.length;O<q;O++){var H=L[O],V=H._offset;F.addColorStop(V??O/(q-1),H._color.toCanvasStyle())}return this._canvasStyle=F},transform:function(v){if(this._type==="gradient"){for(var y=this._components,x=1,M=y.length;x<M;x++){var L=y[x];v._transformPoint(L,L,!0)}this._changed()}},statics:{_types:e,random:function(){var v=Math.random;return new dt(v(),v(),v())},_setOwner:function(v,y,x){return v&&(v._owner&&y&&v._owner!==y&&(v=v.clone()),!v._owner^!y&&(v._owner=y||null,v._setter=x||null)),v}}})},new function(){var e={add:function(i,r){return i+r},subtract:function(i,r){return i-r},multiply:function(i,r){return i*r},divide:function(i,r){return i/r}};return o.each(e,function(i,r){this[r]=function(l){l=dt.read(arguments);for(var f=this._type,g=this._components,m=l._convert(f),v=0,y=g.length;v<y;v++)m[v]=i(g[v],m[v]);return new dt(f,m,this._alpha!=null?i(this._alpha,l.getAlpha()):null)}},{})}),yi=o.extend({_class:"Gradient",initialize:function(i,r){this._id=D.get(),i&&o.isPlainObject(i)&&(this.set(i),i=r=null),this._stops==null&&this.setStops(i||["white","black"]),this._radial==null&&this.setRadial(typeof r=="string"&&r==="radial"||r||!1)},_serialize:function(e,i){return i.add(this,function(){return o.serialize([this._stops,this._radial],e,!0,i)})},_changed:function(){for(var e=0,i=this._owners&&this._owners.length;e<i;e++)this._owners[e]._changed()},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var i=this._owners?this._owners.indexOf(e):-1;i!=-1&&(this._owners.splice(i,1),this._owners.length||(this._owners=s))},clone:function(){for(var e=[],i=0,r=this._stops.length;i<r;i++)e[i]=this._stops[i].clone();return new yi(e,this._radial)},getStops:function(){return this._stops},setStops:function(e){if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var i=this._stops;if(i)for(var r=0,l=i.length;r<l;r++)i[r]._owner=s;i=this._stops=Qi.readList(e,0,{clone:!0});for(var r=0,l=i.length;r<l;r++)i[r]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(e){this._radial=e,this._changed()},equals:function(e){if(e===this)return!0;if(e&&this._class===e._class){var i=this._stops,r=e._stops,l=i.length;if(l===r.length){for(var f=0;f<l;f++)if(!i[f].equals(r[f]))return!1;return!0}}return!1}}),Qi=o.extend({_class:"GradientStop",initialize:function(i,r){var l=i,f=r;typeof i=="object"&&r===s&&(Array.isArray(i)&&typeof i[0]!="number"?(l=i[0],f=i[1]):("color"in i||"offset"in i||"rampPoint"in i)&&(l=i.color,f=i.offset||i.rampPoint||0)),this.setColor(l),this.setOffset(f)},clone:function(){return new Qi(this._color.clone(),this._offset)},_serialize:function(e,i){var r=this._color,l=this._offset;return o.serialize(l==null?[r]:[r,l],e,!0,i)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){dt._setOwner(this._color,null),this._color=dt._setOwner(dt.read(arguments,0),this,"setColor"),this._changed()},equals:function(e){return e===this||e&&this._class===e._class&&this._color.equals(e._color)&&this._offset==e._offset||!1}}),Ji=o.extend(new function(){var e={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new z,selectedColor:null},i=o.set({},e,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),r=o.set({},i,{fillColor:new dt}),l={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},f={beans:!0},g={_class:"Style",beans:!0,initialize:function(v,y,x){this._values={},this._owner=y,this._project=y&&y._project||x||Qe.project,this._defaults=!y||y instanceof le?i:y instanceof Dt?r:e,v&&this.set(v)}};return o.each(i,function(m,v){var y=/Color$/.test(v),x=v==="shadowOffset",M=o.capitalize(v),L=l[v],E="set"+M,k="get"+M;g[E]=function(U){var N=this._owner,F=N&&N._children,A=F&&F.length>0&&!(N instanceof it);if(A)for(var R=0,w=F.length;R<w;R++)F[R]._style[E](U);if((v==="selectedColor"||!A)&&v in this._defaults){var O=this._values[v];O!==U&&(y&&(O&&(dt._setOwner(O,null),O._canvasStyle=null),U&&U.constructor===dt&&(U=dt._setOwner(U,N,A&&E))),this._values[v]=U,N&&N._changed(L||129))}},g[k]=function(U){var N=this._owner,F=N&&N._children,A=F&&F.length>0&&!(N instanceof it),R;if(A&&!U)for(var w=0,O=F.length;w<O;w++){var q=F[w]._style[k]();if(!w)R=q;else if(!o.equals(R,q))return s}else if(v in this._defaults){var R=this._values[v];if(R===s)R=this._defaults[v],R&&R.clone&&(R=R.clone());else{var H=y?dt:x?z:null;H&&!(R&&R.constructor===H)&&(this._values[v]=R=H.read([R],0,{readNull:!0,clone:!0}))}}return R&&y&&(R=dt._setOwner(R,N,A&&E)),R},f[k]=function(U){return this._style[k](U)},f[E]=function(U){this._style[E](U)}}),o.each({Font:"FontFamily",WindingRule:"FillRule"},function(m,v){var y="get"+v,x="set"+v;g[y]=f[y]="#get"+m,g[x]=f[x]="#set"+m}),I.inject(f),g},{set:function(e){var i=e instanceof Ji,r=i?e._values:e;if(r){for(var l in r)if(l in this._defaults){var f=r[l];this[l]=f&&i&&f.clone?f.clone():f}}},equals:function(e){function i(r,l,f){var g=r._values,m=l._values,v=l._defaults;for(var y in g){var x=g[y],M=m[y];if(!(f&&y in m)&&!o.equals(x,M===s?v[y]:M))return!1}return!0}return e===this||e&&this._class===e._class&&i(this,e)&&i(e,this,!0)||!1},_dispose:function(){var e;e=this.getFillColor(),e&&(e._canvasStyle=null),e=this.getStrokeColor(),e&&(e._canvasStyle=null),e=this.getShadowColor(),e&&(e._canvasStyle=null)},hasFill:function(){var e=this.getFillColor();return!!e&&e.alpha>0},hasStroke:function(){var e=this.getStrokeColor();return!!e&&e.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var e=this.getShadowColor();return!!e&&e.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var e=this.getFontSize();return this.getFontWeight()+" "+e+(/[a-z]/i.test(e+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function e(){var i=e.base.call(this),r=this.getFontSize();return/pt|em|%|px/.test(r)&&(r=this.getView().getPixelSize(r)),i??r*1.2}}),at=new function(){function e(i,r,l,f){for(var g=["","webkit","moz","Moz","ms","o"],m=r[0].toUpperCase()+r.substring(1),v=0;v<6;v++){var y=g[v],x=y?y+m:r;if(x in i){if(l)i[x]=f;else return i[x];break}}}return{getStyles:function(i){var r=i&&i.nodeType!==9?i.ownerDocument:i,l=r&&r.defaultView;return l&&l.getComputedStyle(i,"")},getBounds:function(i,r){var l=i.ownerDocument,f=l.body,g=l.documentElement,m;try{m=i.getBoundingClientRect()}catch{m={left:0,top:0,width:0,height:0}}var v=m.left-(g.clientLeft||f.clientLeft||0),y=m.top-(g.clientTop||f.clientTop||0);if(!r){var x=l.defaultView;v+=x.pageXOffset||g.scrollLeft||f.scrollLeft,y+=x.pageYOffset||g.scrollTop||f.scrollTop}return new K(v,y,m.width,m.height)},getViewportBounds:function(i){var r=i.ownerDocument,l=r.defaultView,f=r.documentElement;return new K(0,0,l.innerWidth||f.clientWidth,l.innerHeight||f.clientHeight)},getOffset:function(i,r){return at.getBounds(i,r).getPoint()},getSize:function(i){return at.getBounds(i,!0).getSize()},isInvisible:function(i){return at.getSize(i).equals(new j(0,0))},isInView:function(i){return!at.isInvisible(i)&&at.getViewportBounds(i).intersects(at.getBounds(i,!0))},isInserted:function(i){return c.body.contains(i)},getPrefixed:function(i,r){return i&&e(i,r)},setPrefixed:function(i,r,l){if(typeof r=="object")for(var f in r)e(i,f,!0,r[f]);else e(i,r,!0,l)}}},ut={add:function(e,i){if(e)for(var r in i)for(var l=i[r],f=r.split(/[\s,]+/g),g=0,m=f.length;g<m;g++){var v=f[g],y=e===c&&(v==="touchstart"||v==="touchmove")?{passive:!1}:!1;e.addEventListener(v,l,y)}},remove:function(e,i){if(e)for(var r in i)for(var l=i[r],f=r.split(/[\s,]+/g),g=0,m=f.length;g<m;g++)e.removeEventListener(f[g],l,!1)},getPoint:function(e){var i=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return new z(i.pageX||i.clientX+c.documentElement.scrollLeft,i.pageY||i.clientY+c.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getRelatedTarget:function(e){return e.relatedTarget||e.toElement},getOffset:function(e,i){return ut.getPoint(e).subtract(at.getOffset(i||ut.getTarget(e)))}};ut.requestAnimationFrame=new function(){var e=at.getPrefixed(h,"requestAnimationFrame"),i=!1,r=[],l;function f(){var g=r;r=[];for(var m=0,v=g.length;m<v;m++)g[m]();i=e&&r.length,i&&e(f)}return function(g){r.push(g),e?i||(e(f),i=!0):l||(l=setInterval(f,1e3/60))}};var lt=o.extend(d,{_class:"View",initialize:function e(i,r){function l(L){return r[L]||parseInt(r.getAttribute(L),10)}function f(){var L=at.getSize(r);return L.isNaN()||L.isZero()?new j(l("width"),l("height")):L}var g;if(h&&r){this._id=r.getAttribute("id"),this._id==null&&r.setAttribute("id",this._id="paper-view-"+e._id++),ut.add(r,this._viewEvents);var m="none";if(at.setPrefixed(r.style,{userDrag:m,userSelect:m,touchCallout:m,contentZooming:m,tapHighlightColor:"rgba(0,0,0,0)"}),_.hasAttribute(r,"resize")){var v=this;ut.add(h,this._windowEvents={resize:function(){v.setViewSize(f())}})}if(g=f(),_.hasAttribute(r,"stats")&&typeof Stats<"u"){this._stats=new Stats;var y=this._stats.domElement,x=y.style,M=at.getOffset(r);x.position="absolute",x.left=M.x+"px",x.top=M.y+"px",c.body.appendChild(y)}}else g=new j(r),r=null;this._project=i,this._scope=i._scope,this._element=r,this._pixelRatio||(this._pixelRatio=h&&h.devicePixelRatio||1),this._setElementSize(g.width,g.height),this._viewSize=g,e._views.push(this),e._viewsById[this._id]=this,(this._matrix=new ue)._owner=this,e._focused||(e._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!Qe.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;lt._focused===this&&(lt._focused=null),lt._views.splice(lt._views.indexOf(this),1),delete lt._viewsById[this._id];var e=this._project;return e._view===this&&(e._view=null),ut.remove(this._element,this._viewEvents),ut.remove(h,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:o.each(I._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(e){this[e]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(e){this._autoUpdate=e,e&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var e=this;ut.requestAnimationFrame(function(){if(e._requested=!1,e._animate){e.requestUpdate();var i=e._element;(!at.getPrefixed(c,"hidden")||_.getAttribute(i,"keepalive")==="true")&&at.isInView(i)&&e._handleFrame()}e._autoUpdate&&e.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){Qe=this._scope;var e=Date.now()/1e3,i=this._last?e-this._last:0;this._last=e,this.emit("frame",new o({delta:i,time:this._time+=i,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(e,i){var r=this._frameItems;i?(r[e._id]={item:e,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete r[e._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(e){for(var i in this._frameItems){var r=this._frameItems[i];r.item.emit("frame",new o(e,{time:r.time+=e.delta,count:r.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=s},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var e=this._viewSize;return new re(e.width,e.height,this,"setViewSize")},setViewSize:function(){var e=j.read(arguments),i=e.subtract(this._viewSize);i.isZero()||(this._setElementSize(e.width,e.height),this._viewSize.set(e),this._changed(),this.emit("resize",{size:e,delta:i}),this._autoUpdate&&this.update())},_setElementSize:function(e,i){var r=this._element;r&&(r.width!==e&&(r.width=e),r.height!==i&&(r.height=i))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new K(new z,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return at.isInView(this._element)},isInserted:function(){return at.isInserted(this._element)},getPixelSize:function(e){var i=this._element,r;if(i){var l=i.parentNode,f=c.createElement("div");f.style.fontSize=e,l.appendChild(f),r=parseFloat(at.getStyles(f).fontSize),l.removeChild(f)}else r=parseFloat(r);return r},getTextWidth:function(e,i){return 0}},o.each(["rotate","scale","shear","skew"],function(e){var i=e==="rotate";this[e]=function(){var r=arguments,l=(i?o:z).read(r),f=z.read(r,0,{readNull:!0});return this.transform(new ue()[e](l,f||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var e=new ue;return this.transform(e.translate.apply(e,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var e=z.read(arguments);this.translate(this.getCenter().subtract(e))},getZoom:function(){var e=this._decompose().scaling;return(e.x+e.y)/2},setZoom:function(e){this.transform(new ue().scale(e/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(e){var i=this.getRotation();i!=null&&e!=null&&this.rotate(e-i)},getScaling:function(){var e=this._decompose().scaling;return new J(e.x,e.y,this,"setScaling")},setScaling:function(){var e=this.getScaling(),i=z.read(arguments,0,{clone:!0,readNull:!0});e&&i&&this.scale(i.x/e.x,i.y/e.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var e=this._matrix;e.set.apply(e,arguments)},transform:function(e){this._matrix.append(e)},scrollBy:function(){this.translate(z.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(z.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(z.read(arguments))},getEventPoint:function(e){return this.viewToProject(ut.getOffset(e,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(e,i){c&&typeof i=="string"&&(i=c.getElementById(i));var r=h?Tn:lt;return new r(e,i)}}},new function(){if(!h)return;var e,i,r=!1,l=!1;function f(W){var ee=ut.getTarget(W);return ee.getAttribute&&lt._viewsById[ee.getAttribute("id")]}function g(){var W=lt._focused;if(!W||!W.isVisible()){for(var ee=0,ie=lt._views.length;ee<ie;ee++)if((W=lt._views[ee]).isVisible()){lt._focused=i=W;break}}}function m(W,ee,ie){W._handleMouseEvent("mousemove",ee,ie)}var v=h.navigator,y,x,M;v.pointerEnabled||v.msPointerEnabled?(y="pointerdown MSPointerDown",x="pointermove MSPointerMove",M="pointerup pointercancel MSPointerUp MSPointerCancel"):(y="touchstart",x="touchmove",M="touchend touchcancel","ontouchstart"in h&&v.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(y+=" mousedown",x+=" mousemove",M+=" mouseup"));var L={},E={mouseout:function(W){var ee=lt._focused,ie=ut.getRelatedTarget(W);if(ee&&(!ie||ie.nodeName==="HTML")){var se=ut.getOffset(W,ee._element),oe=se.x,ge=Math.abs,Ie=ge(oe),Ae=1<<25,ze=Ie-Ae;se.x=ge(ze)<Ie?ze*(oe<0?-1:1):oe,m(ee,W,ee.viewToProject(se))}},scroll:g};L[y]=function(W){var ee=lt._focused=f(W);r||(r=!0,ee._handleMouseEvent("mousedown",W))},E[x]=function(W){var ee=lt._focused;if(!l){var ie=f(W);ie?ee!==ie&&(ee&&m(ee,W),e||(e=ee),ee=lt._focused=i=ie):i&&i===ee&&(e&&!e.isInserted()&&(e=null),ee=lt._focused=e,e=null,g())}ee&&m(ee,W)},E[y]=function(){l=!0},E[M]=function(W){var ee=lt._focused;ee&&r&&ee._handleMouseEvent("mouseup",W),l=r=!1},ut.add(c,E),ut.add(h,{load:g});var k=!1,U=!1,N={doubleclick:"click",mousedrag:"mousemove"},F=!1,A,R,w,O,q,H,V,G;function $(W,ee,ie,se,oe,ge,Ie){var Ae=!1,ze;function Oe(ye,xe){if(ye.responds(xe)){if(ze||(ze=new zn(xe,se,oe,ee||ye,ge?oe.subtract(ge):null)),ye.emit(xe,ze)&&(k=!0,ze.prevented&&(U=!0),ze.stopped))return Ae=!0}else{var Le=N[xe];if(Le)return Oe(ye,Le)}}for(;W&&W!==Ie&&!Oe(W,ie);)W=W._parent;return Ae}function X(W,ee,ie,se,oe,ge){return W._project.removeOn(ie),U=k=!1,q&&$(q,null,ie,se,oe,ge)||ee&&ee!==q&&!ee.isDescendant(q)&&$(ee,null,ie==="mousedrag"?"mousemove":ie,se,oe,ge,q)||$(W,q||ee||W,ie,se,oe,ge)}var te={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:L,_handleMouseEvent:function(W,ee,ie){var se=this._itemEvents,oe=se.native[W],ge=W==="mousemove",Ie=this._scope.tool,Ae=this;function ze(qe){return se.virtual[qe]||Ae.responds(qe)||Ie&&Ie.responds(qe)}ge&&r&&ze("mousedrag")&&(W="mousedrag"),ie||(ie=this.getEventPoint(ee));var Oe=this.getBounds().contains(ie),ye=oe&&Oe&&Ae._project.hitTest(ie,{tolerance:0,fill:!0,stroke:!0}),xe=ye&&ye.item||null,Le=!1,De={};if(De[W.substr(5)]=!0,oe&&xe!==O&&(O&&$(O,null,"mouseleave",ee,ie),xe&&$(xe,null,"mouseenter",ee,ie),O=xe),F^Oe&&($(this,null,Oe?"mouseenter":"mouseleave",ee,ie),Le=!0),(Oe||De.drag)&&!ie.equals(R)&&(X(this,xe,ge?W:"mousemove",ee,ie,R),Le=!0),F=Oe,De.down&&Oe||De.up&&A){if(X(this,xe,W,ee,ie,A),De.down){if(G=xe===H&&Date.now()-V<300,w=H=xe,!U&&xe){for(var Re=xe;Re&&!Re.responds("mousedrag");)Re=Re._parent;Re&&(q=xe)}A=ie}else De.up&&(!U&&xe===w&&(V=Date.now(),X(this,xe,G?"doubleclick":"click",ee,ie,A),G=!1),w=q=null);F=!1,Le=!0}R=ie,Le&&Ie&&(k=Ie._handleMouseEvent(W,ee,ie,De)||k),ee.cancelable!==!1&&(k&&!De.move||De.down&&ze("mouseup"))&&ee.preventDefault()},_handleKeyEvent:function(W,ee,ie,se){var oe=this._scope,ge=oe.tool,Ie;function Ae(ze){ze.responds(W)&&(Qe=oe,ze.emit(W,Ie=Ie||new Mn(W,ee,ie,se)))}this.isVisible()&&(Ae(this),ge&&ge.responds(W)&&Ae(ge))},_countItemEvent:function(W,ee){var ie=this._itemEvents,se=ie.native,oe=ie.virtual;for(var ge in te)se[ge]=(se[ge]||0)+(te[ge][W]||0)*ee;oe[W]=(oe[W]||0)+ee},statics:{updateFocus:g,_resetState:function(){r=l=k=F=!1,e=i=A=R=w=O=q=H=V=G=null}}}}),Tn=lt.extend({_class:"CanvasView",initialize:function(i,r){if(!(r instanceof h.HTMLCanvasElement)){var l=j.read(arguments,1);if(l.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+o.slice(arguments,1));r=pt.getCanvas(l)}var f=this._context=r.getContext("2d");if(f.save(),this._pixelRatio=1,!/^off|false$/.test(_.getAttribute(r,"hidpi"))){var g=h.devicePixelRatio||1,m=at.getPrefixed(f,"backingStorePixelRatio")||1;this._pixelRatio=g/m}lt.call(this,i,r),this._needsUpdate=!0},remove:function e(){return this._context.restore(),e.base.call(this)},_setElementSize:function e(i,r){var l=this._pixelRatio;if(e.base.call(this,i*l,r*l),l!==1){var f=this._element,g=this._context;if(!_.hasAttribute(f,"resize")){var m=f.style;m.width=i+"px",m.height=r+"px"}g.restore(),g.save(),g.scale(l,l)}},getContext:function(){return this._context},getPixelSize:function e(i){var r=Qe.agent,l;if(r&&r.firefox)l=e.base.call(this,i);else{var f=this._context,g=f.font;f.font=i+" serif",l=parseFloat(f.font),f.font=g}return l},getTextWidth:function(e,i){var r=this._context,l=r.font,f=0;r.font=e;for(var g=0,m=i.length;g<m;g++)f=Math.max(f,r.measureText(i[g]).width);return r.font=l,f},update:function(){if(!this._needsUpdate)return!1;var e=this._project,i=this._context,r=this._viewSize;return i.clearRect(0,0,r.width+1,r.height+1),e&&e.draw(i,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),ui=o.extend({_class:"Event",initialize:function(i){this.event=i,this.type=i&&i.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return bi.modifiers}}),Mn=ui.extend({_class:"KeyEvent",initialize:function(i,r,l,f){this.type=i,this.event=r,this.key=l,this.character=f},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),bi=new function(){var e={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},i={tab:"	",space:" ",enter:"\r"},r={},l={},f,g,m=new o({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var x=Qe&&Qe.agent;return x&&x.mac?this.meta:this.control}}});function v(x){var M=x.key||x.keyIdentifier;return M=/^U\+/.test(M)?String.fromCharCode(parseInt(M.substr(2),16)):/^Arrow[A-Z]/.test(M)?M.substr(5):M==="Unidentified"||M===s?String.fromCharCode(x.keyCode):M,e[M]||(M.length>1?o.hyphenate(M):M.toLowerCase())}function y(x,M,L,E){var k=lt._focused,U;if(r[M]=x,x?l[M]=L:delete l[M],M.length>1&&(U=o.camelize(M))in m){m[U]=x;var N=Qe&&Qe.agent;if(U==="meta"&&N&&N.mac)if(x)f={};else{for(var F in f)F in l&&y(!1,F,f[F],E);f=null}}else x&&f&&(f[M]=L);k&&k._handleKeyEvent(x?"keydown":"keyup",E,M,L)}return ut.add(c,{keydown:function(x){var M=v(x),L=Qe&&Qe.agent;M.length>1||L&&L.chrome&&(x.altKey||L.mac&&x.metaKey||!L.mac&&x.ctrlKey)?y(!0,M,i[M]||(M.length>1?"":M),x):g=M},keypress:function(x){if(g){var M=v(x),L=x.charCode,E=L>=32?String.fromCharCode(L):M.length>1?"":M;M!==g&&(M=E.toLowerCase()),y(!0,M,E,x),g=null}},keyup:function(x){var M=v(x);M in l&&y(!1,M,l[M],x)}}),ut.add(h,{blur:function(x){for(var M in l)y(!1,M,l[M],x)}}),{modifiers:m,isDown:function(x){return!!r[x]}}},zn=ui.extend({_class:"MouseEvent",initialize:function(i,r,l,f,g){this.type=i,this.event=r,this.point=l,this.target=f,this.delta=g},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Qt=ui.extend({_class:"ToolEvent",_item:null,initialize:function(i,r,l){this.tool=i,this.type=r,this.event=l},_choosePoint:function(e,i){return e||(i?i.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){for(var i=e.item,r=i._parent;/^(Group|CompoundPath)$/.test(r._class);)i=r,r=r._parent;this._item=i}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),xi=b.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(i){b.call(this),this._moveCount=-1,this._downCount=-1,this.set(i)},getMinDistance:function(){return this._minDistance},setMinDistance:function(e){this._minDistance=e,e!=null&&this._maxDistance!=null&&e>this._maxDistance&&(this._maxDistance=e)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){this._maxDistance=e,this._minDistance!=null&&e!=null&&e<this._minDistance&&(this._minDistance=e)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=this._maxDistance=e},_handleMouseEvent:function(e,i,r,l){Qe=this._scope,l.drag&&!this.responds(e)&&(e="mousemove");var f=l.move||l.drag,g=this.responds(e),m=!1,v=this;function y(M,L){var E=r,k=f?v._point:v._downPoint||E;if(f){if(v._moveCount>=0&&E.equals(k))return!1;if(k&&(M!=null||L!=null)){var U=E.subtract(k),N=U.getLength();if(N<(M||0))return!1;L&&(E=k.add(U.normalize(Math.min(N,L))))}v._moveCount++}return v._point=E,v._lastPoint=k||E,l.down&&(v._moveCount=-1,v._downPoint=E,v._downCount++),!0}function x(){g&&(m=v.emit(e,new Qt(v,e,i))||m)}if(l.down)y(),x();else if(l.up)y(null,this._maxDistance),x();else if(g)for(;y(this._minDistance,this._maxDistance);)x();return m}}),Di=o.extend(d,{_class:"Tween",statics:{easings:new o({linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+2*(2-e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}})},initialize:function e(i,r,l,f,g,m){this.object=i;var v=typeof g,y=v==="function";this.type=y?v:v==="string"?g:"linear",this.easing=y?g:e.easings[this.type],this.duration=f,this.running=!1,this._then=null,this._startTime=null;var x=r||l;this._keys=x?Object.keys(x):[],this._parsedKeys=this._parseKeys(this._keys),this._from=x&&this._getState(r),this._to=x&&this._getState(l),m!==!1&&this.start()},then:function(e){return this._then=e,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(e){if(this.running){e>=1&&(e=1,this.running=!1);for(var i=this.easing(e),r=this._keys,l=function(M){return typeof M=="function"?M(i,e):M},f=0,g=r&&r.length;f<g;f++){var m=r[f],v=l(this._from[m]),y=l(this._to[m]),x=v&&y&&v.__add&&y.__add?y.__subtract(v).__multiply(i).__add(v):(y-v)*i+v;this._setProperty(this._parsedKeys[m],x)}this.responds("update")&&this.emit("update",new o({progress:e,factor:i})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(e){var i=this._startTime,r=i?(e-i)/this.duration:0;i||(this._startTime=e),this.update(r)},_getState:function(e){for(var i=this._keys,r={},l=0,f=i.length;l<f;l++){var g=i[l],m=this._parsedKeys[g],v=this._getProperty(m),y;if(e){var x=this._resolveValue(v,e[g]);this._setProperty(m,x),y=this._getProperty(m),y=y&&y.clone?y.clone():y,this._setProperty(m,v)}else y=v&&v.clone?v.clone():v;r[g]=y}return r},_resolveValue:function(e,i){if(i){if(Array.isArray(i)&&i.length===2){var r=i[0];return r&&r.match&&r.match(/^[+\-\*\/]=/)?this._calculate(e,r[0],i[1]):i}else if(typeof i=="string"){var l=i.match(/^[+\-*/]=(.*)/);if(l){var f=JSON.parse(l[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(e,i[0],f)}}}return i},_calculate:function(e,i,r){return Qe.PaperScript.calculateBinary(e,i,r)},_parseKeys:function(e){for(var i={},r=0,l=e.length;r<l;r++){var f=e[r],g=f.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");i[f]=g.split("/")}return i},_getProperty:function(e,i){for(var r=this.object,l=0,f=e.length-(i||0);l<f&&r;l++)r=r[e[l]];return r},_setProperty:function(e,i){var r=this._getProperty(e,1);r&&(r[e[e.length-1]]=i)}}),Vi={request:function(e){var i=new a.XMLHttpRequest;return i.open((e.method||"get").toUpperCase(),e.url,o.pick(e.async,!0)),e.mimeType&&i.overrideMimeType(e.mimeType),i.onload=function(){var r=i.status;r===0||r===200?e.onLoad&&e.onLoad.call(i,i.responseText):i.onerror()},i.onerror=function(){var r=i.status,l='Could not load "'+e.url+'" (Status: '+r+")";if(e.onError)e.onError(l,r);else throw new Error(l)},i.send(null)}},pt=o.exports.CanvasProvider={canvases:[],getCanvas:function(e,i,r){if(!h)return null;var l,f=!0;typeof e=="object"&&(i=e.height,e=e.width),this.canvases.length?l=this.canvases.pop():(l=c.createElement("canvas"),f=!1);var g=l.getContext("2d",r||{});if(!g)throw new Error("Canvas "+l+" is unable to provide a 2D context.");return l.width===e&&l.height===i?f&&g.clearRect(0,0,e+1,i+1):(l.width=e,l.height=i),g.save(),l},getContext:function(e,i,r){var l=this.getCanvas(e,i,r);return l?l.getContext("2d",r||{}):null},release:function(e){var i=e&&e.canvas?e.canvas:e;i&&i.getContext&&(i.getContext("2d").restore(),this.canvases.push(i))}},wi=new function(){var e=Math.min,i=Math.max,r=Math.abs,l,f,g,m,v,y,x,M,L,E,k;function U(q,H,V){return .2989*q+.587*H+.114*V}function N(q,H,V,X){var $=X-U(q,H,V);L=q+$,E=H+$,k=V+$;var X=U(L,E,k),te=e(L,E,k),W=i(L,E,k);if(te<0){var ee=X-te;L=X+(L-X)*X/ee,E=X+(E-X)*X/ee,k=X+(k-X)*X/ee}if(W>255){var ie=255-X,se=W-X;L=X+(L-X)*ie/se,E=X+(E-X)*ie/se,k=X+(k-X)*ie/se}}function F(q,H,V){return i(q,H,V)-e(q,H,V)}function A(q,H,V,G){var $=[q,H,V],X=i(q,H,V),te=e(q,H,V),W;te=te===q?0:te===H?1:2,X=X===q?0:X===H?1:2,W=e(te,X)===0?i(te,X)===1?2:1:0,$[X]>$[te]?($[W]=($[W]-$[te])*G/($[X]-$[te]),$[X]=G):$[W]=$[X]=0,$[te]=0,L=$[0],E=$[1],k=$[2]}var R={multiply:function(){L=v*l/255,E=y*f/255,k=x*g/255},screen:function(){L=v+l-v*l/255,E=y+f-y*f/255,k=x+g-x*g/255},overlay:function(){L=v<128?2*v*l/255:255-2*(255-v)*(255-l)/255,E=y<128?2*y*f/255:255-2*(255-y)*(255-f)/255,k=x<128?2*x*g/255:255-2*(255-x)*(255-g)/255},"soft-light":function(){var q=l*v/255;L=q+v*(255-(255-v)*(255-l)/255-q)/255,q=f*y/255,E=q+y*(255-(255-y)*(255-f)/255-q)/255,q=g*x/255,k=q+x*(255-(255-x)*(255-g)/255-q)/255},"hard-light":function(){L=l<128?2*l*v/255:255-2*(255-l)*(255-v)/255,E=f<128?2*f*y/255:255-2*(255-f)*(255-y)/255,k=g<128?2*g*x/255:255-2*(255-g)*(255-x)/255},"color-dodge":function(){L=v===0?0:l===255?255:e(255,255*v/(255-l)),E=y===0?0:f===255?255:e(255,255*y/(255-f)),k=x===0?0:g===255?255:e(255,255*x/(255-g))},"color-burn":function(){L=v===255?255:l===0?0:i(0,255-(255-v)*255/l),E=y===255?255:f===0?0:i(0,255-(255-y)*255/f),k=x===255?255:g===0?0:i(0,255-(255-x)*255/g)},darken:function(){L=v<l?v:l,E=y<f?y:f,k=x<g?x:g},lighten:function(){L=v>l?v:l,E=y>f?y:f,k=x>g?x:g},difference:function(){L=v-l,L<0&&(L=-L),E=y-f,E<0&&(E=-E),k=x-g,k<0&&(k=-k)},exclusion:function(){L=v+l*(255-v-v)/255,E=y+f*(255-y-y)/255,k=x+g*(255-x-x)/255},hue:function(){A(l,f,g,F(v,y,x)),N(L,E,k,U(v,y,x))},saturation:function(){A(v,y,x,F(l,f,g)),N(L,E,k,U(v,y,x))},luminosity:function(){N(v,y,x,U(l,f,g))},color:function(){N(l,f,g,U(v,y,x))},add:function(){L=e(v+l,255),E=e(y+f,255),k=e(x+g,255)},subtract:function(){L=i(v-l,0),E=i(y-f,0),k=i(x-g,0)},average:function(){L=(v+l)/2,E=(y+f)/2,k=(x+g)/2},negation:function(){L=255-r(255-l-v),E=255-r(255-f-y),k=255-r(255-g-x)}},w=this.nativeModes=o.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(q){this[q]=!0},{}),O=pt.getContext(1,1,{willReadFrequently:!0});O&&(o.each(R,function(q,H){var V=H==="darken",G=!1;O.save();try{O.fillStyle=V?"#300":"#a00",O.fillRect(0,0,1,1),O.globalCompositeOperation=H,O.globalCompositeOperation===H&&(O.fillStyle=V?"#a00":"#300",O.fillRect(0,0,1,1),G=O.getImageData(0,0,1,1).data[0]!==V?170:51)}catch{}O.restore(),w[H]=G}),pt.release(O)),this.process=function(q,H,V,G,$){var X=H.canvas,te=q==="normal";if(te||w[q])V.save(),V.setTransform(1,0,0,1,0,0),V.globalAlpha=G,te||(V.globalCompositeOperation=q),V.drawImage(X,$.x,$.y),V.restore();else{var W=R[q];if(!W)return;for(var ee=V.getImageData($.x,$.y,X.width,X.height),ie=ee.data,se=H.getImageData(0,0,X.width,X.height).data,oe=0,ge=ie.length;oe<ge;oe+=4){l=se[oe],v=ie[oe],f=se[oe+1],y=ie[oe+1],g=se[oe+2],x=ie[oe+2],m=se[oe+3],M=ie[oe+3],W();var Ie=m*G/255,Ae=1-Ie;ie[oe]=Ie*L+Ae*v,ie[oe+1]=Ie*E+Ae*y,ie[oe+2]=Ie*k+Ae*x,ie[oe+3]=m*G+Ae*M}V.putImageData(ee,$.x,$.y)}}},rt=new function(){var e="http://www.w3.org/2000/svg",i="http://www.w3.org/2000/xmlns",r="http://www.w3.org/1999/xlink",l={href:r,xlink:i,xmlns:i+"/","xmlns:xlink":i+"/"};function f(v,y,x){return m(c.createElementNS(e,v),y,x)}function g(v,y){var x=l[y],M=x?v.getAttributeNS(x,y):v.getAttribute(y);return M==="null"?null:M}function m(v,y,x){for(var M in y){var L=y[M],E=l[M];typeof L=="number"&&x&&(L=x.number(L)),E?v.setAttributeNS(E,M,L):v.setAttribute(M,L)}return v}return{svg:e,xmlns:i,xlink:r,create:f,get:g,set:m}},en=o.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(e,i){return!i&&(e instanceof et||e instanceof de||e instanceof Dt)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(e,i){var r=o.capitalize(i),l=e[2];this[i]={type:e[1],property:i,attribute:e[0],toSVG:l,fromSVG:l&&o.each(l,function(f,g){this[f]=g},{}),exportFilter:e[3],get:"get"+r,set:"set"+r}},{});new function(){var e;function i(R,w,O){var q=new o,H=R.getTranslation();if(w){var V;R.isInvertible()?(R=R._shiftless(),V=R._inverseTransform(H),H=null):V=new z,q[O?"cx":"x"]=V.x,q[O?"cy":"y"]=V.y}if(!R.isIdentity()){var G=R.decompose();if(G){var $=[],X=G.rotation,te=G.scaling,W=G.skewing;H&&!H.isZero()&&$.push("translate("+e.point(H)+")"),X&&$.push("rotate("+e.number(X)+")"),(!P.isZero(te.x-1)||!P.isZero(te.y-1))&&$.push("scale("+e.point(te)+")"),W.x&&$.push("skewX("+e.number(W.x)+")"),W.y&&$.push("skewY("+e.number(W.y)+")"),q.transform=$.join(" ")}else q.transform="matrix("+R.getValues().join(",")+")"}return q}function r(R,w){for(var O=i(R._matrix),q=R._children,H=rt.create("g",O,e),V=0,G=q.length;V<G;V++){var $=q[V],X=F($,w);if(X)if($.isClipMask()){var te=rt.create("clipPath");te.appendChild(X),U($,te,"clip"),rt.set(H,{"clip-path":"url(#"+te.id+")"})}else H.appendChild(X)}return H}function l(R,w){var O=i(R._matrix,!0),q=R.getSize(),H=R.getImage();return O.x-=q.width/2,O.y-=q.height/2,O.width=q.width,O.height=q.height,O.href=w.embedImages==!1&&H&&H.src||R.toDataURL(),rt.create("image",O,e)}function f(R,w){var O=w.matchShapes;if(O){var q=R.toShape(!1);if(q)return g(q)}var H=R._segments,V=H.length,G,$=i(R._matrix);if(O&&V>=2&&!R.hasHandles())if(V>2){G=R._closed?"polygon":"polyline";for(var X=[],te=0;te<V;te++)X.push(e.point(H[te]._point));$.points=X.join(" ")}else{G="line";var W=H[0]._point,ee=H[1]._point;$.set({x1:W.x,y1:W.y,x2:ee.x,y2:ee.y})}else G="path",$.d=R.getPathData(null,w.precision);return rt.create(G,$,e)}function g(R){var w=R._type,O=R._radius,q=i(R._matrix,!0,w!=="rectangle");if(w==="rectangle"){w="rect";var H=R._size,V=H.width,G=H.height;q.x-=V/2,q.y-=G/2,q.width=V,q.height=G,O.isZero()&&(O=null)}return O&&(w==="circle"?q.r=O:(q.rx=O.width,q.ry=O.height)),rt.create(w,q,e)}function m(R,w){var O=i(R._matrix),q=R.getPathData(null,w.precision);return q&&(O.d=q),rt.create("path",O,e)}function v(R,w){var O=i(R._matrix,!0),q=R._definition,H=k(q,"symbol"),V=q._item,G=V.getStrokeBounds();return H||(H=rt.create("symbol",{viewBox:e.rectangle(G)}),H.appendChild(F(V,w)),U(q,H,"symbol")),O.href="#"+H.id,O.x+=G.x,O.y+=G.y,O.width=G.width,O.height=G.height,O.overflow="visible",rt.create("use",O,e)}function y(R){var w=k(R,"color");if(!w){var O=R.getGradient(),q=O._radial,H=R.getOrigin(),V=R.getDestination(),G;if(q){G={cx:H.x,cy:H.y,r:H.getDistance(V)};var $=R.getHighlight();$&&(G.fx=$.x,G.fy=$.y)}else G={x1:H.x,y1:H.y,x2:V.x,y2:V.y};G.gradientUnits="userSpaceOnUse",w=rt.create((q?"radial":"linear")+"Gradient",G,e);for(var X=O._stops,te=0,W=X.length;te<W;te++){var ee=X[te],ie=ee._color,se=ie.getAlpha(),oe=ee._offset;G={offset:oe??te/(W-1)},ie&&(G["stop-color"]=ie.toCSS(!0)),se<1&&(G["stop-opacity"]=se),w.appendChild(rt.create("stop",G,e))}U(R,w,"color")}return"url(#"+w.id+")"}function x(R){var w=rt.create("text",i(R._matrix,!0),e);return w.textContent=R._content,w}var M={Group:r,Layer:r,Raster:l,Path:f,Shape:g,CompoundPath:m,SymbolItem:v,PointText:x};function L(R,w,O,q){var H={},V=!q&&R.getParent(),G=[];return R._name!=null&&(H.id=R._name),o.each(en,function($){var X=$.get,te=$.type,W=R[X]();if($.exportFilter?$.exportFilter(R,W):O.reduceAttributes==!1||!V||!o.equals(V[X](),W)){if(te==="color"&&W!=null){var ee=W.getAlpha();ee<1&&(H[$.attribute+"-opacity"]=ee)}te==="style"?G.push($.attribute+": "+W):H[$.attribute]=W==null?"none":te==="color"?W.gradient?y(W):W.toCSS(!0):te==="array"?W.join(","):te==="lookup"?$.toSVG[W]:W}}),G.length&&(H.style=G.join(";")),H.opacity===1&&delete H.opacity,R._visible||(H.visibility="hidden"),rt.set(w,H,e)}var E;function k(R,w){return E||(E={ids:{},svgs:{}}),R&&E.svgs[w+"-"+(R._id||R.__id||(R.__id=D.get("svg")))]}function U(R,w,O){E||k();var q=E.ids[O]=(E.ids[O]||0)+1;w.id=O+"-"+q,E.svgs[O+"-"+(R._id||R.__id)]=w}function N(R,w){var O=R,q=null;if(E){O=R.nodeName.toLowerCase()==="svg"&&R;for(var H in E.svgs)q||(O||(O=rt.create("svg"),O.appendChild(R)),q=O.insertBefore(rt.create("defs"),O.firstChild)),q.appendChild(E.svgs[H]);E=null}return w.asString?new a.XMLSerializer().serializeToString(O):O}function F(R,w,O){var q=M[R._class],H=q&&q(R,w);if(H){var V=w.onExport;V&&(H=V(R,H,w)||H);var G=JSON.stringify(R._data);G&&G!=="{}"&&G!=="null"&&H.setAttribute("data-paper-data",G)}return H&&L(R,H,w,O)}function A(R){return R||(R={}),e=new S(R.precision),R}I.inject({exportSVG:function(R){return R=A(R),N(F(this,R,!0),R)}}),ae.inject({exportSVG:function(R){R=A(R);var w=this._children,O=this.getView(),q=o.pick(R.bounds,"view"),H=R.matrix||q==="view"&&O._matrix,V=H&&ue.read([H]),G=q==="view"?new K([0,0],O.getViewSize()):q==="content"?I._getBounds(w,V,{stroke:!0}).rect:K.read([q],0,{readNull:!0}),$={version:"1.1",xmlns:rt.svg,"xmlns:xlink":rt.xlink};G&&($.width=G.width,$.height=G.height,(G.x||G.x===0||G.y||G.y===0)&&($.viewBox=e.rectangle(G)));var X=rt.create("svg",$,e),te=X;V&&!V.isIdentity()&&(te=X.appendChild(rt.create("g",i(V),e)));for(var W=0,ee=w.length;W<ee;W++)te.appendChild(F(w[W],R,!0));return N(X,R)}})},new function(){var e={},i;function r(w,O,q,H,V,G){var $=rt.get(w,O)||G,X=$==null?H?null:q?"":0:q?$:parseFloat($);return/%\s*$/.test($)?X/100*(V?1:i[/x|^width/.test(O)?"width":"height"]):X}function l(w,O,q,H,V,G,$){return O=r(w,O||"x",!1,H,V,G),q=r(w,q||"y",!1,H,V,$),H&&(O==null||q==null)?null:new z(O,q)}function f(w,O,q,H,V){return O=r(w,O||"width",!1,H,V),q=r(w,q||"height",!1,H,V),H&&(O==null||q==null)?null:new j(O,q)}function g(w,O,q){return w==="none"?null:O==="number"?parseFloat(w):O==="array"?w?w.split(/[\s,]+/g).map(parseFloat):[]:O==="color"?F(w)||w:O==="lookup"?q[w]:w}function m(w,O,q,H){var V=w.childNodes,G=O==="clippath",$=O==="defs",X=new le,te=X._project,W=te._currentStyle,ee=[];if(!G&&!$&&(X=N(X,w,H),te._currentStyle=X._style.clone()),H)for(var ie=w.querySelectorAll("defs"),se=0,oe=ie.length;se<oe;se++)A(ie[se],q,!1);for(var se=0,oe=V.length;se<oe;se++){var ge=V[se],Ie;ge.nodeType===1&&!/^defs$/i.test(ge.nodeName)&&(Ie=A(ge,q,!1))&&!(Ie instanceof Ce)&&ee.push(Ie)}return X.addChildren(ee),G&&(X=N(X.reduce(),w,H)),te._currentStyle=W,(G||$)&&(X.remove(),X=null),X}function v(w,O){for(var q=w.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),H=[],V=0,G=q.length;V<G;V+=2)H.push(new z(parseFloat(q[V]),parseFloat(q[V+1])));var $=new Ve(H);return O==="polygon"&&$.closePath(),$}function y(w){return et.create(w.getAttribute("d"))}function x(w,O){var q=(r(w,"href",!0)||"").substring(1),H=O==="radialgradient",V;if(q)V=e[q].getGradient(),V._radial^H&&(V=V.clone(),V._radial=H);else{for(var G=w.childNodes,$=[],X=0,te=G.length;X<te;X++){var W=G[X];W.nodeType===1&&$.push(N(new Qi,W))}V=new yi($,H)}var ee,ie,se,oe=r(w,"gradientUnits",!0)!=="userSpaceOnUse";H?(ee=l(w,"cx","cy",!1,oe,"50%","50%"),ie=ee.add(r(w,"r",!1,!1,oe,"50%"),0),se=l(w,"fx","fy",!0,oe)):(ee=l(w,"x1","y1",!1,oe,"0%","0%"),ie=l(w,"x2","y2",!1,oe,"100%","0%"));var ge=N(new dt(V,ee,ie,se),w);return ge._scaleToBounds=oe,null}var M={"#document":function(w,O,q,H){for(var V=w.childNodes,G=0,$=V.length;G<$;G++){var X=V[G];if(X.nodeType===1)return A(X,q,H)}},g:m,svg:m,clippath:m,polygon:v,polyline:v,path:y,lineargradient:x,radialgradient:x,image:function(w){var O=new Pe(r(w,"href",!0));return O.on("load",function(){var q=f(w);this.setSize(q);var H=l(w).add(q.divide(2));this._matrix.append(new ue().translate(H))}),O},symbol:function(w,O,q,H){return new Ce(m(w,O,q,H),!0)},defs:m,use:function(w){var O=(r(w,"href",!0)||"").substring(1),q=e[O],H=l(w);return q?q instanceof Ce?q.place(H):q.clone().translate(H):null},circle:function(w){return new de.Circle(l(w,"cx","cy"),r(w,"r"))},ellipse:function(w){return new de.Ellipse({center:l(w,"cx","cy"),radius:f(w,"rx","ry")})},rect:function(w){return new de.Rectangle(new K(l(w),f(w)),f(w,"rx","ry"))},line:function(w){return new Ve.Line(l(w,"x1","y1"),l(w,"x2","y2"))},text:function(w){var O=new Yi(l(w).add(l(w,"dx","dy")));return O.setContent(w.textContent.trim()||""),O},switch:m};function L(w,O,q,H){if(w.transform){for(var V=(H.getAttribute(q)||"").split(/\)\s*/g),G=new ue,$=0,X=V.length;$<X;$++){var te=V[$];if(!te)break;for(var W=te.split(/\(\s*/),ee=W[0].trim(),ie=W[1].split(/[\s,]+/g),se=0,oe=ie.length;se<oe;se++)ie[se]=parseFloat(ie[se]);switch(ee){case"matrix":G.append(new ue(ie[0],ie[1],ie[2],ie[3],ie[4],ie[5]));break;case"rotate":G.rotate(ie[0],ie[1]||0,ie[2]||0);break;case"translate":G.translate(ie[0],ie[1]||0);break;case"scale":G.scale(ie);break;case"skewX":G.skew(ie[0],0);break;case"skewY":G.skew(0,ie[0]);break}}w.transform(G)}}function E(w,O,q){var H=q==="fill-opacity"?"getFillColor":"getStrokeColor",V=w[H]&&w[H]();V&&V.setAlpha(parseFloat(O))}var k=o.set(o.each(en,function(w){this[w.attribute]=function(O,q){if(O[w.set]&&(O[w.set](g(q,w.type,w.fromSVG)),w.type==="color")){var H=O[w.get]();if(H&&H._scaleToBounds){var V=O.getBounds();H.transform(new ue().translate(V.getPoint()).scale(V.getSize()))}}}},{}),{id:function(w,O){e[O]=w,w.setName&&w.setName(O)},"clip-path":function(w,O){var q=F(O);if(q)if(q=q.clone(),q.setClipMask(!0),w instanceof le)w.insertChild(0,q);else return new le(q,w)},gradientTransform:L,transform:L,"fill-opacity":E,"stroke-opacity":E,visibility:function(w,O){w.setVisible&&w.setVisible(O==="visible")},display:function(w,O){w.setVisible&&w.setVisible(O!==null)},"stop-color":function(w,O){w.setColor&&w.setColor(O)},"stop-opacity":function(w,O){w._color&&w._color.setAlpha(parseFloat(O))},offset:function(w,O){if(w.setOffset){var q=O.match(/(.*)%$/);w.setOffset(q?q[1]/100:parseFloat(O))}},viewBox:function(w,O,q,H,V){var G=new K(g(O,"array")),$=f(H,null,null,!0),X,te;if(w instanceof le){var W=$?$.divide(G.getSize()):1,te=new ue().scale(W).translate(G.getPoint().negate());X=w}else w instanceof Ce&&($&&G.setSize($),X=w._item);if(X){if(U(H,"overflow",V)!=="visible"){var ee=new de.Rectangle(G);ee.setClipMask(!0),X.addChild(ee)}te&&X.transform(te)}}});function U(w,O,q){var H=w.attributes[O],V=H&&H.value;if(!V&&w.style){var G=o.camelize(O);V=w.style[G],!V&&q.node[G]!==q.parent[G]&&(V=q.node[G])}return V?V==="none"?null:V:s}function N(w,O,q){var H=O.parentNode,V={node:at.getStyles(O)||{},parent:!q&&!/^defs$/i.test(H.tagName)&&at.getStyles(H)||{}};return o.each(k,function(G,$){var X=U(O,$,V);w=X!==s&&G(w,X,$,O,V)||w}),w}function F(w){var O=w&&w.match(/\((?:["'#]*)([^"')]+)/),q=O&&O[1],H=q&&e[h?q.replace(h.location.href.split("#")[0]+"#",""):q];return H&&H._scaleToBounds&&(H=H.clone(),H._scaleToBounds=!0),H}function A(w,O,q){var H=w.nodeName.toLowerCase(),V=H!=="#document",G=c.body,$,X,te;q&&V&&(i=Qe.getView().getSize(),i=f(w,null,null,!0)||i,$=rt.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),X=w.parentNode,te=w.nextSibling,$.appendChild(w),G.appendChild($));var W=Qe.settings,ee=W.applyMatrix,ie=W.insertItems;W.applyMatrix=!1,W.insertItems=!1;var se=M[H],oe=se&&se(w,H,O,q)||null;if(W.insertItems=ie,W.applyMatrix=ee,oe){V&&!(oe instanceof le)&&(oe=N(oe,w,q));var ge=O.onImport,Ie=V&&w.getAttribute("data-paper-data");ge&&(oe=ge(w,oe,O)||oe),O.expandShapes&&oe instanceof de&&(oe.remove(),oe=oe.toPath()),Ie&&(oe._data=JSON.parse(Ie))}return $&&(G.removeChild($),X&&(te?X.insertBefore(w,te):X.appendChild(w))),q&&(e={},oe&&o.pick(O.applyMatrix,ee)&&oe.matrix.apply(!0,!0)),oe}function R(w,O,q){if(!w)return null;O=typeof O=="function"?{onLoad:O}:O||{};var H=Qe,V=null;function G(W){try{var ee=typeof W=="object"?W:new a.DOMParser().parseFromString(W.trim(),"image/svg+xml");if(!ee.nodeName)throw ee=null,new Error("Unsupported SVG source: "+w);Qe=H,V=A(ee,O,!0),(!O||O.insert!==!1)&&q._insertItem(s,V);var ie=O.onLoad;ie&&ie(V,W)}catch(se){$(se)}}function $(W,ee){var ie=O.onError;if(ie)ie(W,ee);else throw new Error(W)}if(typeof w=="string"&&!/^[\s\S]*</.test(w)){var X=c.getElementById(w);X?G(X):Vi.request({url:w,async:!0,onLoad:G,onError:$})}else if(typeof File<"u"&&w instanceof File){var te=new FileReader;return te.onload=function(){G(te.result)},te.onerror=function(){$(te.error)},te.readAsText(w)}else G(w);return V}I.inject({importSVG:function(w,O){return R(w,O,this)}}),ae.inject({importSVG:function(w,O){return this.activate(),R(w,O,this)}})},o.exports.PaperScript=(function(){var e=this,i=e.acorn;if(!i&&typeof wl<"u")try{i=Il()}catch{}if(!i){var r,l;i=r=l={},(function(N,F){if(typeof r=="object"&&typeof l=="object")return F(r);if(typeof s=="function"&&s.amd)return s(["exports"],F);F(N.acorn||(N.acorn={}))})(this,function(N){N.version="0.5.0";var F,A,R,w;N.parse=function(Q,ne){return A=String(Q),R=A.length,q(ne),us(),ao(F.program)};var O=N.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function q(Q){F=Q||{};for(var ne in O)Object.prototype.hasOwnProperty.call(F,ne)||(F[ne]=O[ne]);w=F.sourceFile||null}var H=N.getLineInfo=function(Q,ne){for(var ve=1,Se=0;;){Bi.lastIndex=Se;var je=Bi.exec(Q);if(je&&je.index<ne)++ve,Se=je.index+je[0].length;else break}return{line:ve,column:ne-Se}};N.tokenize=function(Q,ne){A=String(Q),R=A.length,q(ne),us();var ve={};function Se(je){return Ie=$,ki(je),ve.start=G,ve.end=$,ve.startLoc=X,ve.endLoc=te,ve.type=W,ve.value=ee,ve}return Se.jumpTo=function(je,$e){if(V=je,F.locations){se=1,oe=Bi.lastIndex=0;for(var Xe;(Xe=Bi.exec(A))&&Xe.index<je;)++se,oe=Xe.index+Xe[0].length}ie=$e,Ui()},Se};var V,G,$,X,te,W,ee,ie,se,oe,ge,Ie,Ae,ze,Oe,ye;function xe(Q,ne){var ve=H(A,Q);ne+=" ("+ve.line+":"+ve.column+")";var Se=new SyntaxError(ne);throw Se.pos=Q,Se.loc=ve,Se.raisedAt=V,Se}var Le=[],De={type:"num"},Re={type:"regexp"},qe={type:"string"},Be={type:"name"},Ze={type:"eof"},Ye={keyword:"break"},Ge={keyword:"case",beforeExpr:!0},_t={keyword:"catch"},gt={keyword:"continue"},xt={keyword:"debugger"},mt={keyword:"default"},Te={keyword:"do",isLoop:!0},ht={keyword:"else",beforeExpr:!0},ct={keyword:"finally"},yt={keyword:"for",isLoop:!0},Vt={keyword:"function"},Wt={keyword:"if"},Ft={keyword:"return",beforeExpr:!0},Bt={keyword:"switch"},kt={keyword:"throw",beforeExpr:!0},Nt={keyword:"try"},Zt={keyword:"var"},bt={keyword:"while",isLoop:!0},Et={keyword:"with"},Ln={keyword:"new",beforeExpr:!0},tn={keyword:"this"},Nn={keyword:"null",atomValue:null},On={keyword:"true",atomValue:!0},Rn={keyword:"false",atomValue:!1},Fi={keyword:"in",binop:7,beforeExpr:!0},li={break:Ye,case:Ge,catch:_t,continue:gt,debugger:xt,default:mt,do:Te,else:ht,finally:ct,for:yt,function:Vt,if:Wt,return:Ft,switch:Bt,throw:kt,try:Nt,var:Zt,while:bt,with:Et,null:Nn,true:On,false:Rn,new:Ln,in:Fi,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:tn,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},Ci={type:"[",beforeExpr:!0},Si={type:"]"},Jt={type:"{",beforeExpr:!0},Ht={type:"}"},Ke={type:"(",beforeExpr:!0},Ut={type:")"},Gt={type:",",beforeExpr:!0},qt={type:";",beforeExpr:!0},ei={type:":",beforeExpr:!0},nn={type:"."},rn={type:"?",beforeExpr:!0},sn={binop:10,beforeExpr:!0},n={isAssign:!0,beforeExpr:!0},p={isAssign:!0,beforeExpr:!0},T={postfix:!0,prefix:!0,isUpdate:!0},B={prefix:!0,beforeExpr:!0},Z={binop:1,beforeExpr:!0},he={binop:2,beforeExpr:!0},me={binop:3,beforeExpr:!0},Ee={binop:4,beforeExpr:!0},Ne={binop:5,beforeExpr:!0},We={binop:6,beforeExpr:!0},Je={binop:7,beforeExpr:!0},ot={binop:8,beforeExpr:!0},Ct={binop:9,prefix:!0,beforeExpr:!0},Pi={binop:10,beforeExpr:!0};N.tokTypes={bracketL:Ci,bracketR:Si,braceL:Jt,braceR:Ht,parenL:Ke,parenR:Ut,comma:Gt,semi:qt,colon:ei,dot:nn,question:rn,slash:sn,eq:n,name:Be,eof:Ze,num:De,regexp:Re,string:qe};for(var ti in li)N.tokTypes["_"+ti]=li[ti];function Xt(Q){Q=Q.split(" ");var ne="",ve=[];e:for(var Se=0;Se<Q.length;++Se){for(var je=0;je<ve.length;++je)if(ve[je][0].length==Q[Se].length){ve[je].push(Q[Se]);continue e}ve.push([Q[Se]])}function $e(st){if(st.length==1)return ne+="return str === "+JSON.stringify(st[0])+";";ne+="switch(str){";for(var Kt=0;Kt<st.length;++Kt)ne+="case "+JSON.stringify(st[Kt])+":";ne+="return true}return false;"}if(ve.length>3){ve.sort(function(st,Kt){return Kt.length-st.length}),ne+="switch(str.length){";for(var Se=0;Se<ve.length;++Se){var Xe=ve[Se];ne+="case "+Xe[0].length+":",$e(Xe)}ne+="}"}else $e(Q);return new Function("str",ne)}var hi=Xt("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),ci=Xt("class enum extends super const export import"),rs=Xt("implements interface let package private protected public static yield"),Dn=Xt("eval arguments"),Ga=Xt("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),ja=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,ss="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Wa="------------------------------------------------------------------------------------------------------------------------------------------",as=new RegExp("["+ss+"]"),Za=new RegExp("["+ss+Wa+"]"),Vn=/[\n\r\u2028\u2029]/,Bi=/\r\n|[\n\r\u2028\u2029]/g,Fn=N.isIdentifierStart=function(Q){return Q<65?Q===36:Q<91?!0:Q<97?Q===95:Q<123?!0:Q>=170&&as.test(String.fromCharCode(Q))},os=N.isIdentifierChar=function(Q){return Q<48?Q===36:Q<58?!0:Q<65?!1:Q<91?!0:Q<97?Q===95:Q<123?!0:Q>=170&&Za.test(String.fromCharCode(Q))};function Ii(){this.line=se,this.column=V-oe}function us(){se=1,V=oe=0,ie=!0,Ui()}function St(Q,ne){$=V,F.locations&&(te=new Ii),W=Q,Ui(),ee=ne,ie=Q.beforeExpr}function $a(){var Q=F.onComment&&F.locations&&new Ii,ne=V,ve=A.indexOf("*/",V+=2);if(ve===-1&&xe(V-2,"Unterminated comment"),V=ve+2,F.locations){Bi.lastIndex=ne;for(var Se;(Se=Bi.exec(A))&&Se.index<V;)++se,oe=Se.index+Se[0].length}F.onComment&&F.onComment(!0,A.slice(ne+2,ve),ne,V,Q,F.locations&&new Ii)}function pr(){for(var Q=V,ne=F.onComment&&F.locations&&new Ii,ve=A.charCodeAt(V+=2);V<R&&ve!==10&&ve!==13&&ve!==8232&&ve!==8233;)++V,ve=A.charCodeAt(V);F.onComment&&F.onComment(!1,A.slice(Q+2,V),Q,V,ne,F.locations&&new Ii)}function Ui(){for(;V<R;){var Q=A.charCodeAt(V);if(Q===32)++V;else if(Q===13){++V;var ne=A.charCodeAt(V);ne===10&&++V,F.locations&&(++se,oe=V)}else if(Q===10||Q===8232||Q===8233)++V,F.locations&&(++se,oe=V);else if(Q>8&&Q<14)++V;else if(Q===47){var ne=A.charCodeAt(V+1);if(ne===42)$a();else if(ne===47)pr();else break}else if(Q===160)++V;else if(Q>=5760&&ja.test(String.fromCharCode(Q)))++V;else break}}function Ka(){var Q=A.charCodeAt(V+1);return Q>=48&&Q<=57?hs(!0):(++V,St(nn))}function Xa(){var Q=A.charCodeAt(V+1);return ie?(++V,ls()):Q===61?Pt(p,2):Pt(sn,1)}function Ya(){var Q=A.charCodeAt(V+1);return Q===61?Pt(p,2):Pt(Pi,1)}function Qa(Q){var ne=A.charCodeAt(V+1);return ne===Q?Pt(Q===124?Z:he,2):ne===61?Pt(p,2):Pt(Q===124?me:Ne,1)}function Ja(){var Q=A.charCodeAt(V+1);return Q===61?Pt(p,2):Pt(Ee,1)}function eo(Q){var ne=A.charCodeAt(V+1);return ne===Q?ne==45&&A.charCodeAt(V+2)==62&&Vn.test(A.slice(Ie,V))?(V+=3,pr(),Ui(),ki()):Pt(T,2):ne===61?Pt(p,2):Pt(Ct,1)}function to(Q){var ne=A.charCodeAt(V+1),ve=1;return ne===Q?(ve=Q===62&&A.charCodeAt(V+2)===62?3:2,A.charCodeAt(V+ve)===61?Pt(p,ve+1):Pt(ot,ve)):ne==33&&Q==60&&A.charCodeAt(V+2)==45&&A.charCodeAt(V+3)==45?(V+=4,pr(),Ui(),ki()):(ne===61&&(ve=A.charCodeAt(V+2)===61?3:2),Pt(Je,ve))}function io(Q){var ne=A.charCodeAt(V+1);return ne===61?Pt(We,A.charCodeAt(V+2)===61?3:2):Pt(Q===61?n:B,1)}function no(Q){switch(Q){case 46:return Ka();case 40:return++V,St(Ke);case 41:return++V,St(Ut);case 59:return++V,St(qt);case 44:return++V,St(Gt);case 91:return++V,St(Ci);case 93:return++V,St(Si);case 123:return++V,St(Jt);case 125:return++V,St(Ht);case 58:return++V,St(ei);case 63:return++V,St(rn);case 48:var ne=A.charCodeAt(V+1);if(ne===120||ne===88)return ro();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return hs(!1);case 34:case 39:return so(Q);case 47:return Xa();case 37:case 42:return Ya();case 124:case 38:return Qa(Q);case 94:return Ja();case 43:case 45:return eo(Q);case 60:case 62:return to(Q);case 61:case 33:return io(Q);case 126:return Pt(B,1)}return!1}function ki(Q){if(Q?V=G+1:G=V,F.locations&&(X=new Ii),Q)return ls();if(V>=R)return St(Ze);var ne=A.charCodeAt(V);if(Fn(ne)||ne===92)return fs();var ve=no(ne);if(ve===!1){var Se=String.fromCharCode(ne);if(Se==="\\"||as.test(Se))return fs();xe(V,"Unexpected character '"+Se+"'")}return ve}function Pt(Q,ne){var ve=A.slice(V,V+ne);V+=ne,St(Q,ve)}function ls(){for(var je="",Q,ne,ve=V;;){V>=R&&xe(ve,"Unterminated regular expression");var Se=A.charAt(V);if(Vn.test(Se)&&xe(ve,"Unterminated regular expression"),Q)Q=!1;else{if(Se==="[")ne=!0;else if(Se==="]"&&ne)ne=!1;else if(Se==="/"&&!ne)break;Q=Se==="\\"}++V}var je=A.slice(ve,V);++V;var $e=cs();$e&&!/^[gmsiy]*$/.test($e)&&xe(ve,"Invalid regexp flag");try{var Xe=new RegExp(je,$e)}catch(st){st instanceof SyntaxError&&xe(ve,st.message),xe(st)}return St(Re,Xe)}function an(Q,ne){for(var ve=V,Se=0,je=0,$e=ne??1/0;je<$e;++je){var Xe=A.charCodeAt(V),st;if(Xe>=97?st=Xe-97+10:Xe>=65?st=Xe-65+10:Xe>=48&&Xe<=57?st=Xe-48:st=1/0,st>=Q)break;++V,Se=Se*Q+st}return V===ve||ne!=null&&V-ve!==ne?null:Se}function ro(){V+=2;var Q=an(16);return Q==null&&xe(G+2,"Expected hexadecimal number"),Fn(A.charCodeAt(V))&&xe(V,"Identifier directly after number"),St(De,Q)}function hs(Q){var ne=V,ve=!1,Se=A.charCodeAt(V)===48;!Q&&an(10)===null&&xe(ne,"Invalid number"),A.charCodeAt(V)===46&&(++V,an(10),ve=!0);var je=A.charCodeAt(V);(je===69||je===101)&&(je=A.charCodeAt(++V),(je===43||je===45)&&++V,an(10)===null&&xe(ne,"Invalid number"),ve=!0),Fn(A.charCodeAt(V))&&xe(V,"Identifier directly after number");var $e=A.slice(ne,V),Xe;return ve?Xe=parseFloat($e):!Se||$e.length===1?Xe=parseInt($e,10):/[89]/.test($e)||ye?xe(ne,"Invalid number"):Xe=parseInt($e,8),St(De,Xe)}function so(Q){V++;for(var ne="";;){V>=R&&xe(G,"Unterminated string constant");var ve=A.charCodeAt(V);if(ve===Q)return++V,St(qe,ne);if(ve===92){ve=A.charCodeAt(++V);var Se=/^[0-7]+/.exec(A.slice(V,V+3));for(Se&&(Se=Se[0]);Se&&parseInt(Se,8)>255;)Se=Se.slice(0,-1);if(Se==="0"&&(Se=null),++V,Se)ye&&xe(V-2,"Octal literal in strict mode"),ne+=String.fromCharCode(parseInt(Se,8)),V+=Se.length-1;else switch(ve){case 110:ne+=`
`;break;case 114:ne+="\r";break;case 120:ne+=String.fromCharCode(Bn(2));break;case 117:ne+=String.fromCharCode(Bn(4));break;case 85:ne+=String.fromCharCode(Bn(8));break;case 116:ne+="	";break;case 98:ne+="\b";break;case 118:ne+="\v";break;case 102:ne+="\f";break;case 48:ne+="\0";break;case 13:A.charCodeAt(V)===10&&++V;case 10:F.locations&&(oe=V,++se);break;default:ne+=String.fromCharCode(ve);break}}else(ve===13||ve===10||ve===8232||ve===8233)&&xe(G,"Unterminated string constant"),ne+=String.fromCharCode(ve),++V}}function Bn(Q){var ne=an(16,Q);return ne===null&&xe(G,"Bad character escape sequence"),ne}var qi;function cs(){qi=!1;for(var Q,ne=!0,ve=V;;){var Se=A.charCodeAt(V);if(os(Se))qi&&(Q+=A.charAt(V)),++V;else if(Se===92){qi||(Q=A.slice(ve,V)),qi=!0,A.charCodeAt(++V)!=117&&xe(V,"Expecting Unicode escape sequence \\uXXXX"),++V;var je=Bn(4),$e=String.fromCharCode(je);$e||xe(V-1,"Invalid Unicode escape"),(ne?Fn(je):os(je))||xe(V-4,"Invalid Unicode escape"),Q+=$e}else break;ne=!1}return qi?Q:A.slice(ve,V)}function fs(){var Q=cs(),ne=Be;return!qi&&Ga(Q)&&(ne=li[Q]),St(ne,Q)}function nt(){ge=G,Ie=$,Ae=te,ki()}function gr(Q){if(ye=Q,V=G,F.locations)for(;V<oe;)oe=A.lastIndexOf(`
`,oe-2)+1,--se;Ui(),ki()}function ds(){this.type=null,this.start=G,this.end=null}function ps(){this.start=X,this.end=null,w!==null&&(this.source=w)}function At(){var Q=new ds;return F.locations&&(Q.loc=new ps),F.directSourceFile&&(Q.sourceFile=F.directSourceFile),F.ranges&&(Q.range=[G,0]),Q}function fi(Q){var ne=new ds;return ne.start=Q.start,F.locations&&(ne.loc=new ps,ne.loc.start=Q.loc.start),F.ranges&&(ne.range=[Q.range[0],0]),ne}function tt(Q,ne){return Q.type=ne,Q.end=Ie,F.locations&&(Q.loc.end=Ae),F.ranges&&(Q.range[1]=Ie),Q}function mr(Q){return F.ecmaVersion>=5&&Q.type==="ExpressionStatement"&&Q.expression.type==="Literal"&&Q.expression.value==="use strict"}function vt(Q){if(W===Q)return nt(),!0}function Un(){return!F.strictSemicolons&&(W===Ze||W===Ht||Vn.test(A.slice(Ie,G)))}function Ei(){!vt(qt)&&!Un()&&ii()}function wt(Q){W===Q?nt():ii()}function ii(){xe(G,"Unexpected token")}function qn(Q){Q.type!=="Identifier"&&Q.type!=="MemberExpression"&&xe(Q.start,"Assigning to rvalue"),ye&&Q.type==="Identifier"&&Dn(Q.name)&&xe(Q.start,"Assigning to "+Q.name+" in strict mode")}function ao(Q){ge=Ie=V,F.locations&&(Ae=new Ii),ze=ye=null,Oe=[],ki();var ne=Q||At(),ve=!0;for(Q||(ne.body=[]);W!==Ze;){var Se=$t();ne.body.push(Se),ve&&mr(Se)&&gr(!0),ve=!1}return tt(ne,"Program")}var vr={kind:"loop"},oo={kind:"switch"};function $t(){(W===sn||W===p&&ee=="/=")&&ki(!0);var Q=W,ne=At();switch(Q){case Ye:case gt:nt();var ve=Q===Ye;vt(qt)||Un()?ne.label=null:W!==Be?ii():(ne.label=di(),Ei());for(var Se=0;Se<Oe.length;++Se){var je=Oe[Se];if((ne.label==null||je.name===ne.label.name)&&(je.kind!=null&&(ve||je.kind==="loop")||ne.label&&ve))break}return Se===Oe.length&&xe(ne.start,"Unsyntactic "+Q.keyword),tt(ne,ve?"BreakStatement":"ContinueStatement");case xt:return nt(),Ei(),tt(ne,"DebuggerStatement");case Te:return nt(),Oe.push(vr),ne.body=$t(),Oe.pop(),wt(bt),ne.test=on(),Ei(),tt(ne,"DoWhileStatement");case yt:if(nt(),Oe.push(vr),wt(Ke),W===qt)return _r(ne,null);if(W===Zt){var $e=At();return nt(),ms($e,!0),tt($e,"VariableDeclaration"),$e.declarations.length===1&&vt(Fi)?gs(ne,$e):_r(ne,$e)}var $e=Tt(!1,!0);return vt(Fi)?(qn($e),gs(ne,$e)):_r(ne,$e);case Vt:return nt(),Cr(ne,!0);case Wt:return nt(),ne.test=on(),ne.consequent=$t(),ne.alternate=vt(ht)?$t():null,tt(ne,"IfStatement");case Ft:return!ze&&!F.allowReturnOutsideFunction&&xe(G,"'return' outside of function"),nt(),vt(qt)||Un()?ne.argument=null:(ne.argument=Tt(),Ei()),tt(ne,"ReturnStatement");case Bt:nt(),ne.discriminant=on(),ne.cases=[],wt(Jt),Oe.push(oo);for(var Xe,st;W!=Ht;)if(W===Ge||W===mt){var Kt=W===Ge;Xe&&tt(Xe,"SwitchCase"),ne.cases.push(Xe=At()),Xe.consequent=[],nt(),Kt?Xe.test=Tt():(st&&xe(ge,"Multiple default clauses"),st=!0,Xe.test=null),wt(ei)}else Xe||ii(),Xe.consequent.push($t());return Xe&&tt(Xe,"SwitchCase"),nt(),Oe.pop(),tt(ne,"SwitchStatement");case kt:return nt(),Vn.test(A.slice(Ie,G))&&xe(Ie,"Illegal newline after throw"),ne.argument=Tt(),Ei(),tt(ne,"ThrowStatement");case Nt:if(nt(),ne.block=un(),ne.handler=null,W===_t){var Ai=At();nt(),wt(Ke),Ai.param=di(),ye&&Dn(Ai.param.name)&&xe(Ai.param.start,"Binding "+Ai.param.name+" in strict mode"),wt(Ut),Ai.guard=null,Ai.body=un(),ne.handler=tt(Ai,"CatchClause")}return ne.guardedHandlers=Le,ne.finalizer=vt(ct)?un():null,!ne.handler&&!ne.finalizer&&xe(ne.start,"Missing catch or finally clause"),tt(ne,"TryStatement");case Zt:return nt(),ms(ne),Ei(),tt(ne,"VariableDeclaration");case bt:return nt(),ne.test=on(),Oe.push(vr),ne.body=$t(),Oe.pop(),tt(ne,"WhileStatement");case Et:return ye&&xe(G,"'with' in strict mode"),nt(),ne.object=on(),ne.body=$t(),tt(ne,"WithStatement");case Jt:return un();case qt:return nt(),tt(ne,"EmptyStatement");default:var Pr=ee,Hn=Tt();if(Q===Be&&Hn.type==="Identifier"&&vt(ei)){for(var Se=0;Se<Oe.length;++Se)Oe[Se].name===Pr&&xe(Hn.start,"Label '"+Pr+"' is already declared");var po=W.isLoop?"loop":W===Bt?"switch":null;return Oe.push({name:Pr,kind:po}),ne.body=$t(),Oe.pop(),ne.label=Hn,tt(ne,"LabeledStatement")}else return ne.expression=Hn,Ei(),tt(ne,"ExpressionStatement")}}function on(){wt(Ke);var Q=Tt();return wt(Ut),Q}function un(Q){var ne=At(),ve=!0,Se=!1,je;for(ne.body=[],wt(Jt);!vt(Ht);){var $e=$t();ne.body.push($e),ve&&Q&&mr($e)&&(je=Se,gr(Se=!0)),ve=!1}return Se&&!je&&gr(!1),tt(ne,"BlockStatement")}function _r(Q,ne){return Q.init=ne,wt(qt),Q.test=W===qt?null:Tt(),wt(qt),Q.update=W===Ut?null:Tt(),wt(Ut),Q.body=$t(),Oe.pop(),tt(Q,"ForStatement")}function gs(Q,ne){return Q.left=ne,Q.right=Tt(),wt(Ut),Q.body=$t(),Oe.pop(),tt(Q,"ForInStatement")}function ms(Q,ne){for(Q.declarations=[],Q.kind="var";;){var ve=At();if(ve.id=di(),ye&&Dn(ve.id.name)&&xe(ve.id.start,"Binding "+ve.id.name+" in strict mode"),ve.init=vt(n)?Tt(!0,ne):null,Q.declarations.push(tt(ve,"VariableDeclarator")),!vt(Gt))break}return Q}function Tt(Q,ne){var ve=yr(ne);if(!Q&&W===Gt){var Se=fi(ve);for(Se.expressions=[ve];vt(Gt);)Se.expressions.push(yr(ne));return tt(Se,"SequenceExpression")}return ve}function yr(Q){var ne=uo(Q);if(W.isAssign){var ve=fi(ne);return ve.operator=ee,ve.left=ne,nt(),ve.right=yr(Q),qn(ne),tt(ve,"AssignmentExpression")}return ne}function uo(Q){var ne=lo(Q);if(vt(rn)){var ve=fi(ne);return ve.test=ne,ve.consequent=Tt(!0),wt(ei),ve.alternate=Tt(!0,Q),tt(ve,"ConditionalExpression")}return ne}function lo(Q){return br(xr(),-1,Q)}function br(Q,ne,ve){var Se=W.binop;if(Se!=null&&(!ve||W!==Fi)&&Se>ne){var je=fi(Q);je.left=Q,je.operator=ee;var $e=W;nt(),je.right=br(xr(),Se,ve);var Xe=tt(je,$e===Z||$e===he?"LogicalExpression":"BinaryExpression");return br(Xe,ne,ve)}return Q}function xr(){if(W.prefix){var Q=At(),ne=W.isUpdate;return Q.operator=ee,Q.prefix=!0,ie=!0,nt(),Q.argument=xr(),ne?qn(Q.argument):ye&&Q.operator==="delete"&&Q.argument.type==="Identifier"&&xe(Q.start,"Deleting local variable in strict mode"),tt(Q,ne?"UpdateExpression":"UnaryExpression")}for(var ve=ho();W.postfix&&!Un();){var Q=fi(ve);Q.operator=ee,Q.prefix=!1,Q.argument=ve,qn(ve),nt(),ve=tt(Q,"UpdateExpression")}return ve}function ho(){return ln(wr())}function ln(Q,ne){if(vt(nn)){var ve=fi(Q);return ve.object=Q,ve.property=di(!0),ve.computed=!1,ln(tt(ve,"MemberExpression"),ne)}else if(vt(Ci)){var ve=fi(Q);return ve.object=Q,ve.property=Tt(),ve.computed=!0,wt(Si),ln(tt(ve,"MemberExpression"),ne)}else if(!ne&&vt(Ke)){var ve=fi(Q);return ve.callee=Q,ve.arguments=Sr(Ut,!1),ln(tt(ve,"CallExpression"),ne)}else return Q}function wr(){switch(W){case tn:var Se=At();return nt(),tt(Se,"ThisExpression");case Be:return di();case De:case qe:case Re:var Se=At();return Se.value=ee,Se.raw=A.slice(G,$),nt(),tt(Se,"Literal");case Nn:case On:case Rn:var Se=At();return Se.value=W.atomValue,Se.raw=W.keyword,nt(),tt(Se,"Literal");case Ke:var Q=X,ne=G;nt();var ve=Tt();return ve.start=ne,ve.end=$,F.locations&&(ve.loc.start=Q,ve.loc.end=te),F.ranges&&(ve.range=[ne,$]),wt(Ut),ve;case Ci:var Se=At();return nt(),Se.elements=Sr(Si,!0,!0),tt(Se,"ArrayExpression");case Jt:return fo();case Vt:var Se=At();return nt(),Cr(Se,!1);case Ln:return co();default:ii()}}function co(){var Q=At();return nt(),Q.callee=ln(wr(),!0),vt(Ke)?Q.arguments=Sr(Ut,!1):Q.arguments=Le,tt(Q,"NewExpression")}function fo(){var Q=At(),ne=!0,ve=!1;for(Q.properties=[],nt();!vt(Ht);){if(ne)ne=!1;else if(wt(Gt),F.allowTrailingCommas&&vt(Ht))break;var Se={key:vs()},je=!1,$e;if(vt(ei)?(Se.value=Tt(!0),$e=Se.kind="init"):F.ecmaVersion>=5&&Se.key.type==="Identifier"&&(Se.key.name==="get"||Se.key.name==="set")?(je=ve=!0,$e=Se.kind=Se.key.name,Se.key=vs(),W!==Ke&&ii(),Se.value=Cr(At(),!1)):ii(),Se.key.type==="Identifier"&&(ye||ve))for(var Xe=0;Xe<Q.properties.length;++Xe){var st=Q.properties[Xe];if(st.key.name===Se.key.name){var Kt=$e==st.kind||je&&st.kind==="init"||$e==="init"&&(st.kind==="get"||st.kind==="set");Kt&&!ye&&$e==="init"&&st.kind==="init"&&(Kt=!1),Kt&&xe(Se.key.start,"Redefinition of property")}}Q.properties.push(Se)}return tt(Q,"ObjectExpression")}function vs(){return W===De||W===qe?wr():di(!0)}function Cr(Q,ne){W===Be?Q.id=di():ne?ii():Q.id=null,Q.params=[];var ve=!0;for(wt(Ke);!vt(Ut);)ve?ve=!1:wt(Gt),Q.params.push(di());var Se=ze,je=Oe;if(ze=!0,Oe=[],Q.body=un(!0),ze=Se,Oe=je,ye||Q.body.body.length&&mr(Q.body.body[0]))for(var $e=Q.id?-1:0;$e<Q.params.length;++$e){var Xe=$e<0?Q.id:Q.params[$e];if((rs(Xe.name)||Dn(Xe.name))&&xe(Xe.start,"Defining '"+Xe.name+"' in strict mode"),$e>=0)for(var st=0;st<$e;++st)Xe.name===Q.params[st].name&&xe(Xe.start,"Argument name clash in strict mode")}return tt(Q,ne?"FunctionDeclaration":"FunctionExpression")}function Sr(Q,ne,ve){for(var Se=[],je=!0;!vt(Q);){if(je)je=!1;else if(wt(Gt),ne&&F.allowTrailingCommas&&vt(Q))break;ve&&W===Gt?Se.push(null):Se.push(Tt(!0))}return Se}function di(Q){var ne=At();return Q&&F.forbidReserved=="everywhere"&&(Q=!1),W===Be?(!Q&&(F.forbidReserved&&(F.ecmaVersion===3?hi:ci)(ee)||ye&&rs(ee))&&A.slice(G,$).indexOf("\\")==-1&&xe(G,"The keyword '"+ee+"' is reserved"),ne.name=ee):Q&&W.keyword?ne.name=W.keyword:ii(),ie=!1,nt(),tt(ne,"Identifier")}}),i.version||(i=null)}function f(N,F){return(e.acorn||i).parse(N,F)}var g={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},m={"-":"__negate","+":"__self"},v=o.each(["add","subtract","multiply","divide","modulo","equals","negate"],function(N){this["__"+N]="#"+N},{__self:function(){return this}});z.inject(v),j.inject(v),dt.inject(v);function y(N,F,A){var R=g[F];if(N&&N[R]){var w=N[R](A);return F==="!="?!w:w}switch(F){case"+":return N+A;case"-":return N-A;case"*":return N*A;case"/":return N/A;case"%":return N%A;case"==":return N==A;case"!=":return N!=A}}function x(N,F){var A=m[N];if(F&&F[A])return F[A]();switch(N){case"+":return+F;case"-":return-F}}function M(N,F){if(!N)return"";F=F||{};var A=[];function R(ye){for(var xe=0,Le=A.length;xe<Le;xe++){var De=A[xe];if(De[0]>=ye)break;ye+=De[1]}return ye}function w(ye){return N.substring(R(ye.range[0]),R(ye.range[1]))}function O(ye,xe){return N.substring(R(ye.range[1]),R(xe.range[0]))}function q(ye,xe){for(var Le=R(ye.range[0]),De=R(ye.range[1]),Re=0,qe=A.length-1;qe>=0;qe--)if(Le>A[qe][0]){Re=qe+1;break}A.splice(Re,0,[Le,xe.length-De+Le]),N=N.substring(0,Le)+xe+N.substring(De)}function H(ye,xe){switch(ye.type){case"UnaryExpression":if(ye.operator in m&&ye.argument.type!=="Literal"){var Le=w(ye.argument);q(ye,'$__("'+ye.operator+'", '+Le+")")}break;case"BinaryExpression":if(ye.operator in g&&ye.left.type!=="Literal"){var De=w(ye.left),Re=w(ye.right),qe=O(ye.left,ye.right),Be=ye.operator;q(ye,"__$__("+De+","+qe.replace(new RegExp("\\"+Be),'"'+Be+'"')+", "+Re+")")}break;case"UpdateExpression":case"AssignmentExpression":var Ze=xe&&xe.type;if(!(Ze==="ForStatement"||Ze==="BinaryExpression"&&/^[=!<>]/.test(xe.operator)||Ze==="MemberExpression"&&xe.computed)){if(ye.type==="UpdateExpression"){var Le=w(ye.argument),Ye="__$__("+Le+', "'+ye.operator[0]+'", 1)',Ge=Le+" = "+Ye;ye.prefix?Ge="("+Ge+")":(Ze==="AssignmentExpression"||Ze==="VariableDeclarator"||Ze==="BinaryExpression")&&(w(xe.left||xe.id)===Le&&(Ge=Ye),Ge=Le+"; "+Ge),q(ye,Ge)}else if(/^.=$/.test(ye.operator)&&ye.left.type!=="Literal"){var De=w(ye.left),Re=w(ye.right),Ye=De+" = __$__("+De+', "'+ye.operator[0]+'", '+Re+")";q(ye,/^\(.*\)$/.test(w(ye))?"("+Ye+")":Ye)}}break}}function V(ye){switch(ye.type){case"ExportDefaultDeclaration":q({range:[ye.start,ye.declaration.start]},"module.exports = ");break;case"ExportNamedDeclaration":var xe=ye.declaration,Le=ye.specifiers;if(xe){var De=xe.declarations;De&&(De.forEach(function(qe){q(qe,"module.exports."+w(qe))}),q({range:[ye.start,xe.start+xe.kind.length]},""))}else if(Le){var Re=Le.map(function(qe){var Be=w(qe);return"module.exports."+Be+" = "+Be+"; "}).join("");Re&&q(ye,Re)}break}}function G(ye,xe,Le){if(ye){for(var De in ye)if(De!=="range"&&De!=="loc"){var Re=ye[De];if(Array.isArray(Re))for(var qe=0,Be=Re.length;qe<Be;qe++)G(Re[qe],ye,Le);else Re&&typeof Re=="object"&&G(Re,ye,Le)}Le.operatorOverloading!==!1&&H(ye,xe),Le.moduleExports!==!1&&V(ye)}}function $(ye){var xe="",Le="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ye=(Math.abs(ye)<<1)+(ye<0?1:0);ye||!xe;){var De=ye&31;ye>>=5,ye&&(De|=32),xe+=Le[De]}return xe}var X=F.url||"",te=F.sourceMaps,W=F.paperFeatures||{},ee=F.source||N,ie=F.offset||0,se=Qe.agent,oe=se.versionNumber,ge=!1,Ie=/\r\n|\n|\r/mg,Ae;if(te&&(se.chrome&&oe>=30||se.webkit&&oe>=537.76||se.firefox&&oe>=23||se.node)){if(se.node)ie-=2;else if(h&&X&&!h.location.href.indexOf(X)){var ze=c.getElementsByTagName("html")[0].innerHTML;ie=ze.substr(0,ze.indexOf(N)+1).match(Ie).length+1}ge=ie>0&&!(se.chrome&&oe>=36||se.safari&&oe>=600||se.firefox&&oe>=40||se.node);var Oe=["AA"+$(ge?0:ie)+"A"];Oe.length=(N.match(Ie)||[]).length+1+(ge?ie:0),Ae={version:3,file:X,names:[],mappings:Oe.join(";AACA"),sourceRoot:"",sources:[X],sourcesContent:[ee]}}return(W.operatorOverloading!==!1||W.moduleExports!==!1)&&G(f(N,{ranges:!0,preserveParens:!0,sourceType:"module"}),null,W),Ae&&(ge&&(N=new Array(ie+1).join(`
`)+N),/^(inline|both)$/.test(te)&&(N+=`
//# sourceMappingURL=data:application/json;base64,`+a.btoa(unescape(encodeURIComponent(JSON.stringify(Ae))))),N+=`
//# sourceURL=`+(X||"paperscript")),{url:X,source:ee,code:N,map:Ae}}function L(N,F,A){Qe=F;var R=F.getView(),w=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(N)&&!/\bnew\s+Tool\b/.test(N)?new xi:null,O=w?w._events:[],q=["onFrame","onResize"].concat(O),H=[],V=[],G,$=typeof N=="object"?N:M(N,A);N=$.code;function X(oe,ge){for(var Ie in oe)(ge||!/^_/.test(Ie))&&new RegExp("([\\b\\s\\W]|^)"+Ie.replace(/\$/g,"\\$")+"\\b").test(N)&&(H.push(Ie),V.push(oe[Ie]))}X({__$__:y,$__:x,paper:F,tool:w},!0),X(F),N="var module = { exports: {} }; "+N;var ie=o.each(q,function(oe){new RegExp("\\s+"+oe+"\\b").test(N)&&(H.push(oe),this.push("module.exports."+oe+" = "+oe+";"))},[]).join(`
`);ie&&(N+=`
`+ie),N+=`
return module.exports;`;var te=Qe.agent;if(c&&(te.chrome||te.firefox&&te.versionNumber<40)){var W=c.createElement("script"),ee=c.head||c.getElementsByTagName("head")[0];te.firefox&&(N=`
`+N),W.appendChild(c.createTextNode("document.__paperscript__ = function("+H+") {"+N+`
}`)),ee.appendChild(W),G=c.__paperscript__,delete c.__paperscript__,ee.removeChild(W)}else G=Function(H,N);var ie=G&&G.apply(F,V),se=ie||{};return o.each(O,function(oe){var ge=se[oe];ge&&(w[oe]=ge)}),R&&(se.onResize&&R.setOnResize(se.onResize),R.emit("resize",{size:R.size,delta:new z}),se.onFrame&&R.setOnFrame(se.onFrame),R.requestUpdate()),ie}function E(N){if(/^text\/(?:x-|)paperscript$/.test(N.type)&&_.getAttribute(N,"ignore")!=="true"){var F=_.getAttribute(N,"canvas"),A=c.getElementById(F),R=N.src||N.getAttribute("data-src"),w=_.hasAttribute(N,"async"),O="data-paper-scope";if(!A)throw new Error('Unable to find canvas with id "'+F+'"');var q=_.get(A.getAttribute(O))||new _().setup(A);return A.setAttribute(O,q._id),R?Vi.request({url:R,async:w,mimeType:"text/plain",onLoad:function(H){L(H,q,R)}}):L(N.innerHTML,q,N.baseURI),N.setAttribute("data-paper-ignore","true"),q}}function k(){o.each(c&&c.getElementsByTagName("script"),E)}function U(N){return N?E(N):k()}return h&&(c.readyState==="complete"?setTimeout(k):ut.add(h,{load:k})),{compile:M,execute:L,load:U,parse:f,calculateBinary:y,calculateUnary:x}}).call(this);var Qe=new(_.inject(o.exports,{Base:o,Numerical:P,Key:bi,DomEvent:ut,DomElement:at,document:c,window:h,Symbol:Ce,PlacedSymbol:be}));return Qe.agent.node&&Xs(Qe),typeof s=="function"&&s.amd?s("paper",Qe):u&&(u.exports=Qe),Qe}).call(kl,typeof self=="object"?self:null)})(Jn)),Jn.exports}var Al=El();const Fe=Jr(Al);function Tl(u){const a=[];if(u.segments.length===0)return a;const s=u.segments[0],h={type:"move",p:[s.point.x,s.point.y]};a.push(h);for(let c=1;c<u.segments.length;c++){const o=u.segments[c-1],d=u.segments[c];if(o.handleOut&&o.handleOut.length>0||d.handleIn&&d.handleIn.length>0){const b=o.handleOut?[o.point.x+o.handleOut.x,o.point.y+o.handleOut.y]:[o.point.x,o.point.y],C=d.handleIn?[d.point.x+d.handleIn.x,d.point.y+d.handleIn.y]:[d.point.x,d.point.y],S={type:"bezier",p1:b,p2:C,p3:[d.point.x,d.point.y]};a.push(S)}else{const b={type:"line",p:[d.point.x,d.point.y]};a.push(b)}}return a}function Yr(u){const a=new Fe.Path;if(u.length===0)return a;let s=null;for(const h of u)switch(h.type){case"move":{const[c,o]=h.p;s=new Fe.Point(c,o),a.moveTo(s);break}case"line":{const[c,o]=h.p;s=new Fe.Point(c,o),a.lineTo(s);break}case"bezier":{if(!s){console.warn("paperUtils: CurveTo command without a current point, skipping");break}const[c,o]=h.p1,[d,_]=h.p2,[b,C]=h.p3,S=new Fe.Point(b,C),P=new Fe.Point(c,o),D=new Fe.Point(d,_);a.add(S);const z=a.lastSegment,J=D.subtract(S);if(z.handleIn=J,a.segments.length>=2){const j=P.subtract(s);a.segments[a.segments.length-2].handleOut=j}s=S;break}case"arc":console.warn("paperUtils: Arc commands not yet supported, skipping arc command");break}return a}function Ml(u,a){const s=new Fe.Group,h=Yr(u.borderPath);h.strokeColor=new Fe.Color(a),h.strokeWidth=1,h.data.isBorder=!0,s.addChild(h);for(const c of u.pieces.values()){const o=zl(c,u);o.strokeColor=new Fe.Color(a),o.strokeWidth=1,o.data.pieceId=c.id,s.addChild(o)}return s}function zl(u,a){const s=new Fe.Path;let h=a.halfEdges.get(u.halfEdge);if(!h)return s;const c=h.id;s.moveTo(new Fe.Point(h.origin[0],h.origin[1]));do{if(h.segments)for(const o of h.segments)Ll(s,o);else{const o=a.halfEdges.get(h.next);s.lineTo(new Fe.Point(o.origin[0],o.origin[1]))}h=a.halfEdges.get(h.next)}while(h.id!==c);return s}function Ll(u,a){switch(a.type){case"line":{u.lineTo(new Fe.Point(a.p[0],a.p[1]));break}case"bezier":{u.cubicCurveTo(new Fe.Point(a.p1[0],a.p1[1]),new Fe.Point(a.p2[0],a.p2[1]),new Fe.Point(a.p3[0],a.p3[1]));break}}}function Nl(u,a,s){if(a.removeChildren(),!!s)for(const h of u.pieces.values()){const[c,o]=h.site,d=new Fe.Path.Circle(new Fe.Point(c,o),3);d.fillColor=new Fe.Color(s),d.data.pieceId=h.id,a.addChild(d)}}function Ol(u,a){if(a.removeChildren(),!(!u.problems||u.problems.length===0))for(const s of u.problems){const[h,c]=s,o=new Fe.Path.Circle(new Fe.Point(h,c),8);o.strokeColor=new Fe.Color("red"),o.strokeWidth=2,a.addChild(o)}}function Rl(u,a,s){Fe.setup(u),Fe.view.viewSize=new Fe.Size(a,s)}function ar(u,a,s,h){_a("Paper.js Rendering",()=>{u.paperPath&&(u.paperPath.remove(),u.paperPath=null),u.paperPath=Ml(a,s),Vl(a,u),u.seedPointItems&&Nl(a,u.seedPointItems,h),u.problemItems&&Ol(a,u.problemItems)})}function Dl(u){u.seedPointItems=new Fe.Group,u.problemItems=new Fe.Group,u.vertexItems=new Fe.Group}function qa(u){const a=new Set;for(const s of u.halfEdges.values())if(s.twin===-1){const h=u.vertices.findIndex(c=>c[0]===s.origin[0]&&c[1]===s.origin[1]);h>=0&&a.add(h)}return a}function Vl(u,a){if(!a.vertexItems)return;a.vertexItems.removeChildren();const s=qa(u);for(let h=0;h<u.vertices.length;h++){if(s.has(h))continue;const[c,o]=u.vertices[h],d=new Fe.Path.Circle(new Fe.Point(c,o),4);d.fillColor=new Fe.Color("#4363d8"),d.strokeColor=new Fe.Color("#ffffff"),d.strokeWidth=1,d.visible=!1,d.data.vertexId=h,a.vertexItems.addChild(d)}}function Fl(u){u.paperPath&&(u.paperPath.remove(),u.paperPath=null),u.seedPointItems&&(u.seedPointItems.remove(),u.seedPointItems=null),u.problemItems&&(u.problemItems.remove(),u.problemItems=null),u.vertexItems&&(u.vertexItems.remove(),u.vertexItems=null),Fe.project&&Fe.project.remove()}function er(u,a){for(const s of u.children)if(s.data.vertexId===a)return s;return null}function dr(u,a){const s=a.getBoundingClientRect();let h,c;if(u instanceof TouchEvent){if(u.changedTouches.length===0)return null;const d=u.changedTouches[0];h=d.clientX,c=d.clientY}else h=u.clientX,c=u.clientY;const o=new Fe.Point(h-s.left,c-s.top);return Fe.view.viewToProject(o)}function or(u){return[u.x,u.y]}function Js(u,a,s,h){const c=[...u.puzzle.seedPoints];let o=0;for(const d of u.puzzle.pieces.values()){if(d.id===s){c[o]=h;break}o++}Ri({bounds:{width:u.puzzle.width,height:u.puzzle.height},border:u.puzzle.borderPath,pieceSize:u.puzzle.pieceSize,pointConfig:u.puzzle.pointConfig,pieceConfig:u.puzzle.pieceConfig,placementConfig:u.puzzle.placementConfig,tabConfig:u.puzzle.tabConfig,seed:u.puzzle.seed,seedPoints:c,skipTabs:!0}).then(d=>{a.draggedSeedPointId===s&&ar(a,d,u.color,u.pointColor)}).catch(d=>{console.error("Failed to regenerate preview:",d)})}function Bl(u,a,s){if(u.redraw=!1,s.isDragging||!s.canvas)return;const h=dr(u,s.canvas);if(!h)return;let c=!1;const o=or(h);if(s.vertexItems){let d=-1,_=bl;const b=qa(a.puzzle);for(let C=0;C<a.puzzle.vertices.length;C++){if(b.has(C))continue;const S=kn(a.puzzle.vertices[C],o);S<_&&(_=S,d=C)}if(d>=0){if(s.hoveredVertexId!==d){if(s.hoveredVertexId>=0){const S=er(s.vertexItems,s.hoveredVertexId);S&&(S.visible=!1)}const C=er(s.vertexItems,d);C&&(C.visible=!0,s.hoveredVertexId=d)}c=!0}else if(s.hoveredVertexId>=0){const C=er(s.vertexItems,s.hoveredVertexId);C&&(C.visible=!1,s.hoveredVertexId=-1)}}a.pointColor&&s.seedPointItems&&s.seedPointItems.hitTest(h,{fill:!0,tolerance:5})&&(c=!0),s.canvas.style.cursor=c?"grab":"default"}function ea(u,a,s){if(u.redraw=!1,!s.canvas)return;if(u instanceof TouchEvent&&u.touches.length>1){s.isDragging=!1,s.draggedVertexId=-1,s.draggedSeedPointId=-1;return}if(u instanceof MouseEvent&&u.button!==0)return;const h=dr(u,s.canvas);if(h){if(a.pointColor&&s.seedPointItems){const c=s.seedPointItems.hitTest(h,{fill:!0,tolerance:5});if(c?.item.data.pieceId!==void 0){s.draggedSeedPointId=c.item.data.pieceId,s.isDragging=!1,u instanceof MouseEvent&&(s.documentMouseMove=o=>{const d=o;d.redraw=!1,ur(d,a,s)},s.documentMouseUp=o=>{const d=o;d.redraw=!1,xn(d,a,s)},document.addEventListener("mousemove",s.documentMouseMove),document.addEventListener("mouseup",s.documentMouseUp));return}}if(s.vertexItems){const c=s.vertexItems.hitTest(h,{fill:!0,tolerance:8});if(c?.item.data.vertexId!==void 0){s.draggedVertexId=c.item.data.vertexId,s.isDragging=!1,u instanceof MouseEvent&&(s.documentMouseMove=o=>{const d=o;d.redraw=!1,ur(d,a,s)},s.documentMouseUp=o=>{const d=o;d.redraw=!1,xn(d,a,s)},document.addEventListener("mousemove",s.documentMouseMove),document.addEventListener("mouseup",s.documentMouseUp));return}}}}function ur(u,a,s){if(u.redraw=!1,!s.canvas)return;const h=dr(u,s.canvas);if(h){if(s.draggedVertexId>=0){s.isDragging=!0,u.preventDefault(),s.canvas.style.cursor="grabbing";const c=or(h);if(Ca(a.puzzle,s.draggedVertexId,c),s.vertexItems){const o=er(s.vertexItems,s.draggedVertexId);o&&(o.position=h)}ar(s,a.puzzle,a.color,a.pointColor);return}if(s.draggedSeedPointId>=0){s.isDragging=!0,u.preventDefault(),s.canvas.style.cursor="grabbing";const c=or(h),o=performance.now();if(o-s.lastRegenerationTime<$s){s.pendingRegeneration&&clearTimeout(s.pendingRegeneration),s.pendingRegeneration=window.setTimeout(()=>{Js(a,s,s.draggedSeedPointId,c)},$s);return}s.lastRegenerationTime=o,Js(a,s,s.draggedSeedPointId,c)}}}function xn(u,a,s){if(u.redraw=!1,!s.canvas)return;s.pendingRegeneration&&(clearTimeout(s.pendingRegeneration),s.pendingRegeneration=null);const h=s.draggedVertexId>=0&&s.isDragging,c=s.draggedSeedPointId>=0&&s.isDragging;if(h&&(u.preventDefault(),a.onPuzzleChanged(a.puzzle)),c){u.preventDefault();const o=s.draggedSeedPointId,d=dr(u,s.canvas);if(d&&a.onSeedPointMoved){const _=or(d);a.onSeedPointMoved(o,_)}}s.documentMouseMove&&(document.removeEventListener("mousemove",s.documentMouseMove),s.documentMouseMove=null),s.documentMouseUp&&(document.removeEventListener("mouseup",s.documentMouseUp),s.documentMouseUp=null),s.isDragging=!1,s.draggedVertexId=-1,s.draggedSeedPointId=-1,s.canvas.style.cursor="default"}const Ul=()=>{const u={canvas:null,isDragging:!1,draggedVertexId:-1,draggedSeedPointId:-1,lastRegenerationTime:0,pendingRegeneration:null,documentMouseMove:null,documentMouseUp:null,paperPath:null,seedPointItems:null,problemItems:null,vertexItems:null,hoveredVertexId:-1};return{oncreate:({dom:a,attrs:s})=>{if(u.canvas=a.querySelector("canvas.puzzle-paper"),!u.canvas){console.error("PuzzlePaper: couldn't get canvas element");return}Rl(u.canvas,s.width,s.height),Dl(u),s.isDirty||ar(u,s.puzzle,s.color,s.pointColor)},onupdate:({attrs:a})=>{if(!u.canvas){console.error("PuzzlePaper: couldn't get canvas element");return}a.isDirty||ar(u,a.puzzle,a.color,a.pointColor)},onremove:()=>{u.documentMouseMove&&(document.removeEventListener("mousemove",u.documentMouseMove),u.documentMouseMove=null),u.documentMouseUp&&(document.removeEventListener("mouseup",u.documentMouseUp),u.documentMouseUp=null),Fl(u)},view:({attrs:a})=>Y(".puzzle-paper-stack",[Y("img.background",{width:a.width,height:a.height,src:a.imageUrl??xl}),Y("canvas.puzzle-paper",{width:a.width,height:a.height,style:{width:`${a.width}px`,height:`${a.height}px`,touchAction:"manipulation"},onmousedown:s=>ea(s,a,u),onmousemove:s=>{Bl(s,a,u),ur(s,a,u)},onmouseup:s=>xn(s,a,u),ontouchstart:s=>ea(s,a,u),ontouchmove:s=>ur(s,a,u),ontouchend:s=>xn(s,a,u),ontouchcancel:s=>xn(s,a,u)})])}};let Qr=!1;const ql=window.matchMedia("(prefers-color-scheme: dark)");ql.matches&&(Qr=!0);const Hl=()=>{const s=hr,h=cr,c=fr,o={seed:new Date().getTime()%10240,canvasWidth:800,canvasHeight:600,aspectRatio:800/600,distance:40,color:Qr?"#DDDDDD":"#333333",drawPoints:!1,pointColor:Qr?"#FF0000":"#0000FF",borderShape:"rectangle",borderCornerRadius:50,geometryProblems:{autoCheck:!1,problems:void 0,progress:void 0},dirty:!0,generators:{point:{label:"Seed Points",registry:vi,name:s,config:vi.getDefaultConfig(s,800,600)},piece:{label:"Piece Generation",registry:Ni,name:h,config:Ni.getDefaultConfig(h,800,600)},placement:{label:"Tab Placement",registry:Oi,name:Xi,config:Oi.getDefaultConfig(Xi,800,600)},tab:{label:"Tabs",registry:oi,name:c,config:oi.getDefaultConfig(c,800,600)}},puzzle:void 0,backgroundImageUrl:void 0,backgroundImageName:""};function d(){const{canvasWidth:b,canvasHeight:C,borderShape:S,borderCornerRadius:P}=o;switch(S){case"rectangle":return Ki(b,C);case"circle":return ba(Math.min(b,C));case"ellipse":return xa(b,C);case"rounded-rect":return wa(b,C,P);default:return Ki(b,C)}}function _(){o.puzzle&&(o.geometryProblems.progress=0,Y.redraw(),Ra(o.puzzle,(b,C)=>{o.geometryProblems.progress=b/C*100,Y.redraw()}).then(b=>{o.geometryProblems.problems=b.length,o.geometryProblems.progress=void 0,o.puzzle&&(o.puzzle.problems=b),Y.redraw()}).catch(b=>{o.geometryProblems.progress=void 0,console.error(b),Y.redraw()}))}return{oncreate:()=>{Ri({bounds:{width:o.canvasWidth,height:o.canvasHeight},border:d(),pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,placementConfig:o.generators.placement.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(b=>{o.puzzle=b,Y.redraw(),o.geometryProblems.autoCheck&&_()}).catch(b=>{console.error(b)})},onupdate:()=>{o.dirty&&(o.dirty=!1,Ri({bounds:{width:o.canvasWidth,height:o.canvasHeight},border:d(),pieceSize:o.distance,pointConfig:o.generators.point.config,pieceConfig:o.generators.piece.config,placementConfig:o.generators.placement.config,tabConfig:o.generators.tab.config,seed:o.seed}).then(b=>{o.geometryProblems.problems=void 0,o.geometryProblems.progress=void 0,o.puzzle=b,Y.redraw(),o.geometryProblems.autoCheck&&_()}).catch(b=>{console.error(b)}))},onremove:()=>{o.backgroundImageUrl&&(URL.revokeObjectURL(o.backgroundImageUrl),o.backgroundImageUrl=void 0)},view:()=>Y(".page",[Y("h1","Puzzle Generator"),Y(".container",[o.puzzle&&Y(".puzzle-stack",[Y(Ul,{width:o.canvasWidth,height:o.canvasHeight,color:o.color,imageUrl:o.backgroundImageUrl,puzzle:o.puzzle,isDirty:o.dirty,pointColor:o.drawPoints?o.pointColor:void 0,onPuzzleChanged:b=>{o.puzzle=b,Y.redraw()},onSeedPointMoved:(b,C)=>{o.dirty=!1,o.puzzle&&ya(o.puzzle,b,C).then(S=>{o.geometryProblems.problems=void 0,o.geometryProblems.progress=void 0,o.puzzle=S,Y.redraw(),o.geometryProblems.autoCheck&&_()}).catch(S=>{console.error("Failed to rebuild puzzle with updated seed point:",S)})}}),Y(".actions",[Y(Sa,{puzzle:o.puzzle,width:o.canvasWidth,height:o.canvasHeight,color:o.color}),Y(Pa,{autoCheck:o.geometryProblems.autoCheck,problems:o.geometryProblems.problems,progressPercent:o.geometryProblems.progress,onCheckRequested:()=>{o.dirty||_(),Y.redraw()},onAutocheckChanged:b=>{b!==o.geometryProblems.autoCheck&&(o.geometryProblems.autoCheck=b,Y.redraw())}})])]),Y(".controls",[Y(".background-image",[Y(Ia,{label:"Background Image",onUpload:(b,C,S,P)=>{o.backgroundImageUrl&&URL.revokeObjectURL(o.backgroundImageUrl),o.canvasWidth=S,o.canvasHeight=P,o.aspectRatio=S/P,o.backgroundImageUrl=b,o.backgroundImageName=C,o.dirty=!0,Y.redraw()},onClear:()=>{o.backgroundImageUrl&&URL.revokeObjectURL(o.backgroundImageUrl),o.backgroundImageUrl=void 0,o.backgroundImageName="",o.dirty=!0,Y.redraw()}})]),Y(Ea,{ratio:o.aspectRatio,disabled:o.backgroundImageUrl!==void 0,onChange:b=>{o.aspectRatio=b,o.canvasWidth=o.canvasHeight*b,o.dirty=!0,Y.redraw()}}),Y(Aa,{shape:o.borderShape,disabled:o.backgroundImageUrl!==void 0,onChange:b=>{o.borderShape=b,o.dirty=!0,Y.redraw()}}),o.borderShape==="rounded-rect"&&Y(Li,{config:{name:"cornerRadius",label:"Corner Radius",type:"number"},value:o.borderCornerRadius,onChange:b=>{o.borderCornerRadius=b??50,o.dirty=!0,Y.redraw()}}),Y(Li,{config:{name:"seed",label:"Seed",type:"number"},value:o.seed,onChange:b=>{o.seed=b??0,o.dirty=!0,Y.redraw()}}),Y(Li,{config:{name:"pieceSize",label:"Piece size",type:"number"},value:o.distance,onChange:b=>{o.distance=b??0,o.dirty=!0,Y.redraw()}}),Y(rr,{label:"Piece color",color:o.color,size:"small",onUpdate:b=>{o.color=b,Y.redraw()}}),Y(".draw-points",[Y(is,{config:{name:"drawPoints",label:"Draw seed points",type:"boolean"},value:o.drawPoints,onChange:b=>{o.drawPoints=b,Y.redraw()}}),o.drawPoints&&Y(rr,{label:"Seed points color",color:o.pointColor,size:"small",onUpdate:b=>{o.pointColor=b,Y.redraw()}})]),...Object.entries(o.generators).map(([b,C])=>Y("label",[C.label+":",Y(ka,{generator:C.name,registry:C.registry,config:C.config,onGeneratorChange:S=>{S!=C.name&&(console.log(`${b} generator changed to ${S}`),C.name=S,o.generators[b].config=C.registry.getDefaultConfig(S,o.canvasWidth,o.canvasHeight),o.dirty=!0,Y.redraw())},onConfigChange:(S,P)=>{console.log(`${b} generator config "${S}" changed to ${String(P)}`),C.config[S]=P,o.dirty=!0,Y.redraw()}})]))])])])}},Ur=10,qr="#2196F3",ta=2,Gl="#999999",jl=1,Wl=[4,4],ia=.5,Zl=.1,$l=10,Hr=1,Kl=.025,Xl=[.25,.5,1,2,4],Yl=["25%","50%","100%","200%","400%"];let wn=null,Cn=null,Sn=null,Pn=null,In=null,zi=null,_n=!1,Ti=null;function Ql(u,a,s){const h=new Fe.Tool;return wn=c=>{c.code==="Space"&&!u.isSpacebarPressed&&(u.isSpacebarPressed=!0,c.preventDefault())},Cn=c=>{c.code==="Space"&&(u.isSpacebarPressed=!1,c.preventDefault())},Sn=c=>{c.preventDefault();const o=-Math.sign(c.deltaY)*Kl,d=Math.max(Zl,Math.min($l,u.zoom+o));if(d!==u.zoom){const _=new Fe.Point(c.offsetX,c.offsetY),b=Fe.view.viewToProject(_),C=d/u.zoom;Fe.view.scale(C,b),u.zoom=d,s()}},Pn=c=>{u.isSpacebarPressed&&(_n=!0,Ti={x:c.clientX,y:c.clientY},c.preventDefault())},In=c=>{if(_n&&Ti){const o=c.clientX-Ti.x,d=c.clientY-Ti.y;Fe.view.translate(new Fe.Point(o,d)),Ti={x:c.clientX,y:c.clientY},c.preventDefault()}},zi=()=>{_n&&(_n=!1,Ti=null)},window.addEventListener("keydown",wn),window.addEventListener("keyup",Cn),u.canvas&&(u.canvas.addEventListener("wheel",Sn,{passive:!1}),u.canvas.addEventListener("mousedown",Pn),u.canvas.addEventListener("mousemove",In),u.canvas.addEventListener("mouseup",zi),u.canvas.addEventListener("mouseleave",zi)),h.onMouseDown=c=>{u.isSpacebarPressed||(u.mode==="draw"?eh(u,c):ih(u,c))},h.onMouseDrag=c=>{u.isSpacebarPressed||(u.mode==="draw"?th(u,c):nh(u,c))},h.onMouseUp=()=>{if(!u.isSpacebarPressed)if(u.mode==="draw"){if(u.pendingPoint&&u.path){if(u.isDraggingCurve&&u.previewPath&&u.previewPath.segments.length>0){const c=u.previewPath.lastSegment,o=new Fe.Segment(u.pendingPoint,c.handleIn,c.handleOut);if(u.path.add(o),u.path.segments.length>1&&u.previewPath.segments.length>1){const d=u.path.segments[u.path.segments.length-2],_=u.previewPath.segments[0];d.handleOut=_.handleOut}}else u.path.add(u.pendingPoint);u.pendingPoint=null,u.isDraggingCurve=!1,u.previewPath&&(u.previewPath.removeSegments(),u.previewPath.visible=!1)}a()}else u.selectedSegment=null,u.selectedHandle=null,a()},h.onMouseMove=c=>{u.mode==="draw"&&!u.isSpacebarPressed&&Ha(u,c.point)},h.activate(),h}function Jl(u){wn&&(window.removeEventListener("keydown",wn),wn=null),Cn&&(window.removeEventListener("keyup",Cn),Cn=null),u&&(Sn&&(u.removeEventListener("wheel",Sn),Sn=null),Pn&&(u.removeEventListener("mousedown",Pn),Pn=null),In&&(u.removeEventListener("mousemove",In),In=null),zi&&(u.removeEventListener("mouseup",zi),u.removeEventListener("mouseleave",zi),zi=null)),_n=!1,Ti=null}function eh(u,a){if(u.path){if(u.path.segments.length>0){const s=u.path.lastSegment;s.handleOut&&s.handleOut.length>0&&(s.handleOut=new Fe.Point(0,0))}u.pendingPoint=a.point.clone(),u.isDraggingCurve=!1,Ha(u,a.point)}}function th(u,a){if(!u.path||!u.previewPath||!u.pendingPoint)return;u.isDraggingCurve=!0;const s=u.pendingPoint,h=a.point.subtract(s),c=h.multiply(ia),o=h.multiply(-ia);let d=new Fe.Point(0,0);if(u.path.segments.length>0){const _=u.path.lastSegment,b=s.subtract(_.point);if(u.path.segments.length>1)if(_.handleIn&&_.handleIn.length>0){const D=_.handleIn.normalize(),z=b.length;d=D.multiply(-z)}else if(u.path.segments.length>1){const D=u.path.segments[u.path.segments.length-2];d=_.point.subtract(D.point).multiply(.33)}else d=b.multiply(.33);u.previewPath.removeSegments();const C=new Fe.Segment(_.point,new Fe.Point(0,0),d);u.previewPath.add(C);const S=new Fe.Segment(s,o,c);u.previewPath.add(S),u.previewPath.visible=!0}else{u.previewPath.removeSegments();const _=new Fe.Segment(s,o,c);u.previewPath.add(_),u.previewPath.visible=!0}}function Ha(u,a){if(!(!u.previewPath||!u.path))if(u.previewPath.removeSegments(),u.path.segments.length>0){const s=u.path.lastSegment.point;u.previewPath.moveTo(s),u.previewPath.lineTo(a),u.previewPath.visible=!0}else u.previewPath.visible=!1}function ih(u,a){if(!u.path)return;if(u.selectedSegment!==null||u.path.fullySelected){const o=u.path.hitTest(a.point,{handles:!0,tolerance:Ur});if(o?.type==="handle-in"||o?.type==="handle-out"){u.selectedHandle={segment:o.segment,type:o.type==="handle-in"?"handleIn":"handleOut"},u.selectedSegment=null;return}}const h=u.path.hitTest(a.point,{segments:!0,tolerance:Ur});if(h?.segment){for(const o of u.path.segments)o.selected=!1;u.selectedSegment=h.segment,u.selectedSegment.selected=!0,u.selectedHandle=null;return}if(u.path.hitTest(a.point,{stroke:!0,tolerance:Ur})){u.path.fullySelected=!0,u.selectedSegment=null,u.selectedHandle=null;return}u.selectedSegment=null,u.selectedHandle=null,u.path.selected=!1,u.path.fullySelected=!1;for(const o of u.path.segments)o.selected=!1}function nh(u,a){if(u.selectedSegment)u.selectedSegment.point=u.selectedSegment.point.add(a.delta);else if(u.selectedHandle){const{segment:s,type:h}=u.selectedHandle,c=a.point.subtract(s.point);h==="handleOut"?s.handleOut=c:s.handleIn=c}}const rh=()=>{const u={canvas:null,path:null,previewPath:null,mode:"draw",selectedSegment:null,selectedHandle:null,zoom:Hr,isSpacebarPressed:!1,pendingPoint:null,isDraggingCurve:!1};let a=null,s;const h=(C,S)=>{Fe.setup(C),u.canvas=C,Fe.view.viewSize=new Fe.Size(S.width,S.height),Fe.settings.handleSize=8;const P=S.initialPath&&S.initialPath.length>0;if(u.mode=P?"edit":"draw",u.path=new Fe.Path,u.path.strokeColor=new Fe.Color(S.strokeColor??qr),u.path.strokeWidth=ta,P&&S.initialPath){const D=Yr(S.initialPath);u.path.segments=D.segments,u.path.strokeColor=new Fe.Color(S.strokeColor??qr),u.path.strokeWidth=ta}u.previewPath=new Fe.Path,u.previewPath.strokeColor=new Fe.Color(Gl),u.previewPath.strokeWidth=jl,u.previewPath.dashArray=Wl,u.previewPath.visible=!1,a=Ql(u,()=>{c(S)},()=>{Y.redraw()})},c=C=>{if(u.path){const S=Tl(u.path);C.onPathChanged(S)}Y.redraw()},o=()=>{u.mode==="draw"&&(u.mode="edit",u.pendingPoint=null,u.isDraggingCurve=!1,u.previewPath&&(u.previewPath.removeSegments(),u.previewPath.visible=!1),Y.redraw())},d=()=>{a&&(a.remove(),a=null),Jl(u.canvas),Fe.project&&Fe.project.remove(),u.canvas=null,u.path=null,u.previewPath=null,u.selectedSegment=null,u.selectedHandle=null},_=C=>{if(C===u.zoom)return;const S=C/u.zoom;Fe.view.scale(S,Fe.view.center),u.zoom=C,Y.redraw()},b=()=>`${Math.round(u.zoom*100)}%`;return{oncreate:({dom:C,attrs:S})=>{const P=C.querySelector("canvas");P&&(h(P,S),s=S.initialPath)},onupdate:({attrs:C})=>{if(!u.path||(C.strokeColor&&(u.path.strokeColor=new Fe.Color(C.strokeColor)),C.initialPath===s))return;const S=s?.length??0,P=C.initialPath?.length??0;if(s=C.initialPath,!(S!==P)&&!(S===0&&P===0))return;if(!(C.initialPath&&C.initialPath.length>0))u.path.removeSegments(),u.mode="draw",u.selectedSegment=null,u.selectedHandle=null,u.pendingPoint=null,u.isDraggingCurve=!1,Y.redraw();else if(C.initialPath){u.path.removeSegments();const j=Yr(C.initialPath);u.path.segments=j.segments,u.path.strokeColor=new Fe.Color(C.strokeColor??qr),u.mode="edit",u.selectedSegment=null,u.selectedHandle=null,u.pendingPoint=null,u.isDraggingCurve=!1,Y.redraw()}},onremove:()=>{d()},view:({attrs:C})=>{const S=b();return Y(".path-editor",[Y("canvas",{style:`width: ${C.width}px; height: ${C.height}px;`}),Y(".path-editor-controls",[Y(".mode-indicator",`Mode: ${u.mode==="draw"?"Drawing":"Editing"}`),u.mode==="draw"&&Y("wa-button.end-drawing-button",{variant:"success",size:"small",onclick:o},"End Drawing"),Y("wa-dropdown.zoom-control",{"onwa-select":P=>{P.redraw=!1;const D=P.detail.item.value;if(D&&typeof D=="string"){const z=parseFloat(D);isNaN(z)||_(z)}}},[Y("wa-button",{slot:"trigger","with-caret":!0,size:"small",value:u.zoom},S),...Xl.map((P,D)=>Y("wa-dropdown-item",{type:"checkbox",checked:u.zoom==P?!0:void 0,value:P.toString()},Yl[D]))]),Y("wa-tooltip",{for:"recenter-button"},"Recenter view"),Y("wa-button#recenter-button",{appearance:"plain",size:"large",onclick:()=>{const P=Hr/u.zoom;Fe.view.scale(P,Fe.view.center),u.zoom=Hr,Fe.view.center=new Fe.Point(Fe.view.viewSize.width/2,Fe.view.viewSize.height/2)}},Y("wa-icon",{library:"material",name:"recenter",label:"Recenter view"}))])])}}},sh=()=>{const u={initialPathToLoad:[],pathCommands:[],pathDataDisplay:"No path data yet"},a=c=>{u.pathCommands=c,u.pathDataDisplay=JSON.stringify(c,null,2)},s=()=>{u.initialPathToLoad=[],u.pathCommands=[],u.pathDataDisplay="No path data yet",Y.redraw()},h=()=>{const c=[{type:"move",p:[100,150]},{type:"line",p:[300,150]},{type:"bezier",p1:[350,180],p2:[350,280],p3:[300,350]},{type:"bezier",p1:[250,380],p2:[150,380],p3:[100,350]},{type:"bezier",p1:[70,300],p2:[70,200],p3:[100,150]}];u.initialPathToLoad=c,u.pathCommands=c,u.pathDataDisplay=JSON.stringify(c,null,2),Y.redraw()};return{view:()=>Y(".page",[Y("h1","Path Editor - Phase 4 Pan and Zoom"),Y("p","Testing the PathEditor component with pan and zoom support."),Y(".test-page",[Y(".test-area",[Y(rh,{width:800,height:600,initialPath:u.initialPathToLoad,onPathChanged:a,strokeColor:"#000000ff"})]),Y(".controls",[Y("h2","Controls"),Y(".button-group",[Y("button",{onclick:s,style:"background: #f44336;"},"Clear Canvas"),Y("button",{onclick:h,style:"background: #4CAF50;"},"Load Sample Path")]),Y(".instructions",[Y("h3",{style:"margin-top: 1rem;"},"Instructions:"),Y("p","The editor has two modes:"),Y("ul",{style:"margin: 0.5rem 0;"},[Y("li",Y("strong","Drawing Mode"),": Click to add points (straight lines), or click-drag to add points with smooth bezier curves"),Y("li","Stay in drawing mode until you click the ",Y("strong","End Drawing")," button"),Y("li",Y("strong","Editing Mode"),":"),Y("ul",{style:"margin-left: 1rem;"},[Y("li","Click anywhere on the path to select it and show all vertices"),Y("li","Click a specific vertex to select it, then drag to move it"),Y("li","Drag curve handles to adjust curve shape"),Y("li","Click empty space to deselect")]),Y("li","The mode indicator below the canvas shows the current mode")]),Y("h3",{style:"margin-top: 1rem;"},"Pan and Zoom:"),Y("ul",{style:"margin: 0.5rem 0;"},[Y("li","Hold ",Y("strong","Spacebar")," and drag to pan the canvas"),Y("li","Use ",Y("strong","mouse wheel")," to zoom in/out (zooms toward cursor position)"),Y("li","Use the ",Y("strong","Zoom dropdown")," to select preset zoom levels (25%, 50%, 100%, 200%, 400%)"),Y("li","Click the ",Y("strong","Recenter button")," to reset view to 100% zoom and center position")])])]),Y(".data-display",[Y("h2","Path Data"),Y("h3","PathCommand[] Format:"),Y("textarea",{readonly:!0,value:u.pathDataDisplay,rows:15,style:"font-family: monospace; font-size: 12px; width: 100%;"})]),Y(".findings",[Y("h2","Implementation Status"),Y("h3",{style:"margin-top: 1rem;"},"Phase 4 - Pan and Zoom:"),Y("ul",[Y("li"," Spacebar + drag to pan"),Y("li"," Mouse wheel to zoom (centered on cursor)"),Y("li"," Zoom dropdown with preset levels"),Y("li"," Recenter button to reset view")])])])])}},ah=Math.sin(Math.PI/3),na=(u,a)=>u<a?`${u}:${a}`:`${a}:${u}`;function oh(u){const{width:a,height:s,pieceSize:h,border:c}=u,o=Math.max(h,4),d=o,_=o*ah,b=d,C=_,S=-b,P=-C,D=Math.ceil((a+b*2)/d),z=Math.ceil((s+C*2)/_),J=[],j=new Map;for(let fe=0;fe<=z;fe+=1){const ae=P+fe*_,I=fe%2===0?0:d/2;for(let le=0;le<=D;le+=1){const de=[S+le*d+I,ae],Pe=ri(de,c),be=J.length;J.push({id:be,row:fe,column:le,position:de,insideBoundary:Pe}),j.set(`${fe}:${le}`,be)}}const re=[],K=new Map,ce=(fe,ae,I)=>{const le=j.get(`${fe[0]}:${fe[1]}`),_e=j.get(`${ae[0]}:${ae[1]}`),de=j.get(`${I[0]}:${I[1]}`);if(le===void 0||_e===void 0||de===void 0)return;const Pe=J[le].position,be=J[_e].position,Ce=J[de].position,ke=[(Pe[0]+be[0]+Ce[0])/3,(Pe[1]+be[1]+Ce[1])/3],we=re.length;re.push({id:we,vertices:[le,_e,de],centroid:ke,neighbors:[],insideBoundary:ri(ke,c)});const Ue=[[le,_e],[_e,de],[de,le]];for(const pe of Ue){const He=na(pe[0],pe[1]),et=K.get(He);et?et.triangles.push(we):K.set(He,{vertices:pe,triangles:[we]})}};for(let fe=0;fe<z;fe+=1){const ae=fe%2===0;for(let I=0;I<D;I+=1)ae?(ce([fe,I],[fe,I+1],[fe+1,I]),ce([fe,I+1],[fe+1,I+1],[fe+1,I])):(ce([fe,I],[fe+1,I+1],[fe+1,I]),ce([fe,I],[fe,I+1],[fe+1,I+1]))}const ue=[];K.forEach(fe=>{const ae=ue.length,I=fe.triangles.length<2||fe.triangles.some(le=>!re[le].insideBoundary);ue.push({id:ae,vertices:fe.vertices,triangles:fe.triangles.slice(),touchesBoundary:I})});for(const fe of re){const ae=new Set,I=fe.vertices;for(let le=0;le<I.length;le+=1){const _e=I[le],de=I[(le+1)%I.length],Pe=na(_e,de),be=K.get(Pe);if(be)for(const Ce of be.triangles)Ce!==fe.id&&ae.add(Ce)}fe.neighbors=Array.from(ae).sort((le,_e)=>le-_e)}return{vertices:J,edges:ue,triangles:re,horizontalSpacing:d,verticalSpacing:_,rowCount:z+1,columnCount:D+1}}const uh=u=>Number.isNaN(u)||!Number.isFinite(u)||u<=0?0:u>=1?1:u,lh=(u,a)=>{for(let s=u.length-1;s>0;s-=1){const h=Math.floor(a()*(s+1)),c=u[s];u[s]=u[h],u[h]=c}};function hh(u){const{lattice:a,random:s}=u,h=uh(u.mergeChance),c=new Array(a.triangles.length).fill(-1),o=[];for(const b of a.triangles){if(!b.insideBoundary||c[b.id]!==-1)continue;const C=o.length,S=[b.id];c[b.id]=C;const P=[];for(;S.length>0;){const D=S.pop();P.push(D);const z=a.triangles[D].neighbors.filter(J=>a.triangles[J]?.insideBoundary);lh(z,s);for(const J of z)c[J]===-1&&s()<=h&&(c[J]=C,S.push(J))}P.sort((D,z)=>D-z),o.push(P)}const d=o.map((b,C)=>({id:C,triangleIds:b,edgeIds:[]})),_=a.edges.map(()=>[]);return a.edges.forEach(b=>{const C=new Set;for(const P of b.triangles){const D=c[P];D!==void 0&&D!==-1&&C.add(D)}const S=Array.from(C).sort((P,D)=>P-D);_[b.id]=S;for(const P of S){const D=d[P];D&&D.edgeIds.push(b.id)}}),d.forEach(b=>{b.edgeIds.sort((C,S)=>C-S)}),{clusters:d,triangleToCluster:c,edgeToClusters:_}}const Yn=["#ff6b6b","#4dabf7","#51cf66","#845ef7"],ra=["#f6bd60","#f28482","#84a59d","#f5cac3","#82c0cc","#90be6d","#ffafcc","#cdb4db"],ch=()=>{const u={width:900,height:600,pieceSize:120,mergeProbability:45,seed:1,border:Ki(900,600),lattice:null,clustering:null},a=()=>{const h=ts(u.seed),c=oh({width:u.width,height:u.height,pieceSize:u.pieceSize,border:u.border});u.lattice=c,u.clustering=hh({lattice:c,mergeChance:u.mergeProbability/100,random:h})},s=h=>c=>{const o=c.target,d=Number(o.value);u[h]=Number.isFinite(d)?d:u[h],h==="seed"&&(u[h]=Math.max(0,Math.round(u[h]))),h==="mergeProbability"&&(u[h]=Math.min(100,Math.max(0,Math.round(u[h])))),a()};return{oninit:a,view:()=>{u.lattice||a();const h=u.lattice,c=u.clustering,o=h.triangles.filter(D=>D.insideBoundary).length,d=h.vertices.filter(D=>D.insideBoundary).length,_=h.edges.filter(D=>D.touchesBoundary).length,b=c?c.clusters.length:0,C=c?c.clusters.map(D=>D.triangleIds.length):[],S=C.length>0?C.reduce((D,z)=>D+z,0)/C.length:0,P=C.length>0?Math.max(...C):0;return Y(".townscaper-debug-page",[Y("h1","Townscaper Lattice Debug"),Y("p.description",["Phase 2 visualizer for the Townscaper-inspired generator. Adjust the sliders to explore seeded lattice construction, clustering probability, and the resulting Townscaper-style blocks."]),Y(".townscaper-debug-layout",[Y(".townscaper-debug-controls",[Y("wa-slider",{label:"Nominal Piece Size",min:60,max:200,step:5,value:u.pieceSize,"with-tooltip":!0,onchange:s("pieceSize")}),Y("wa-slider",{label:"Seed",min:0,max:999,step:1,value:u.seed,"with-tooltip":!0,onchange:s("seed")}),Y("wa-slider",{label:"Merge Probability (%)",min:0,max:100,step:1,value:u.mergeProbability,"with-tooltip":!0,onchange:s("mergeProbability")}),Y(".metrics",[Y("div",[Y("span.label","Vertices in border"),Y("span.value",`${d} / ${h.vertices.length}`)]),Y("div",[Y("span.label","Triangles in border"),Y("span.value",`${o} / ${h.triangles.length}`)]),Y("div",[Y("span.label","Boundary edges"),Y("span.value",`${_}`)]),Y("div",[Y("span.label","Clusters"),Y("span.value",`${b}`)]),Y("div",[Y("span.label","Avg cluster size"),Y("span.value",C.length>0?S.toFixed(2):"0")]),Y("div",[Y("span.label","Largest cluster (triangles)"),Y("span.value",`${P}`)])])]),Y(".townscaper-debug-preview",[Y("svg",{viewBox:`0 0 ${u.width} ${u.height}`,width:"100%",height:"100%",preserveAspectRatio:"xMidYMid meet"},[Y("rect",{x:0,y:0,width:u.width,height:u.height,fill:"none",stroke:"#9e9e9e","stroke-width":1}),c?c.triangleToCluster.flatMap((D,z)=>{if(D===-1)return[];const J=h.triangles[z];if(!J?.insideBoundary)return[];const j=J.vertices.map(K=>h.vertices[K]?.position);if(j.some(K=>!K))return[];const re=ra[D%ra.length];return Y("polygon",{points:j.map(K=>`${K[0]},${K[1]}`).join(" "),fill:re,opacity:.45,stroke:re,"stroke-width":.5})}):null,h.edges.map(D=>{const z=h.vertices[D.vertices[0]].position,J=h.vertices[D.vertices[1]].position;return Y("line",{x1:z[0],y1:z[1],x2:J[0],y2:J[1],stroke:D.touchesBoundary?"#ff922b":"#2f9e44","stroke-width":D.touchesBoundary?2:1,"stroke-linecap":"round",opacity:D.touchesBoundary?.85:.4})}),h.vertices.map(D=>{const[z,J]=D.position,j=Yn[(D.row%Yn.length+Yn.length)%Yn.length];return Y("circle",{cx:z,cy:J,r:D.insideBoundary?3:2,fill:j,opacity:D.insideBoundary?.9:.3})})])])])])}}};function fh(){const u=window.matchMedia("(prefers-color-scheme: dark)");function a(){u.matches?document.documentElement.classList.add("wa-dark"):document.documentElement.classList.remove("wa-dark")}a(),u.addEventListener("change",a)}fh();const Qn={view:u=>[Y(vo,{link:"https://github.com/weevilgenius/puzzle-generator"}),Y(_o),u.children]};mo("material",{resolver:u=>{const a=u.match(/^(.*?)(_(rounded|sharp))?$/);return a?`https://cdn.jsdelivr.net/npm/@material-symbols/svg-400@0.32.0/${a[3]??"outlined"}/${a[1]}.svg`:""},mutator:u=>u.setAttribute("fill","currentColor")});Y.route(document.body,"/puzzle",{"/puzzle":{render:()=>Y(Qn,Y(yl))},"/puzzle-paper":{render:()=>Y(Qn,Y(Hl))},"/test":{render:()=>Y(Qn,Y(sh))},"/townscaper-debug":{render:()=>Y(Qn,Y(ch))}});
//# sourceMappingURL=index-8Pq4fCaw.js.map
